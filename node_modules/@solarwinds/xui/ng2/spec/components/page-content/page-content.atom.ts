import { Atom } from "@solarwinds/uzi";
import { by, element, browser, ElementFinder, promise } from "@solarwinds/uzi/protractor";
import { BusyAtom, IconAtom } from "../index.atom";

export class PageContentAtom extends Atom {
    public static CSS_CLASS = "xui-page-content";

    public getBreadcrumbsText = (): promise.Promise<string> => {
        return super.getElement().element(by.className("xui-page-breadcrumbs")).getText();
    };

    public getTitle = (): promise.Promise<string> => {
        return this.getHeader().element(by.css(".xui-page-content__header-title")).getText();
    };

    public isIconDisplayed = (iconName: string): promise.Promise<boolean> => {
        let iconAtom: IconAtom = Atom.findIn(IconAtom, element(by.css(".xui-page-content__header-link-item")));
        return iconAtom.getName().then((val) => { return val === iconName; });
    };

    public getLink = (): ElementFinder => {
        return super.getElement().all(by.css(".xui-page-content__header-link a")).get(0);
    };

    public getLinkText = (): promise.Promise<string> => {
        return this.getLink().getText();
    };

    public getLinkUrl = (): promise.Promise<string> => {
        return this.getLink().getAttribute("href");
    };

    public getLinkTarget = (): promise.Promise<string> => {
        return this.getLink().getAttribute("target");
    };

    public isBusyIndicatorDisplayed = (): promise.Promise<boolean> => {
        let busyAtom: BusyAtom = Atom.findIn(BusyAtom, super.getElement());
        return busyAtom.isDisplayed();
    };

    public getBusyMessage = (): promise.Promise<string>  => {
        const busy = Atom.findIn(BusyAtom, super.getElement());
        return busy.getProgress().getMessage();
    };

    public getHeader = (): ElementFinder => {
        return super.getElement().element(by.css("[xui-page-content__header]"));
    };

    public isDefaultHeader = (): promise.Promise<boolean> => {
        return this.getHeader()
            .element(by.className("xui-page-content__header"))
            .isPresent();
    };

    public getFooter = (): ElementFinder => {
        return super.getElement().element(by.css("[xui-page-content__footer]"));
    };

    public getBody = (): ElementFinder => {
        return super.getElement().element(by.className("xui-page-content__body"));
    };
}
