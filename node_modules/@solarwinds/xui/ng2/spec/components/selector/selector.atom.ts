import { by, ElementFinder } from "@solarwinds/uzi/protractor";
import { Atom } from "@solarwinds/uzi";
import { CheckboxAtom } from "../index.atom";

export class SelectorAtom extends Atom {

    public static CSS_CLASS = "xui-selector";

    public async select(selectionType: "All" | "None" | "All pages"): Promise<void> {
        if (!(await this.isOpened())) {
            this.getToggle().click();
        }

        return this.getPopupArea()
            .element(by.xpath(`//*[@class="xui-list-item__content"]/span[text()="${selectionType}"]`))
            .click();
    }

    public getCheckbox(elementId: string): CheckboxAtom {
        return Atom.find(CheckboxAtom, elementId);
    }

    private getToggle(): ElementFinder {
        return this.getElement().element(by.css(".xui-selector__toggle"));
    }

    private getPopupArea(): ElementFinder {
        return this.getElement().element(by.css(".xui-popup__area"));
    }

    private async isOpened(): Promise<boolean> {
        return this.getPopupArea().isDisplayed();
    }

}
