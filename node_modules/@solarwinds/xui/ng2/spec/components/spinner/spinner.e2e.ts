import {browser, by, element, ElementFinder, promise} from "@solarwinds/uzi/protractor";
import Helpers from "../helpers";
import {SpinnerAtom} from "../index.atom";
import {Atom} from "@solarwinds/uzi";

describe("USERCONTROL Spinner", () => {
    let spinner: SpinnerAtom;
    let spinnerButton: ElementFinder;

    beforeEach(() => {
        Helpers.prepareBrowser("spinner");
        spinner = Atom.find(SpinnerAtom, "spinner1");
        spinnerButton = element(by.css("[id*='spinnerButton1']"));
    });

    it("will show/hide based on property", () => {
        expect(spinner.isDisplayed()).toBe(false);
        spinnerButton.click();
        browser.sleep(1000);
        expect(spinner.isDisplayed()).toBe(true);
        spinnerButton.click();
        browser.wait(spinner.waitForHidden(), 3000);
        expect(spinner.isDisplayed()).toBe(false);
    });

    it("should have 'small' default size if no 'size' input provided", () => {
        spinnerButton.click();
        browser.sleep(1000);
        expect(spinner.hasClass("xui-spinner-small")).toBe(true);
    });

    it("will respect size", () => {
        spinnerButton.click();
        browser.sleep(1000);
        let width = 4;
        let height = 4;
        spinner.getSize().then((size: any)=> {
            width = size.width;
            height = size.height;
            expect(width).toBe(20);
            expect(height).toBe(20);
        });
    });

    it("will wait for display", () => {
        browser.ignoreSynchronization = true;
        //if you do not ignore sync, this promise will wait until the
        // timeout has been evaluated, which not what we are testing
        spinnerButton.click();
        expect(spinner.isDisplayed()).toBe(false);
        browser.sleep(1000);
        browser.ignoreSynchronization = false;
        browser.wait(spinner.isDisplayed(), 4000); //wait up to 4 seconds
        expect(spinner.isDisplayed()).toBe(true);
    });
});
