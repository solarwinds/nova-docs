import { Injectable } from "@angular/core";
import { Subject, Subscription } from "rxjs/Rx";

type NotificationHandler = (args:any) => void;

export interface INotificationService {
    subscribe(channel: string, handler: NotificationHandler): Subscription;
    post(channel: string, args: any): void;
}

@Injectable()
/**
 * @ngdoc service
 *
 * @name xui.services:xuiNotificationService
 *
 * @description
 * Service that provides generic notifications to consumers that subscribe.
 */
export class NotificationService implements INotificationService {
    private channels: {[channelId: string]: Subject<any>} = {};

   private ensureChannel(channelId: string): Subject<any> {
        return this.channels[channelId] || (this.channels[channelId] = new Subject<any>());
    }

   public subscribe(channelId: string, action: NotificationHandler): Subscription {
        const channel = this.ensureChannel(channelId);
        return channel.subscribe(action);
    }

   public post(channelId: string, args: any): void {
        const channel = this.channels[channelId];
        if (!channel) {
            console.warn(`post on nonexistent channel #${channelId}`);
            return;
        }
        channel.next(args);
    }
}

export default NotificationService;
