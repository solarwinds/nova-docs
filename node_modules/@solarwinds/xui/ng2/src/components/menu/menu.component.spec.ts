import { IMenuItem } from "./menu-item";
import { ComponentFixture, TestBed } from "@angular/core/testing";
import { Component, DebugElement } from "@angular/core";
import { Logger } from "angular2-logger/app/core/logger";
import { By } from "@angular/platform-browser";
import { EdgeDetectionService } from "../../index";
import { MenuComponent,
         MenuActionComponent,
         MenuHeaderComponent,
         MenuLinkComponent,
         MenuOptionComponent,
         PopupComponent,
         CheckboxComponent,
         HelpHintComponent,
         ButtonComponent,
         IconComponent
} from "../index";
import { IconService } from "../../services/icon.service";
import initTestSuite from "../../spec-init";

initTestSuite(TestBed);

@Component({
    selector: "test-app",
    template: `
    <html>
    <body>
   <xui-menu
        [title]="title"
        [size]="size"
        [icon]="icon"
        [itemsSource]="itemsSource">
    </xui-menu>
    </body>
    </html>
    `
})
class TestApp {
    public size: string = "small";
    public icon: string = "add";
    public title: string = "menu filled by json data";
    public itemsSource = [
        {
            itemType: "link",
            title: "Disabled link",
            disabled: true
        },
        {
            itemType: "header",
            title: "Actions:"
        },
        {
            itemType: "action",
            title: "Action",
            disabled: false
        }] as IMenuItem[];

}

describe("components >", () => {
    let fixture: ComponentFixture<TestApp>;
    let testComponent: TestApp;
    let de: DebugElement;
    let el: HTMLElement;

    describe("menu >", () => {
        beforeEach(() => {
            TestBed.configureTestingModule({
                declarations: [TestApp,
                    MenuComponent,
                    MenuActionComponent,
                    MenuHeaderComponent,
                    MenuLinkComponent,
                    MenuOptionComponent,
                    ButtonComponent,
                    PopupComponent,
                    CheckboxComponent,
                    HelpHintComponent,
                    IconComponent],
                providers: [
                    IconService,
                    EdgeDetectionService,
                    Logger
                ]
            });
            fixture = TestBed.createComponent(TestApp);
            fixture.detectChanges();
            testComponent = fixture.componentInstance;
            de = fixture.debugElement.query(By.css("xui-menu"));
            el = de.nativeElement;
        });

        it("should contain menu-link in menu filled by json data", () => {
            fixture.detectChanges();
            let linkMenu = el.querySelectorAll("xui-menu-link");
            expect(linkMenu.length).toBe(1);
        });

        it("should contain menu-header in menu filled by json data", () => {
            fixture.detectChanges();
            let headerMenu = el.querySelectorAll("xui-menu-header");
            expect(headerMenu.length).toBe(1);
        });

        it("should contain menu-action in menu filled by json data", () => {
            fixture.detectChanges();
            let actionMenu = el.querySelectorAll("xui-menu-action");
            expect(actionMenu.length).toBe(1);
        });
    });
});
