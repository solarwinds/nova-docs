import { CUSTOM_ELEMENTS_SCHEMA } from "@angular/core";
import { ComponentFixture, TestBed } from "@angular/core/testing";
import { By } from "@angular/platform-browser";
import initTestSuite from "../../spec-init";

import { BusyComponent } from "./busy.component";
import { ProgressComponent } from "../progress/progress.component";

initTestSuite(TestBed);

const xuiProgressShownClass = "xui-progress--shown";

describe("components >", () => {
    describe("busy >", () => {
        let fixture: ComponentFixture<BusyComponent>;
        let subject: BusyComponent;
        let progress: ProgressComponent;

        beforeEach(() => {
            TestBed.configureTestingModule({
                declarations: [BusyComponent, ProgressComponent],
                schemas: [CUSTOM_ELEMENTS_SCHEMA]
            });

            fixture = TestBed.createComponent(BusyComponent);
            subject = fixture.componentInstance;
            progress = fixture.debugElement.query(By.css("xui-progress")).injector.get(ProgressComponent);
        });

        it("should be busy", () => {
            subject.busy = true;

            fixture.detectChanges();

            expect(progress.show).toBeTruthy();
        });

        it(`should have ${xuiProgressShownClass}`, () => {
            subject.busy = true;

            fixture.detectChanges();

            let progressBar = fixture.debugElement.query(By.css(".xui-progress"));
            expect(progressBar.classes[xuiProgressShownClass]).toBeTruthy();
        });
    });
});
