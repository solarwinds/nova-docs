"use strict";

const gulp = require("gulp");
const path = require("path");
const fs = require("fs");

gulp.task("dist:icons", () => {
    const iconsJsonPath = path.resolve(process.cwd(), "../data/icons.json");
    const icons = require(iconsJsonPath);

    // array of non-status icon names
    const iconNames = icons.filter(icon => icon.name.indexOf("status_") < 0).map((icon) => `"${icon.name}"`);
    const iconNamesJoined = iconNames.join(" | ");

    // array of status icon names (used in xuiIcon.status property)
    const statusNames = icons.filter(icon => icon.name.indexOf("status_") === 0).map((icon) => `"${icon.name.substring(7)}"`);
    const statusNamesJoined = statusNames.join(" | ");
    
    const iconsTypingsPath = path.resolve(process.cwd(), "typings/solarwinds-xui/icons.d.ts");
    const content = 
`declare namespace xui {
/**
 * Available icon names
 */
type IconName = ${iconNamesJoined};

/**
 * Available icon status names
 */
type IconStatusName = ${statusNamesJoined};
}`;

    fs.writeFile(iconsTypingsPath, content, (err) => {
        if (err) {
            return console.log(err);
        }
    });
});
