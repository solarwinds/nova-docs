Xui.directive('example', function($compile) {

    function link(scope, element, attrs) {
        Prism.highlightAll(); // TODO
    }

    /**
     * This utility function can be used for counting watches on components.
     */
    function calculateWatches(id) {
        var root = $("#" + id);
        var watchers = [];

        var f = function (element) {
            angular.forEach(['$scope', '$isolateScope'], function (scopeProperty) {
                if (element.data() && element.data().hasOwnProperty(scopeProperty)) {
                    angular.forEach(element.data()[scopeProperty].$$watchers, function (watcher) {
                        watchers.push(watcher);
                    });
                }
            });

            angular.forEach(element.children(), function (childElement) {
                f(angular.element(childElement));
            });
        };

        f(root);

        return _.uniq(watchers).length;
    }

    function controller() {
        var vm = this;
        vm.showCode = false;
        vm.showWatches = false;
        vm.calculateWatches = calculateWatches;
    }

    return {
        restrict: 'E',
        templateUrl: 'src/templates/example/example.html',
        replace: true,
        transclude: true,
        priority: 1,
        scope: {
            title: '@',
            id: '@'
        },
        link: link,
        controller: controller,
        controllerAs: 'ctrl'
    };
});
