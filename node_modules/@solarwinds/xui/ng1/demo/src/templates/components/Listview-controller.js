(function() {
    "use strict";

    Xui.module.controller("DemoListViewController",
        controller, ["xuiToastService", "$interval", "$timeout"]);

    function controller(toastr, $interval, $timeout) {
        var vm = this;

        vm.items = [];
        vm.items2 = [];
        vm.noTemplateItems = [];
        for (var i = 0; i < 10; i++) {
            vm.items.push({
                name: "item_" + i,
                value: "Item " + i,
                $templateUrl: "demo-listview-item-template-1"
            });
            vm.items2.push({
                id: i,
                name: "item_" + i,
                value: "Item " + i,
                type: i % 2 === 0 ? "1" : "2",
                templateUrl: (i === 5 ? "demo-listview-item-template-3" : null)
            });
            vm.noTemplateItems.push({
                id: i,
                name: "item_" + i
            });
        }

        vm.people = [
            {name: "Jo Smith", level: "bronze", status:"active"},
            {name: "Claire Rogan", level: "gold", status:"active"},
            {name: "Declan McGregor", level: "platinum", status:"active"},
            {name: "Fergus O'Brien", level: "bronze", status:"inactive"},
            {name: "Catriona Kildare", level: "gold", status:"active"}
        ];
        vm.isLoadingPeople = true;

        vm.peopleSelection = vm.people[2];

        vm.highlightStatus = "success";
        vm.highlightedIndex1 = 2;
        vm.highlightedIndex2 = 6;
        vm.highlightItems = function() {
            const msg = "Items 2 & 6 highlighted. Hover on me and see what happens...";
            const title = "Listview Toast Highlights!";
            const itemsToHighlight = [vm.items[vm.highlightedIndex1], vm.items[vm.highlightedIndex2]];
            if (vm.highlightStatus === "success") {
                toastr.success(msg, title, {}, itemsToHighlight);
            } else {  toastr.info(msg, title, {}, itemsToHighlight); }
        };

        vm.getTemplate = function(item) {
            if (item.id === 5) {
                return null;
            }
            return "demo-listview-item-template-" + item.type;
        };

        vm.getNumber = function() {
            return 3;
        };

        vm.makeBusy = function() {
            vm.isLoadingPeople = true;
            $timeout(function() {
                vm.isLoadingPeople = false;
            }, 3000);
        };

        activate();

        //#region Internal Methods

        function activate() {
            var newPeople = [
                {name: "Kester Cockburn", level: "bronze", status:"active"},
                {name: "Bhaltair McCrae", level: "bronze", status:"active"},
                {name: "Ross McAdams", level: "platinum", status:"active"},
                {name: "Fergie Meyrick", level: "gold", status:"inactive"}
            ];
            var currIndex = 0;
            var promise = $interval(function() {
                if (currIndex < newPeople.length) {
                    vm.people.push(newPeople[currIndex]);
                    ++currIndex;
                } else {
                    vm.isLoadingPeople = false;
                    if (promise) {
                        $interval.cancel(promise);
                        promise = undefined;
                    }
                }
            }, 1000);
        }

        //#endregion
    }
})();
