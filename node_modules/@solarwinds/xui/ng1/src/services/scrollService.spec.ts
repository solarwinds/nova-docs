/// <reference path="../ref.d.ts" />

import ScrollService from "./scrollService";

describe("services >", () => {
    describe("scroll-service >", () => {
        let scrollService:xui.IScrollService;
        let $document:ng.IDocumentService;
        
        beforeEach(angular.mock.module("xui.services"));
        beforeEach(inject(($injector:any) => {
            scrollService = $injector.get("xuiScrollService");
            $document = $injector.get("$document");
        }));

        it("should bind the scroll callback and invoke it on scroll", () => {
            let counter = 0;
            const scrollCallback = () => ++counter;
            scrollService.bind(scrollCallback);
            expect(counter).toBe(0);
            $document.trigger("scroll");
            expect(counter).toBeGreaterThan(0);
        });

        it("should bind the scroll callback and invoke it on perfect scrollbar events", () => {
            let counterX = 0;
            scrollService.bind(() => ++counterX);
            expect(counterX).toBe(0);
            $document.trigger("ps-scroll-x");
            expect(counterX).toBeGreaterThan(0);
            
            let counterY = 0;
            scrollService.bind(() => ++counterY);
            expect(counterY).toBe(0);
            $document.trigger("ps-scroll-y");
            expect(counterY).toBeGreaterThan(0);
        });

        it("should unbind the scroll callback", () => {
            let counter = 0;
            const scrollCallback = () => ++counter;
            scrollService.bind(scrollCallback);
            expect(counter).toBe(0);
            $document.trigger("scroll");
            expect(counter).toBeGreaterThan(0);

            scrollService.unbind(scrollCallback);
            counter = 0;
            $document.trigger("scroll");
            expect(counter).toBe(0);
        });
    });
});
