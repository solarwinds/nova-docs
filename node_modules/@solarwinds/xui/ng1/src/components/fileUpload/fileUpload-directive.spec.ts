import SpecHelper from "../../specHelper";
import FileUploadController from "./fileUpload-controller";

describe("components >", () => {
    describe("fileUpload >", () => {
        let element: ng.IAugmentedJQuery,
            ctrl: FileUploadController,
            scope: any,
            $compile: ng.ICompileService,
            $controller: ng.IControllerService,
            html:string = `<xui-file-upload file="file"></xui-file-upload>`,
            parentTag: string = "form";

        beforeEach(() => {
            angular.mock.module("xui");
            angular.mock.inject(($injector: any) => {
                scope = $injector.get("$rootScope").$new();//<IPanelTestScope>
                $compile = $injector.get("$compile");
                $controller = $injector.get("$controller");
            });
        });

        function compileDirective() {
            element = SpecHelper.getCompiledElementInParentElement($compile, scope, html, parentTag);
            scope.$apply();
            ctrl = element.find(".xui-file-upload").controller("xuiFileUpload");
        }

        it("compilation should be successful", () => {
            compileDirective();
            expect(element).not.toEqual("");
        });

        it("should have onchange listener which calls onFileRead", (done:()=>void) => {
            compileDirective();

            let inputElement = element.find("input[type='file']"),
                $event = jQuery.Event("change");

            spyOn(ctrl, "onFileRead").and.callFake(
                () => {
                    expect(ctrl.onFileRead).toHaveBeenCalled();
                    done();
                }
            );
            inputElement.trigger("change", $event);
        });
    });
});
