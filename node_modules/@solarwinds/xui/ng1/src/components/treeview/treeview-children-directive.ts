import ITreeviewController = xui.ITreeviewController;

export class TreeviewChildren implements ng.IDirective {
    public static $inject = ["$compile"];

    public replace = true;
    public restrict = "E";
    public require = "^xuiTreeview";
    public templateUrl = "xui/components/treeview/treeview-children-directive.html";

    public constructor(private $compile: ng.ICompileService) {
        this.compile = this.compile.bind(this);
    }

    public compile(tElement: ng.IAugmentedJQuery) {
        const template = tElement.clone();
        tElement.empty();

        return {
            post: (scope: ng.IScope, element: ng.IAugmentedJQuery, attrs: ng.IAttributes,
                   ctrl: ITreeviewController) => {
                if (!ctrl.context.rootNode.$hasChildren) {
                    return;
                }
                if (ctrl.options.limit == null) {
                    template.find(".xui-treeview-limit-links").remove();
                }
                if (ctrl.options.load == null) {
                    template.find(".xui-treeview-spinner").remove();
                }
                let compiled = this.$compile(template.html())(scope);
                element.append(compiled);
            }
        };
    }
}

export default TreeviewChildren;
