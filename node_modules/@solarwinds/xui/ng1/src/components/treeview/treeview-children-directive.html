<div>
    <ul ng-if="!node.collapsed && !node.loading"
        class="xui-treeview-list xui-treeview-level-{{::node.$level}}">
        <li class="xui-treeview-node"
            ng-class="{'xui-treeview-node-nested' : node.$level > 2}"
            ng-repeat="node in node.$children | treeviewLimit:node:ctrl.options track by ctrl.trackByFunction(node, $index)">
            <div ng-click="ctrl.onNodeClick($event, node)"
                 ng-dblclick="ctrl.onNodeDblClick($event, node)" data="{{ node.$level }}"
                 ng-style="::ctrl.getNodeCssStyle(node)"
                 class="xui-treeview-head media"
                 xui-toast="node.$model"
                 ng-class="{'xui-is-selected': node.checked, 'xui-is-focused': node === ctrl.context.focusedNode, 'xui-is-expanded': node.$hasChildren && !node.collapsed}">
                <div class="media-left xui-treeview-togglecell">
                    <div class="xui-treeview-toggle-wrapper">
                        <span ng-if="node.loading">
                            <i class="xui-treeview-toggle xui-icon-name-busy-cube xui-spinner-20 xui-spinner" />
                        </span>
                        <span class="xui-treeview-toggle" ng-if="!node.loading && (node.$hasChildren || node.$parent.$hasGrandChildren)">
                            <a ng-if="node.$hasChildren"
                               ng-click="ctrl.toggle($event, node)">
                                <xui-icon is-dynamic="true" icon="{{node.collapsed ? 'triangle-right' : 'triangle-down'}}"></xui-icon>
                            </a>
                        </span>
                        <xui-checkbox ng-if="::ctrl.options.selectionMode == 'multi'"
                               ng-model="node.checked"
                               ng-change="ctrl.checkNode($event, node)"
                               is-indeterminate="node.indeterminate"
                               class="xui-treeview-checkbox"></xui-checkbox>
                    </div>
                </div>
                <div class="media-left xui-treeview-icon"
                     ng-if="node.$model.icon">
                    <xui-icon icon="{{node.$model.icon}}" status="{{node.$model.iconStatus}}" is-dynamic="true"></xui-icon>
                </div>
                <div class="media-body media-middle xui-treeview-label">
                    <div xui-treeview-transclude></div>
                </div>
            </div>
            <xui-treeview-children></xui-treeview-children>
        </li>
        <li ng-if="ctrl.showLimitLinks(node)" class="xui-treeview-limit-links small">
            <a href ng-click="ctrl.showMore($event, node)" class="xui-treeview-showmore" translate>xui_treeview_showMore</a> /
            <a href ng-click="ctrl.showAll($event, node)" class="xui-treeview-showall" translate>xui_treeview_showAll</a>
        </li>
    </ul>
</div>
