class TimepickerValidator {
    public restrict = "A";
    public require = "ngModel";
    public link = (scope:ng.IScope, element:ng.IAugmentedJQuery, attrs:ng.IAttributes,
                   ngModelCtrl:ng.INgModelController)=> {
        const timeFormat = attrs["xuiTimePickerValidator"] || "h:mm A";

        function isValidDate(viewValue:string):boolean {
            return ngModelCtrl.$isEmpty(viewValue) || moment(viewValue, timeFormat).isValid();
        }

        ngModelCtrl.$validators["time"] = (modelValue:any, viewValue:any):boolean => {
            return isValidDate(viewValue);
        };

        ngModelCtrl.$parsers.unshift((viewValue:any)=> {
            if (viewValue === "" || viewValue == null ||
                viewValue === undefined || !isValidDate(viewValue)) {
                // null means that there is no value which is fine
                return null;
            }
            return moment(viewValue, timeFormat).year(0).dayOfYear(1).toDate();
        });

    };
}

export default TimepickerValidator;
