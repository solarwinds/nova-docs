@import (reference) url('../../styles/xui-framework-variables.less');
@import (reference) url('../../styles/xui-framework-base.less');
@import (reference) url('../../styles/mixins.less');

@xui-dropdown-border-width: 1px;
@xui-dropdown-max-height: 300px;
@xui-dropdown-height: 30px;
@xui-dropdown-narrow-input-width: 100px;
@xui-dropdown-scrollbar-width: 17px;
@xui-dropdown-narrow-input-width-ie-hack: @xui-dropdown-narrow-input-width - @xui-dropdown-scrollbar-width;
@xui-dropdown-padding-internal-vertical: 7px;
@xui-dropdown-input-right-padding: 10px;
@xui-dropdown-input-width: 200px;
@xui-dropdown-validation-icon-margin: 7px;
@xui-dropdown-validation-offset: 20px;
@xui-dropdown-toggle-horizontal-padding: 8px;

.xui .xui-dropdown {
    padding: 0;
    margin: 0 0 10px 0;

    &__btn-group {
        > .btn {
            &:hover, &:focus, &:active {
                border-color: @xui-color-focused-border;
                z-index: @zindex-active;
            }

            &:disabled {
                pointer-events: none;
                &:hover, &:focus, &:active {
                    border-color: @input-border;
                }
            }
            &.btn-sm {
                padding: (@padding-small-vertical - @xui-dropdown-border-width) (@padding-small-horizontal - @xui-dropdown-border-width);
                &.xui-dropdown__action {
                    > .xui-icon {
                        margin-right: @padding-xs-horizontal;
                    }
                }
                &.xui-dropdown__toggle-button {
                    padding-left: 4px;
                    padding-right: 4px;
                    > .xui-icon {
                        margin-left: 1px;
                        margin-right: 1px;
                    }
                    > .xui-dropdown__display-value {
                        margin-top: 0;
                        margin-right: @padding-xs-horizontal;
                    }
                }
            }
        }

        &.open {
            > .xui-dropdown__toggle-button {
                border-color: @xui-color-focused-border;
                z-index: @zindex-active;
            }
        }
    }

    &__input {
        .xui-input-text();
        float: left;
        margin-right: -1px;
        width: 200px;
        height: @xui-dropdown-height;

        &:not(:disabled) {
            &:hover, &:focus {
                z-index: @zindex-active;
                position: relative;
            }
        }
    }

    &__caret {
        width: @icon-size-small;
        height: @icon-size-small;
        background-position: center center;
    }

    &__icon {
        position: absolute;
        top: 5px;
        left: 5px;
        z-index: (@zindex-active + 1);
        pointer-events: none;
    }

    &__input-icon {
        padding-left: 32px; //20 icon + 7 right margin + 5 left margin
    }

    &__label {
        display: block;
    }

    &__display-value {
        font-weight: @xui-font-weight-regular;
        float: left;
    }

    &__placeholder {
        font-weight: @xui-font-weight-semibold;
        margin: 1px @padding-base-horizontal 0 0;
    }

    &__toggle-button {
        padding: (@padding-base-vertical - @xui-dropdown-border-width) (@xui-dropdown-toggle-horizontal-padding);
        line-height: (@xui-dropdown-height - 2 * @padding-base-vertical);
        // height: border*2 + padding*2 + iconHeight
        height: @xui-dropdown-border-width*2 + (@padding-base-vertical - @xui-dropdown-border-width)*2+@icon-size-default;

        &:hover {
            z-index: @zindex-active;
            position: relative;
        }

        > .xui-dropdown__display-value {
            margin: 1px @padding-base-horizontal 0 0;
        }

        > .xui-icon {
            margin-top: 0;
            margin-left: -2px;
            margin-right: -2px;
            bottom: 2px;
            right: 2px;
            position:relative;
        }
    }

    &__action {
        padding: (@padding-base-vertical - @xui-dropdown-border-width) (@padding-base-horizontal - @xui-dropdown-border-width);
        line-height: (@xui-dropdown-height - 2 * @padding-base-vertical);

        > .xui-icon {
            float: left;
            margin-right: @padding-base-horizontal;
            margin-top: 2px;
        }

        > .xui-dropdown__display-value {
        }
    }

    &__menu {
        border-color: @xui-color-focused-border;
        max-height: @xui-dropdown-max-height;
        overflow-y: auto;
        margin-top: -1px;
        .default-drop-shadow();
    }

    &__invalid {
        background-color: @critical-red-bg;
        border: 1px solid @critical-red;
        color: @critical-red;
    }

    &__invalid-hint {
        color: @critical-red;
        font-weight: @xui-font-weight-bold;
    }

    &.disabled {
        > .xui-dropdown__label {
            .opacity(@disabled-opacity);
        }
        > .xui-dropdown__btn-group {
            > .btn {
                color: @xui-color-inactive;
                background-color: @xui-color-border;
                border-color: @xui-color-border;
            }
        }
    }

    /* Combobox typeahead menu */
    .dropdown-menu {
        > li {
            &.active {
                > .xui-dropdown__typeahead-item {
                    background-color: @xui-color-light-bg-hvr;
                    cursor: pointer;
                }
            }
            > .xui-dropdown__typeahead-item {
                padding: @padding-base-vertical @padding-base-horizontal;
            }
        }
    }

    &__validation-icon {
        z-index: (@zindex-active + 1);
        position: relative;
        float: left;

        .form-control-feedback {
            top: 7px;
            margin: 0 @xui-dropdown-validation-icon-margin 0 0;
        }
    }

    &.has-error {
        & .xui-dropdown__messages div[ng-message] {
            clear: both;
            margin: 0 0 @xui-space-sm 0;
            line-height: @line-height-small;
            font-size: @xui-font-size-small;
            font-weight: @xui-font-weight-bold;
        }
    }

    /******* Modifiers ********/

    /* Public */
    &--justified {
        .xui-dropdown {
            &__btn-group {
                display: flex;
                flex-grow: 1;
                > .btn.btn-sm.xui-dropdown__toggle-button > .xui-dropdown__caret { //specificity needed for small class override
                    margin-left: auto;
                }

                &.btn-group > .xui-dropdown__toggle-button {
                    flex-grow: 0;
                }
            }

            &__action {
                flex-grow: 1;
            }

            &__toggle-button {
                flex-grow: 1;
                display: flex;
            }

            //icon in right button
            &__caret {
                margin-left: auto;
                align-self: center;
            }

            &__input {
                flex-grow: 1;
            }
        }

    }

    /* Public */
    &-inline, &--inline {
        & .xui-dropdown, &.xui-dropdown {
            margin-bottom: 0;
        }

        & .xui-dropdown {
            &__layout-block {
                display: flex;
                flex-direction: row;
                align-items: center;
            }
            &__label {
                margin: 0 @padding-xs-horizontal 0 0;
            }
        }
    }

    /* Internal */
    &--narrow {
        .xui-dropdown {
            &__input {
                width: @xui-dropdown-narrow-input-width;
                padding-right: @xui-dropdown-input-right-padding;
            }

            &__menu {
                min-width: @xui-dropdown-narrow-input-width;
            }
        }

        &.has-error {
            .xui-dropdown {
                &__menu-validation-icon {
                    min-width: @xui-dropdown-narrow-input-width + @xui-dropdown-validation-offset;
                }
            }
        }
    }

    /* Internal */
    &--right-align-menu {
        .xui-dropdown__menu {
            text-align: right;
            .xui-listitem--compact {
                padding-right: @padding-large-horizontal;
            }
        }
    }

    /* Internal */
    &--uppercase {
        .xui-dropdown__btn-group,
        .xui-dropdown__input {
            text-transform: uppercase;
        }
    }

    /* Internal */
    &.xui-dropdown--drombo {
        .xui-dropdown__input {
            margin-right: 0;

            &:not(.ng-invalid) {
                color: @xui-color-input-focus;
            }

            &:not(:focus) {
                cursor: pointer;
            }

            &:disabled {
                pointer-events: none;
            }
        }
    }
}

/*
  Hack - IE counts width of ul element without scrollbar
  (UIF-2284 should solve this issue in more proper way)
*/
.no-smil .xui-dropdown {
    &--narrow {
        .xui-dropdown__menu {
            min-width: @xui-dropdown-narrow-input-width-ie-hack;
        }

        &.has-error {
            .xui-dropdown__menu {
                min-width: @xui-dropdown-narrow-input-width-ie-hack + @xui-dropdown-validation-offset;
            }
        }
    }
}
