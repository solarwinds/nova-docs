<div class="xui-dropdown"
     ng-class="{ 'has-error': vm.isInErrorState(), 'disabled': vm.isDisabled, 'xui-dropdown--drombo': vm.isDromboBox() }">
    <div class="xui-dropdown__layout-block">
        <label id="{{::vm.name}}_label" for="{{::vm.name}}_input" ng-show="::vm.caption" class="xui-dropdown__label">{{::vm
            .caption}}</label>
        <div uib-dropdown ng-attr-dropdown-append-to-body="{{vm.dropdownAppendToBody && 'true' || undefined }}"
             class="xui-dropdown__btn-group"
             ng-class="{ 'btn-group': vm.onSecondaryAction || vm.isEditable,
                         'has-feedback': vm.isInErrorState()}"
             is-open="vm.isDropdownOpen">
            <div class="xui-dropdown__icon" ng-show="vm.icon != null && vm.isEditable">
                <xui-icon icon="{{vm.icon}}" is-dynamic="true"
                          aria-hidden="true">
                </xui-icon>
            </div>
            <button ng-if="!vm.isEditable && vm.onSecondaryAction !== undefined"
                    name="{{::vm.name}}_action"
                    type="button"
                    ng-click="vm.action()"
                    ng-class="{'xui-dropdown__invalid': vm.isInErrorState()}"
                    class="btn btn-default xui-dropdown__action">
                <xui-icon ng-if="::vm.icon" is-dynamic="true" icon="{{vm.icon}}" icon-size="small"></xui-icon>
                <span class="xui-dropdown__display-value"
                      ng-show="!vm.displayPlaceholder()">{{vm.getDisplayValueFormatted(vm.getSelectedItem())}}</span>
                <span class="xui-dropdown__placeholder" ng-show="vm.displayPlaceholder()">
                    ({{vm.placeholder}})</span>
            </button>
            <input ng-show="vm.isEditable"
                   class="xui-dropdown__input form-control"
                   ng-class="{'xui-dropdown__input-icon': vm.icon != null && vm.isEditable}"
                   ng-model="vm.internalModel"
                   type="text"
                   id="{{::vm.name}}_input"
                   name="{{::vm.name}}_input"
                   autocomplete="off"
                   placeholder="{{::vm.placeholder}}"
                   ng-disabled="vm.isDisabled"
                   ng-focus="vm.onInputFocus()"
                   ng-blur="vm.onInputBlur()"
                   uib-typeahead="item as vm.getItemDisplay(item) for item in vm.itemsSource|filter:vm.getFilterValue($viewValue)|limitTo:10"
                   typeahead-on-select="vm.select($item, $model, $label)"
                   typeahead-template-url="xui/components/dropdown/templates/typeahead-item.html"/>
            <button ng-show="vm.showDropdown()"
                    uib-dropdown-toggle
                    name="{{::vm.name}}"
                    type="button"
                    ng-focus="vm.isBlurred=false;"
                    ng-blur="vm.isBlurred=true;"
                    ng-class="{'xui-dropdown__invalid': vm.isInErrorState()}"
                    class="btn btn-default xui-dropdown__toggle-button xui-dropdown__toggle">
                <span class="xui-dropdown__display-value"
                      ng-if="::!vm.onSecondaryAction && !vm.isEditable"
                      ng-show="!vm.displayPlaceholder()">{{vm.getDisplayValueFormatted(vm.getSelectedItem())}}</span>
                <span class="xui-dropdown__placeholder"
                      ng-if="::!vm.onSecondaryAction && !vm.isEditable"
                      ng-show="vm.displayPlaceholder()">({{vm.placeholder}})</span>
                <xui-icon css-class="xui-dropdown__caret" icon="caret-down"></xui-icon>
            </button>
            <ul uib-dropdown-menu
                role="menu"
                class="xui-dropdown__menu"
                aria-labelledby="{{::vm.name}}_label"
                ng-class="{'dropdown-menu-right': vm.isEditable && !vm.isDromboBox(),
                'dropdown-menu-validation-icon': !vm.hideSeverityIcon}"
                xui-scrollbar>
                <xui-listitem padding-size="{{::item.separator ? 'none' : 'compact'}}"
                              ng-repeat="item in vm.itemsSource"
                              ng-click="vm.select(item)"
                              ng-style="::item.separator ? {'pointer-events': 'none'} : {}"
                              role="menuitem"
                              nowrap="vm.isNarrow"
                              class="xui-dropdown__menuitem"
                              is-clickable="::!item.separator"
                              is-selected="vm.isItemSelected(item)">
                    <ng-include src="::item.separator ? vm.separatorTemplateUrl : vm.itemTemplateUrl"></ng-include>
                </xui-listitem>
            </ul>
        </div>
    </div>
    <div ng-messages="vm.ngModelCtrl.$error" ng-show="vm.isInErrorState()"
         class="xui-dropdown__messages xui-validation" role="alert" ng-transclude></div>
    <xui-help-hint ng-if="::vm.helpText">{{::vm.helpText}}</xui-help-hint>
</div>
