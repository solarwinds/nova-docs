(function () {
    "use strict";

    Xui.module
        .controller("DemoTextBoxController", DemoTextBoxController, ["$log"])
        .directive("customip", customip, ["$timeout"]);


    function DemoTextBoxController($log) {
        var vm = this;

        vm.isRequired = true;

        vm.readOnlyDisplayValue = 'this is read only';
        vm.disabledDisplayValue = 'this is disabled text';
        vm.plainValue = 'plain text';
        vm.validEmail = "krustyTheClown@oldskool.museum";
        vm.numberValue = 23;
        vm.regexValue = "";
        vm.regexPattern = "^apollo-rulezz$";
        vm.ipAddress = "0.0.0.0";

        vm.onChange = function () {
            $log.info("text value changed", arguments);
        };
    }

    function customip($timeout) {
        return {
            require: 'ngModel',
            restrict: '',
            link: function (scope, elm, attrs, ctrl) {
                if (ctrl) {
                    ctrl.$asyncValidators.customIp = function (modelValue, viewValue) {
                        return $timeout(function () {
                            var isValid = true;
                            var octets = modelValue.split(".");

                            if (octets.length !== 4) {
                                isValid = false;
                            } else {
                                isValid = parseInt(octets[0]) === 192 &&
                                    parseInt(octets[1]) === 168 &&
                                    parseInt(octets[2]) === 1 &&
                                    (parseInt(octets[3]) >= 0 && parseInt(octets[3]) <= 255);
                            }

                            ctrl.$setValidity('customip', isValid);
                            return isValid;
                        }, 2000);
                    };
                }
            }
        };
    }
})();
