<div id="xuiDialogElement" ng-controller="DialogController as vm">
    <xui-button name="xuiButtonElement"
                size="small"
                ng-click="vm.showDialog()"
                display-style="primary"
                is-disabled="false">
        Show Dialog
    </xui-button>
</div>


<script type="text/javascript">

    (function () {
        "use strict";

        Xui.controller("DialogController", DialogController, ["$scope", "$timeout", "perfService", "xuiDialogService"]);

        function DialogController($scope, $timeout, perfService, dialogService) {

            var vm = this;

            vm.showDialog = function () {
                var viewModel = { wasStarted: false, isBusy: false, wasCancelled: false, result: "success" };
                var timeoutPromise = null;
                dialogService.showModal({size: "lg"}, {
                    title: "Dialog Confirmation",
                    message: "Dialog performance testing",
                    actionButtonText: "Confirm",
                    cancelButtonText: "Close",
                    buttons: [{
                        name: "confirm",
                        isPrimary: true,
                        text: "Confirm",
                        actionText: "Please wait, winter is coming...",
                        action: function () {
                            viewModel.wasStarted = true;
                            viewModel.wasCanceled = false;
                            viewModel.isBusy = true;
                            timeoutPromise = $timeout(function () {
                                viewModel.isBusy = false;
                                return true;
                            }, 3000);
                            return timeoutPromise;
                        },
                        cancelAction: function () {
                            if (viewModel.wasStarted) {
                                $timeout.cancel(timeoutPromise);
                                viewModel.wasCanceled = true;
                                viewModel.isBusy = false;
                            }
                        }
                    }],
                    viewModel: viewModel
                });
            };

            //register custom user metrics
            perfService.registerMetrics(["watchersCount", "digestLoop", "pageLoad"], $scope);

        }
    })();
</script>

