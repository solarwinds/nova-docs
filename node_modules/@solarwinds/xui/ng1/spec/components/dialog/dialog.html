<div id="xui-demo-components-dialog" ng-controller="DialogSampleController as ctrl">
    <xui-button id="testMessageBtn"
                size="small"
                ng-click="ctrl.showMessage()"
                display-style="primary"
                is-disabled="false">
        Show Message
    </xui-button>
    <xui-button id="testWarningBtn"
                size="small"
                ng-click="ctrl.showWarning()"
                display-style="primary"
                is-disabled="false">
        Show Warning
    </xui-button>
    <xui-button id="testErrorBtn"
                size="small"
                ng-click="ctrl.showError()"
                display-style="primary"
                is-disabled="false">
        Show Error
    </xui-button>
    <xui-button id="testDialogBtn"
                size="small"
                ng-click="ctrl.showDialog()"
                display-style="primary"
                is-disabled="false">
        Show Dialog
    </xui-button>
    <xui-button id="testDialogTemplateBtn"
                size="small"
                ng-click="ctrl.showDialogWithTemplate()"
                display-style="primary"
                is-disabled="false">
        Show Template
    </xui-button>
    <xui-button id="testCustomFooterName"
                size="small"
                ng-click="ctrl.showCustomFooterWithTemplate()"
                display-style="primary"
                is-disabled="false">
        Show Custom Footer
    </xui-button>
    <xui-button id="testDialogIconsBtn"
                size="small"
                ng-click="ctrl.showDialogWithBtnIcons()"
                display-style="primary"
                is-disabled="false">
        Show Dialog with custom button icons
    </xui-button>
</div>
<script>
    Xui.app().controller("DialogSampleController", ["$interval", "xuiDialogService", "$q",
        function ($interval, dialogService, $q) {
            this.warningVm = {ignored: false};
            this.showMessage = function () {
                dialogService.showMessage({title: "Gothos", message: "Greetings and Felicitations!"});
            };
            this.showWarning = function () {
                this.warningVm.ignored = false;
                var viewModel = this.warningVm;
                dialogService.showWarning({message: "An error message is imminent."}, {
                    name: "proceed",
                    text: "Proceed",
                    action: function (dialogResult) {
                        viewModel.ignored = true;
                        return true;
                    }
                });
            };
            this.showError = function () {
                dialogService.showError({message: "We seem to be stuck in a temporal causality loop."});
            };
            this.showDialog = function () {
                var viewModel = {wasStarted: false, isBusy: false, wasCanceled: false, result: "success!"};
                var timeoutPromise = null;
                var result = dialogService.showModal({
                    size: "lg"
                }, {
                    hideCancel: false,
                    hideTopCancel: true,
                    title: "Dialog Confirmation",
                    message: "Are you sure this is the dialog you're looking for? Click Start to get busy...",
                    actionButtonText: "Start",
                    buttons: [{
                        name: "start",
                        isPrimary: true,
                        text: "Start",
                        actionText: "Please wait, I'm real busy...",
                        action: function (dialogResult) {
                            viewModel.wasStarted = true;
                            viewModel.wasCanceled = false;
                            viewModel.isBusy = true;

                            // we're wrapping the interval promise because it throws error on cancel
                            return $q(function(resolve, reject) {
                                timeoutPromise = $interval(function() {
                                    console.log("Resolved.");
                                    viewModel.isBusy = false;
                                    resolve("ok");
                                }, 20000, 1);

                                // this must be separated because $interval.cancel doesn't work if the calls are chained
                                timeoutPromise.catch(function() {
                                    resolve("canceled");
                                }).finally(function() {
                                    console.log("Finally!");
                                });
                            });
                        },
                        cancelAction: function () {
                            if (viewModel.wasStarted) {
                                $interval.cancel(timeoutPromise);
                                viewModel.wasCanceled = true;
                                viewModel.isBusy = false;
                            }
                        }
                    }],
                    viewModel: viewModel
                });
            };
            this.showDialogWithBtnIcons = function() {
                var viewModel = {wasStarted: false, isBusy: false, wasCanceled: false, result: "success!"};
                var result = dialogService.showModal({size:"lg"},{
                    hideTopCancel: false,
                    title: "Dialog Confirmation",
                    message: "Are you sure this is the dialog you're looking for? Click Start to get busy...",
                    actionButtonText: "Start",
                    cancelButtonText: "Close",
                    buttons: [{
                        name: "start",
                        isPrimary: true,
                        text: "Start",
                        actionText: "Please wait, I'm real busy...",
                        icon: "state_running",
                        iconRight: "true"
                    }],
                    viewModel: viewModel
                });
            };
            this.showDialogWithTemplate = function () {
                dialogService.showModal({
                    templateUrl: "/e2e/templates/dialog-template.html"
                }, {
                    title: 'Sample Header',
                    viewModel: {
                        launch: this.showDialog,
                        launchTemplated: this.showDialogWithTemplate
                    },
                    hideCancel: false,
                    actionButtonText: "Ok",
                    cancelButtonText: "Cancel"
                });
            };
            this.showCustomFooterWithTemplate = function() {
                var viewModel = {content: "Where is buttons?" };
                var result = dialogService.showModal({ templateUrl: "/e2e/templates/dialog-custom-footer-template.html", size:"lg"},{
                    title: "Dialog Custom Footer",
                    message: "Are you sure this is the dialog you're looking for?",
                    viewModel: viewModel
                });
            };
        }]);
</script>
