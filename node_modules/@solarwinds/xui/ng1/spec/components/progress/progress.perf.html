<div ng-controller="PopoverController as vm">
    <xui-button name="xuiButtonElement" ng-click="vm.startProgress()">Start Progress</xui-button>
    <xui-progress id="xuiProgressElement"
                  show="vm.show"
                  show-progress="true"
                  allow-cancel="true"
                  on-cancel="vm.onCancel()"
                  percent="{{vm.percent}}"
                  message="{{::vm.message}}"
                  help-text="{{::vm.helpText}}">
    </xui-progress>
</div>


<script type="text/javascript">

    (function () {
        "use strict";

        Xui.controller("PopoverController", PopoverController, ["$interval", "$scope", "perfService"]);

        function PopoverController($interval, $scope, perfService) {

            var vm = this;

            vm.show = false;
            vm.percent = 0;
            vm.isCancelled = false;
            vm.message = "Discovering the network, please wait...";
            vm.helpText="Discovered 10.199.1.2. Trying SNMP credentials...";

            var stop;
            vm.startProgress = function () {
                vm.show = true;
                vm.percent = 0;

                stop = $interval(function () {
                    if (vm.percent < 100) {
                        vm.percent += 10;
                    }
                }, 1000);
            };

            vm.onCancel = function () {
                if (angular.isDefined(stop)) {
                    vm.show = false;
                    $interval.cancel(stop);
                    stop = undefined;
                    vm.percent = 0;
                }
                vm.isCancelled = true;
            };

            //register custom user metrics
            perfService.registerMetrics(["watchersCount", "digestLoop", "pageLoad"], $scope);

        }
    })();
</script>

