import { browser, by, promise, element } from "@solarwinds/uzi/protractor";
import { Atom } from "@solarwinds/uzi";
import { Eyes } from "eyes.protractor";
import { ProgressAtom, ButtonAtom } from "../index.atom";
import Helpers from "../helpers";

describe("Visual tests: Progress", function() {
    let eyes: Eyes;
    let bigProgress: ProgressAtom;
    let startButton: ButtonAtom;
    let progressAtom: ProgressAtom;

    beforeEach(() => {
        eyes = Helpers.prepareEyes();
        Helpers.prepareBrowser("progress");
        progressAtom = Atom.findIn(ProgressAtom, undefined, 0);
        startButton = Atom.findIn(ButtonAtom, element(by.className("xui-demo-start-progress-btn")));
        bigProgress = Atom.findIn(ProgressAtom, element(by.xpath(".//div[contains(@allow-cancel, 'true')]")));
    });

    it("Default look", async function() {
        eyes.open(browser, "XUI","Progress");
        eyes.checkWindow("Default");

        await startButton.click();
        //Waiting for the progress bar to stop moving
        await progressAtom.waitForProgressBarToComplete(15000);
        eyes.checkWindow("Progress bars color state");

        await bigProgress.cancelProgress();
        eyes.checkWindow("Progress cancelled. The first progress component is not visible");
        
        eyes.close();
    });
});
