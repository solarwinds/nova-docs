import {by, element, ElementFinder, promise} from "@solarwinds/uzi/protractor";
import {Atom} from "@solarwinds/uzi";

export enum IconSize {
    small,
    default,
    large,
    xlarge
}

export class IconAtom extends Atom {
    public static CSS_CLASS = "xui-icon";

    public static iconSize = {
        small: "sm",
        default: "default",
        large: "lg",
        xlarge: "xlg"
    };

    static count(element: ElementFinder, extStyle = ""): promise.Promise<number> {
        return element.all(by.css(".xui-icon" + extStyle)).count();
    }

    public name = (): promise.Promise<string> => {
        return super.getElement().getAttribute("icon");
    };

    public getSize(): promise.Promise<string> {
        return super.getElement().getAttribute("class").then((css: string) => {
            if (css.search(IconAtom.iconSize.small) !== -1) {
                return IconAtom.iconSize.small;
            } else if (css.search(IconAtom.iconSize.xlarge) !== -1) {    // order is important here
                return IconAtom.iconSize.xlarge;
            } else if (css.search(IconAtom.iconSize.large) !== -1) {
                return IconAtom.iconSize.large;
            } else {
                return IconAtom.iconSize.default;
            }
        });
    }

    public getStatus(): promise.Promise<string> {
        return super.getElement().getAttribute("status");
    }

    public getCounter(): promise.Promise<string> {
        return super.getElement().getAttribute("counter");
    }

    public getExtraStyling(): promise.Promise<string> {
        return super.getElement().getAttribute("css-class");
    }

    public async getTooltip(): Promise<string> {
        const tooltipElem = super.getElement().element(by.xpath(".."))
            .element(by.xpath(".//div[@uib-tooltip-popup]/div[contains(@class, 'tooltip-inner')]"));

        const isDisplayed = await tooltipElem.isDisplayed();
        if (!isDisplayed) {
            return undefined;
        }

        return await tooltipElem.getText();
    }
}
