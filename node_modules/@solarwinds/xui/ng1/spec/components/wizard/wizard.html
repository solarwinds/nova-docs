<div id="wizardTest" ng-controller="WizardHostController as vm">
    <h4>Stand-Alone Wizard</h4>
    <div ng-if="vm.isStandAloneTest">
        <form ng-include="'/e2e/templates/wizard-template.html'"></form>
    </div>

    <h4>Dialog Wizard</h4>
    <xui-button name="startWizardDialog" ng-click="vm.showDialog()">Wizard Dialog</xui-button>
</div>

<script id="dialog-wizard" type="text/ng-template">
    <xui-dialog>
        <div ng-include="'/e2e/templates/wizard-template.html'"></div>
    </xui-dialog>
</script>

<script type="text/javascript">
    (function () {
        "use strict";

        Xui.controller("WizardHostController",
            wizardHostController, ["xuiWizardDialogService"]);
        function wizardHostController(wizardService) {
            var vm = this;
            vm.isStandAloneTest = true;

            vm.showDialog = function () {
                vm.isStandAloneTest = false;
                wizardService
                    .showModal({
                        title: "Wizard Demo",
                        templateUrl: "dialog-wizard"
                    });
            }
        }

        Xui.controller("WizardTestController",
            wizardTestController, ["$timeout"]);
        function wizardTestController($timeout) {
            var vm = this;
            vm.canGoNext = true;
            vm.canGoBack = true;
            vm.inputField = "";
            vm.canFinish = false;
            vm.hideHeader = false;
            vm.isCancelled = false;
            vm.isFinished = false;
            vm.isStandAloneTest = true;
            vm.shouldCancelNext = false;
            vm.currentStepIndex = 0;
            vm.stepStates = {
                step1: {
                    entered: false,
                    exited: false
                },
                step2: {
                    entered: false,
                    exited: false
                },
                step3: {
                    entered: false,
                    exited: false
                }
            };

            vm.additionalButtonClicked = false;
            vm.additionalButtons = [{
                name: 'btn1',
                text: 'added Button 1',
                action: function () {
                    vm.additionalButtonClicked = true;
                    return false;
                }
            }];

            vm.onEnterStep = function (step) {
                if (vm.stepStates[step.label]) {
                    vm.stepStates[step.label].entered = true;
                }
            };
            vm.onExitStep = function (step) {
                vm.stepStates[step.label].exited = true;
            };
            vm.onNextStep = function (from, to, cancellation) {
                var timeout = (from.label === "step2") ? 500 : 0;
                var promise = $timeout(function () {
                    return !vm.shouldCancelNext;
                }, timeout);
                cancellation.then(function () {
                    $timeout.cancel(promise);
                });

                return promise;
            };
            vm.onCancel = function () {
                vm.isCancelled = true;
                return false;
            };
            vm.onFinish = function (cancellation) {
                var promise = $timeout(function () {
                    if (!vm.shouldCancelNext) {
                        vm.isFinished = true;
                    }

                    // Return false here also so the dialog doesn't close.
                    return false;
                }, 500);
                cancellation.then(function () {
                    $timeout.cancel(promise);
                });

                return promise;
            };
        }
    })();
</script>

