<div ng-controller="SearchTestController as ctrl">
    <xui-search id="searchTest"
                caption="xui-search-complex"
                placeholder="{{ctrl.placeholder}}"
                item-limit="{{ctrl.itemLimit}}"
                value="ctrl.value"
                items-source="ctrl.items"
                display-value="ctrl.displayValue"
                on-search="ctrl.onSearch(value, cancellation)"
                on-clear="ctrl.onClear()"
                on-change="ctrl.onChange()">
    </xui-search>
    <pre>Model: <code>{{ctrl.value}}</code></pre>

    <div class="xui-checkbox-inline">
        <xui-checkbox id="wasSearched" ng-model="ctrl.wasSearched">wasSearched</xui-checkbox>
        <xui-checkbox id="inputChanged" ng-model="ctrl.inputChanged">inputChanged</xui-checkbox>
        <xui-checkbox id="searchFinished" ng-model="ctrl.searchFinished">searchFinished</xui-checkbox>
        <xui-checkbox id="searchCancelled" ng-model="ctrl.searchCancelled">searchCancelled</xui-checkbox>
    </div>
</div>

<script>
    (function () {
        "use strict";

        Xui.controller('SearchTestController', function ($interval) {
            var vm = this;
            vm.displayValue = 'value';
            vm.placeholder = 'Search...';
            vm.value = undefined;
            vm.itemLimit = 3;
            vm.inputChanged = false;
            vm.wasSearched = false;
            vm.searchFinished = false;
            vm.searchCancelled = false;
            vm.items = [
                {name: 'item_1', value: 'Item One'},
                {name: 'item_2', value: 'Item Two'},
                {name: 'item_3', value: 'Item Three'},
                {name: 'item_4', value: 'Item Four'},
                {name: 'item_5', value: 'Item Five'}
            ];
            vm.onChange = function () {
                vm.inputChanged = true;
            };
            vm.onSearch = function (value, cancellation) {
                vm.wasSearched = true;
                // Need to use $interval here because protractor tries to synchronize on the $timeout service.
                // https://github.com/angular/protractor/issues/169
                const promise = $interval(function () {
                    $interval.cancel(promise);
                    vm.searchFinished = true;
                }, 1000);
                cancellation.then(function () {
                    $interval.cancel(promise);
                    vm.searchCancelled = true;
                });
                return promise;
            };
            vm.onClear = function () {
                const promise = $interval(function () {
                    $interval.cancel(promise);
                    vm.searchCancelled = true;
                }, 0);
                return promise;
            };
        }, ["$interval"]);
    })();
</script>

