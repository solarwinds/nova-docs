import {by, ElementArrayFinder, ElementFinder, promise} from "@solarwinds/uzi/protractor";
import {Atom} from "@solarwinds/uzi";
import {ButtonAtom, SpinnerAtom} from "../index.atom";

export class SearchAtom extends Atom {
    public static CSS_CLASS = "xui-search";

    public getValueAttr = (): promise.Promise<string> => {
        return super.getElement().element(by.tagName("input")).getAttribute("value");
    };

    public acceptInput = (input: string) => {
        return super.getElement().element(by.tagName("input")).sendKeys(input);
    };

    public areSuggestionsDisplayed = (): promise.Promise<boolean> => {
        return this.getDropdown().isDisplayed();
    };

    public getSuggestions = (): ElementArrayFinder => {
        return this.getDropdown().all(by.css("li"));
    };

    public getSuggestion = (index: number): ElementFinder => {
        return this.getDropdown().all(by.css("li")).get(index);
    };

    public getSuggestionLinks = (): ElementArrayFinder => {
        return this.getDropdown().all(by.css("li a"));
    };

    public getSuggestionLink = (index: number): ElementFinder => {
        return this.getSuggestionLinks().get(index);
    };

    public isBusy = () => {
        return this.getElement().element(by.css(".xui-search__input.xui-search--busy")).isPresent();
    };

    public isActive = () => {
        return this.getElement().element(by.css(".xui-search__input.xui-search--active")).isPresent();
    };

    public getSpinner = (): SpinnerAtom => {
        return new SpinnerAtom(this.getElement().element(by.className("xui-search__input-spinner")));
    };

    public getSearchButton = (): ButtonAtom => {
        return Atom.findIn(ButtonAtom, this.getElement().element(by.className("xui-search__button")));
    };

    public getCancelButton = (): ButtonAtom => {
        return new ButtonAtom(this.getElement().element(by.className("xui-search__input-cancel")));
    };

    private getDropdown = (): ElementFinder => {
        return super.getElement().element(by.css("ul.dropdown-menu"));
    };
}
