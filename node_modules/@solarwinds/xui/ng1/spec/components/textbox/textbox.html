<div id="xui-demo-components-textbox" ng-controller="TextboxController as ctrl">
    <ng-form>
        <xui-textbox id="validEmailTextboxMock" type="email" ng-model="shell.textbox.validEmail" size="large"
                     caption="Validation" placeholder="email address"
                     help-text="This is supposed to be an email address.  It is also required."
                     validators="required,email">
            <div ng-message="required">This field is required</div>
            <div ng-message="email">This field must be a valid email address</div>
        </xui-textbox>

        <xui-textbox id="numberTextboxValidationMock" type="number" ng-model="ctrl.someNumber" caption="Number type"
                     help-text="This must be a number between {{ctrl.minNumber}} and {{ctrl.maxNumber}}."
                     validators="required,min={{ctrl.minNumber}},max={{ctrl.maxNumber}}">
            <div ng-message="min">too low!</div>
            <div ng-message="max">too high!</div>
        </xui-textbox>
        <xui-textbox id="customStringValidatorMock" type="text" ng-model="shell.textbox.displayvalue"
                     caption="Custom type" help-text="This must contain the string foo"
                     validators="customstringvalidator1=foo">
            <div ng-message="customstringvalidator1">no foo!</div>
        </xui-textbox>
        <xui-textbox id="thinTextBox" type="text" ng-model="shell.textbox.displayvalue">
        </xui-textbox>
        <xui-textbox id="disabledTextBox" is-disabled="{{ctrl.isDisabled}}" type="text" ng-model="ctrl.displayvalue">
        </xui-textbox>
        <xui-button id="disableButton" ng-click="ctrl.isDisabled = true">test</xui-button>
        <xui-textbox id="asyncWarningValidatorMock" type="text" ng-model="shell.textbox.displayvalue"
                     validators="asyncwarningvalidator3=foo">
            <div ng-message="asyncwarningvalidator3">no foo!</div>
        </xui-textbox>
        <xui-textbox id="numericTextBox" type="number" ng-model="ctrl.unsetBinding"></xui-textbox>
        <xui-textbox id="numericTextBoxValidation" type="number" ng-model="ctrl.anotherUnsetBinding"
                     validators="max=2"></xui-textbox>
    </ng-form>
</div>
<script>
    Xui.directive("customstringvalidator1", validatorDirective);
    function validatorDirective() {
        return {
            require: 'ngModel',
            restrict: '',
            link: function (scope, elm, attrs, ctrl) {
                if (ctrl) {
                    //DOM -> model
                    ctrl.$parsers.unshift(function (value) {
                        var neededString = attrs.customstringvalidator1;

                        var valid = false;
                        if (value) {
                            valid = value.indexOf(neededString) > -1;
                        }
                        ctrl.$setValidity('customstringvalidator1', valid);
                        return valid ? value : undefined;
                    });

                    //Model-> DOM
                    ctrl.$formatters.unshift(function (value) {
                        var neededString = attrs.customstringvalidator1;

                        var valid = false;
                        if (value) {
                            valid = value.indexOf(neededString) > -1;
                        }
                        ctrl.$setValidity('customstringvalidator1', valid);
                        ctrl.$setDirty(); //gets instant validation, without a blur
                        return value;
                    });
                }
            }
        };
    }
    ;

    Xui.directive("asyncwarningvalidator3", ["$timeout", "$q", asyncWarningValidatorDirective]);
    function asyncWarningValidatorDirective($timeout, $q) {
        return {
            require: 'ngModel',
            restrict: '',
            link: function (scope, elm, attrs, ctrl) {
                if (ctrl) {
                    ctrl.$asyncValidators.asyncwarningvalidator3 = function (modelValue, viewValue) {
                        var deferred = $q.defer();
                        $timeout(function () {
                            var neededString = attrs.asyncwarningvalidator3;
                            var isWarning = true;
                            if (viewValue) {
                                isWarning = !(viewValue.indexOf(neededString) > -1);
                            }
                            ctrl.$xuiSetWarning('asyncwarningvalidator3', isWarning);
                            deferred.resolve();
                        }, 10);
                        return deferred.promise;
                    };
                }
            }
        };
    }

    function textboxController() {
        this.maxNumber = 100;
        this.minNumber = -100;
        this.someNumber = 42;
        this.isDisabled = false;
    }
    Xui.controller("TextboxController", textboxController);

</script>
