<script type="text/javascript">
    function generateTree(children, count, depth, callbackFn, childrenName) {
        childrenName = childrenName || 'children';
        if (depth <= 0) {
            return;
        }
        for (var i = 0; i < count; i++) {
            var node = {label: 'Node' + (i + 1), id: 'id_' + i};
            if (depth > 1) {
                node[childrenName] = [];
            }
            if (callbackFn) {
                callbackFn(node);
            }
            children.push(node);
            generateTree(node[childrenName], count, depth - 1, callbackFn, childrenName);
        }
    }

    var imageUrl = 'pages/img/sw.gif';
</script>

<hr>

<h3>Basic usage</h3>
<div ng-controller="TreeviewBasicCtrl" id="basic-usage">
    <xui-treeview model="model" options="options" context="context">
        {{::node.$model.label}}
    </xui-treeview>
    <p>Focused node: <span id="basic-usage-focused">{{context.focusedNode.$model.label}}</span></p>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewBasicCtrl', function ($scope) {
        $scope.context = {};

        $scope.options = {
            selectionMode: 'single',
            isAlwaysSelected: true
        };

        $scope.model = [];
        generateTree($scope.model, 10, 3);
    }, ['$scope']);
</script>

<h3>Basic usage with custom child name</h3>
<div ng-controller="TreeviewCustomChildrenNameCtrl" id="basic-usage-custom-children">
    <xui-treeview model="model" options="options" context="context">
        {{::node.$model.label}}
    </xui-treeview>
    <p>Focused node: <span id="basic-usage-custom-children-focused">{{context.focusedNode.$model.label}}</span> </p>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewCustomChildrenNameCtrl', function ($scope) {
        var CUSTOM_CHILDREN_KEY_NAME = 'childrenRenamed';

        $scope.context = {};

        $scope.options = {
            childrenKey: CUSTOM_CHILDREN_KEY_NAME,
            selectionMode: 'single',
            isAlwaysSelected: true
        };

        $scope.model = [];
        generateTree($scope.model, 10, 3, angular.noop, CUSTOM_CHILDREN_KEY_NAME);
    }, ['$scope']);
</script>

<hr>

<h3>Is always selected disabled</h3>
<div ng-controller="TreeviewIsAlwaysSelectedDisabledCtrl" id="is-always-selected-disabled">
    <xui-treeview model="model" options="options" context="context">
        {{::node.$model.label}}
    </xui-treeview>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewIsAlwaysSelectedDisabledCtrl', function ($scope) {
        $scope.context = {};

        $scope.options = {
            selectionMode: 'single'
        };

        $scope.model = [];
        generateTree($scope.model, 10, 3);
    }, ['$scope']);
</script>

<hr>

<h3>Links in nodes</h3>
<div ng-controller="TreeviewLinksCtrl" id="links-images">
    <xui-treeview model="model" options="options" context="context">
        <a href="http://www.solarwinds.com">{{::node.$model.label}}</a>
    </xui-treeview>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewLinksCtrl', function ($scope) {
        $scope.context = {};

        $scope.model = [];
        generateTree($scope.model, 10, 3, function (n) {
            n.imageUrl = imageUrl;
            n.icon = "status_up";            
        });
        delete $scope.model[9].children;
    }, ['$scope']);
</script>

<hr>

<h3>Multi-selection mode</h3>
<div ng-controller="TreeviewMultiCtrl" id="multi-select">
    <xui-treeview model="model" options="options" context="context">
        {{::node.$model.label}}
    </xui-treeview>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewMultiCtrl', function ($scope) {
        $scope.context = {};

        $scope.options = {
            selectionMode: 'multi'
        };

        $scope.model = [];
        generateTree($scope.model, 10, 3, function (n) {
            n.imageUrl = imageUrl;
        });
    }, ['$scope']);
</script>

<hr>

<!--This is commented out due to defect UIF-2727-->
<!--<h3>Async mode</h3>-->
<!--<div ng-controller="TreeviewAsyncCtrl">-->
    <!--<xui-treeview model="model" options="options" context="context">-->
        <!--{{::node.$model.label}}-->
    <!--</xui-treeview>-->
<!--</div>-->
<!--<script type="text/javascript">-->
    <!--Xui.controller('TreeviewAsyncCtrl', function ($scope, $q) {-->
        <!--$scope.context = {};-->

        <!--$scope.options = {-->
            <!--selectionMode: 'single',-->
            <!--load: function (vnode) {-->
                <!--var deferred = $q.defer();-->

                <!--var children = vnode.$level > 3 ? null : [];-->

                <!--setTimeout(function () {-->
                    <!--deferred.resolve([-->
                        <!--{label: 'Async #1', children: children, imageUrl: imageUrl},-->
                        <!--{label: 'Async #2', children: children, imageUrl: imageUrl}]);-->
                <!--}, 1000);-->

                <!--return deferred.promise;-->
            <!--}-->
        <!--};-->

        <!--$scope.model = [];-->
    <!--}, ['$scope', '$q']);-->
<!--</script>-->

<!--<hr>-->

<h3>Limiting number of nodes</h3>
<div ng-controller="TreeviewLimitCtrl" id="limit">
    <xui-treeview model="model" options="options" context="context">
        {{::node.$model.label}}
    </xui-treeview>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewLimitCtrl', function ($scope) {
        $scope.context = {};

        $scope.options = {
            selectionMode: 'single',
            limit: 3
        };

        $scope.model = [];
        generateTree($scope.model, 10, 3, function (n) {
            n.imageUrl = imageUrl;
        });

    }, ['$scope']);
</script>

<hr>

<h3>Sorting</h3>
<div ng-controller="TreeviewSort" id="sorter">
    <xui-button ng-click="model.reverse()">sort root</xui-button>
    <xui-button ng-click="model[0].children.reverse()">sort first child</xui-button>
    <xui-treeview model="model" options="options" context="context">
        {{::node.$model.label}}
    </xui-treeview>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewSort', function ($scope, $q) {
        $scope.context = {};
        $scope.options = {trackBy: 'id'};

        $scope.model = [];
        generateTree($scope.model, 10, 3, function (n) {
            n.imageUrl = imageUrl;
        });

    }, ['$scope', '$q']);
</script>

<hr>

<h3>State binding</h3>
<div ng-controller="TreeviewStateCtrl" id="state">
    <xui-treeview model="model" options="options" context="context" state="{{state}}"
                  node-identifier="id">
        Node {{::node.$model.id}}
    </xui-treeview>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewStateCtrl', function($scope,$timeout) {
        $scope.context = {};
        $scope.model = [];
        generateTree($scope.model, 5, 3);
        $scope.options = {
            selectionMode: 'single'
        }

        $timeout(function() {
            $scope.state = [
                {id: "id_0",
                    path: [],
                    expanded:true,
                    checked:false},
                {id: "id_2",
                    path: ["id_0"],
                    expanded:true,
                    checked:true}];
        });
    }, ['$scope', '$timeout']);
</script>

<hr>

<h3>Firing events</h3>
<div ng-controller="TreeviewEventsCtrl" id="events">
    <xui-treeview model="model" options="options" context="context" node-identifier="id">
        Node {{::node.$model.id}}
    </xui-treeview>
    <p>
        Event:
        <span id="events-last-fired">{{firedEvent}}</span>
    </p>
</div>
<script type="text/javascript">
    Xui.controller('TreeviewEventsCtrl', function($scope) {
        $scope.context = {};
        $scope.model = [];
        generateTree($scope.model, 5, 3);
        $scope.options = {
            onExpand: expandCb,
            onCollapse: collapseCb,
            onSelect: selectCb,
            onDblClick: dblClickCb,
            selectionMode: 'single'
        }

        function expandCb() {
            console.log('expanded');
            $scope.firedEvent = 'expanded';
        }
        function collapseCb() {
            console.log('collapsed');
            $scope.firedEvent = 'collapsed';
        }
        function selectCb() {
            console.log('selected');
            $scope.firedEvent = 'selected';
        }
        function dblClickCb() {
            console.log('dbClicked');
            $scope.firedEvent = 'dbClicked';
        }
    }, ['$scope']);
</script>
