<div class="xui" ng-controller="StatusFilterController as vm">
    <xui-status-filter id="testStatusFilter"
                       active-filters="vm.activeFilters"
                       filter-source="vm.filterSource"
                       filter-change="vm.filterChange()">
    </xui-status-filter>
    <xui-grid id="testGrid"
              items-source="vm.filteredItems"
              pagination-data="vm.gridPagination"
              smart-mode="vm.smartMode"
              sorting-data="vm.sorting"
              options="vm.gridOptions"
              hide-toolbar="vm.hideToolbar"
              template-url="demo-item-template">
    </xui-grid>
</div>

<script type="text/javascript">
    (function () {
        Xui.controller("StatusFilterController", statusFilterController, ["$templateCache"]);
        function statusFilterController($templateCache) {
            var vm = this;

            vm.activeFilters = [];
            vm.selectedItems = [];
            vm.items = [
                {
                    id: 0, severity: "critical", name: "Alert me when a component goes into critical state",
                    description: "Some custom description for critical alert"
                },
                {
                    id: 1, severity: "critical", name: "Alert me when a component goes into critical state",
                    description: "Some custom description for critical alert"
                },
                {
                    id: 2, severity: "critical", name: "Alert me when a component goes into critical state",
                    description: "Some custom description for critical alert"
                },
                {
                    id: 3, severity: "critical", name: "Alert me when a component goes into critical state",
                    description: "Some custom description for critical alert"
                },
                {
                    id: 5, severity: "warning", name: "Alert me when a component needs to be updated",
                    description: "Some custom description for warning alert"
                },
                {
                    id: 6, severity: "warning", name: "Alert me when a component needs to be updated",
                    description: "Some custom description for warning alert"
                },
                {
                    id: 7, severity: "warning", name: "Alert me when a component needs to be updated",
                    description: "Some custom description for warning alert"
                },
                {
                    id: 8, severity: "warning", name: "Alert me when a component needs to be updated",
                    description: "Some custom description for warning alert"
                },
                {
                    id: 9, severity: "warning", name: "Alert me when a component needs to be updated",
                    description: "Some custom description for warning alert"
                },
                {
                    id: 10, severity: "info", name: "Notify me when a component change his status",
                    description: "Some custom description for info alert"
                },
                {
                    id: 11, severity: "info", name: "Notify me when a component change his status",
                    description: "Some custom description for info alert"
                },
                {
                    id: 12, severity: "info", name: "Notify me when a component change his status",
                    description: "Some custom description for info alert"
                }
            ];

            _.each(vm.items, function (item) {
                item.filterIcon = "severity_" + item.severity
            });

            vm.smartMode = true;
            vm.hideToolbar = true;

            vm.gridOptions = {
                triggerSearchOnChange: true,
                searchDebounce: 500,
                hidePagination: false,
                pagerAdjacent: 0
            };

            vm.gridPagination = {
                page: 1,
                pageSize: 5
            };

            vm.sorting = {
                sortableColumns: [{
                    id: "name",
                    label: "Name"
                }, {
                    id: "severity",
                    label: "Severity"
                }
                ],
                sortBy: {
                    id: "name",
                    label: "Name"
                },
                direction: "asc"
            };

            vm.filteredItems = _.cloneDeep(vm.items);

            vm.filterSource = transformFilterSource();

            vm.filterChange = function () {
                if (_.isEmpty(vm.activeFilters)) {
                    return vm.filteredItems = _.cloneDeep(vm.items);
                }
                vm.filteredItems = _.filter(vm.items, function (item) {
                    var isFiltered = false;
                    _.each(vm.activeFilters, function (filter) {
                        if (item.filterIcon === filter) {
                            return isFiltered = true;
                        }
                    });
                    return isFiltered;
                });
            };
            function transformFilterSource() {
                var transformedFilterSource = [];
                var filterCounts = _.countBy(vm.items, "filterIcon");
                _.forEach(filterCounts, function (value, key) {
                    transformedFilterSource.push({
                        name: key,
                        value: value,
                        tooltip: key,
                        tooltipAppendToBody: true,
                        emphasize: resolveEmphasize(key),
                        icon: key
                    });
                });
                return transformedFilterSource;
            }

            function resolveEmphasize(name) {
                var vocabulary = {
                    "severity_critical": "xui-color-critical-border",
                    "severity_warning": "xui-color-warning-border",
                    "severity_info": "xui-color-info-border"
                };
                return vocabulary[name] || "xui-color-ok-border"
            }


            $templateCache.put("demo-item-template",
                    "<div style='display:flex; justify-content:flex-start;'><xui-icon icon='{{item.filterIcon}}'></xui-icon>" +
                    "<div style='margin-left:20px;' class='xui-text-warning'>{{item.name}}</div><div style='margin-left:20px;'>{{item.description}}</div></div>");
        }
    })();
</script>