import { browser, by, promise } from "@solarwinds/uzi/protractor";
import { WebElementPromise } from "@solarwinds/uzi/webdriver";
import { Eyes } from "eyes.protractor";

///<reference path="../typings/index.d.ts"/>

let eyes: Eyes;

// Node typings have conflicts with webpack-env
declare var process: any;

export default class Helpers {
    static async prepareBrowser(pageName?: string) {
        const url = pageName
            ? `/e2e/${pageName}.html`
            : "/demo";
        await browser.get(url);
    }

    static prepareEyes() {
        if (!eyes) {
            eyes = new Eyes();
            eyes.setApiKey(<string> process.env.EYES_API_KEY);
            let branchName = <string> process.env.EYES_BRANCH || "Unknown";
            branchName = branchName.substring(branchName.lastIndexOf("/") + 1);
            eyes.setBatch("Visual Testing - " + branchName);
            eyes.setBranchName(branchName);
            if (branchName !== "develop") {
                eyes.setParentBranchName("develop");
            }
            eyes.setForceFullPageScreenshot(true);
            eyes.setStitchMode("CSS");
        }
        return eyes;
    }

    public static getElementByXpath(elementXpath: string): WebElementPromise {
        return browser.driver.findElement(by.xpath(elementXpath));
    }

    public static getElementByCSS(elementCSS: string): WebElementPromise {
        return browser.driver.findElement(by.css(elementCSS));
    }

}
