"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor_1 = require("@solarwinds/uzi/protractor");
const uzi_1 = require("@solarwinds/uzi");
const index_atom_1 = require("../index.atom");
class TimeframePickerAtom extends uzi_1.Atom {
    getPopoverAtom() {
        return index_atom_1.PopoverAtom.findIn(index_atom_1.PopoverAtom, super.getElement());
    }
    ;
    getStartDatetimePicker() {
        return this.getPopoverAtom().getPopover().then((popover) => {
            return index_atom_1.DatetimePickerAtom.findIn(index_atom_1.DatetimePickerAtom, popover.element(protractor_1.by.className("xui-timeframe-picker__start-datetime-picker")));
        });
    }
    ;
    getEndDatetimePicker() {
        return this.getPopoverAtom().getPopover().then((popover) => {
            return index_atom_1.DatetimePickerAtom.findIn(index_atom_1.DatetimePickerAtom, popover.element(protractor_1.by.className("xui-timeframe-picker__end-datetime-picker")));
        });
    }
    ;
    setStartDate(date) {
        this.open();
        return this.getStartDatetimePicker().then((picker) => {
            picker.getDatePicker().clearText();
            picker.getDatePicker().acceptText(date);
            picker.getDatePicker().clickCalendarIcon();
        });
    }
    ;
    setStartTime(time) {
        return this.open()
            .then(() => this.getStartDatetimePicker())
            .then((picker) => {
            return picker.getTimePicker().acceptText(time);
        });
    }
    ;
    setEndDate(date) {
        this.open();
        return this.getEndDatetimePicker().then((picker) => {
            picker.getDatePicker().clearText();
            picker.getDatePicker().acceptText(date);
            picker.getDatePicker().clickCalendarIcon();
        });
    }
    ;
    setEndTime(time) {
        this.open();
        return this.getEndDatetimePicker().then((picker) => {
            return picker.getTimePicker().acceptText(time);
        });
    }
    ;
    getLinkElement() {
        return this.getElement().element(protractor_1.by.className("xui-timeframe-picker__link"));
    }
    ;
    isOpened() {
        return this.getPopoverAtom().getPopover().then((popover) => {
            return popover.isDisplayed();
        });
    }
    ;
    selectPresetByTitle(title) {
        this.getLinkElement().click();
        return this.getPopoverAtom().getPopover().then((popover) => {
            return popover.all(protractor_1.by.className("xui-timeframe-picker__preset"))
                .filter((elem) => {
                return elem.getText().then(function (text) {
                    return text === title;
                });
            })
                .get(0).click();
        });
    }
    ;
    open() {
        return this.isOpened().then((opened) => {
            if (!opened) {
                this.getLinkElement().click();
            }
        });
    }
    ;
    close() {
        return this.isOpened().then((opened) => {
            if (opened) {
                this.getLinkElement().click();
            }
        });
    }
    ;
    getSelectedPreset() {
        return this.open().then(() => {
            return this.getPopoverAtom().getPopover().then((popover) => {
                let selectedPreset = popover.element(protractor_1.by.className("xui-timeframe-picker__preset--selected"));
                let selectedPresetName = selectedPreset.isPresent().then((preset) => {
                    if (!preset) {
                        return null;
                    }
                    else {
                        return selectedPreset.getText();
                    }
                });
                return selectedPresetName;
            });
        });
    }
    ;
    isConfirmationPanelShown() {
        return this.getPopoverAtom().getPopover().then((popover) => {
            const confirmationPanelElement = popover.element(protractor_1.by.className("xui-timeframe-picker__confirmation-panel"));
            return confirmationPanelElement.isPresent().then((present) => {
                return present ? confirmationPanelElement.isDisplayed() : false;
            });
        });
    }
    ;
    clickUseButton() {
        this.getPopoverAtom().getPopover().then((popover) => {
            popover.element(protractor_1.by.className("xui-timeframe-picker__confirm-button")).click();
        });
    }
    ;
    clickCancelButton() {
        return this.getPopoverAtom().getPopover().then((popover) => {
            return popover.element(protractor_1.by.className("xui-timeframe-picker__cancel-button")).click();
        });
    }
    ;
    clickOnDateStartDTP(day) {
        this.open();
        return this.getStartDatetimePicker().then((dateTimePicker) => {
            let datePicker = dateTimePicker.getDatePicker();
            datePicker.clickInput();
            datePicker.selectDay(day);
            this.clickUseButton();
        });
    }
    clickOnDateEndDTP(day) {
        this.open();
        return this.getEndDatetimePicker().then((dateTimePicker) => {
            let datePicker = dateTimePicker.getDatePicker();
            datePicker.clickInput();
            datePicker.selectDay(day);
            this.clickUseButton();
        });
    }
}
TimeframePickerAtom.CSS_CLASS = "xui-timeframe-picker";
exports.TimeframePickerAtom = TimeframePickerAtom;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdGltZWZyYW1lcGlja2VyL3RpbWVmcmFtZVBpY2tlci5hdG9tLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkRBQXNFO0FBQ3RFLHlDQUFxQztBQUNyQyw4Q0FBOEQ7QUFFOUQseUJBQWlDLFNBQVEsVUFBSTtJQUdsQyxjQUFjO1FBQ2pCLE1BQU0sQ0FBQyx3QkFBVyxDQUFDLE1BQU0sQ0FBQyx3QkFBVyxFQUFFLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFBQSxDQUFDO0lBRUssc0JBQXNCO1FBQ3pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsVUFBVSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDdkQsTUFBTSxDQUFDLCtCQUFrQixDQUFDLE1BQU0sQ0FBQywrQkFBa0IsRUFDL0MsT0FBTyxDQUFDLE9BQU8sQ0FBQyxlQUFFLENBQUMsU0FBUyxDQUFDLDZDQUE2QyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RGLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUFBLENBQUM7SUFFSyxvQkFBb0I7UUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUN2RCxNQUFNLENBQUMsK0JBQWtCLENBQUMsTUFBTSxDQUFDLCtCQUFrQixFQUMvQyxPQUFPLENBQUMsT0FBTyxDQUFDLGVBQUUsQ0FBQyxTQUFTLENBQUMsMkNBQTJDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEYsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQUEsQ0FBQztJQUVLLFlBQVksQ0FBQyxJQUFZO1FBQzVCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVaLE1BQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFN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QUFDLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDeEYsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQUEsQ0FBQztJQUVLLG1CQUFtQixDQUFDLEdBQVc7UUFDbEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRVosTUFBTSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWtDLEVBQUUsRUFBRTtZQUM3RSxJQUFJLFVBQVUsR0FBRyxjQUFjLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFaEQsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3hCLFVBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVNLGlCQUFpQixDQUFDLEdBQVc7UUFDaEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRVosTUFBTSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWtDLEVBQUUsRUFBRTtZQUMzRSxJQUFJLFVBQVUsR0FBRyxjQUFjLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFaEQsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3hCLFVBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7QUE5SmEsNkJBQVMsR0FBRyxzQkFBc0IsQ0FBQztBQURyRCxrREFnS0MiLCJmaWxlIjoiY29tcG9uZW50cy90aW1lZnJhbWVwaWNrZXIvdGltZWZyYW1lUGlja2VyLmF0b20uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2J5LCBFbGVtZW50RmluZGVyLCBwcm9taXNlfSBmcm9tIFwiQHNvbGFyd2luZHMvdXppL3Byb3RyYWN0b3JcIjtcbmltcG9ydCB7QXRvbX0gZnJvbSBcIkBzb2xhcndpbmRzL3V6aVwiO1xuaW1wb3J0IHtEYXRldGltZVBpY2tlckF0b20sIFBvcG92ZXJBdG9tfSBmcm9tIFwiLi4vaW5kZXguYXRvbVwiO1xuXG5leHBvcnQgY2xhc3MgVGltZWZyYW1lUGlja2VyQXRvbSBleHRlbmRzIEF0b20ge1xuICAgIHB1YmxpYyBzdGF0aWMgQ1NTX0NMQVNTID0gXCJ4dWktdGltZWZyYW1lLXBpY2tlclwiO1xuXG4gICAgcHVibGljIGdldFBvcG92ZXJBdG9tKCk6IFBvcG92ZXJBdG9tIHtcbiAgICAgICAgcmV0dXJuIFBvcG92ZXJBdG9tLmZpbmRJbihQb3BvdmVyQXRvbSwgc3VwZXIuZ2V0RWxlbWVudCgpKTtcbiAgICB9O1xuXG4gICAgcHVibGljIGdldFN0YXJ0RGF0ZXRpbWVQaWNrZXIoKTogcHJvbWlzZS5Qcm9taXNlPERhdGV0aW1lUGlja2VyQXRvbT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRQb3BvdmVyQXRvbSgpLmdldFBvcG92ZXIoKS50aGVuKChwb3BvdmVyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gRGF0ZXRpbWVQaWNrZXJBdG9tLmZpbmRJbihEYXRldGltZVBpY2tlckF0b20sXG4gICAgICAgICAgICAgICAgcG9wb3Zlci5lbGVtZW50KGJ5LmNsYXNzTmFtZShcInh1aS10aW1lZnJhbWUtcGlja2VyX19zdGFydC1kYXRldGltZS1waWNrZXJcIikpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBnZXRFbmREYXRldGltZVBpY2tlcigpOiBwcm9taXNlLlByb21pc2U8RGF0ZXRpbWVQaWNrZXJBdG9tPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFBvcG92ZXJBdG9tKCkuZ2V0UG9wb3ZlcigpLnRoZW4oKHBvcG92ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBEYXRldGltZVBpY2tlckF0b20uZmluZEluKERhdGV0aW1lUGlja2VyQXRvbSxcbiAgICAgICAgICAgICAgICBwb3BvdmVyLmVsZW1lbnQoYnkuY2xhc3NOYW1lKFwieHVpLXRpbWVmcmFtZS1waWNrZXJfX2VuZC1kYXRldGltZS1waWNrZXJcIikpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzZXRTdGFydERhdGUoZGF0ZTogc3RyaW5nKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5vcGVuKCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RhcnREYXRldGltZVBpY2tlcigpLnRoZW4oKHBpY2tlcikgPT4ge1xuICAgICAgICAgICAgcGlja2VyLmdldERhdGVQaWNrZXIoKS5jbGVhclRleHQoKTtcbiAgICAgICAgICAgIHBpY2tlci5nZXREYXRlUGlja2VyKCkuYWNjZXB0VGV4dChkYXRlKTtcbiAgICAgICAgICAgIHBpY2tlci5nZXREYXRlUGlja2VyKCkuY2xpY2tDYWxlbmRhckljb24oKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzZXRTdGFydFRpbWUodGltZTogc3RyaW5nKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlbigpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLmdldFN0YXJ0RGF0ZXRpbWVQaWNrZXIoKSlcbiAgICAgICAgICAgIC50aGVuKChwaWNrZXIpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGlja2VyLmdldFRpbWVQaWNrZXIoKS5hY2NlcHRUZXh0KHRpbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzZXRFbmREYXRlKGRhdGU6IHN0cmluZyk6IHByb21pc2UuUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRoaXMub3BlbigpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmdldEVuZERhdGV0aW1lUGlja2VyKCkudGhlbigocGlja2VyKSA9PiB7XG4gICAgICAgICAgICBwaWNrZXIuZ2V0RGF0ZVBpY2tlcigpLmNsZWFyVGV4dCgpO1xuICAgICAgICAgICAgcGlja2VyLmdldERhdGVQaWNrZXIoKS5hY2NlcHRUZXh0KGRhdGUpO1xuICAgICAgICAgICAgcGlja2VyLmdldERhdGVQaWNrZXIoKS5jbGlja0NhbGVuZGFySWNvbigpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHVibGljIHNldEVuZFRpbWUodGltZTogc3RyaW5nKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5vcGVuKCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RW5kRGF0ZXRpbWVQaWNrZXIoKS50aGVuKChwaWNrZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBwaWNrZXIuZ2V0VGltZVBpY2tlcigpLmFjY2VwdFRleHQodGltZSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgZ2V0TGlua0VsZW1lbnQoKTogRWxlbWVudEZpbmRlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEVsZW1lbnQoKS5lbGVtZW50KGJ5LmNsYXNzTmFtZShcInh1aS10aW1lZnJhbWUtcGlja2VyX19saW5rXCIpKTtcbiAgICB9O1xuXG4gICAgcHVibGljIGlzT3BlbmVkKCk6IHByb21pc2UuUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFBvcG92ZXJBdG9tKCkuZ2V0UG9wb3ZlcigpLnRoZW4oKHBvcG92ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBwb3BvdmVyLmlzRGlzcGxheWVkKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgc2VsZWN0UHJlc2V0QnlUaXRsZSh0aXRsZTogc3RyaW5nKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5nZXRMaW5rRWxlbWVudCgpLmNsaWNrKCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UG9wb3ZlckF0b20oKS5nZXRQb3BvdmVyKCkudGhlbigocG9wb3ZlcikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHBvcG92ZXIuYWxsKGJ5LmNsYXNzTmFtZShcInh1aS10aW1lZnJhbWUtcGlja2VyX19wcmVzZXRcIikpXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoZWxlbTogRWxlbWVudEZpbmRlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRUZXh0KCkudGhlbihmdW5jdGlvbiAodGV4dDogc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGV4dCA9PT0gdGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmdldCgwKS5jbGljaygpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHVibGljIG9wZW4oKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNPcGVuZWQoKS50aGVuKChvcGVuZWQpID0+IHtcbiAgICAgICAgICAgIGlmICghb3BlbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRMaW5rRWxlbWVudCgpLmNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgY2xvc2UoKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNPcGVuZWQoKS50aGVuKChvcGVuZWQpID0+IHtcbiAgICAgICAgICAgIGlmIChvcGVuZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldExpbmtFbGVtZW50KCkuY2xpY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBnZXRTZWxlY3RlZFByZXNldCgpOiBwcm9taXNlLlByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wZW4oKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFBvcG92ZXJBdG9tKCkuZ2V0UG9wb3ZlcigpLnRoZW4oKHBvcG92ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRQcmVzZXQgPSBwb3BvdmVyLmVsZW1lbnQoYnkuY2xhc3NOYW1lKFwieHVpLXRpbWVmcmFtZS1waWNrZXJfX3ByZXNldC0tc2VsZWN0ZWRcIikpO1xuXG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkUHJlc2V0TmFtZSA9IHNlbGVjdGVkUHJlc2V0LmlzUHJlc2VudCgpLnRoZW4oKHByZXNldCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXByZXNldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRQcmVzZXQuZ2V0VGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRQcmVzZXROYW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgaXNDb25maXJtYXRpb25QYW5lbFNob3duKCk6IHByb21pc2UuUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFBvcG92ZXJBdG9tKCkuZ2V0UG9wb3ZlcigpLnRoZW4oKHBvcG92ZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1hdGlvblBhbmVsRWxlbWVudCA9IHBvcG92ZXIuZWxlbWVudChieS5jbGFzc05hbWUoXCJ4dWktdGltZWZyYW1lLXBpY2tlcl9fY29uZmlybWF0aW9uLXBhbmVsXCIpKTtcblxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1hdGlvblBhbmVsRWxlbWVudC5pc1ByZXNlbnQoKS50aGVuKChwcmVzZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByZXNlbnQgPyBjb25maXJtYXRpb25QYW5lbEVsZW1lbnQuaXNEaXNwbGF5ZWQoKSA6IDxhbnk+ZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBjbGlja1VzZUJ1dHRvbigpIHtcbiAgICAgICAgdGhpcy5nZXRQb3BvdmVyQXRvbSgpLmdldFBvcG92ZXIoKS50aGVuKChwb3BvdmVyKSA9PiB7XG4gICAgICAgICAgICBwb3BvdmVyLmVsZW1lbnQoYnkuY2xhc3NOYW1lKFwieHVpLXRpbWVmcmFtZS1waWNrZXJfX2NvbmZpcm0tYnV0dG9uXCIpKS5jbGljaygpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcHVibGljIGNsaWNrQ2FuY2VsQnV0dG9uKCk6IHByb21pc2UuUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFBvcG92ZXJBdG9tKCkuZ2V0UG9wb3ZlcigpLnRoZW4oKHBvcG92ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBwb3BvdmVyLmVsZW1lbnQoYnkuY2xhc3NOYW1lKFwieHVpLXRpbWVmcmFtZS1waWNrZXJfX2NhbmNlbC1idXR0b25cIikpLmNsaWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgY2xpY2tPbkRhdGVTdGFydERUUChkYXk6IG51bWJlcikge1xuICAgICAgICB0aGlzLm9wZW4oKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5nZXRTdGFydERhdGV0aW1lUGlja2VyKCkudGhlbigoZGF0ZVRpbWVQaWNrZXI6IERhdGV0aW1lUGlja2VyQXRvbSkgPT4ge1xuICAgICAgICAgICAgbGV0IGRhdGVQaWNrZXIgPSBkYXRlVGltZVBpY2tlci5nZXREYXRlUGlja2VyKCk7XG5cbiAgICAgICAgICAgIGRhdGVQaWNrZXIuY2xpY2tJbnB1dCgpO1xuICAgICAgICAgICAgZGF0ZVBpY2tlci5zZWxlY3REYXkoZGF5KTtcbiAgICAgICAgICAgIHRoaXMuY2xpY2tVc2VCdXR0b24oKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNsaWNrT25EYXRlRW5kRFRQKGRheTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMub3BlbigpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmdldEVuZERhdGV0aW1lUGlja2VyKCkudGhlbigoZGF0ZVRpbWVQaWNrZXI6IERhdGV0aW1lUGlja2VyQXRvbSkgPT4ge1xuICAgICAgICAgICAgbGV0IGRhdGVQaWNrZXIgPSBkYXRlVGltZVBpY2tlci5nZXREYXRlUGlja2VyKCk7XG5cbiAgICAgICAgICAgIGRhdGVQaWNrZXIuY2xpY2tJbnB1dCgpO1xuICAgICAgICAgICAgZGF0ZVBpY2tlci5zZWxlY3REYXkoZGF5KTtcbiAgICAgICAgICAgIHRoaXMuY2xpY2tVc2VCdXR0b24oKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
