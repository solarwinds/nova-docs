"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor_1 = require("@solarwinds/uzi/protractor");
const helpers_1 = require("../helpers");
const index_atom_1 = require("../index.atom");
describe("USERCONTROL TimeframePicker >", () => {
    let timeframePicker, timeframePickerMaxMin;
    function getModelStartDatetime(id = "model-startDatetime") {
        return protractor_1.element(protractor_1.by.id(id)).getText();
    }
    function getModelEndDatetime(id = "model-endDatetime") {
        return protractor_1.element(protractor_1.by.id(id)).getText();
    }
    function getMaxDate() {
        return protractor_1.element(protractor_1.by.id("maxDatetime")).getText();
    }
    function getMinDate() {
        return protractor_1.element(protractor_1.by.id("minDatetime")).getText();
    }
    function getOnChangeText() {
        return protractor_1.element(protractor_1.by.id("model-onChangeTitle")).getText();
    }
    function getModelSelectedPresetId() {
        return protractor_1.element(protractor_1.by.id("model-selectedPresetId")).getText();
    }
    function getTime() {
        let hour = new Date().getHours();
        hour = hour === 1 ? 3 : 1;
        return "0" + hour + ":01 AM";
    }
    function getStartDate() {
        return "01-Jan-2010";
    }
    function getEndDate() {
        return "01-Feb-2010";
    }
    beforeEach(() => {
        helpers_1.default.prepareBrowser("timeframepicker");
        timeframePicker = index_atom_1.TimeframePickerAtom.findIn(index_atom_1.TimeframePickerAtom, protractor_1.element(protractor_1.by.id("timeframepicker")));
        timeframePickerMaxMin = index_atom_1.TimeframePickerAtom.findIn(index_atom_1.TimeframePickerAtom, protractor_1.element(protractor_1.by.id("tfpMaxMin")));
    });
    describe("when the title is clicked", () => {
        it(" it opens the popover", () => {
            expect(timeframePicker.isOpened()).toEqual(false);
            timeframePicker.open();
            expect(timeframePicker.isOpened()).toEqual(true);
        });
    });
    describe("when the popover is opened", () => {
        describe("and a new quick pick is selected", () => {
            it(" it highlights the selected quick pick", () => {
                timeframePicker.selectPresetByTitle("Last 12 hours");
                protractor_1.browser.wait(() => {
                    return timeframePicker.getSelectedPreset().then((preset) => {
                        return preset === "Last 12 hours";
                    });
                }, 20000);
                expect(timeframePicker.getSelectedPreset()).toEqual("Last 12 hours");
            });
            it(" it closes the confirmation panel", () => {
                timeframePicker.selectPresetByTitle("Last 12 hours");
                protractor_1.browser.wait(() => {
                    return timeframePicker.isOpened().then((isOpened) => {
                        return !isOpened;
                    });
                }, 1000);
                expect(timeframePicker.isOpened()).toEqual(false);
            });
            it(" it changes model.selectedPresetId", () => {
                expect(getModelSelectedPresetId()).toBe("lastHour");
                timeframePicker.selectPresetByTitle("Last 12 hours");
                expect(getModelSelectedPresetId()).toBe("last12Hours");
            });
        });
        describe("and a date is changed", () => {
            it("it displays the confirmation panel", () => {
                timeframePicker.open();
                expect(timeframePicker.isConfirmationPanelShown()).toBe(false);
                timeframePicker.setStartTime(getTime());
                expect(timeframePicker.isConfirmationPanelShown()).toBe(true);
            });
            it(" no quick pick is selected", () => {
                expect(timeframePicker.getSelectedPreset()).not.toBeNull();
                timeframePicker.setStartTime(getTime());
                expect(timeframePicker.getSelectedPreset()).toBeNull();
            });
            it(" it restores dates when start date is greater then end date", () => {
                const startDatetime = getModelStartDatetime();
                const endDatetime = getModelEndDatetime();
                const selectedPresetId = getModelSelectedPresetId();
                timeframePicker.setStartDate(getEndDate());
                timeframePicker.setEndDate(getStartDate());
                expect(getModelStartDatetime()).toBe(startDatetime);
                expect(getModelEndDatetime()).toBe(endDatetime);
                expect(getModelSelectedPresetId()).toBe(selectedPresetId);
            });
            it(" it restores dates when start date or end date is empty", () => {
                const startDatetime = getModelStartDatetime();
                const selectedPresetId = getModelSelectedPresetId();
                timeframePicker.open();
                timeframePicker.getStartDatetimePicker().then((picker) => {
                    picker.getDatePicker().clearText();
                    picker.getDatePicker().clickCalendarIcon();
                });
                expect(getModelStartDatetime()).toBe(startDatetime);
                timeframePicker.getStartDatetimePicker().then((picker) => {
                    picker.getTimePicker().clearText();
                });
                expect(getModelStartDatetime()).toBe(startDatetime);
                expect(getModelSelectedPresetId()).toBe(selectedPresetId);
            });
            describe("and 'Use' button is clicked", () => {
                it(" it closes the popover", () => {
                    timeframePicker.setStartTime(getTime());
                    timeframePicker.clickUseButton();
                    protractor_1.browser.wait(() => {
                        return timeframePicker.isOpened().then((isOpened) => {
                            return !isOpened;
                        });
                    }, 1000);
                    expect(timeframePicker.isOpened()).toBe(false);
                });
                it(" it changes the title", () => {
                    timeframePicker.getLinkElement().getText().then((link) => {
                        timeframePicker.open();
                        timeframePicker.setStartTime(getTime());
                        timeframePicker.clickUseButton();
                        protractor_1.browser.wait(() => {
                            return timeframePicker.getLinkElement().getText().then((updatedLink) => {
                                return updatedLink !== link;
                            });
                        }, 1000);
                        expect(timeframePicker.getLinkElement().getText()).not.toBe(link);
                    });
                });
                it(" it propagates the value to model", () => {
                    const startDatetime = getModelStartDatetime();
                    const endDatetime = getModelEndDatetime();
                    timeframePicker.setStartDate(getStartDate());
                    timeframePicker.setStartTime(getTime());
                    timeframePicker.setEndDate(getEndDate());
                    timeframePicker.setEndTime(getTime());
                    timeframePicker.clickUseButton();
                    const expectedStartDatetime = '"' + new Date(getStartDate() + " " + getTime()).toISOString() + '"';
                    const expectedEndDatetime = '"' + new Date(getEndDate() + " " + getTime()).toISOString() + '"';
                    expect(getModelStartDatetime()).toBe(expectedStartDatetime);
                    expect(getModelStartDatetime()).not.toBe(startDatetime);
                    expect(getModelEndDatetime()).toBe(expectedEndDatetime);
                    expect(getModelEndDatetime()).not.toBe(endDatetime);
                    expect(getModelSelectedPresetId()).toBe("");
                });
                it(" it raises on change event", () => {
                    timeframePicker.setStartTime(getTime());
                    timeframePicker.clickUseButton();
                    expect(getOnChangeText()).not.toBe("");
                });
                describe("and the time is changed", () => {
                    it(" it restores time when start time is set greater then" +
                        " end time and date is same for both", () => {
                        const startDatetime = getModelStartDatetime();
                        const endDatetime = getModelEndDatetime();
                        const selectedPresetId = getModelSelectedPresetId();
                        timeframePicker.setStartDate("1/10/2015");
                        timeframePicker.setEndDate("1/10/2015");
                        timeframePicker.setEndTime("22:00");
                        timeframePicker.setStartTime("23:00");
                        expect(getModelStartDatetime()).toBe(startDatetime);
                        expect(getModelEndDatetime()).toBe(endDatetime);
                        expect(getModelSelectedPresetId()).toBe(selectedPresetId);
                    });
                    it(" it restores time when end time is set lower then end time and date is same for both", () => {
                        const startDatetime = getModelStartDatetime();
                        const endDatetime = getModelEndDatetime();
                        const selectedPresetId = getModelSelectedPresetId();
                        timeframePicker.setStartDate("1/10/2015");
                        timeframePicker.setEndDate("1/10/2015");
                        timeframePicker.setStartTime("22:00");
                        timeframePicker.setEndTime("21:00");
                        expect(getModelStartDatetime()).toBe(startDatetime);
                        expect(getModelEndDatetime()).toBe(endDatetime);
                        expect(getModelSelectedPresetId()).toBe(selectedPresetId);
                    });
                });
            });
            describe("and 'Cancel' button is clicked", () => {
                xit(" it closes the popover", () => {
                    timeframePicker.setStartTime(getTime())
                        .then(() => timeframePicker.clickCancelButton())
                        .then(() => expect(timeframePicker.isOpened()).toBe(false));
                });
                xit(" it doesn't change the title", () => {
                    timeframePicker.getLinkElement().getText().then((link) => {
                        timeframePicker.setStartTime(getTime())
                            .then(() => timeframePicker.clickCancelButton())
                            .then(() => expect(timeframePicker.getLinkElement().getText()).toBe(link));
                    });
                });
                xit(" it doesn't propagate the value to model", () => {
                    const startDatetime = getModelStartDatetime();
                    const endDatetime = getModelEndDatetime();
                    const selectedPresetId = getModelSelectedPresetId();
                    timeframePicker.setStartTime(getTime())
                        .then(() => timeframePicker.setEndTime(getTime()))
                        .then(() => timeframePicker.clickCancelButton())
                        .then(() => {
                        expect(getModelStartDatetime()).toBe(startDatetime);
                        expect(getModelEndDatetime()).toBe(endDatetime);
                        expect(getModelSelectedPresetId()).toBe(selectedPresetId);
                    });
                });
            });
        });
        describe("and maxDate, minDate is set", () => {
            let minDate, maxDate;
            beforeEach(() => {
                return getMinDate().then((dateStr) => {
                    minDate = new Date(dateStr.slice(1, -1));
                    return getMaxDate().then((dateStr2) => {
                        maxDate = new Date(dateStr2.slice(1, -1));
                    });
                });
            });
            it("should forbid selection of date less than minDate", () => {
                //greater dates could be selected
                timeframePickerMaxMin.clickOnDateStartDTP(minDate.getDate() + 2);
                expect(getModelStartDatetime("modelMaxMin-startDatetime")).toEqual('"2012-08-16T00:00:00.000Z"');
                timeframePickerMaxMin.clickOnDateStartDTP(minDate.getDate() - 3).catch(() => {
                    //not-clickable element will fire webdriver error
                });
                //since there is no possibility to click on date less than minDate the model should left unchanged
                expect(getModelStartDatetime("modelMaxMin-startDatetime")).toEqual('"2012-08-16T00:00:00.000Z"');
            });
            it("should forbid selection of date greater than maxDate", () => {
                //smaller dates could be selected
                timeframePickerMaxMin.clickOnDateEndDTP(maxDate.getDate() - 2);
                expect(getModelStartDatetime("modelMaxMin-endDatetime")).toEqual('"2015-07-14T00:00:00.000Z"');
                timeframePickerMaxMin.clickOnDateEndDTP(maxDate.getDate() + 3).catch(() => {
                    //not-clickable element will fire webdriver error
                });
                //since there is no possibility to click on date greater than maxDate the model should left unchanged
                expect(getModelStartDatetime("modelMaxMin-endDatetime")).toEqual('"2015-07-14T00:00:00.000Z"');
            });
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdGltZWZyYW1lcGlja2VyL3RpbWVmcmFtZXBpY2tlci5lMmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyREFBeUU7QUFDekUsd0NBQWlDO0FBQ2pDLDhDQUFrRDtBQUVsRCxRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO0lBQzNDLElBQUksZUFBb0MsRUFDcEMscUJBQTBDLENBQUM7SUFFL0MsK0JBQStCLEVBQUUsR0FBRyxxQkFBcUI7UUFDckQsTUFBTSxDQUFDLG9CQUFPLENBQUMsZUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3hDLENBQUM7SUFFRCw2QkFBNkIsRUFBRSxHQUFHLG1CQUFtQjtRQUNqRCxNQUFNLENBQUMsb0JBQU8sQ0FBQyxlQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDeEMsQ0FBQztJQUVEO1FBQ0ksTUFBTSxDQUFDLG9CQUFPLENBQUMsZUFBRSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ25ELENBQUM7SUFFRDtRQUNJLE1BQU0sQ0FBQyxvQkFBTyxDQUFDLGVBQUUsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNuRCxDQUFDO0lBRUQ7UUFDSSxNQUFNLENBQUMsb0JBQU8sQ0FBQyxlQUFFLENBQUMsRUFBRSxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUMzRCxDQUFDO0lBRUQ7UUFDSSxNQUFNLENBQUMsb0JBQU8sQ0FBQyxlQUFFLENBQUMsRUFBRSxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM5RCxDQUFDO0lBRUQ7UUFDSSxJQUFJLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pDLElBQUksR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUxQixNQUFNLENBQUMsR0FBRyxHQUFHLElBQUksR0FBRyxRQUFRLENBQUM7SUFDakMsQ0FBQztJQUVEO1FBQ0ksTUFBTSxDQUFDLGFBQWEsQ0FBQztJQUN6QixDQUFDO0lBRUQ7UUFDSSxNQUFNLENBQUMsYUFBYSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osaUJBQU8sQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUUxQyxlQUFlLEdBQUcsZ0NBQW1CLENBQUMsTUFBTSxDQUFDLGdDQUFtQixFQUFFLG9CQUFPLENBQUMsZUFBRSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRyxxQkFBcUIsR0FBRyxnQ0FBbUIsQ0FBQyxNQUFNLENBQUMsZ0NBQW1CLEVBQUUsb0JBQU8sQ0FBQyxlQUFFLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RyxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFFLEVBQUU7UUFFdEMsRUFBRSxDQUFDLHVCQUF1QixFQUFFLEdBQUUsRUFBRTtZQUM1QixNQUFNLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRWxELGVBQWUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUV2QixNQUFNLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRSxFQUFFO1FBQ3ZDLFFBQVEsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFFLEVBQUU7WUFDN0MsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEdBQUUsRUFBRTtnQkFDN0MsZUFBZSxDQUFDLG1CQUFtQixDQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUNyRCxvQkFBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7b0JBQ2QsTUFBTSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQWMsRUFBQyxFQUFFO3dCQUM5RCxNQUFNLENBQUMsTUFBTSxLQUFLLGVBQWUsQ0FBQztvQkFDdEMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1AsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUVWLE1BQU0sQ0FBQyxlQUFlLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUN6RSxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxHQUFFLEVBQUU7Z0JBQ3hDLGVBQWUsQ0FBQyxtQkFBbUIsQ0FBQyxlQUFlLENBQUMsQ0FBQztnQkFFckQsb0JBQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO29CQUNkLE1BQU0sQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBaUIsRUFBQyxFQUFFO3dCQUN4RCxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUM7b0JBQ3JCLENBQUMsQ0FBQyxDQUFDO2dCQUNQLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFFVCxNQUFNLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RELENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUUsRUFBRTtnQkFDekMsTUFBTSxDQUFDLHdCQUF3QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBRXBELGVBQWUsQ0FBQyxtQkFBbUIsQ0FBQyxlQUFlLENBQUMsQ0FBQztnQkFFckQsTUFBTSxDQUFDLHdCQUF3QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDM0QsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFFLEVBQUU7WUFDbEMsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUUsRUFBRTtnQkFDekMsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUV2QixNQUFNLENBQUMsZUFBZSxDQUFDLHdCQUF3QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBRS9ELGVBQWUsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztnQkFFeEMsTUFBTSxDQUFDLGVBQWUsQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xFLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDRCQUE0QixFQUFFLEdBQUUsRUFBRTtnQkFDakMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUUzRCxlQUFlLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBRXhDLE1BQU0sQ0FBQyxlQUFlLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzNELENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDZEQUE2RCxFQUFFLEdBQUUsRUFBRTtnQkFDbEUsTUFBTSxhQUFhLEdBQUcscUJBQXFCLEVBQUUsQ0FBQztnQkFDOUMsTUFBTSxXQUFXLEdBQUcsbUJBQW1CLEVBQUUsQ0FBQztnQkFDMUMsTUFBTSxnQkFBZ0IsR0FBRyx3QkFBd0IsRUFBRSxDQUFDO2dCQUVwRCxlQUFlLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7Z0JBQzNDLGVBQWUsQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztnQkFFM0MsTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3BELE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUNoRCxNQUFNLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzlELENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEdBQUUsRUFBRTtnQkFDOUQsTUFBTSxhQUFhLEdBQUcscUJBQXFCLEVBQUUsQ0FBQztnQkFDOUMsTUFBTSxnQkFBZ0IsR0FBRyx3QkFBd0IsRUFBRSxDQUFDO2dCQUVwRCxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBRXZCLGVBQWUsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO29CQUNyRCxNQUFNLENBQUMsYUFBYSxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUM7b0JBQ25DLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUMvQyxDQUFDLENBQUMsQ0FBQztnQkFFSCxNQUFNLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztnQkFFcEQsZUFBZSxDQUFDLHNCQUFzQixFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7b0JBQ3JELE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDdkMsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3BELE1BQU0sQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDOUQsQ0FBQyxDQUFDLENBQUM7WUFFSCxRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRSxFQUFFO2dCQUN4QyxFQUFFLENBQUMsd0JBQXdCLEVBQUUsR0FBRSxFQUFFO29CQUM3QixlQUFlLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7b0JBRXhDLGVBQWUsQ0FBQyxjQUFjLEVBQUUsQ0FBQztvQkFFakMsb0JBQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO3dCQUNkLE1BQU0sQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBaUIsRUFBQyxFQUFFOzRCQUN4RCxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUM7d0JBQ3JCLENBQUMsQ0FBQyxDQUFDO29CQUNQLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFFVCxNQUFNLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNuRCxDQUFDLENBQUMsQ0FBQztnQkFFSCxFQUFFLENBQUMsdUJBQXVCLEVBQUUsR0FBRSxFQUFFO29CQUM1QixlQUFlLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7d0JBQ3JELGVBQWUsQ0FBQyxJQUFJLEVBQUUsQ0FBQzt3QkFFdkIsZUFBZSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO3dCQUV4QyxlQUFlLENBQUMsY0FBYyxFQUFFLENBQUM7d0JBRWpDLG9CQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRTs0QkFDZCxNQUFNLENBQUMsZUFBZSxDQUFDLGNBQWMsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO2dDQUNuRSxNQUFNLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQzs0QkFDaEMsQ0FBQyxDQUFDLENBQUM7d0JBQ1AsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO3dCQUVULE1BQU0sQ0FBQyxlQUFlLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUN0RSxDQUFDLENBQUMsQ0FBQztnQkFDUCxDQUFDLENBQUMsQ0FBQztnQkFFSCxFQUFFLENBQUMsbUNBQW1DLEVBQUUsR0FBRSxFQUFFO29CQUN4QyxNQUFNLGFBQWEsR0FBRyxxQkFBcUIsRUFBRSxDQUFDO29CQUM5QyxNQUFNLFdBQVcsR0FBRyxtQkFBbUIsRUFBRSxDQUFDO29CQUUxQyxlQUFlLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7b0JBQzdDLGVBQWUsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztvQkFDeEMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO29CQUN6QyxlQUFlLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7b0JBRXRDLGVBQWUsQ0FBQyxjQUFjLEVBQUUsQ0FBQztvQkFDakMsTUFBTSxxQkFBcUIsR0FBRyxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsR0FBRyxDQUFDO29CQUNuRyxNQUFNLG1CQUFtQixHQUFHLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxHQUFHLEdBQUcsT0FBTyxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxHQUFHLENBQUM7b0JBRS9GLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7b0JBQzVELE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztvQkFDeEQsTUFBTSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztvQkFDeEQsTUFBTSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO29CQUNwRCxNQUFNLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDaEQsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsRUFBRSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtvQkFDbEMsZUFBZSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO29CQUV4QyxlQUFlLENBQUMsY0FBYyxFQUFFLENBQUM7b0JBRWpDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQzNDLENBQUMsQ0FBQyxDQUFDO2dCQUVILFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxHQUFFLEVBQUU7b0JBQ3BDLEVBQUUsQ0FBQyx1REFBdUQ7d0JBQ3RELHFDQUFxQyxFQUFFLEdBQUUsRUFBRTt3QkFDM0MsTUFBTSxhQUFhLEdBQUcscUJBQXFCLEVBQUUsQ0FBQzt3QkFDOUMsTUFBTSxXQUFXLEdBQUcsbUJBQW1CLEVBQUUsQ0FBQzt3QkFDMUMsTUFBTSxnQkFBZ0IsR0FBRyx3QkFBd0IsRUFBRSxDQUFDO3dCQUVwRCxlQUFlLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUMxQyxlQUFlLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUN4QyxlQUFlLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUNwQyxlQUFlLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUV0QyxNQUFNLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQzt3QkFDcEQsTUFBTSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7d0JBQ2hELE1BQU0sQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7b0JBQzlELENBQUMsQ0FBQyxDQUFDO29CQUVILEVBQUUsQ0FBQyxzRkFBc0YsRUFBRSxHQUFFLEVBQUU7d0JBQzNGLE1BQU0sYUFBYSxHQUFHLHFCQUFxQixFQUFFLENBQUM7d0JBQzlDLE1BQU0sV0FBVyxHQUFHLG1CQUFtQixFQUFFLENBQUM7d0JBQzFDLE1BQU0sZ0JBQWdCLEdBQUcsd0JBQXdCLEVBQUUsQ0FBQzt3QkFFcEQsZUFBZSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQzt3QkFDMUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQzt3QkFDeEMsZUFBZSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFDdEMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFcEMsTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7d0JBQ3BELE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUNoRCxNQUFNLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO29CQUM5RCxDQUFDLENBQUMsQ0FBQztnQkFDUCxDQUFDLENBQUMsQ0FBQztZQUNQLENBQUMsQ0FBQyxDQUFDO1lBRUgsUUFBUSxDQUFDLGdDQUFnQyxFQUFFLEdBQUUsRUFBRTtnQkFDM0MsR0FBRyxDQUFDLHdCQUF3QixFQUFFLEdBQUUsRUFBRTtvQkFDOUIsZUFBZSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQzt5QkFDbEMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO3lCQUMvQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNwRSxDQUFDLENBQUMsQ0FBQztnQkFFSCxHQUFHLENBQUMsOEJBQThCLEVBQUUsR0FBRSxFQUFFO29CQUNwQyxlQUFlLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7d0JBQ3JELGVBQWUsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7NkJBQ2xDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLEVBQUUsQ0FBQzs2QkFDL0MsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFDbkYsQ0FBQyxDQUFDLENBQUM7Z0JBQ1AsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsR0FBRyxDQUFDLDBDQUEwQyxFQUFFLEdBQUUsRUFBRTtvQkFDaEQsTUFBTSxhQUFhLEdBQUcscUJBQXFCLEVBQUUsQ0FBQztvQkFDOUMsTUFBTSxXQUFXLEdBQUcsbUJBQW1CLEVBQUUsQ0FBQztvQkFDMUMsTUFBTSxnQkFBZ0IsR0FBRyx3QkFBd0IsRUFBRSxDQUFDO29CQUVwRCxlQUFlLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDO3lCQUNsQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO3lCQUNqRCxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsZUFBZSxDQUFDLGlCQUFpQixFQUFFLENBQUM7eUJBQy9DLElBQUksQ0FBQyxHQUFHLEVBQUU7d0JBQ1AsTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7d0JBQ3BELE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUNoRCxNQUFNLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO29CQUM5RCxDQUFDLENBQUMsQ0FBQztnQkFDWCxDQUFDLENBQUMsQ0FBQztZQUNQLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLElBQUksT0FBYSxFQUNiLE9BQWEsQ0FBQztZQUVsQixVQUFVLENBQUUsR0FBRyxFQUFFO2dCQUNiLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUUsQ0FBQyxPQUFlLEVBQUUsRUFBRTtvQkFDMUMsT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDekMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FBRSxDQUFDLFFBQWdCLEVBQUUsRUFBRTt3QkFDM0MsT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDOUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1AsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxHQUFHLEVBQUU7Z0JBQ3pELGlDQUFpQztnQkFDakMscUJBQXFCLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNqRSxNQUFNLENBQUMscUJBQXFCLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO2dCQUNqRyxxQkFBcUIsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRTtvQkFDeEUsaURBQWlEO2dCQUNyRCxDQUFDLENBQUMsQ0FBQztnQkFDSCxrR0FBa0c7Z0JBQ2xHLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLDRCQUE0QixDQUFDLENBQUM7WUFDckcsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsc0RBQXNELEVBQUUsR0FBRyxFQUFFO2dCQUM1RCxpQ0FBaUM7Z0JBQ2pDLHFCQUFxQixDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDL0QsTUFBTSxDQUFDLHFCQUFxQixDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsNEJBQTRCLENBQUMsQ0FBQztnQkFDL0YscUJBQXFCLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUU7b0JBQ3RFLGlEQUFpRDtnQkFDckQsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gscUdBQXFHO2dCQUNyRyxNQUFNLENBQUMscUJBQXFCLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1lBQ25HLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImNvbXBvbmVudHMvdGltZWZyYW1lcGlja2VyL3RpbWVmcmFtZXBpY2tlci5lMmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2Jyb3dzZXIsIGJ5LCBlbGVtZW50LCBwcm9taXNlfSBmcm9tIFwiQHNvbGFyd2luZHMvdXppL3Byb3RyYWN0b3JcIjtcbmltcG9ydCBIZWxwZXJzIGZyb20gXCIuLi9oZWxwZXJzXCI7XG5pbXBvcnQge1RpbWVmcmFtZVBpY2tlckF0b219IGZyb20gXCIuLi9pbmRleC5hdG9tXCI7XG5cbmRlc2NyaWJlKFwiVVNFUkNPTlRST0wgVGltZWZyYW1lUGlja2VyID5cIiwgKCkgPT4ge1xuICAgIGxldCB0aW1lZnJhbWVQaWNrZXI6IFRpbWVmcmFtZVBpY2tlckF0b20sXG4gICAgICAgIHRpbWVmcmFtZVBpY2tlck1heE1pbjogVGltZWZyYW1lUGlja2VyQXRvbTtcblxuICAgIGZ1bmN0aW9uIGdldE1vZGVsU3RhcnREYXRldGltZShpZCA9IFwibW9kZWwtc3RhcnREYXRldGltZVwiKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50KGJ5LmlkKGlkKSkuZ2V0VGV4dCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE1vZGVsRW5kRGF0ZXRpbWUoaWQgPSBcIm1vZGVsLWVuZERhdGV0aW1lXCIpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQoYnkuaWQoaWQpKS5nZXRUZXh0KCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0TWF4RGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQoYnkuaWQoXCJtYXhEYXRldGltZVwiKSkuZ2V0VGV4dCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE1pbkRhdGUoKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50KGJ5LmlkKFwibWluRGF0ZXRpbWVcIikpLmdldFRleHQoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRPbkNoYW5nZVRleHQoKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50KGJ5LmlkKFwibW9kZWwtb25DaGFuZ2VUaXRsZVwiKSkuZ2V0VGV4dCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE1vZGVsU2VsZWN0ZWRQcmVzZXRJZCgpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQoYnkuaWQoXCJtb2RlbC1zZWxlY3RlZFByZXNldElkXCIpKS5nZXRUZXh0KCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0VGltZSgpOiBzdHJpbmcge1xuICAgICAgICBsZXQgaG91ciA9IG5ldyBEYXRlKCkuZ2V0SG91cnMoKTtcbiAgICAgICAgaG91ciA9IGhvdXIgPT09IDEgPyAzIDogMTtcblxuICAgICAgICByZXR1cm4gXCIwXCIgKyBob3VyICsgXCI6MDEgQU1cIjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRTdGFydERhdGUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIFwiMDEtSmFuLTIwMTBcIjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRFbmREYXRlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBcIjAxLUZlYi0yMDEwXCI7XG4gICAgfVxuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIEhlbHBlcnMucHJlcGFyZUJyb3dzZXIoXCJ0aW1lZnJhbWVwaWNrZXJcIik7XG5cbiAgICAgICAgdGltZWZyYW1lUGlja2VyID0gVGltZWZyYW1lUGlja2VyQXRvbS5maW5kSW4oVGltZWZyYW1lUGlja2VyQXRvbSwgZWxlbWVudChieS5pZChcInRpbWVmcmFtZXBpY2tlclwiKSkpO1xuICAgICAgICB0aW1lZnJhbWVQaWNrZXJNYXhNaW4gPSBUaW1lZnJhbWVQaWNrZXJBdG9tLmZpbmRJbihUaW1lZnJhbWVQaWNrZXJBdG9tLCBlbGVtZW50KGJ5LmlkKFwidGZwTWF4TWluXCIpKSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcIndoZW4gdGhlIHRpdGxlIGlzIGNsaWNrZWRcIiwgKCk9PiB7XG5cbiAgICAgICAgaXQoXCIgaXQgb3BlbnMgdGhlIHBvcG92ZXJcIiwgKCk9PiB7XG4gICAgICAgICAgICBleHBlY3QodGltZWZyYW1lUGlja2VyLmlzT3BlbmVkKCkpLnRvRXF1YWwoZmFsc2UpO1xuXG4gICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIub3BlbigpO1xuXG4gICAgICAgICAgICBleHBlY3QodGltZWZyYW1lUGlja2VyLmlzT3BlbmVkKCkpLnRvRXF1YWwodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJ3aGVuIHRoZSBwb3BvdmVyIGlzIG9wZW5lZFwiLCAoKT0+IHtcbiAgICAgICAgZGVzY3JpYmUoXCJhbmQgYSBuZXcgcXVpY2sgcGljayBpcyBzZWxlY3RlZFwiLCAoKT0+IHtcbiAgICAgICAgICAgIGl0KFwiIGl0IGhpZ2hsaWdodHMgdGhlIHNlbGVjdGVkIHF1aWNrIHBpY2tcIiwgKCk9PiB7XG4gICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLnNlbGVjdFByZXNldEJ5VGl0bGUoXCJMYXN0IDEyIGhvdXJzXCIpO1xuICAgICAgICAgICAgICAgIGJyb3dzZXIud2FpdCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aW1lZnJhbWVQaWNrZXIuZ2V0U2VsZWN0ZWRQcmVzZXQoKS50aGVuKChwcmVzZXQ6IHN0cmluZyk9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJlc2V0ID09PSBcIkxhc3QgMTIgaG91cnNcIjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMjAwMDApO1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0KHRpbWVmcmFtZVBpY2tlci5nZXRTZWxlY3RlZFByZXNldCgpKS50b0VxdWFsKFwiTGFzdCAxMiBob3Vyc1wiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdChcIiBpdCBjbG9zZXMgdGhlIGNvbmZpcm1hdGlvbiBwYW5lbFwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2VsZWN0UHJlc2V0QnlUaXRsZShcIkxhc3QgMTIgaG91cnNcIik7XG5cbiAgICAgICAgICAgICAgICBicm93c2VyLndhaXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGltZWZyYW1lUGlja2VyLmlzT3BlbmVkKCkudGhlbigoaXNPcGVuZWQ6IGJvb2xlYW4pPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFpc09wZW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMTAwMCk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QodGltZWZyYW1lUGlja2VyLmlzT3BlbmVkKCkpLnRvRXF1YWwoZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KFwiIGl0IGNoYW5nZXMgbW9kZWwuc2VsZWN0ZWRQcmVzZXRJZFwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxTZWxlY3RlZFByZXNldElkKCkpLnRvQmUoXCJsYXN0SG91clwiKTtcblxuICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5zZWxlY3RQcmVzZXRCeVRpdGxlKFwiTGFzdCAxMiBob3Vyc1wiKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFNlbGVjdGVkUHJlc2V0SWQoKSkudG9CZShcImxhc3QxMkhvdXJzXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKFwiYW5kIGEgZGF0ZSBpcyBjaGFuZ2VkXCIsICgpPT4ge1xuICAgICAgICAgICAgaXQoXCJpdCBkaXNwbGF5cyB0aGUgY29uZmlybWF0aW9uIHBhbmVsXCIsICgpPT4ge1xuICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5vcGVuKCk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QodGltZWZyYW1lUGlja2VyLmlzQ29uZmlybWF0aW9uUGFuZWxTaG93bigpKS50b0JlKGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5zZXRTdGFydFRpbWUoZ2V0VGltZSgpKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdCh0aW1lZnJhbWVQaWNrZXIuaXNDb25maXJtYXRpb25QYW5lbFNob3duKCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCIgbm8gcXVpY2sgcGljayBpcyBzZWxlY3RlZFwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QodGltZWZyYW1lUGlja2VyLmdldFNlbGVjdGVkUHJlc2V0KCkpLm5vdC50b0JlTnVsbCgpO1xuXG4gICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLnNldFN0YXJ0VGltZShnZXRUaW1lKCkpO1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0KHRpbWVmcmFtZVBpY2tlci5nZXRTZWxlY3RlZFByZXNldCgpKS50b0JlTnVsbCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KFwiIGl0IHJlc3RvcmVzIGRhdGVzIHdoZW4gc3RhcnQgZGF0ZSBpcyBncmVhdGVyIHRoZW4gZW5kIGRhdGVcIiwgKCk9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnREYXRldGltZSA9IGdldE1vZGVsU3RhcnREYXRldGltZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVuZERhdGV0aW1lID0gZ2V0TW9kZWxFbmREYXRldGltZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkUHJlc2V0SWQgPSBnZXRNb2RlbFNlbGVjdGVkUHJlc2V0SWQoKTtcblxuICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5zZXRTdGFydERhdGUoZ2V0RW5kRGF0ZSgpKTtcbiAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0RW5kRGF0ZShnZXRTdGFydERhdGUoKSk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxTdGFydERhdGV0aW1lKCkpLnRvQmUoc3RhcnREYXRldGltZSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGdldE1vZGVsRW5kRGF0ZXRpbWUoKSkudG9CZShlbmREYXRldGltZSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGdldE1vZGVsU2VsZWN0ZWRQcmVzZXRJZCgpKS50b0JlKHNlbGVjdGVkUHJlc2V0SWQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KFwiIGl0IHJlc3RvcmVzIGRhdGVzIHdoZW4gc3RhcnQgZGF0ZSBvciBlbmQgZGF0ZSBpcyBlbXB0eVwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydERhdGV0aW1lID0gZ2V0TW9kZWxTdGFydERhdGV0aW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcmVzZXRJZCA9IGdldE1vZGVsU2VsZWN0ZWRQcmVzZXRJZCgpO1xuXG4gICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLm9wZW4oKTtcblxuICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5nZXRTdGFydERhdGV0aW1lUGlja2VyKCkudGhlbigocGlja2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBpY2tlci5nZXREYXRlUGlja2VyKCkuY2xlYXJUZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHBpY2tlci5nZXREYXRlUGlja2VyKCkuY2xpY2tDYWxlbmRhckljb24oKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoKSkudG9CZShzdGFydERhdGV0aW1lKTtcblxuICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5nZXRTdGFydERhdGV0aW1lUGlja2VyKCkudGhlbigocGlja2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBpY2tlci5nZXRUaW1lUGlja2VyKCkuY2xlYXJUZXh0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxTdGFydERhdGV0aW1lKCkpLnRvQmUoc3RhcnREYXRldGltZSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGdldE1vZGVsU2VsZWN0ZWRQcmVzZXRJZCgpKS50b0JlKHNlbGVjdGVkUHJlc2V0SWQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRlc2NyaWJlKFwiYW5kICdVc2UnIGJ1dHRvbiBpcyBjbGlja2VkXCIsICgpPT4ge1xuICAgICAgICAgICAgICAgIGl0KFwiIGl0IGNsb3NlcyB0aGUgcG9wb3ZlclwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLnNldFN0YXJ0VGltZShnZXRUaW1lKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5jbGlja1VzZUJ1dHRvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgIGJyb3dzZXIud2FpdCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGltZWZyYW1lUGlja2VyLmlzT3BlbmVkKCkudGhlbigoaXNPcGVuZWQ6IGJvb2xlYW4pPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhaXNPcGVuZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHRpbWVmcmFtZVBpY2tlci5pc09wZW5lZCgpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KFwiIGl0IGNoYW5nZXMgdGhlIHRpdGxlXCIsICgpPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuZ2V0TGlua0VsZW1lbnQoKS5nZXRUZXh0KCkudGhlbigobGluaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLm9wZW4oKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLnNldFN0YXJ0VGltZShnZXRUaW1lKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuY2xpY2tVc2VCdXR0b24oKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3Nlci53YWl0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGltZWZyYW1lUGlja2VyLmdldExpbmtFbGVtZW50KCkuZ2V0VGV4dCgpLnRoZW4oKHVwZGF0ZWRMaW5rKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVkTGluayAhPT0gbGluaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QodGltZWZyYW1lUGlja2VyLmdldExpbmtFbGVtZW50KCkuZ2V0VGV4dCgpKS5ub3QudG9CZShsaW5rKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdChcIiBpdCBwcm9wYWdhdGVzIHRoZSB2YWx1ZSB0byBtb2RlbFwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnREYXRldGltZSA9IGdldE1vZGVsU3RhcnREYXRldGltZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmREYXRldGltZSA9IGdldE1vZGVsRW5kRGF0ZXRpbWUoKTtcblxuICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0U3RhcnREYXRlKGdldFN0YXJ0RGF0ZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLnNldFN0YXJ0VGltZShnZXRUaW1lKCkpO1xuICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0RW5kRGF0ZShnZXRFbmREYXRlKCkpO1xuICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0RW5kVGltZShnZXRUaW1lKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5jbGlja1VzZUJ1dHRvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZFN0YXJ0RGF0ZXRpbWUgPSAnXCInICsgbmV3IERhdGUoZ2V0U3RhcnREYXRlKCkgKyBcIiBcIiArIGdldFRpbWUoKSkudG9JU09TdHJpbmcoKSArICdcIic7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkRW5kRGF0ZXRpbWUgPSAnXCInICsgbmV3IERhdGUoZ2V0RW5kRGF0ZSgpICsgXCIgXCIgKyBnZXRUaW1lKCkpLnRvSVNPU3RyaW5nKCkgKyAnXCInO1xuXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoKSkudG9CZShleHBlY3RlZFN0YXJ0RGF0ZXRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxTdGFydERhdGV0aW1lKCkpLm5vdC50b0JlKHN0YXJ0RGF0ZXRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxFbmREYXRldGltZSgpKS50b0JlKGV4cGVjdGVkRW5kRGF0ZXRpbWUpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxFbmREYXRldGltZSgpKS5ub3QudG9CZShlbmREYXRldGltZSk7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFNlbGVjdGVkUHJlc2V0SWQoKSkudG9CZShcIlwiKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0KFwiIGl0IHJhaXNlcyBvbiBjaGFuZ2UgZXZlbnRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0U3RhcnRUaW1lKGdldFRpbWUoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLmNsaWNrVXNlQnV0dG9uKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGdldE9uQ2hhbmdlVGV4dCgpKS5ub3QudG9CZShcIlwiKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGRlc2NyaWJlKFwiYW5kIHRoZSB0aW1lIGlzIGNoYW5nZWRcIiwgKCk9PiB7XG4gICAgICAgICAgICAgICAgICAgIGl0KFwiIGl0IHJlc3RvcmVzIHRpbWUgd2hlbiBzdGFydCB0aW1lIGlzIHNldCBncmVhdGVyIHRoZW5cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiBlbmQgdGltZSBhbmQgZGF0ZSBpcyBzYW1lIGZvciBib3RoXCIsICgpPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnREYXRldGltZSA9IGdldE1vZGVsU3RhcnREYXRldGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kRGF0ZXRpbWUgPSBnZXRNb2RlbEVuZERhdGV0aW1lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFByZXNldElkID0gZ2V0TW9kZWxTZWxlY3RlZFByZXNldElkKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5zZXRTdGFydERhdGUoXCIxLzEwLzIwMTVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0RW5kRGF0ZShcIjEvMTAvMjAxNVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5zZXRFbmRUaW1lKFwiMjI6MDBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0U3RhcnRUaW1lKFwiMjM6MDBcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoKSkudG9CZShzdGFydERhdGV0aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbEVuZERhdGV0aW1lKCkpLnRvQmUoZW5kRGF0ZXRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGdldE1vZGVsU2VsZWN0ZWRQcmVzZXRJZCgpKS50b0JlKHNlbGVjdGVkUHJlc2V0SWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpdChcIiBpdCByZXN0b3JlcyB0aW1lIHdoZW4gZW5kIHRpbWUgaXMgc2V0IGxvd2VyIHRoZW4gZW5kIHRpbWUgYW5kIGRhdGUgaXMgc2FtZSBmb3IgYm90aFwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF0ZXRpbWUgPSBnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZERhdGV0aW1lID0gZ2V0TW9kZWxFbmREYXRldGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcmVzZXRJZCA9IGdldE1vZGVsU2VsZWN0ZWRQcmVzZXRJZCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0U3RhcnREYXRlKFwiMS8xMC8yMDE1XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLnNldEVuZERhdGUoXCIxLzEwLzIwMTVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0U3RhcnRUaW1lKFwiMjI6MDBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0RW5kVGltZShcIjIxOjAwXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxTdGFydERhdGV0aW1lKCkpLnRvQmUoc3RhcnREYXRldGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxFbmREYXRldGltZSgpKS50b0JlKGVuZERhdGV0aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFNlbGVjdGVkUHJlc2V0SWQoKSkudG9CZShzZWxlY3RlZFByZXNldElkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVzY3JpYmUoXCJhbmQgJ0NhbmNlbCcgYnV0dG9uIGlzIGNsaWNrZWRcIiwgKCk9PiB7XG4gICAgICAgICAgICAgICAgeGl0KFwiIGl0IGNsb3NlcyB0aGUgcG9wb3ZlclwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLnNldFN0YXJ0VGltZShnZXRUaW1lKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aW1lZnJhbWVQaWNrZXIuY2xpY2tDYW5jZWxCdXR0b24oKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IGV4cGVjdCh0aW1lZnJhbWVQaWNrZXIuaXNPcGVuZWQoKSkudG9CZShmYWxzZSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgeGl0KFwiIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSB0aXRsZVwiLCAoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyLmdldExpbmtFbGVtZW50KCkuZ2V0VGV4dCgpLnRoZW4oKGxpbmspID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVmcmFtZVBpY2tlci5zZXRTdGFydFRpbWUoZ2V0VGltZSgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRpbWVmcmFtZVBpY2tlci5jbGlja0NhbmNlbEJ1dHRvbigpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IGV4cGVjdCh0aW1lZnJhbWVQaWNrZXIuZ2V0TGlua0VsZW1lbnQoKS5nZXRUZXh0KCkpLnRvQmUobGluaykpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHhpdChcIiBpdCBkb2Vzbid0IHByb3BhZ2F0ZSB0aGUgdmFsdWUgdG8gbW9kZWxcIiwgKCk9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF0ZXRpbWUgPSBnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kRGF0ZXRpbWUgPSBnZXRNb2RlbEVuZERhdGV0aW1lKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkUHJlc2V0SWQgPSBnZXRNb2RlbFNlbGVjdGVkUHJlc2V0SWQoKTtcblxuICAgICAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXIuc2V0U3RhcnRUaW1lKGdldFRpbWUoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRpbWVmcmFtZVBpY2tlci5zZXRFbmRUaW1lKGdldFRpbWUoKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aW1lZnJhbWVQaWNrZXIuY2xpY2tDYW5jZWxCdXR0b24oKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxTdGFydERhdGV0aW1lKCkpLnRvQmUoc3RhcnREYXRldGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGdldE1vZGVsRW5kRGF0ZXRpbWUoKSkudG9CZShlbmREYXRldGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGdldE1vZGVsU2VsZWN0ZWRQcmVzZXRJZCgpKS50b0JlKHNlbGVjdGVkUHJlc2V0SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoXCJhbmQgbWF4RGF0ZSwgbWluRGF0ZSBpcyBzZXRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IG1pbkRhdGU6IERhdGUsXG4gICAgICAgICAgICAgICAgbWF4RGF0ZTogRGF0ZTtcblxuICAgICAgICAgICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRNaW5EYXRlKCkudGhlbiggKGRhdGVTdHI6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBtaW5EYXRlID0gbmV3IERhdGUoZGF0ZVN0ci5zbGljZSgxLCAtMSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TWF4RGF0ZSgpLnRoZW4oIChkYXRlU3RyMjogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhEYXRlID0gbmV3IERhdGUoZGF0ZVN0cjIuc2xpY2UoMSwgLTEpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCJzaG91bGQgZm9yYmlkIHNlbGVjdGlvbiBvZiBkYXRlIGxlc3MgdGhhbiBtaW5EYXRlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAvL2dyZWF0ZXIgZGF0ZXMgY291bGQgYmUgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXJNYXhNaW4uY2xpY2tPbkRhdGVTdGFydERUUChtaW5EYXRlLmdldERhdGUoKSArIDIpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoXCJtb2RlbE1heE1pbi1zdGFydERhdGV0aW1lXCIpKS50b0VxdWFsKCdcIjIwMTItMDgtMTZUMDA6MDA6MDAuMDAwWlwiJyk7XG4gICAgICAgICAgICAgICAgdGltZWZyYW1lUGlja2VyTWF4TWluLmNsaWNrT25EYXRlU3RhcnREVFAobWluRGF0ZS5nZXREYXRlKCkgLSAzKS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90LWNsaWNrYWJsZSBlbGVtZW50IHdpbGwgZmlyZSB3ZWJkcml2ZXIgZXJyb3JcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvL3NpbmNlIHRoZXJlIGlzIG5vIHBvc3NpYmlsaXR5IHRvIGNsaWNrIG9uIGRhdGUgbGVzcyB0aGFuIG1pbkRhdGUgdGhlIG1vZGVsIHNob3VsZCBsZWZ0IHVuY2hhbmdlZFxuICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoXCJtb2RlbE1heE1pbi1zdGFydERhdGV0aW1lXCIpKS50b0VxdWFsKCdcIjIwMTItMDgtMTZUMDA6MDA6MDAuMDAwWlwiJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCJzaG91bGQgZm9yYmlkIHNlbGVjdGlvbiBvZiBkYXRlIGdyZWF0ZXIgdGhhbiBtYXhEYXRlXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAvL3NtYWxsZXIgZGF0ZXMgY291bGQgYmUgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXJNYXhNaW4uY2xpY2tPbkRhdGVFbmREVFAobWF4RGF0ZS5nZXREYXRlKCkgLSAyKTtcbiAgICAgICAgICAgICAgICBleHBlY3QoZ2V0TW9kZWxTdGFydERhdGV0aW1lKFwibW9kZWxNYXhNaW4tZW5kRGF0ZXRpbWVcIikpLnRvRXF1YWwoJ1wiMjAxNS0wNy0xNFQwMDowMDowMC4wMDBaXCInKTtcbiAgICAgICAgICAgICAgICB0aW1lZnJhbWVQaWNrZXJNYXhNaW4uY2xpY2tPbkRhdGVFbmREVFAobWF4RGF0ZS5nZXREYXRlKCkgKyAzKS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm90LWNsaWNrYWJsZSBlbGVtZW50IHdpbGwgZmlyZSB3ZWJkcml2ZXIgZXJyb3JcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvL3NpbmNlIHRoZXJlIGlzIG5vIHBvc3NpYmlsaXR5IHRvIGNsaWNrIG9uIGRhdGUgZ3JlYXRlciB0aGFuIG1heERhdGUgdGhlIG1vZGVsIHNob3VsZCBsZWZ0IHVuY2hhbmdlZFxuICAgICAgICAgICAgICAgIGV4cGVjdChnZXRNb2RlbFN0YXJ0RGF0ZXRpbWUoXCJtb2RlbE1heE1pbi1lbmREYXRldGltZVwiKSkudG9FcXVhbCgnXCIyMDE1LTA3LTE0VDAwOjAwOjAwLjAwMFpcIicpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
