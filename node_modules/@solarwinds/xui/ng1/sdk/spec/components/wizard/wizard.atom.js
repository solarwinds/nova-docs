"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor_1 = require("@solarwinds/uzi/protractor");
const uzi_1 = require("@solarwinds/uzi");
const index_atom_1 = require("../index.atom");
class WizardAtom extends uzi_1.Atom {
    constructor(element, dialog) {
        super(element);
        this.cancel = () => {
            return this.cancelButton.click();
        };
        this.next = () => {
            return this.nextButton.click();
        };
        this.back = () => {
            return this.backButton.click();
        };
        this.finish = () => {
            return this.finishButton.click();
        };
        this.goToStep = (index) => {
            const headerStep = super.getElement().all(protractor_1.by.className("xui-wizard__header-step")).get(index);
            headerStep.click();
        };
        this.getHeaderSteps = () => {
            const stepsEl = super.getElement().element(protractor_1.by.className("xui-wizard__header-steps"));
            return stepsEl.all(protractor_1.by.className("xui-wizard__header-step")).map((el) => {
                return el.all(protractor_1.by.className("xui-wizard__header-step-title")).first().getText();
            });
        };
        this.getSteps = () => {
            const stepsEl = super.getElement().element(protractor_1.by.className("xui-wizard__steps"));
            //this should really be a map operation.  However, map has a bug- if you put an element finder
            //in it, it will try to resolve EVERYTHING, and causes node to go into an infinite loop
            return stepsEl.all(protractor_1.by.className("xui-wizard__step"))
                .reduce((accumulator, el) => {
                accumulator.push(new index_atom_1.WizardStepAtom(el));
                return accumulator;
            }, []);
        };
        this.getCurrentStepTitle = () => {
            const el = super.getElement().element(protractor_1.by.className("xui-wizard__title"));
            return el.getText();
        };
        if (dialog) {
            this.dialog = dialog;
            const buttons = dialog.getFooterButtons();
            this.backButton = new index_atom_1.ButtonAtom(buttons.filter((el) => {
                return new protractor_1.promise.Promise((resolve) => {
                    uzi_1.Atom.hasClass(el, "xui-wizard__back-button").then((value) => {
                        resolve(value);
                    });
                });
            }).first());
            this.nextButton = new index_atom_1.ButtonAtom(buttons.filter((el) => {
                return new protractor_1.promise.Promise((resolve) => {
                    uzi_1.Atom.hasClass(el, "xui-wizard__next-button").then((value) => {
                        resolve(value);
                    });
                });
            }).first());
            this.finishButton = new index_atom_1.ButtonAtom(buttons.filter((el) => {
                return new protractor_1.promise.Promise((resolve) => {
                    uzi_1.Atom.hasClass(el, "xui-wizard__finish-button").then((value) => {
                        resolve(value);
                    });
                });
            }).first());
            this.cancelButton = new index_atom_1.ButtonAtom(buttons.filter((el) => {
                return new protractor_1.promise.Promise((resolve) => {
                    uzi_1.Atom.hasClass(el, "xui-wizard__cancel-button").then((value) => {
                        resolve(value);
                    });
                });
            }).first());
            this.additionalButtons = buttons.filter((el) => {
                return new protractor_1.promise.Promise((resolve) => {
                    const builtInButtons = ["xui-wizard__back-button",
                        "xui-wizard__next-button",
                        "xui-wizard__finish-button",
                        "xui-wizard__cancel-button"];
                    uzi_1.Atom.hasAnyClass(el, builtInButtons).then((result) => {
                        resolve(!result);
                    });
                });
            })
                .reduce((accumulator, el) => {
                accumulator.push(new index_atom_1.ButtonAtom(el));
                return accumulator;
            }, []);
        }
        else {
            this.backButton = new index_atom_1.ButtonAtom(super.getElement().element(protractor_1.by.className("xui-wizard__back-button")));
            this.nextButton = new index_atom_1.ButtonAtom(super.getElement().element(protractor_1.by.className("xui-wizard__next-button")));
            this.finishButton = new index_atom_1.ButtonAtom(super.getElement().element(protractor_1.by.className("xui-wizard__finish-button")));
            this.cancelButton = new index_atom_1.ButtonAtom(super.getElement().element(protractor_1.by.className("xui-wizard__cancel-button")));
            this.additionalButtons = super.getElement().all(protractor_1.by.className("xui-wizard__additional-button"))
                .reduce((accumulator, el) => {
                accumulator.push(new index_atom_1.ButtonAtom(el));
                return accumulator;
            }, []);
        }
    }
    static fromDialog() {
        const dialog = index_atom_1.DialogAtom.get();
        return new WizardAtom(dialog.getBody(), dialog);
    }
}
WizardAtom.CSS_CLASS = "xui-wizard";
exports.WizardAtom = WizardAtom;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvd2l6YXJkL3dpemFyZC5hdG9tLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkRBQXNFO0FBQ3RFLHlDQUFxQztBQUNyQyw4Q0FBcUU7QUFFckUsZ0JBQXdCLFNBQVEsVUFBSTtJQWVoQyxZQUFZLE9BQXNCLEVBQUUsTUFBbUI7UUFDbkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBK0RaLFdBQU0sR0FBRyxHQUFHLEVBQUU7WUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDckMsQ0FBQyxDQUFDO1FBRUssU0FBSSxHQUFHLEdBQUcsRUFBRTtZQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ25DLENBQUMsQ0FBQztRQUVLLFNBQUksR0FBRyxHQUFHLEVBQUU7WUFDZixNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUM7UUFFSyxXQUFNLEdBQUcsR0FBRyxFQUFFO1lBQ2pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3JDLENBQUMsQ0FBQztRQUVLLGFBQVEsR0FBRyxDQUFDLEtBQWEsRUFBRSxFQUFFO1lBQ2hDLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxHQUFHLENBQUMsZUFBRSxDQUFDLFNBQVMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlGLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2QixDQUFDLENBQUM7UUFFSyxtQkFBYyxHQUFHLEdBQUcsRUFBRTtZQUN6QixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUMsT0FBTyxDQUFDLGVBQUUsQ0FBQyxTQUFTLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFD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QUFJLENBQUMsSUFBSSx1QkFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLE1BQU0sQ0FBQyxXQUFXLENBQUM7WUFDdkIsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2YsQ0FBQztJQUNMLENBQUM7SUExRU0sTUFBTSxDQUFDLFVBQVU7UUFDcEIsTUFBTSxNQUFNLEdBQUcsdUJBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNoQyxNQUFNLENBQUMsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3BELENBQUM7O0FBTGEsb0JBQVMsR0FBRyxZQUFZLENBQUM7QUFEM0MsZ0NBNkhDIiwiZmlsZSI6ImNvbXBvbmVudHMvd2l6YXJkL3dpemFyZC5hdG9tLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtieSwgRWxlbWVudEZpbmRlciwgcHJvbWlzZX0gZnJvbSBcIkBzb2xhcndpbmRzL3V6aS9wcm90cmFjdG9yXCI7XG5pbXBvcnQge0F0b219IGZyb20gXCJAc29sYXJ3aW5kcy91emlcIjtcbmltcG9ydCB7QnV0dG9uQXRvbSwgRGlhbG9nQXRvbSwgV2l6YXJkU3RlcEF0b219IGZyb20gXCIuLi9pbmRleC5hdG9tXCI7XG5cbmV4cG9ydCBjbGFzcyBXaXphcmRBdG9tIGV4dGVuZHMgQXRvbSB7XG4gICAgcHVibGljIHN0YXRpYyBDU1NfQ0xBU1MgPSBcInh1aS13aXphcmRcIjtcblxuICAgIHB1YmxpYyBzdGF0aWMgZnJvbURpYWxvZygpIHtcbiAgICAgICAgY29uc3QgZGlhbG9nID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBXaXphcmRBdG9tKGRpYWxvZy5nZXRCb2R5KCksIGRpYWxvZyk7XG4gICAgfVxuXG4gICAgcHVibGljIGRpYWxvZzogRGlhbG9nQXRvbTtcbiAgICBwdWJsaWMgYmFja0J1dHRvbjogQnV0dG9uQXRvbTtcbiAgICBwdWJsaWMgbmV4dEJ1dHRvbjogQnV0dG9uQXRvbTtcbiAgICBwdWJsaWMgZmluaXNoQnV0dG9uOiBCdXR0b25BdG9tO1xuICAgIHB1YmxpYyBjYW5jZWxCdXR0b246IEJ1dHRvbkF0b207XG4gICAgcHVibGljIGFkZGl0aW9uYWxCdXR0b25zOiBwcm9taXNlLlByb21pc2U8QnV0dG9uQXRvbVtdPjtcblxuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEVsZW1lbnRGaW5kZXIsIGRpYWxvZz86IERpYWxvZ0F0b20pIHtcbiAgICAgICAgc3VwZXIoZWxlbWVudCk7XG5cbiAgICAgICAgaWYgKGRpYWxvZykge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cgPSBkaWFsb2c7XG4gICAgICAgICAgICBjb25zdCBidXR0b25zID0gZGlhbG9nLmdldEZvb3RlckJ1dHRvbnMoKTtcbiAgICAgICAgICAgIHRoaXMuYmFja0J1dHRvbiA9IG5ldyBCdXR0b25BdG9tKGJ1dHRvbnMuZmlsdGVyKChlbDogRWxlbWVudEZpbmRlcik9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBwcm9taXNlLlByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQXRvbS5oYXNDbGFzcyhlbCwgXCJ4dWktd2l6YXJkX19iYWNrLWJ1dHRvblwiKS50aGVuKCh2YWx1ZSk9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5maXJzdCgpKTtcbiAgICAgICAgICAgIHRoaXMubmV4dEJ1dHRvbiA9IG5ldyBCdXR0b25BdG9tKGJ1dHRvbnMuZmlsdGVyKChlbDogRWxlbWVudEZpbmRlcik9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBwcm9taXNlLlByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQXRvbS5oYXNDbGFzcyhlbCwgXCJ4dWktd2l6YXJkX19uZXh0LWJ1dHRvblwiKS50aGVuKCh2YWx1ZSk9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5maXJzdCgpKTtcbiAgICAgICAgICAgIHRoaXMuZmluaXNoQnV0dG9uID0gbmV3IEJ1dHRvbkF0b20oYnV0dG9ucy5maWx0ZXIoKGVsOiBFbGVtZW50RmluZGVyKT0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHByb21pc2UuUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBBdG9tLmhhc0NsYXNzKGVsLCBcInh1aS13aXphcmRfX2ZpbmlzaC1idXR0b25cIikudGhlbigodmFsdWUpPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuZmlyc3QoKSk7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbEJ1dHRvbiA9IG5ldyBCdXR0b25BdG9tKGJ1dHRvbnMuZmlsdGVyKChlbDogRWxlbWVudEZpbmRlcik9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBwcm9taXNlLlByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgQXRvbS5oYXNDbGFzcyhlbCwgXCJ4dWktd2l6YXJkX19jYW5jZWwtYnV0dG9uXCIpLnRoZW4oKHZhbHVlKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLmZpcnN0KCkpO1xuXG4gICAgICAgICAgICB0aGlzLmFkZGl0aW9uYWxCdXR0b25zID0gYnV0dG9ucy5maWx0ZXIoKGVsOiBFbGVtZW50RmluZGVyKT0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHByb21pc2UuUHJvbWlzZSgocmVzb2x2ZSk9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWx0SW5CdXR0b25zID0gW1wieHVpLXdpemFyZF9fYmFjay1idXR0b25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieHVpLXdpemFyZF9fbmV4dC1idXR0b25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieHVpLXdpemFyZF9fZmluaXNoLWJ1dHRvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4dWktd2l6YXJkX19jYW5jZWwtYnV0dG9uXCJdO1xuICAgICAgICAgICAgICAgICAgICBBdG9tLmhhc0FueUNsYXNzKGVsLCBidWlsdEluQnV0dG9ucykudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCFyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnJlZHVjZSgoYWNjdW11bGF0b3I6IEJ1dHRvbkF0b21bXSwgZWw6IEVsZW1lbnRGaW5kZXIpPT4ge1xuICAgICAgICAgICAgICAgICAgICBhY2N1bXVsYXRvci5wdXNoKG5ldyBCdXR0b25BdG9tKGVsKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2N1bXVsYXRvcjtcbiAgICAgICAgICAgICAgICB9LCBbXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmJhY2tCdXR0b24gPSBuZXcgQnV0dG9uQXRvbShzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jbGFzc05hbWUoXCJ4dWktd2l6YXJkX19iYWNrLWJ1dHRvblwiKSkpO1xuICAgICAgICAgICAgdGhpcy5uZXh0QnV0dG9uID0gbmV3IEJ1dHRvbkF0b20oc3VwZXIuZ2V0RWxlbWVudCgpLmVsZW1lbnQoYnkuY2xhc3NOYW1lKFwieHVpLXdpemFyZF9fbmV4dC1idXR0b25cIikpKTtcbiAgICAgICAgICAgIHRoaXMuZmluaXNoQnV0dG9uID0gbmV3IEJ1dHRvbkF0b20oc3VwZXIuZ2V0RWxlbWVudCgpLmVsZW1lbnQoYnkuY2xhc3NOYW1lKFwieHVpLXdpemFyZF9fZmluaXNoLWJ1dHRvblwiKSkpO1xuICAgICAgICAgICAgdGhpcy5jYW5jZWxCdXR0b24gPSBuZXcgQnV0dG9uQXRvbShzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jbGFzc05hbWUoXCJ4dWktd2l6YXJkX19jYW5jZWwtYnV0dG9uXCIpKSk7XG5cbiAgICAgICAgICAgIHRoaXMuYWRkaXRpb25hbEJ1dHRvbnMgPSBzdXBlci5nZXRFbGVtZW50KCkuYWxsKGJ5LmNsYXNzTmFtZShcInh1aS13aXphcmRfX2FkZGl0aW9uYWwtYnV0dG9uXCIpKVxuICAgICAgICAgICAgICAgIC5yZWR1Y2UoKGFjY3VtdWxhdG9yOiBCdXR0b25BdG9tW10sIGVsOiBFbGVtZW50RmluZGVyKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgYWNjdW11bGF0b3IucHVzaChuZXcgQnV0dG9uQXRvbShlbCkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgICAgICAgICAgICAgfSwgW10pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNhbmNlbCA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsQnV0dG9uLmNsaWNrKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBuZXh0ID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5uZXh0QnV0dG9uLmNsaWNrKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBiYWNrID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5iYWNrQnV0dG9uLmNsaWNrKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBmaW5pc2ggPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmlzaEJ1dHRvbi5jbGljaygpO1xuICAgIH07XG5cbiAgICBwdWJsaWMgZ29Ub1N0ZXAgPSAoaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCBoZWFkZXJTdGVwID0gc3VwZXIuZ2V0RWxlbWVudCgpLmFsbChieS5jbGFzc05hbWUoXCJ4dWktd2l6YXJkX19oZWFkZXItc3RlcFwiKSkuZ2V0KGluZGV4KTtcbiAgICAgICAgaGVhZGVyU3RlcC5jbGljaygpO1xuICAgIH07XG5cbiAgICBwdWJsaWMgZ2V0SGVhZGVyU3RlcHMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0ZXBzRWwgPSBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jbGFzc05hbWUoXCJ4dWktd2l6YXJkX19oZWFkZXItc3RlcHNcIikpO1xuXG4gICAgICAgIHJldHVybiBzdGVwc0VsLmFsbChieS5jbGFzc05hbWUoXCJ4dWktd2l6YXJkX19oZWFkZXItc3RlcFwiKSkubWFwKChlbDogRWxlbWVudEZpbmRlcik9PiB7XG4gICAgICAgICAgICByZXR1cm4gZWwuYWxsKGJ5LmNsYXNzTmFtZShcInh1aS13aXphcmRfX2hlYWRlci1zdGVwLXRpdGxlXCIpKS5maXJzdCgpLmdldFRleHQoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBnZXRTdGVwcyA9ICgpID0+IHtcbiAgICAgICAgY29uc3Qgc3RlcHNFbCA9IHN1cGVyLmdldEVsZW1lbnQoKS5lbGVtZW50KGJ5LmNsYXNzTmFtZShcInh1aS13aXphcmRfX3N0ZXBzXCIpKTtcblxuICAgICAgICAvL3RoaXMgc2hvdWxkIHJlYWxseSBiZSBhIG1hcCBvcGVyYXRpb24uICBIb3dldmVyLCBtYXAgaGFzIGEgYnVnLSBpZiB5b3UgcHV0IGFuIGVsZW1lbnQgZmluZGVyXG4gICAgICAgIC8vaW4gaXQsIGl0IHdpbGwgdHJ5IHRvIHJlc29sdmUgRVZFUllUSElORywgYW5kIGNhdXNlcyBub2RlIHRvIGdvIGludG8gYW4gaW5maW5pdGUgbG9vcFxuICAgICAgICByZXR1cm4gc3RlcHNFbC5hbGwoYnkuY2xhc3NOYW1lKFwieHVpLXdpemFyZF9fc3RlcFwiKSlcbiAgICAgICAgICAgIC5yZWR1Y2UoKGFjY3VtdWxhdG9yOiBXaXphcmRTdGVwQXRvbVtdLCBlbDogRWxlbWVudEZpbmRlcik9PiB7XG4gICAgICAgICAgICAgICAgYWNjdW11bGF0b3IucHVzaChuZXcgV2l6YXJkU3RlcEF0b20oZWwpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgICAgICAgICB9LCBbXSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBnZXRDdXJyZW50U3RlcFRpdGxlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBlbCA9IHN1cGVyLmdldEVsZW1lbnQoKS5lbGVtZW50KGJ5LmNsYXNzTmFtZShcInh1aS13aXphcmRfX3RpdGxlXCIpKTtcbiAgICAgICAgcmV0dXJuIGVsLmdldFRleHQoKTtcbiAgICB9O1xuXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
