"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const protractor = require("@solarwinds/uzi/protractor");
const protractor_1 = require("@solarwinds/uzi/protractor");
const uzi_1 = require("@solarwinds/uzi");
const index_atom_1 = require("../index.atom");
class TextboxAtom extends uzi_1.Atom {
    constructor() {
        super(...arguments);
        this.isInWarningState = () => {
            return this.hasClass("has-warning");
        };
    }
    //error styles are applied to the form consistently; styles applied to
    //input boxes are not
    static isFormValidWith(validatorName) {
        let formInvalidStyle = "ng-form.ng-invalid-" + validatorName;
        return protractor_1.element.all(protractor_1.by.css(formInvalidStyle))
            .count()
            .then((count) => {
            return count === 0;
        });
    }
    getInput() {
        return super.getElement().element(protractor_1.by.className("form-control"));
    }
    getText() {
        // tslint:disable-next-line:max-line-length
        // https://github.com/angular/protractor/blob/master/docs/faq.md#the-result-of-gettext-from-an-input-element-is-always-empty
        return this.getInput().getAttribute("value");
    }
    getNumericUpButton() {
        let buttonSpan = super.getElement().element(protractor_1.by.className("xui-textbox__up-button"));
        return uzi_1.Atom.findIn(index_atom_1.ButtonAtom, buttonSpan);
    }
    getNumericDownButton() {
        let buttonSpan = super.getElement().element(protractor_1.by.className("xui-textbox__down-button"));
        return uzi_1.Atom.findIn(index_atom_1.ButtonAtom, buttonSpan);
    }
    acceptText(text) {
        return this.getInput().sendKeys(text, protractor.Key.ENTER);
    }
    clearText() {
        return this.getInput().clear();
    }
    /**
     * Gets a boolean indicating whether all validators are valid
     */
    isValid() {
        const xpath = `.//div[contains(@class, 'xui-validation')]`;
        const validationElem = this.getElement().element(protractor_1.by.xpath(xpath));
        // note: since using ng-show for changing visibility, we consider 
        //  textbox to be valid in case it is not displayed
        return validationElem.isDisplayed().then(isDisplayed => !isDisplayed);
    }
    /**
     * Gets a number of displayed validation messages
     */
    getValidationMessagesCount() {
        return __awaiter(this, void 0, void 0, function* () {
            const xpath = `.//div[contains(@class, 'xui-validation')]/*[@ng-message]`;
            const messages = this.getElement().all(protractor_1.by.xpath(xpath));
            const count = yield messages.count();
            let displayedCount = 0;
            for (let i = 0; i < count; i++) {
                if (yield messages.get(i).isDisplayed()) {
                    displayedCount++;
                }
            }
            return displayedCount;
        });
    }
    /**
     * Gets a message of ng-message element
     * @returns Text of validation message if present on page, otherwise undefined
     */
    getValidationMessage(ngMessage) {
        const xpath = `.//div[contains(@class, 'xui-validation')]/*[@ng-message='${ngMessage}']`;
        const validatorElem = this.getElement().element(protractor_1.by.xpath(xpath));
        // note: isPresent() check is here to prevent "NoSuchElementError" before getting the actual text
        return validatorElem.isPresent().then(isPresent => {
            if (!isPresent) {
                return undefined;
            }
            return validatorElem.getText();
        });
    }
}
TextboxAtom.CSS_CLASS = "xui-textbox";
exports.TextboxAtom = TextboxAtom;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdGV4dGJveC90ZXh0Ym94LmF0b20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLHlEQUF5RDtBQUN6RCwyREFBK0U7QUFDL0UseUNBQXFDO0FBQ3JDLDhDQUF5QztBQUV6QyxpQkFBeUIsU0FBUSxVQUFJO0lBQXJDOztRQWNXLHFCQUFnQixHQUFHLEdBQXFCLEVBQUU7WUFDN0MsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDO0lBNkVOLENBQUM7SUExRkcsc0VBQXNFO0lBQ3RFLHFCQUFxQjtJQUNyQixNQUFNLENBQUMsZUFBZSxDQUFDLGFBQXFCO1FBQ3hDLElBQUksZ0JBQWdCLEdBQUcscUJBQXFCLEdBQUcsYUFBYSxDQUFDO1FBQzdELE1BQU0sQ0FBQyxvQkFBTyxDQUFDLEdBQUcsQ0FBQyxlQUFFLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7YUFDdkMsS0FBSyxFQUFFO2FBQ1AsSUFBSSxDQUFDLENBQUMsS0FBYSxFQUFFLEVBQUU7WUFDcEIsTUFBTSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBTU0sUUFBUTtRQUNYLE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUMsT0FBTyxDQUFDLGVBQUUsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRU0sT0FBTztRQUNWLDJDQUEyQztRQUMzQyw0SEFBNEg7UUFDNUgsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVNLGtCQUFrQjtRQUNyQixJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUMsT0FBTyxDQUFDLGVBQUUsQ0FBQyxTQUFTLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLE1BQU0sQ0FBQyxVQUFJLENBQUMsTUFBTSxDQUFDLHVCQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVNLG9CQUFvQjtRQUN2QixJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUMsT0FBTyxDQUFDLGVBQUUsQ0FBQyxTQUFTLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDO1FBQ3RGLE1BQU0sQ0FBQyxVQUFJLENBQUMsTUFBTSxDQUFDLHVCQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVNLFVBQVUsQ0FBQyxJQUFZO1FBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFFTSxTQUFTO1FBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxPQUFPO1FBQ1YsTUFBTSxLQUFLLEdBQUcsNENBQTRDLENBQUM7UUFDM0QsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxlQUFFLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFbEUsa0VBQWtFO1FBQ2xFLG1EQUFtRDtRQUNuRCxNQUFNLENBQUMsY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDMUUsQ0FBQztJQUVEOztPQUVHO0lBQ1UsMEJBQTBCOztZQUNuQyxNQUFNLEtBQUssR0FBRywyREFBMkQsQ0FBQztZQUMxRSxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLGVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN4RCxNQUFNLEtBQUssR0FBRyxNQUFNLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUVyQyxJQUFJLGNBQWMsR0FBRyxDQUFDLENBQUM7WUFDdkIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDN0IsRUFBRSxDQUFDLENBQUMsTUFBTSxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFDdEMsY0FBYyxFQUFFLENBQUM7Z0JBQ3JCLENBQUM7WUFDTCxDQUFDO1lBRUQsTUFBTSxDQUFDLGNBQWMsQ0FBQztRQUMxQixDQUFDO0tBQUE7SUFFRDs7O09BR0c7SUFDSSxvQkFBb0IsQ0FBQyxTQUFpQjtRQUN6QyxNQUFNLEtBQUssR0FBRyw2REFBNkQsU0FBUyxJQUFJLENBQUM7UUFDekYsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxlQUFFLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFakUsaUdBQWlHO1FBQ2pHLE1BQU0sQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQzlDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDYixNQUFNLENBQUMsU0FBUyxDQUFDO1lBQ3JCLENBQUM7WUFFRCxNQUFNLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7QUEzRmEscUJBQVMsR0FBRyxhQUFhLENBQUM7QUFENUMsa0NBNkZDIiwiZmlsZSI6ImNvbXBvbmVudHMvdGV4dGJveC90ZXh0Ym94LmF0b20uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwcm90cmFjdG9yIGZyb20gXCJAc29sYXJ3aW5kcy91emkvcHJvdHJhY3RvclwiO1xuaW1wb3J0IHtieSwgZWxlbWVudCwgRWxlbWVudEZpbmRlciwgcHJvbWlzZX0gZnJvbSBcIkBzb2xhcndpbmRzL3V6aS9wcm90cmFjdG9yXCI7XG5pbXBvcnQge0F0b219IGZyb20gXCJAc29sYXJ3aW5kcy91emlcIjtcbmltcG9ydCB7QnV0dG9uQXRvbX0gZnJvbSBcIi4uL2luZGV4LmF0b21cIjtcblxuZXhwb3J0IGNsYXNzIFRleHRib3hBdG9tIGV4dGVuZHMgQXRvbSB7XG4gICAgcHVibGljIHN0YXRpYyBDU1NfQ0xBU1MgPSBcInh1aS10ZXh0Ym94XCI7XG5cbiAgICAvL2Vycm9yIHN0eWxlcyBhcmUgYXBwbGllZCB0byB0aGUgZm9ybSBjb25zaXN0ZW50bHk7IHN0eWxlcyBhcHBsaWVkIHRvXG4gICAgLy9pbnB1dCBib3hlcyBhcmUgbm90XG4gICAgc3RhdGljIGlzRm9ybVZhbGlkV2l0aCh2YWxpZGF0b3JOYW1lOiBzdHJpbmcpOiBwcm9taXNlLlByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBsZXQgZm9ybUludmFsaWRTdHlsZSA9IFwibmctZm9ybS5uZy1pbnZhbGlkLVwiICsgdmFsaWRhdG9yTmFtZTtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuYWxsKGJ5LmNzcyhmb3JtSW52YWxpZFN0eWxlKSlcbiAgICAgICAgICAgIC5jb3VudCgpXG4gICAgICAgICAgICAudGhlbigoY291bnQ6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb3VudCA9PT0gMDtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBpc0luV2FybmluZ1N0YXRlID0gKCk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXNDbGFzcyhcImhhcy13YXJuaW5nXCIpO1xuICAgIH07XG5cbiAgICBwdWJsaWMgZ2V0SW5wdXQoKTogRWxlbWVudEZpbmRlciB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jbGFzc05hbWUoXCJmb3JtLWNvbnRyb2xcIikpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRUZXh0KCk6IHByb21pc2UuUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9wcm90cmFjdG9yL2Jsb2IvbWFzdGVyL2RvY3MvZmFxLm1kI3RoZS1yZXN1bHQtb2YtZ2V0dGV4dC1mcm9tLWFuLWlucHV0LWVsZW1lbnQtaXMtYWx3YXlzLWVtcHR5XG4gICAgICAgIHJldHVybiB0aGlzLmdldElucHV0KCkuZ2V0QXR0cmlidXRlKFwidmFsdWVcIik7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE51bWVyaWNVcEJ1dHRvbigpOiBCdXR0b25BdG9tIHtcbiAgICAgICAgbGV0IGJ1dHRvblNwYW4gPSBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jbGFzc05hbWUoXCJ4dWktdGV4dGJveF9fdXAtYnV0dG9uXCIpKTtcbiAgICAgICAgcmV0dXJuIEF0b20uZmluZEluKEJ1dHRvbkF0b20sIGJ1dHRvblNwYW4pO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXROdW1lcmljRG93bkJ1dHRvbigpOiBCdXR0b25BdG9tIHtcbiAgICAgICAgbGV0IGJ1dHRvblNwYW4gPSBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jbGFzc05hbWUoXCJ4dWktdGV4dGJveF9fZG93bi1idXR0b25cIikpO1xuICAgICAgICByZXR1cm4gQXRvbS5maW5kSW4oQnV0dG9uQXRvbSwgYnV0dG9uU3Bhbik7XG4gICAgfVxuXG4gICAgcHVibGljIGFjY2VwdFRleHQodGV4dDogc3RyaW5nKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW5wdXQoKS5zZW5kS2V5cyh0ZXh0LCBwcm90cmFjdG9yLktleS5FTlRFUik7XG4gICAgfVxuXG4gICAgcHVibGljIGNsZWFyVGV4dCgpOiBwcm9taXNlLlByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnB1dCgpLmNsZWFyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIGFsbCB2YWxpZGF0b3JzIGFyZSB2YWxpZFxuICAgICAqL1xuICAgIHB1YmxpYyBpc1ZhbGlkKCk6IHByb21pc2UuUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGNvbnN0IHhwYXRoID0gYC4vL2Rpdltjb250YWlucyhAY2xhc3MsICd4dWktdmFsaWRhdGlvbicpXWA7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25FbGVtID0gdGhpcy5nZXRFbGVtZW50KCkuZWxlbWVudChieS54cGF0aCh4cGF0aCkpO1xuXG4gICAgICAgIC8vIG5vdGU6IHNpbmNlIHVzaW5nIG5nLXNob3cgZm9yIGNoYW5naW5nIHZpc2liaWxpdHksIHdlIGNvbnNpZGVyIFxuICAgICAgICAvLyAgdGV4dGJveCB0byBiZSB2YWxpZCBpbiBjYXNlIGl0IGlzIG5vdCBkaXNwbGF5ZWRcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25FbGVtLmlzRGlzcGxheWVkKCkudGhlbihpc0Rpc3BsYXllZCA9PiAhaXNEaXNwbGF5ZWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYSBudW1iZXIgb2YgZGlzcGxheWVkIHZhbGlkYXRpb24gbWVzc2FnZXNcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgZ2V0VmFsaWRhdGlvbk1lc3NhZ2VzQ291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgY29uc3QgeHBhdGggPSBgLi8vZGl2W2NvbnRhaW5zKEBjbGFzcywgJ3h1aS12YWxpZGF0aW9uJyldLypbQG5nLW1lc3NhZ2VdYDtcbiAgICAgICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLmdldEVsZW1lbnQoKS5hbGwoYnkueHBhdGgoeHBhdGgpKTtcbiAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCBtZXNzYWdlcy5jb3VudCgpO1xuXG4gICAgICAgIGxldCBkaXNwbGF5ZWRDb3VudCA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgaWYgKGF3YWl0IG1lc3NhZ2VzLmdldChpKS5pc0Rpc3BsYXllZCgpKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheWVkQ291bnQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaXNwbGF5ZWRDb3VudDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgbWVzc2FnZSBvZiBuZy1tZXNzYWdlIGVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyBUZXh0IG9mIHZhbGlkYXRpb24gbWVzc2FnZSBpZiBwcmVzZW50IG9uIHBhZ2UsIG90aGVyd2lzZSB1bmRlZmluZWRcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0VmFsaWRhdGlvbk1lc3NhZ2UobmdNZXNzYWdlOiBzdHJpbmcpOiBwcm9taXNlLlByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHhwYXRoID0gYC4vL2Rpdltjb250YWlucyhAY2xhc3MsICd4dWktdmFsaWRhdGlvbicpXS8qW0BuZy1tZXNzYWdlPScke25nTWVzc2FnZX0nXWA7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRvckVsZW0gPSB0aGlzLmdldEVsZW1lbnQoKS5lbGVtZW50KGJ5LnhwYXRoKHhwYXRoKSk7XG5cbiAgICAgICAgLy8gbm90ZTogaXNQcmVzZW50KCkgY2hlY2sgaXMgaGVyZSB0byBwcmV2ZW50IFwiTm9TdWNoRWxlbWVudEVycm9yXCIgYmVmb3JlIGdldHRpbmcgdGhlIGFjdHVhbCB0ZXh0XG4gICAgICAgIHJldHVybiB2YWxpZGF0b3JFbGVtLmlzUHJlc2VudCgpLnRoZW4oaXNQcmVzZW50ID0+IHtcbiAgICAgICAgICAgIGlmICghaXNQcmVzZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRvckVsZW0uZ2V0VGV4dCgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
