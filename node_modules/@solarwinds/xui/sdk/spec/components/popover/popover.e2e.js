"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor_1 = require("@solarwinds/uzi/protractor");
const index_atom_1 = require("../index.atom");
const helpers_1 = require("../helpers");
describe("USERCONTROL popover", () => {
    const inlineParentId = "elementPopoverTarget";
    const boxParentId = "boxPopoverTarget";
    const focusParentId = "focusTarget";
    const leftPlacementParentId = "leftButton";
    const rightPlacementParentId = "rightButton";
    const getStatusPopoverId = (status) => `statusPopover_${status}`;
    beforeEach(() => {
        helpers_1.default.prepareBrowser("popover");
    });
    describe("title", () => {
        it("shouldn't show when is not defined", () => {
            const inlineAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(inlineParentId)));
            inlineAtom.getTitle().then((title) => {
                expect(title.isPresent()).toBe(false);
            });
        });
        it("should show title when is defined and component is clicked", () => {
            const boxAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(boxParentId)));
            boxAtom.getTitle().then((title) => {
                expect(title.isPresent()).toBe(true);
            });
            boxAtom.moveMouseAndClickTarget();
            boxAtom.getTitleText().then(result => expect(result).toEqual("TEXT TO BIND"));
        });
    });
    describe("status", () => {
        function checkStatus(status, icon) {
            const statusAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(getStatusPopoverId(status))));
            expect(statusAtom.hasStatus(status)).toBe(true);
            expect(statusAtom.getStatusIconName()).toBe(icon);
        }
        it("should honor status", () => {
            const boxAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(boxParentId)));
            expect(boxAtom.hasNoStatus()).toBe(true);
            const okStatusAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(getStatusPopoverId("ok"))));
            expect(okStatusAtom.hasNoStatus()).toBe(false);
        });
        it("should honor empty status", () => {
            checkStatus("", "");
        });
        it("should honor 'ok' status", () => {
            checkStatus("ok", "");
        });
        it("should honor 'warning' status", () => {
            checkStatus("warning", "status_warning");
        });
        it("should honor 'critical' status", () => {
            checkStatus("critical", "status_critical");
        });
        it("should honor 'down' status", () => {
            checkStatus("down", "status_down");
        });
    });
    describe("triggers", () => {
        it("should honor 'click' trigger", () => {
            const boxAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(boxParentId)));
            expect(boxAtom.isPopoverDisplayed()).toBe(false);
            boxAtom.togglePopover();
            expect(boxAtom.isPopoverDisplayed()).toBe(true);
            boxAtom.togglePopover();
            expect(boxAtom.isPopoverDisplayed()).toBe(false);
            // ensure it isn't triggered by hover
            boxAtom.moveMouseToTarget();
            expect(boxAtom.isPopoverDisplayed()).toBe(false);
        });
        it("should honor 'mouseenter' trigger as default trigger", () => {
            const inlineAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(inlineParentId)));
            expect(inlineAtom.isPopoverDisplayed()).toBe(false);
            inlineAtom.moveMouseToTarget();
            expect(inlineAtom.isPopoverDisplayed()).toBe(true);
            // ensure click has no effect
            inlineAtom.clickTarget();
            expect(inlineAtom.isPopoverDisplayed()).toBe(true);
            // move away from parent and ensure the popover disappears
            const boxAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(boxParentId)));
            boxAtom.moveMouseToTarget();
            protractor_1.browser.wait(() => {
                return inlineAtom.isPopoverDisplayed().then((isDisplayed) => {
                    return !isDisplayed;
                });
            });
            expect(inlineAtom.isPopoverDisplayed()).toBe(false);
        });
        it("should honor 'focus' trigger", () => {
            const focusAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(focusParentId)));
            expect(focusAtom.isPopoverDisplayed()).toBe(false);
            focusAtom.togglePopover();
            expect(focusAtom.isPopoverDisplayed()).toBe(true);
            focusAtom.clickTarget();
            expect(focusAtom.isPopoverDisplayed()).toBe(true);
            focusAtom.clickTarget();
            expect(focusAtom.isPopoverDisplayed()).toBe(true);
            // move away from parent, click to shift focus and ensure the popover disappears
            const boxAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(boxParentId)));
            boxAtom.togglePopover();
            protractor_1.browser.wait(() => {
                return focusAtom.isPopoverDisplayed().then((isDisplayed) => {
                    return !isDisplayed;
                });
            });
            expect(focusAtom.isPopoverDisplayed()).toBe(false);
        });
        // it("should honor multiple triggers", () => {
        //     const warningStatusAtom = new PopoverAtom(element(by.id(warningParentId)));
        //     expect(warningStatusAtom.isPopoverDisplayed()).toBe(false);
        //     warningStatusAtom.moveMouseToTarget();
        //     expect(warningStatusAtom.isPopoverDisplayed()).toBe(true);
        //     const boxAtom = new PopoverAtom(element(by.id(boxParentId)));
        //     boxAtom.moveMouseToTarget();
        //     browser.wait(warningStatusAtom.isPopoverDisplayed().then(displayed => !displayed));
        //     expect(warningStatusAtom.isPopoverDisplayed()).toBe(false);
        //     warningStatusAtom.clickTarget();
        //     expect(warningStatusAtom.isPopoverDisplayed()).toBe(true);
        //     // move away from parent and ensure the popover disappears
        //     boxAtom.togglePopover();
        //     browser.wait(warningStatusAtom.isPopoverDisplayed().then(displayed => !displayed));
        //     expect(warningStatusAtom.isPopoverDisplayed()).toBe(false);
        // });
    });
    describe("resize", () => {
        it("should be hidden on window resize", () => {
            protractor_1.browser.manage().window().getSize().then((initialSize) => {
                const boxAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(boxParentId)));
                expect(boxAtom.isPopoverDisplayed()).toBe(false);
                boxAtom.moveMouseAndClickTarget();
                expect(boxAtom.isPopoverDisplayed()).toBe(true);
                protractor_1.browser.manage().window().setSize(320, 240).then(() => {
                    //expect(boxAtom.isPopoverDisplayed()).toBe(false);
                    protractor_1.browser.manage().window().setSize(initialSize.width, initialSize.height);
                });
            });
        });
    });
    describe("placement", () => {
        it("should honor 'placement'", () => {
            const leftPlacementAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(leftPlacementParentId)));
            leftPlacementAtom.togglePopover();
            expect(leftPlacementAtom.isDisplayedLeft()).toBe(true);
            expect(leftPlacementAtom.isDisplayedRight()).toBe(false);
            leftPlacementAtom.clickTarget();
            const rightPlacementAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id(rightPlacementParentId)));
            rightPlacementAtom.togglePopover();
            expect(rightPlacementAtom.isDisplayedLeft()).toBe(false);
            expect(rightPlacementAtom.isDisplayedRight()).toBe(true);
        });
        it("appear on the right to adjust for the lack of real-estate", () => {
            const adjustorAtom = new index_atom_1.PopoverAtom(protractor_1.element(protractor_1.by.id("leftAdjustToRightButton")));
            adjustorAtom.togglePopover();
            expect(adjustorAtom.isDisplayedLeft()).toBe(false);
            expect(adjustorAtom.isDisplayedRight()).toBe(true);
            adjustorAtom.clickTarget();
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvcG9wb3Zlci9wb3BvdmVyLmUyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDJEQUEyRTtBQUUzRSw4Q0FBNEM7QUFDNUMsd0NBQWlDO0FBRWpDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsTUFBTSxjQUFjLEdBQUcsc0JBQXNCLENBQUM7SUFDOUMsTUFBTSxXQUFXLEdBQUcsa0JBQWtCLENBQUM7SUFDdkMsTUFBTSxhQUFhLEdBQUcsYUFBYSxDQUFDO0lBQ3BDLE1BQU0scUJBQXFCLEdBQUcsWUFBWSxDQUFDO0lBQzNDLE1BQU0sc0JBQXNCLEdBQUcsYUFBYSxDQUFDO0lBRTdDLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxNQUFjLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixNQUFNLEVBQUUsQ0FBQztJQUV6RSxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osaUJBQU8sQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUNuQixFQUFFLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1lBQzFDLE1BQU0sVUFBVSxHQUFHLElBQUksd0JBQVcsQ0FBQyxvQkFBTyxDQUFDLGVBQUUsQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25FLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtnQkFDakMsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDREQUE0RCxFQUFFLEdBQUcsRUFBRTtZQUNsRSxNQUFNLE9BQU8sR0FBRyxJQUFJLHdCQUFXLENBQUMsb0JB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LENBQUMsb0JBQU8sQ0FBQyxlQUFFLENBQUMsRUFBRSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25GLGtCQUFrQixDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsa0JBQWtCLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyREFBMkQsRUFBRSxHQUFHLEVBQUU7WUFDakUsTUFBTSxZQUFZLEdBQUcsSUFBSSx3QkFBVyxDQUFDLG9CQUFPLENBQUMsZUFBRSxDQUFDLEVBQUUsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoRixZQUFZLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDN0IsTUFBTSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsWUFBWSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbkQsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJjb21wb25lbnRzL3BvcG92ZXIvcG9wb3Zlci5lMmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBicm93c2VyLCBieSwgZWxlbWVudCwgcHJvbWlzZSB9IGZyb20gXCJAc29sYXJ3aW5kcy91emkvcHJvdHJhY3RvclwiO1xuaW1wb3J0ICogYXMgd2ViZHJpdmVyIGZyb20gXCJAc29sYXJ3aW5kcy91emkvd2ViZHJpdmVyXCI7XG5pbXBvcnQgeyBQb3BvdmVyQXRvbSB9IGZyb20gXCIuLi9pbmRleC5hdG9tXCI7XG5pbXBvcnQgSGVscGVycyBmcm9tIFwiLi4vaGVscGVyc1wiO1xuXG5kZXNjcmliZShcIlVTRVJDT05UUk9MIHBvcG92ZXJcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGlubGluZVBhcmVudElkID0gXCJlbGVtZW50UG9wb3ZlclRhcmdldFwiO1xuICAgIGNvbnN0IGJveFBhcmVudElkID0gXCJib3hQb3BvdmVyVGFyZ2V0XCI7XG4gICAgY29uc3QgZm9jdXNQYXJlbnRJZCA9IFwiZm9jdXNUYXJnZXRcIjtcbiAgICBjb25zdCBsZWZ0UGxhY2VtZW50UGFyZW50SWQgPSBcImxlZnRCdXR0b25cIjtcbiAgICBjb25zdCByaWdodFBsYWNlbWVudFBhcmVudElkID0gXCJyaWdodEJ1dHRvblwiO1xuXG4gICAgY29uc3QgZ2V0U3RhdHVzUG9wb3ZlcklkID0gKHN0YXR1czogc3RyaW5nKSA9PiBgc3RhdHVzUG9wb3Zlcl8ke3N0YXR1c31gO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIEhlbHBlcnMucHJlcGFyZUJyb3dzZXIoXCJwb3BvdmVyXCIpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJ0aXRsZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkbid0IHNob3cgd2hlbiBpcyBub3QgZGVmaW5lZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmxpbmVBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoaW5saW5lUGFyZW50SWQpKSk7XG4gICAgICAgICAgICBpbmxpbmVBdG9tLmdldFRpdGxlKCkudGhlbigodGl0bGUpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QodGl0bGUuaXNQcmVzZW50KCkpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIHNob3cgdGl0bGUgd2hlbiBpcyBkZWZpbmVkIGFuZCBjb21wb25lbnQgaXMgY2xpY2tlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBib3hBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoYm94UGFyZW50SWQpKSk7XG4gICAgICAgICAgICBib3hBdG9tLmdldFRpdGxlKCkudGhlbigodGl0bGUpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QodGl0bGUuaXNQcmVzZW50KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYm94QXRvbS5tb3ZlTW91c2VBbmRDbGlja1RhcmdldCgpO1xuXG4gICAgICAgICAgICBib3hBdG9tLmdldFRpdGxlVGV4dCgpLnRoZW4ocmVzdWx0ID0+IGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoXCJURVhUIFRPIEJJTkRcIikpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwic3RhdHVzXCIsICgpID0+IHtcblxuICAgICAgICBmdW5jdGlvbiBjaGVja1N0YXR1cyhzdGF0dXM6IHN0cmluZywgaWNvbjogc3RyaW5nKSB7XG4gICAgICAgICAgICBjb25zdCBzdGF0dXNBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoZ2V0U3RhdHVzUG9wb3ZlcklkKHN0YXR1cykpKSk7XG4gICAgICAgICAgICBleHBlY3Qoc3RhdHVzQXRvbS5oYXNTdGF0dXMoc3RhdHVzKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChzdGF0dXNBdG9tLmdldFN0YXR1c0ljb25OYW1lKCkpLnRvQmUoaWNvbik7XG4gICAgICAgIH1cblxuICAgICAgICBpdChcInNob3VsZCBob25vciBzdGF0dXNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYm94QXRvbSA9IG5ldyBQb3BvdmVyQXRvbShlbGVtZW50KGJ5LmlkKGJveFBhcmVudElkKSkpO1xuICAgICAgICAgICAgZXhwZWN0KGJveEF0b20uaGFzTm9TdGF0dXMoKSkudG9CZSh0cnVlKTtcblxuICAgICAgICAgICAgY29uc3Qgb2tTdGF0dXNBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoZ2V0U3RhdHVzUG9wb3ZlcklkKFwib2tcIikpKSk7XG4gICAgICAgICAgICBleHBlY3Qob2tTdGF0dXNBdG9tLmhhc05vU3RhdHVzKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCBob25vciBlbXB0eSBzdGF0dXNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY2hlY2tTdGF0dXMoXCJcIiwgXCJcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhvbm9yICdvaycgc3RhdHVzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNoZWNrU3RhdHVzKFwib2tcIiwgXCJcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhvbm9yICd3YXJuaW5nJyBzdGF0dXNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY2hlY2tTdGF0dXMoXCJ3YXJuaW5nXCIsIFwic3RhdHVzX3dhcm5pbmdcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhvbm9yICdjcml0aWNhbCcgc3RhdHVzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNoZWNrU3RhdHVzKFwiY3JpdGljYWxcIiwgXCJzdGF0dXNfY3JpdGljYWxcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhvbm9yICdkb3duJyBzdGF0dXNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY2hlY2tTdGF0dXMoXCJkb3duXCIsIFwic3RhdHVzX2Rvd25cIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJ0cmlnZ2Vyc1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIGhvbm9yICdjbGljaycgdHJpZ2dlclwiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBib3hBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoYm94UGFyZW50SWQpKSk7XG4gICAgICAgICAgICBleHBlY3QoYm94QXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBib3hBdG9tLnRvZ2dsZVBvcG92ZXIoKTtcbiAgICAgICAgICAgIGV4cGVjdChib3hBdG9tLmlzUG9wb3ZlckRpc3BsYXllZCgpKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgYm94QXRvbS50b2dnbGVQb3BvdmVyKCk7XG4gICAgICAgICAgICBleHBlY3QoYm94QXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICAvLyBlbnN1cmUgaXQgaXNuJ3QgdHJpZ2dlcmVkIGJ5IGhvdmVyXG4gICAgICAgICAgICBib3hBdG9tLm1vdmVNb3VzZVRvVGFyZ2V0KCk7XG4gICAgICAgICAgICBleHBlY3QoYm94QXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhvbm9yICdtb3VzZWVudGVyJyB0cmlnZ2VyIGFzIGRlZmF1bHQgdHJpZ2dlclwiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmxpbmVBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoaW5saW5lUGFyZW50SWQpKSk7XG4gICAgICAgICAgICBleHBlY3QoaW5saW5lQXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBpbmxpbmVBdG9tLm1vdmVNb3VzZVRvVGFyZ2V0KCk7XG4gICAgICAgICAgICBleHBlY3QoaW5saW5lQXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIC8vIGVuc3VyZSBjbGljayBoYXMgbm8gZWZmZWN0XG4gICAgICAgICAgICBpbmxpbmVBdG9tLmNsaWNrVGFyZ2V0KCk7XG4gICAgICAgICAgICBleHBlY3QoaW5saW5lQXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIC8vIG1vdmUgYXdheSBmcm9tIHBhcmVudCBhbmQgZW5zdXJlIHRoZSBwb3BvdmVyIGRpc2FwcGVhcnNcbiAgICAgICAgICAgIGNvbnN0IGJveEF0b20gPSBuZXcgUG9wb3ZlckF0b20oZWxlbWVudChieS5pZChib3hQYXJlbnRJZCkpKTtcbiAgICAgICAgICAgIGJveEF0b20ubW92ZU1vdXNlVG9UYXJnZXQoKTtcbiAgICAgICAgICAgIGJyb3dzZXIud2FpdCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlubGluZUF0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkudGhlbigoaXNEaXNwbGF5ZWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFpc0Rpc3BsYXllZDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGlubGluZUF0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCBob25vciAnZm9jdXMnIHRyaWdnZXJcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZm9jdXNBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoZm9jdXNQYXJlbnRJZCkpKTtcbiAgICAgICAgICAgIGV4cGVjdChmb2N1c0F0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZm9jdXNBdG9tLnRvZ2dsZVBvcG92ZXIoKTtcbiAgICAgICAgICAgIGV4cGVjdChmb2N1c0F0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBmb2N1c0F0b20uY2xpY2tUYXJnZXQoKTtcbiAgICAgICAgICAgIGV4cGVjdChmb2N1c0F0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBmb2N1c0F0b20uY2xpY2tUYXJnZXQoKTtcbiAgICAgICAgICAgIGV4cGVjdChmb2N1c0F0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICAvLyBtb3ZlIGF3YXkgZnJvbSBwYXJlbnQsIGNsaWNrIHRvIHNoaWZ0IGZvY3VzIGFuZCBlbnN1cmUgdGhlIHBvcG92ZXIgZGlzYXBwZWFyc1xuICAgICAgICAgICAgY29uc3QgYm94QXRvbSA9IG5ldyBQb3BvdmVyQXRvbShlbGVtZW50KGJ5LmlkKGJveFBhcmVudElkKSkpO1xuICAgICAgICAgICAgYm94QXRvbS50b2dnbGVQb3BvdmVyKCk7XG4gICAgICAgICAgICBicm93c2VyLndhaXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBmb2N1c0F0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkudGhlbigoaXNEaXNwbGF5ZWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFpc0Rpc3BsYXllZDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGZvY3VzQXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGl0KFwic2hvdWxkIGhvbm9yIG11bHRpcGxlIHRyaWdnZXJzXCIsICgpID0+IHtcbiAgICAgICAgLy8gICAgIGNvbnN0IHdhcm5pbmdTdGF0dXNBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQod2FybmluZ1BhcmVudElkKSkpO1xuICAgICAgICAvLyAgICAgZXhwZWN0KHdhcm5pbmdTdGF0dXNBdG9tLmlzUG9wb3ZlckRpc3BsYXllZCgpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgLy8gICAgIHdhcm5pbmdTdGF0dXNBdG9tLm1vdmVNb3VzZVRvVGFyZ2V0KCk7XG4gICAgICAgIC8vICAgICBleHBlY3Qod2FybmluZ1N0YXR1c0F0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUodHJ1ZSk7XG5cbiAgICAgICAgLy8gICAgIGNvbnN0IGJveEF0b20gPSBuZXcgUG9wb3ZlckF0b20oZWxlbWVudChieS5pZChib3hQYXJlbnRJZCkpKTtcbiAgICAgICAgLy8gICAgIGJveEF0b20ubW92ZU1vdXNlVG9UYXJnZXQoKTtcbiAgICAgICAgLy8gICAgIGJyb3dzZXIud2FpdCh3YXJuaW5nU3RhdHVzQXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKS50aGVuKGRpc3BsYXllZCA9PiAhZGlzcGxheWVkKSk7XG4gICAgICAgIC8vICAgICBleHBlY3Qod2FybmluZ1N0YXR1c0F0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgICAvLyAgICAgd2FybmluZ1N0YXR1c0F0b20uY2xpY2tUYXJnZXQoKTtcbiAgICAgICAgLy8gICAgIGV4cGVjdCh3YXJuaW5nU3RhdHVzQXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgLy8gICAgIC8vIG1vdmUgYXdheSBmcm9tIHBhcmVudCBhbmQgZW5zdXJlIHRoZSBwb3BvdmVyIGRpc2FwcGVhcnNcbiAgICAgICAgLy8gICAgIGJveEF0b20udG9nZ2xlUG9wb3ZlcigpO1xuICAgICAgICAvLyAgICAgYnJvd3Nlci53YWl0KHdhcm5pbmdTdGF0dXNBdG9tLmlzUG9wb3ZlckRpc3BsYXllZCgpLnRoZW4oZGlzcGxheWVkID0+ICFkaXNwbGF5ZWQpKTtcbiAgICAgICAgLy8gICAgIGV4cGVjdCh3YXJuaW5nU3RhdHVzQXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgIC8vIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJyZXNpemVcIiwgKCkgPT4ge1xuICAgICAgICBpdChcInNob3VsZCBiZSBoaWRkZW4gb24gd2luZG93IHJlc2l6ZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBicm93c2VyLm1hbmFnZSgpLndpbmRvdygpLmdldFNpemUoKS50aGVuKChpbml0aWFsU2l6ZTogd2ViZHJpdmVyLklTaXplKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYm94QXRvbSA9IG5ldyBQb3BvdmVyQXRvbShlbGVtZW50KGJ5LmlkKGJveFBhcmVudElkKSkpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChib3hBdG9tLmlzUG9wb3ZlckRpc3BsYXllZCgpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBib3hBdG9tLm1vdmVNb3VzZUFuZENsaWNrVGFyZ2V0KCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGJveEF0b20uaXNQb3BvdmVyRGlzcGxheWVkKCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnJvd3Nlci5tYW5hZ2UoKS53aW5kb3coKS5zZXRTaXplKDMyMCwgMjQwKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy9leHBlY3QoYm94QXRvbS5pc1BvcG92ZXJEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyb3dzZXIubWFuYWdlKCkud2luZG93KCkuc2V0U2l6ZShpbml0aWFsU2l6ZS53aWR0aCwgaW5pdGlhbFNpemUuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwicGxhY2VtZW50XCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJzaG91bGQgaG9ub3IgJ3BsYWNlbWVudCdcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGVmdFBsYWNlbWVudEF0b20gPSBuZXcgUG9wb3ZlckF0b20oZWxlbWVudChieS5pZChsZWZ0UGxhY2VtZW50UGFyZW50SWQpKSk7XG4gICAgICAgICAgICBsZWZ0UGxhY2VtZW50QXRvbS50b2dnbGVQb3BvdmVyKCk7XG4gICAgICAgICAgICBleHBlY3QobGVmdFBsYWNlbWVudEF0b20uaXNEaXNwbGF5ZWRMZWZ0KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QobGVmdFBsYWNlbWVudEF0b20uaXNEaXNwbGF5ZWRSaWdodCgpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGxlZnRQbGFjZW1lbnRBdG9tLmNsaWNrVGFyZ2V0KCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0UGxhY2VtZW50QXRvbSA9IG5ldyBQb3BvdmVyQXRvbShlbGVtZW50KGJ5LmlkKHJpZ2h0UGxhY2VtZW50UGFyZW50SWQpKSk7XG4gICAgICAgICAgICByaWdodFBsYWNlbWVudEF0b20udG9nZ2xlUG9wb3ZlcigpO1xuICAgICAgICAgICAgZXhwZWN0KHJpZ2h0UGxhY2VtZW50QXRvbS5pc0Rpc3BsYXllZExlZnQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmlnaHRQbGFjZW1lbnRBdG9tLmlzRGlzcGxheWVkUmlnaHQoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJhcHBlYXIgb24gdGhlIHJpZ2h0IHRvIGFkanVzdCBmb3IgdGhlIGxhY2sgb2YgcmVhbC1lc3RhdGVcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYWRqdXN0b3JBdG9tID0gbmV3IFBvcG92ZXJBdG9tKGVsZW1lbnQoYnkuaWQoXCJsZWZ0QWRqdXN0VG9SaWdodEJ1dHRvblwiKSkpO1xuICAgICAgICAgICAgYWRqdXN0b3JBdG9tLnRvZ2dsZVBvcG92ZXIoKTtcbiAgICAgICAgICAgIGV4cGVjdChhZGp1c3RvckF0b20uaXNEaXNwbGF5ZWRMZWZ0KCkpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KGFkanVzdG9yQXRvbS5pc0Rpc3BsYXllZFJpZ2h0KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBhZGp1c3RvckF0b20uY2xpY2tUYXJnZXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
