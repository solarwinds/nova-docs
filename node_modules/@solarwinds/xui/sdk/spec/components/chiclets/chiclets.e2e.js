"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor_1 = require("@solarwinds/uzi/protractor");
const helpers_1 = require("../helpers");
const index_atom_1 = require("../index.atom");
const uzi_1 = require("@solarwinds/uzi");
const _ = require("lodash");
describe("USERCONTROL chiclets", () => {
    const itemsSource = {
        "statusId": ["downId", "criticalId", "warningId", "okId"],
        "vendorId": ["ciscoId", "hpId", "uniperId"]
    };
    const flatItemsSource = ["downId", "criticalId", "warningId", "okId"];
    const groupsCount = 2, // Object.keys(itemsSource).length
    groupItemsCount = 7, // Object.keys(itemsSource).reduce((p,c) => p+itemsSource[c].length,0)
    itemsCount = 4; // flatItemsSource.length;
    const parsedGroupNames = ["Status", "Vendor"];
    const parsedChickletNamesForGroups = ["Down", "Critical", "Warning", "Ok", "Cisco", "Hp", "Uniper"];
    const parsedChickletNamesForFlat = ["Down", "Critical", "Warning", "Ok"];
    describe("when chiclets are in horizontal mode with groups", () => {
        basicGroupTestCase("uc1");
    });
    describe("when chiclets are in horizontal mode without groups", () => {
        basicFlatTestCase("uc2");
    });
    describe("when chiclets are in vertical mode with groups", () => {
        basicGroupTestCase("uc3");
    });
    describe("when chiclets are in vertical mode without groups", () => {
        basicFlatTestCase("uc4");
    });
    function basicGroupTestCase(elementClassName) {
        let atom;
        beforeEach(() => {
            helpers_1.default.prepareBrowser("chiclets");
            atom = index_atom_1.ChicletsAtom.findIn(index_atom_1.ChicletsAtom, protractor_1.element(protractor_1.by.className(elementClassName)));
        });
        it("should have " + groupsCount + " filter groups on the page", () => {
            expect(atom.getChicletsGroupCount()).toBe(groupsCount);
        });
        it("should have correct group names with specified item-label-fn", () => {
            expect(atom.getChicletsGroupNames()).toEqual(parsedGroupNames);
        });
        it("should have correct chicklets names with specified item-label-fn", () => {
            expect(atom.getChicletsNames()).toEqual(parsedChickletNamesForGroups);
        });
        it("should have " + groupItemsCount + " filter values on the page", () => {
            expect(atom.getChicletsCount()).toBe(groupItemsCount);
        });
        it("should have correct number near 'Applied Filters' string", () => {
            expect(atom.getChicletsQuantityFromLabel()).toBe(groupItemsCount);
        });
        it("one filter should be removed", () => {
            atom.removeItem(0);
            expect(atom.getChicletsCount()).toBe(groupItemsCount - 1);
        });
        it("one group label should be removed when all items are unchecked", () => {
            _.times(itemsCount, () => atom.removeItem(0));
            expect(atom.getChicletsGroupCount()).toBe(groupsCount - 1);
        });
        it("should disappear after unchecking all filters", () => {
            expect(atom.isVisible()).toEqual(true);
            _.times(groupItemsCount, () => atom.removeItem(0));
            expect(atom.isVisible()).toEqual(false);
        });
        it("should disappear when 'clear all' link is used (= no filters are applied)", () => {
            atom.clearAll();
            expect(atom.isVisible()).toEqual(false);
        });
        it("itemsSource should be empty when 'clear all' is used", () => {
            const pre = protractor_1.element(protractor_1.by.id("itemsSourcePre"));
            atom.clearAll();
            pre.getText().then((text) => {
                let dataSource = JSON.parse(text);
                expect(dataSource.statusId.length).toBe(0);
                expect(dataSource.vendorId.length).toBe(0);
            });
        });
    }
    function basicFlatTestCase(elementClassName) {
        let atom;
        beforeEach(() => {
            helpers_1.default.prepareBrowser("chiclets");
            atom = uzi_1.Atom.findIn(index_atom_1.ChicletsAtom, protractor_1.element(protractor_1.by.className(elementClassName)));
        });
        it("should have no filter groups on the page", () => {
            expect(atom.getChicletsGroupCount()).toBe(0);
        });
        it("should have correct chicklets names with specified item-label-fn", () => {
            expect(atom.getChicletsNames()).toEqual(parsedChickletNamesForFlat);
        });
        it("should have " + itemsCount + " filter values on the page", () => {
            expect(atom.getChicletsCount()).toBe(itemsCount);
        });
        it("one filter should be removed", () => {
            atom.removeItem(0);
            expect(atom.getChicletsCount()).toBe(itemsCount - 1);
        });
        it("should disappear when when all items are unchecked", () => {
            expect(atom.isVisible()).toEqual(true);
            _.times(itemsCount, () => atom.removeItem(0));
            expect(atom.isVisible()).toEqual(false);
        });
        it("should disappear when 'clear all' link is used (= no filters are applied)", () => {
            atom.clearAll();
            expect(atom.isVisible()).toEqual(false);
        });
        it("itemsSource should be empty when 'clear all' is used", () => {
            const pre = protractor_1.element(protractor_1.by.id("flatItemsSourcePre"));
            atom.clearAll();
            expect(pre.getText()).toBe("[]");
        });
    }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvY2hpY2xldHMvY2hpY2xldHMuZTJlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkRBQWdFO0FBQ2hFLHdDQUFpQztBQUNqQyw4Q0FBMkM7QUFDM0MseUNBQXFDO0FBQ3JDLDRCQUE0QjtBQUU1QixRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBRWxDLE1BQU0sV0FBVyxHQUFHO1FBQ2hCLFVBQVUsRUFBRSxDQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sQ0FBQztRQUN6RCxVQUFVLEVBQUUsQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLFVBQVUsQ0FBQztLQUM5QyxDQUFDO0lBQ0YsTUFBTSxlQUFlLEdBQUcsQ0FBQyxRQUFRLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUV0RSxNQUFNLFdBQVcsR0FBRyxDQUFDLEVBQUUsa0NBQWtDO0lBQ3JELGVBQWUsR0FBRyxDQUFDLEVBQUUsc0VBQXNFO0lBQzNGLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQywwQkFBMEI7SUFFOUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUU5QyxNQUFNLDRCQUE0QixHQUFHLENBQUMsTUFBTSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDcEcsTUFBTSwwQkFBMEIsR0FBRyxDQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRXpFLFFBQVEsQ0FBQyxrREFBa0QsRUFBRSxHQUFHLEVBQUU7UUFDOUQsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMscURBQXFELEVBQUUsR0FBRyxFQUFFO1FBQ2pFLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxD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QUUsQ0FBQywyRUFBMkUsRUFBRSxHQUFHLEVBQUU7WUFDakYsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hCLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsc0RBQXNELEVBQUUsR0FBRyxFQUFFO1lBQzVELE1BQU0sR0FBRyxHQUFHLG9CQUFPLENBQUMsZUFBRSxDQUFDLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFDakQsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiY29tcG9uZW50cy9jaGljbGV0cy9jaGljbGV0cy5lMmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2J5LCBlbGVtZW50LCBwcm9taXNlfSBmcm9tIFwiQHNvbGFyd2luZHMvdXppL3Byb3RyYWN0b3JcIjtcbmltcG9ydCBIZWxwZXJzIGZyb20gXCIuLi9oZWxwZXJzXCI7XG5pbXBvcnQge0NoaWNsZXRzQXRvbX0gZnJvbSBcIi4uL2luZGV4LmF0b21cIjtcbmltcG9ydCB7QXRvbX0gZnJvbSBcIkBzb2xhcndpbmRzL3V6aVwiO1xuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XG5cbmRlc2NyaWJlKFwiVVNFUkNPTlRST0wgY2hpY2xldHNcIiwgKCkgPT4ge1xuXG4gICAgY29uc3QgaXRlbXNTb3VyY2UgPSB7XG4gICAgICAgIFwic3RhdHVzSWRcIjogW1wiZG93bklkXCIsIFwiY3JpdGljYWxJZFwiLCBcIndhcm5pbmdJZFwiLCBcIm9rSWRcIl0sXG4gICAgICAgIFwidmVuZG9ySWRcIjogW1wiY2lzY29JZFwiLCBcImhwSWRcIiwgXCJ1bmlwZXJJZFwiXVxuICAgIH07XG4gICAgY29uc3QgZmxhdEl0ZW1zU291cmNlID0gW1wiZG93bklkXCIsIFwiY3JpdGljYWxJZFwiLCBcIndhcm5pbmdJZFwiLCBcIm9rSWRcIl07XG5cbiAgICBjb25zdCBncm91cHNDb3VudCA9IDIsIC8vIE9iamVjdC5rZXlzKGl0ZW1zU291cmNlKS5sZW5ndGhcbiAgICAgICAgZ3JvdXBJdGVtc0NvdW50ID0gNywgLy8gT2JqZWN0LmtleXMoaXRlbXNTb3VyY2UpLnJlZHVjZSgocCxjKSA9PiBwK2l0ZW1zU291cmNlW2NdLmxlbmd0aCwwKVxuICAgICAgICBpdGVtc0NvdW50ID0gNDsgLy8gZmxhdEl0ZW1zU291cmNlLmxlbmd0aDtcblxuICAgIGNvbnN0IHBhcnNlZEdyb3VwTmFtZXMgPSBbXCJTdGF0dXNcIiwgXCJWZW5kb3JcIl07XG5cbiAgICBjb25zdCBwYXJzZWRDaGlja2xldE5hbWVzRm9yR3JvdXBzID0gW1wiRG93blwiLCBcIkNyaXRpY2FsXCIsIFwiV2FybmluZ1wiLCBcIk9rXCIsIFwiQ2lzY29cIiwgXCJIcFwiLCBcIlVuaXBlclwiXTtcbiAgICBjb25zdCBwYXJzZWRDaGlja2xldE5hbWVzRm9yRmxhdCA9IFtcIkRvd25cIiwgXCJDcml0aWNhbFwiLCBcIldhcm5pbmdcIiwgXCJPa1wiXTtcblxuICAgIGRlc2NyaWJlKFwid2hlbiBjaGljbGV0cyBhcmUgaW4gaG9yaXpvbnRhbCBtb2RlIHdpdGggZ3JvdXBzXCIsICgpID0+IHtcbiAgICAgICAgYmFzaWNHcm91cFRlc3RDYXNlKFwidWMxXCIpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJ3aGVuIGNoaWNsZXRzIGFyZSBpbiBob3Jpem9udGFsIG1vZGUgd2l0aG91dCBncm91cHNcIiwgKCkgPT4ge1xuICAgICAgICBiYXNpY0ZsYXRUZXN0Q2FzZShcInVjMlwiKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwid2hlbiBjaGljbGV0cyBhcmUgaW4gdmVydGljYWwgbW9kZSB3aXRoIGdyb3Vwc1wiLCAoKSA9PiB7XG4gICAgICAgIGJhc2ljR3JvdXBUZXN0Q2FzZShcInVjM1wiKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwid2hlbiBjaGljbGV0cyBhcmUgaW4gdmVydGljYWwgbW9kZSB3aXRob3V0IGdyb3Vwc1wiLCAoKSA9PiB7XG4gICAgICAgIGJhc2ljRmxhdFRlc3RDYXNlKFwidWM0XCIpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gYmFzaWNHcm91cFRlc3RDYXNlKGVsZW1lbnRDbGFzc05hbWU6c3RyaW5nKSB7XG4gICAgICAgIGxldCBhdG9tOiBDaGljbGV0c0F0b207XG5cbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgICAgICBIZWxwZXJzLnByZXBhcmVCcm93c2VyKFwiY2hpY2xldHNcIik7XG4gICAgICAgICAgICBhdG9tID0gQ2hpY2xldHNBdG9tLmZpbmRJbihDaGljbGV0c0F0b20sIGVsZW1lbnQoYnkuY2xhc3NOYW1lKGVsZW1lbnRDbGFzc05hbWUpKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhhdmUgXCIgKyBncm91cHNDb3VudCArIFwiIGZpbHRlciBncm91cHMgb24gdGhlIHBhZ2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGF0b20uZ2V0Q2hpY2xldHNHcm91cENvdW50KCkpLnRvQmUoZ3JvdXBzQ291bnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCBoYXZlIGNvcnJlY3QgZ3JvdXAgbmFtZXMgd2l0aCBzcGVjaWZpZWQgaXRlbS1sYWJlbC1mblwiLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoYXRvbS5nZXRDaGljbGV0c0dyb3VwTmFtZXMoKSkudG9FcXVhbChwYXJzZWRHcm91cE5hbWVzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgaGF2ZSBjb3JyZWN0IGNoaWNrbGV0cyBuYW1lcyB3aXRoIHNwZWNpZmllZCBpdGVtLWxhYmVsLWZuXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhdG9tLmdldENoaWNsZXRzTmFtZXMoKSkudG9FcXVhbChwYXJzZWRDaGlja2xldE5hbWVzRm9yR3JvdXBzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgaGF2ZSBcIiArIGdyb3VwSXRlbXNDb3VudCArIFwiIGZpbHRlciB2YWx1ZXMgb24gdGhlIHBhZ2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGF0b20uZ2V0Q2hpY2xldHNDb3VudCgpKS50b0JlKGdyb3VwSXRlbXNDb3VudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGhhdmUgY29ycmVjdCBudW1iZXIgbmVhciAnQXBwbGllZCBGaWx0ZXJzJyBzdHJpbmdcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGF0b20uZ2V0Q2hpY2xldHNRdWFudGl0eUZyb21MYWJlbCgpKS50b0JlKGdyb3VwSXRlbXNDb3VudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwib25lIGZpbHRlciBzaG91bGQgYmUgcmVtb3ZlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBhdG9tLnJlbW92ZUl0ZW0oMCk7XG4gICAgICAgICAgICBleHBlY3QoYXRvbS5nZXRDaGljbGV0c0NvdW50KCkpLnRvQmUoZ3JvdXBJdGVtc0NvdW50IC0gMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwib25lIGdyb3VwIGxhYmVsIHNob3VsZCBiZSByZW1vdmVkIHdoZW4gYWxsIGl0ZW1zIGFyZSB1bmNoZWNrZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgXy50aW1lcyhpdGVtc0NvdW50LCAoKSA9PiBhdG9tLnJlbW92ZUl0ZW0oMCkpO1xuICAgICAgICAgICAgZXhwZWN0KGF0b20uZ2V0Q2hpY2xldHNHcm91cENvdW50KCkpLnRvQmUoZ3JvdXBzQ291bnQgLSAxKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgZGlzYXBwZWFyIGFmdGVyIHVuY2hlY2tpbmcgYWxsIGZpbHRlcnNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGF0b20uaXNWaXNpYmxlKCkpLnRvRXF1YWwodHJ1ZSk7XG4gICAgICAgICAgICBfLnRpbWVzKGdyb3VwSXRlbXNDb3VudCwgKCkgPT4gYXRvbS5yZW1vdmVJdGVtKDApKTtcbiAgICAgICAgICAgIGV4cGVjdChhdG9tLmlzVmlzaWJsZSgpKS50b0VxdWFsKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgZGlzYXBwZWFyIHdoZW4gJ2NsZWFyIGFsbCcgbGluayBpcyB1c2VkICg9IG5vIGZpbHRlcnMgYXJlIGFwcGxpZWQpXCIsICgpID0+IHtcbiAgICAgICAgICAgIGF0b20uY2xlYXJBbGwoKTtcbiAgICAgICAgICAgIGV4cGVjdChhdG9tLmlzVmlzaWJsZSgpKS50b0VxdWFsKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJpdGVtc1NvdXJjZSBzaG91bGQgYmUgZW1wdHkgd2hlbiAnY2xlYXIgYWxsJyBpcyB1c2VkXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByZSA9IGVsZW1lbnQoYnkuaWQoXCJpdGVtc1NvdXJjZVByZVwiKSk7XG4gICAgICAgICAgICBhdG9tLmNsZWFyQWxsKCk7XG4gICAgICAgICAgICBwcmUuZ2V0VGV4dCgpLnRoZW4oKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZGF0YVNvdXJjZSA9IEpTT04ucGFyc2UodGV4dCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGRhdGFTb3VyY2Uuc3RhdHVzSWQubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICAgICAgICAgIGV4cGVjdChkYXRhU291cmNlLnZlbmRvcklkLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBiYXNpY0ZsYXRUZXN0Q2FzZShlbGVtZW50Q2xhc3NOYW1lOnN0cmluZykge1xuICAgICAgICBsZXQgYXRvbTogQ2hpY2xldHNBdG9tO1xuXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAgICAgSGVscGVycy5wcmVwYXJlQnJvd3NlcihcImNoaWNsZXRzXCIpO1xuICAgICAgICAgICAgYXRvbSA9IEF0b20uZmluZEluKENoaWNsZXRzQXRvbSwgZWxlbWVudChieS5jbGFzc05hbWUoZWxlbWVudENsYXNzTmFtZSkpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgaGF2ZSBubyBmaWx0ZXIgZ3JvdXBzIG9uIHRoZSBwYWdlXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhdG9tLmdldENoaWNsZXRzR3JvdXBDb3VudCgpKS50b0JlKDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCBoYXZlIGNvcnJlY3QgY2hpY2tsZXRzIG5hbWVzIHdpdGggc3BlY2lmaWVkIGl0ZW0tbGFiZWwtZm5cIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGF0b20uZ2V0Q2hpY2xldHNOYW1lcygpKS50b0VxdWFsKHBhcnNlZENoaWNrbGV0TmFtZXNGb3JGbGF0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgaGF2ZSBcIiArIGl0ZW1zQ291bnQgKyBcIiBmaWx0ZXIgdmFsdWVzIG9uIHRoZSBwYWdlXCIsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhdG9tLmdldENoaWNsZXRzQ291bnQoKSkudG9CZShpdGVtc0NvdW50KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJvbmUgZmlsdGVyIHNob3VsZCBiZSByZW1vdmVkXCIsICgpID0+IHtcbiAgICAgICAgICAgIGF0b20ucmVtb3ZlSXRlbSgwKTtcbiAgICAgICAgICAgIGV4cGVjdChhdG9tLmdldENoaWNsZXRzQ291bnQoKSkudG9CZShpdGVtc0NvdW50IC0gMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGRpc2FwcGVhciB3aGVuIHdoZW4gYWxsIGl0ZW1zIGFyZSB1bmNoZWNrZWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGF0b20uaXNWaXNpYmxlKCkpLnRvRXF1YWwodHJ1ZSk7XG4gICAgICAgICAgICBfLnRpbWVzKGl0ZW1zQ291bnQsICgpID0+IGF0b20ucmVtb3ZlSXRlbSgwKSk7XG4gICAgICAgICAgICBleHBlY3QoYXRvbS5pc1Zpc2libGUoKSkudG9FcXVhbChmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGRpc2FwcGVhciB3aGVuICdjbGVhciBhbGwnIGxpbmsgaXMgdXNlZCAoPSBubyBmaWx0ZXJzIGFyZSBhcHBsaWVkKVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBhdG9tLmNsZWFyQWxsKCk7XG4gICAgICAgICAgICBleHBlY3QoYXRvbS5pc1Zpc2libGUoKSkudG9FcXVhbChmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiaXRlbXNTb3VyY2Ugc2hvdWxkIGJlIGVtcHR5IHdoZW4gJ2NsZWFyIGFsbCcgaXMgdXNlZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwcmUgPSBlbGVtZW50KGJ5LmlkKFwiZmxhdEl0ZW1zU291cmNlUHJlXCIpKTtcbiAgICAgICAgICAgIGF0b20uY2xlYXJBbGwoKTtcbiAgICAgICAgICAgIGV4cGVjdChwcmUuZ2V0VGV4dCgpKS50b0JlKFwiW11cIik7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
