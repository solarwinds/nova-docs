"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor_1 = require("@solarwinds/uzi/protractor");
const helpers_1 = require("../helpers");
const index_atom_1 = require("../index.atom");
const uzi_1 = require("@solarwinds/uzi");
describe("USERCONTROL dialog", () => {
    let pageContainer;
    beforeEach(() => {
        helpers_1.default.prepareBrowser("dialog");
        pageContainer = protractor_1.element(protractor_1.by.id("xui-demo-components-dialog"));
    });
    let showDialog = (buttonIndex) => {
        const buttonAtom = uzi_1.Atom.findIn(index_atom_1.ButtonAtom, pageContainer, buttonIndex);
        buttonAtom.click();
    };
    let showMessageDialog = () => {
        showDialog(0);
    };
    let showWarningDialog = () => {
        showDialog(1);
    };
    let showErrorDialog = () => {
        showDialog(2);
    };
    let showCustomDialog = () => {
        showDialog(3);
    };
    let showDialogWithTemplate = () => {
        showDialog(4);
    };
    let showCustomFooterDialog = () => {
        showDialog(5);
    };
    let showDialogWithBtnIcons = () => {
        showDialog(6);
    };
    it("should appear when showModal is invoked", () => {
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
        showMessageDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        const dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom).toBeDefined();
    });
    it("should display message dialog on button-click with correct title", () => {
        showMessageDialog();
        const dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.getTitle()).toBe("Gothos");
        expect(dialogAtom.getMessage()).toBe("Greetings and Felicitations!");
    });
    it("should display an OK button in the footer which closes the dialog", () => {
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
        showMessageDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        const dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.footerButtonCount()).toBe(1);
        dialogAtom.clickFooterButton("OK");
        index_atom_1.DialogAtom.waitUntilHidden();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
    });
    it("should close when the closeX is clicked", () => {
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
        showMessageDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        const dialogAtom = index_atom_1.DialogAtom.get();
        const closeXButton = uzi_1.Atom.findIn(index_atom_1.ButtonAtom, dialogAtom.getHeader());
        expect(closeXButton).toBeDefined();
        closeXButton.click();
        index_atom_1.DialogAtom.waitUntilHidden();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
    });
    it("should not include a status icon", () => {
        showMessageDialog();
        const dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.isStatusIconPresent()).toBe(false);
    });
    it("should include warning icon in title", () => {
        showWarningDialog();
        const dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.isStatusIconPresent()).toBe(true);
        expect(dialogAtom.isWarningStatusIconPresent()).toBe(true);
        expect(dialogAtom.isErrorStatusIconPresent()).toBe(false);
    });
    it("should include error icon in title", () => {
        showErrorDialog();
        const dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.isStatusIconPresent()).toBe(true);
        expect(dialogAtom.isErrorStatusIconPresent()).toBe(true);
        expect(dialogAtom.isWarningStatusIconPresent()).toBe(false);
    });
    it("should include CLOSE footer-button for status dialogs", () => {
        showWarningDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        let dialogAtom = index_atom_1.DialogAtom.get();
        dialogAtom.clickFooterButton("CLOSE");
        index_atom_1.DialogAtom.waitUntilHidden();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
        showErrorDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        dialogAtom = index_atom_1.DialogAtom.get();
        dialogAtom.clickFooterButton("CLOSE");
        index_atom_1.DialogAtom.waitUntilHidden();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
    });
    it("should include optional action footer-button for warning dialogs", () => {
        showWarningDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        let dialogAtom = index_atom_1.DialogAtom.get();
        dialogAtom.clickFooterButton("PROCEED");
        index_atom_1.DialogAtom.waitUntilHidden();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
    });
    it("should include START and CLOSE footer-buttons for custom dialog", () => {
        showCustomDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.getVisibleFooterButton("START")).toBeDefined();
        expect(dialogAtom.getVisibleFooterButton("CLOSE")).toBeDefined();
    });
    it("should include START and CLOSE footer-buttons for custom dialog", () => {
        showCustomDialog();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(true);
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.getVisibleFooterButton("START")).toBeDefined();
        expect(dialogAtom.getVisibleFooterButton("CLOSE")).toBeDefined();
    });
    it("should disable footer buttons while busy", () => {
        showCustomDialog();
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.isBusyOverlayDisplayed()).toBe(false);
        const startButton = new index_atom_1.ButtonAtom(dialogAtom.getVisibleFooterButton("START"));
        expect(startButton).toBeDefined();
        expect(startButton.isDisabled()).toBe(false);
        const closeButton = new index_atom_1.ButtonAtom(dialogAtom.getVisibleFooterButton("CLOSE"));
        expect(closeButton).toBeDefined();
        expect(closeButton.isDisabled()).toBe(false);
        startButton.click();
        // allow dialog action promise to resolve so that we can
        // test busy state while it's actually busy
        protractor_1.browser.ignoreSynchronization = true;
        protractor_1.browser.wait(() => dialogAtom.isBusyOverlayDisplayed());
        expect(dialogAtom.isBusyOverlayDisplayed()).toBe(true);
        expect(startButton.isDisabled()).toBe(true);
        expect(closeButton.isDisabled()).toBe(true);
        dialogAtom.cancelBusy();
        protractor_1.browser.ignoreSynchronization = false;
    });
    it("should close the dialog when busy canceled is clicked", () => {
        showCustomDialog();
        let dialogAtom = index_atom_1.DialogAtom.get();
        const startButton = new index_atom_1.ButtonAtom(dialogAtom.getVisibleFooterButton("START"));
        startButton.click();
        // allow dialog action promise to resolve so that we can
        // test busy state while it's actually busy
        protractor_1.browser.ignoreSynchronization = true;
        protractor_1.browser.wait(() => dialogAtom.isBusyOverlayDisplayed());
        expect(dialogAtom.isBusyOverlayDisplayed()).toBe(true);
        dialogAtom.cancelBusy();
        protractor_1.browser.ignoreSynchronization = false;
        index_atom_1.DialogAtom.waitUntilHidden();
        expect(index_atom_1.DialogAtom.isPresent()).toBe(false);
    });
    it("should handle nested dialogs", () => {
        showDialogWithTemplate();
        let dialogAtom = index_atom_1.DialogAtom.get();
        const launchButton = uzi_1.Atom.findIn(index_atom_1.ButtonAtom, dialogAtom.getBody(), 0);
        launchButton.click();
        //second dialog should be open at this point- the atom should automatically refocus to it
        expect(dialogAtom.isBusyOverlayDisplayed()).toBe(false);
        expect(dialogAtom.getVisibleFooterButton("START")).toBeDefined();
        dialogAtom.clickFooterButton("START");
        // allow dialog action promise to resolve so that we can
        // test busy state while it's actually busy
        protractor_1.browser.ignoreSynchronization = true;
        protractor_1.browser.wait(() => dialogAtom.isBusyOverlayDisplayed());
        expect(dialogAtom.isBusyOverlayDisplayed()).toBe(true);
        dialogAtom.cancelBusy();
        protractor_1.browser.ignoreSynchronization = false;
    });
    it("should transclude custom dialog templates", () => {
        showDialogWithTemplate();
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.getContent("xui-demo-components-dialog").isDisplayed()).toBe(true);
    });
    it("should hide top close button", () => {
        showCustomDialog();
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.getHeaderClose().isPresent()).toBeFalsy();
    });
    it("should show top close button", () => {
        showDialogWithTemplate();
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.getHeaderClose().isPresent()).toBeTruthy();
    });
    it("should show dialog with text message instead of buttons", () => {
        showCustomFooterDialog();
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.getVisibleFooterButtons().count()).toBe(0);
        expect(dialogAtom.getFooter().getText()).toContain("buttons");
    });
    it("should show dialog with specified icons on footer buttons and align them properly", () => {
        showDialogWithBtnIcons();
        let dialogAtom = index_atom_1.DialogAtom.get();
        expect(dialogAtom.isFooterBtnHasClass(0, "icon-right")).toBeTruthy();
        expect(dialogAtom.isFooterBtnIconHasClass(0, "xui-icon-state_running")).toBeTruthy();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZGlhbG9nL2RpYWxvZy5lMmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyREFBd0Y7QUFDeEYsd0NBQWlDO0FBQ2pDLDhDQUFxRDtBQUNyRCx5Q0FBcUM7QUFFckMsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLGFBQTRCLENBQUM7SUFFakMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGlCQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pDLGFBQWEsR0FBRyxvQkFBTyxDQUFDLGVBQUUsQ0FBQyxFQUFFLENBQUMsNEJBQTRCLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxVQUFVLEdBQUcsQ0FBQyxXQUFtQixFQUFFLEVBQUU7UUFDckMsTUFBTSxVQUFVLEdBQUcsVUFBSSxDQUFDLE1BQU0sQ0FBQyx1QkFBVSxFQUFFLGFBQWEsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUN2RSxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDO0lBRUYsSUFBSSxpQkFBaUIsR0FBRyxHQUFHLEVBQUU7UUFDekIsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUMsQ0FBQztJQUVGLElBQUksaUJBQWlCLEdBQUcsR0FBRyxFQUFFO1FBQ3pCLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDLENBQUM7SUFFRixJQUFJLGVBQWUsR0FBRyxHQUFHLEVBQUU7UUFDdkIsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUMsQ0FBQztJQUVGLElBQUksZ0JBQWdCLEdBQUcsR0FBRyxFQUFFO1FBQ3hCLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDLENBQUM7SUFFRixJQUFJLHNCQUFzQixHQUFHLEdBQUcsRUFBRTtRQUM5QixVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEIs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QUE4QixFQUFFLEdBQUcsRUFBRTtRQUNwQyxzQkFBc0IsRUFBRSxDQUFDO1FBQ3pCLElBQUksVUFBVSxHQUFHLHVCQUFVLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDbEMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEdBQUcsRUFBRTtRQUMvRCxzQkFBc0IsRUFBRSxDQUFDO1FBQ3pCLElBQUksVUFBVSxHQUFHLHVCQUFVLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDbEMsTUFBTSxDQUFDLFVBQVUsQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEUsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsbUZBQW1GLEVBQUUsR0FBRyxFQUFFO1FBQ3pGLHNCQUFzQixFQUFFLENBQUM7UUFDekIsSUFBSSxVQUFVLEdBQUcsdUJBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNsQyxNQUFNLENBQUMsVUFBVSxDQUFDLG1CQUFtQixDQUFDLENBQUMsRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3JFLE1BQU0sQ0FBQyxVQUFVLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxFQUFFLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUN6RixDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImNvbXBvbmVudHMvZGlhbG9nL2RpYWxvZy5lMmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2Jyb3dzZXIsIGJ5LCBlbGVtZW50LCBFbGVtZW50RmluZGVyLCBwcm9taXNlfSBmcm9tIFwiQHNvbGFyd2luZHMvdXppL3Byb3RyYWN0b3JcIjtcbmltcG9ydCBIZWxwZXJzIGZyb20gXCIuLi9oZWxwZXJzXCI7XG5pbXBvcnQge0J1dHRvbkF0b20sIERpYWxvZ0F0b219IGZyb20gXCIuLi9pbmRleC5hdG9tXCI7XG5pbXBvcnQge0F0b219IGZyb20gXCJAc29sYXJ3aW5kcy91emlcIjtcblxuZGVzY3JpYmUoXCJVU0VSQ09OVFJPTCBkaWFsb2dcIiwgKCkgPT4ge1xuICAgIGxldCBwYWdlQ29udGFpbmVyOiBFbGVtZW50RmluZGVyO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIEhlbHBlcnMucHJlcGFyZUJyb3dzZXIoXCJkaWFsb2dcIik7XG4gICAgICAgIHBhZ2VDb250YWluZXIgPSBlbGVtZW50KGJ5LmlkKFwieHVpLWRlbW8tY29tcG9uZW50cy1kaWFsb2dcIikpO1xuICAgIH0pO1xuXG4gICAgbGV0IHNob3dEaWFsb2cgPSAoYnV0dG9uSW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCBidXR0b25BdG9tID0gQXRvbS5maW5kSW4oQnV0dG9uQXRvbSwgcGFnZUNvbnRhaW5lciwgYnV0dG9uSW5kZXgpO1xuICAgICAgICBidXR0b25BdG9tLmNsaWNrKCk7XG4gICAgfTtcblxuICAgIGxldCBzaG93TWVzc2FnZURpYWxvZyA9ICgpID0+IHtcbiAgICAgICAgc2hvd0RpYWxvZygwKTtcbiAgICB9O1xuXG4gICAgbGV0IHNob3dXYXJuaW5nRGlhbG9nID0gKCkgPT4ge1xuICAgICAgICBzaG93RGlhbG9nKDEpO1xuICAgIH07XG5cbiAgICBsZXQgc2hvd0Vycm9yRGlhbG9nID0gKCkgPT4ge1xuICAgICAgICBzaG93RGlhbG9nKDIpO1xuICAgIH07XG5cbiAgICBsZXQgc2hvd0N1c3RvbURpYWxvZyA9ICgpID0+IHtcbiAgICAgICAgc2hvd0RpYWxvZygzKTtcbiAgICB9O1xuXG4gICAgbGV0IHNob3dEaWFsb2dXaXRoVGVtcGxhdGUgPSAoKSA9PiB7XG4gICAgICAgIHNob3dEaWFsb2coNCk7XG4gICAgfTtcblxuICAgIGxldCBzaG93Q3VzdG9tRm9vdGVyRGlhbG9nID0gKCkgPT4ge1xuICAgICAgICBzaG93RGlhbG9nKDUpO1xuICAgIH07XG5cbiAgICBsZXQgc2hvd0RpYWxvZ1dpdGhCdG5JY29ucyA9ICgpID0+IHtcbiAgICAgICAgc2hvd0RpYWxvZyg2KTtcbiAgICB9O1xuXG4gICAgaXQoXCJzaG91bGQgYXBwZWFyIHdoZW4gc2hvd01vZGFsIGlzIGludm9rZWRcIiwgKCkgPT4ge1xuICAgICAgICBleHBlY3QoRGlhbG9nQXRvbS5pc1ByZXNlbnQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgIHNob3dNZXNzYWdlRGlhbG9nKCk7XG4gICAgICAgIGV4cGVjdChEaWFsb2dBdG9tLmlzUHJlc2VudCgpKS50b0JlKHRydWUpO1xuICAgICAgICBjb25zdCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBkaXNwbGF5IG1lc3NhZ2UgZGlhbG9nIG9uIGJ1dHRvbi1jbGljayB3aXRoIGNvcnJlY3QgdGl0bGVcIiwgKCkgPT4ge1xuICAgICAgICBzaG93TWVzc2FnZURpYWxvZygpO1xuICAgICAgICBjb25zdCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0VGl0bGUoKSkudG9CZShcIkdvdGhvc1wiKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0TWVzc2FnZSgpKS50b0JlKFwiR3JlZXRpbmdzIGFuZCBGZWxpY2l0YXRpb25zIVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGRpc3BsYXkgYW4gT0sgYnV0dG9uIGluIHRoZSBmb290ZXIgd2hpY2ggY2xvc2VzIHRoZSBkaWFsb2dcIiwgKCkgPT4ge1xuICAgICAgICBleHBlY3QoRGlhbG9nQXRvbS5pc1ByZXNlbnQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgIHNob3dNZXNzYWdlRGlhbG9nKCk7XG4gICAgICAgIGV4cGVjdChEaWFsb2dBdG9tLmlzUHJlc2VudCgpKS50b0JlKHRydWUpO1xuICAgICAgICBjb25zdCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZm9vdGVyQnV0dG9uQ291bnQoKSkudG9CZSgxKTtcbiAgICAgICAgZGlhbG9nQXRvbS5jbGlja0Zvb3RlckJ1dHRvbihcIk9LXCIpO1xuICAgICAgICBEaWFsb2dBdG9tLndhaXRVbnRpbEhpZGRlbigpO1xuICAgICAgICBleHBlY3QoRGlhbG9nQXRvbS5pc1ByZXNlbnQoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBjbG9zZSB3aGVuIHRoZSBjbG9zZVggaXMgY2xpY2tlZFwiLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChEaWFsb2dBdG9tLmlzUHJlc2VudCgpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgc2hvd01lc3NhZ2VEaWFsb2coKTtcbiAgICAgICAgZXhwZWN0KERpYWxvZ0F0b20uaXNQcmVzZW50KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGNvbnN0IGRpYWxvZ0F0b20gPSBEaWFsb2dBdG9tLmdldCgpO1xuICAgICAgICBjb25zdCBjbG9zZVhCdXR0b24gPSBBdG9tLmZpbmRJbihCdXR0b25BdG9tLCBkaWFsb2dBdG9tLmdldEhlYWRlcigpKTtcbiAgICAgICAgZXhwZWN0KGNsb3NlWEJ1dHRvbikudG9CZURlZmluZWQoKTtcbiAgICAgICAgY2xvc2VYQnV0dG9uLmNsaWNrKCk7XG4gICAgICAgIERpYWxvZ0F0b20ud2FpdFVudGlsSGlkZGVuKCk7XG4gICAgICAgIGV4cGVjdChEaWFsb2dBdG9tLmlzUHJlc2VudCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIG5vdCBpbmNsdWRlIGEgc3RhdHVzIGljb25cIiwgKCkgPT4ge1xuICAgICAgICBzaG93TWVzc2FnZURpYWxvZygpO1xuICAgICAgICBjb25zdCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNTdGF0dXNJY29uUHJlc2VudCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGluY2x1ZGUgd2FybmluZyBpY29uIGluIHRpdGxlXCIsICgpID0+IHtcbiAgICAgICAgc2hvd1dhcm5pbmdEaWFsb2coKTtcbiAgICAgICAgY29uc3QgZGlhbG9nQXRvbSA9IERpYWxvZ0F0b20uZ2V0KCk7XG4gICAgICAgIGV4cGVjdChkaWFsb2dBdG9tLmlzU3RhdHVzSWNvblByZXNlbnQoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNXYXJuaW5nU3RhdHVzSWNvblByZXNlbnQoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNFcnJvclN0YXR1c0ljb25QcmVzZW50KCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaW5jbHVkZSBlcnJvciBpY29uIGluIHRpdGxlXCIsICgpID0+IHtcbiAgICAgICAgc2hvd0Vycm9yRGlhbG9nKCk7XG4gICAgICAgIGNvbnN0IGRpYWxvZ0F0b20gPSBEaWFsb2dBdG9tLmdldCgpO1xuICAgICAgICBleHBlY3QoZGlhbG9nQXRvbS5pc1N0YXR1c0ljb25QcmVzZW50KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChkaWFsb2dBdG9tLmlzRXJyb3JTdGF0dXNJY29uUHJlc2VudCgpKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QoZGlhbG9nQXRvbS5pc1dhcm5pbmdTdGF0dXNJY29uUHJlc2VudCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGluY2x1ZGUgQ0xPU0UgZm9vdGVyLWJ1dHRvbiBmb3Igc3RhdHVzIGRpYWxvZ3NcIiwgKCkgPT4ge1xuICAgICAgICBzaG93V2FybmluZ0RpYWxvZygpO1xuICAgICAgICBleHBlY3QoRGlhbG9nQXRvbS5pc1ByZXNlbnQoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgbGV0IGRpYWxvZ0F0b20gPSBEaWFsb2dBdG9tLmdldCgpO1xuICAgICAgICBkaWFsb2dBdG9tLmNsaWNrRm9vdGVyQnV0dG9uKFwiQ0xPU0VcIik7XG4gICAgICAgIERpYWxvZ0F0b20ud2FpdFVudGlsSGlkZGVuKCk7XG4gICAgICAgIGV4cGVjdChEaWFsb2dBdG9tLmlzUHJlc2VudCgpKS50b0JlKGZhbHNlKTtcblxuICAgICAgICBzaG93RXJyb3JEaWFsb2coKTtcbiAgICAgICAgZXhwZWN0KERpYWxvZ0F0b20uaXNQcmVzZW50KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGRpYWxvZ0F0b20gPSBEaWFsb2dBdG9tLmdldCgpO1xuICAgICAgICBkaWFsb2dBdG9tLmNsaWNrRm9vdGVyQnV0dG9uKFwiQ0xPU0VcIik7XG4gICAgICAgIERpYWxvZ0F0b20ud2FpdFVudGlsSGlkZGVuKCk7XG4gICAgICAgIGV4cGVjdChEaWFsb2dBdG9tLmlzUHJlc2VudCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGluY2x1ZGUgb3B0aW9uYWwgYWN0aW9uIGZvb3Rlci1idXR0b24gZm9yIHdhcm5pbmcgZGlhbG9nc1wiLCAoKSA9PiB7XG4gICAgICAgIHNob3dXYXJuaW5nRGlhbG9nKCk7XG4gICAgICAgIGV4cGVjdChEaWFsb2dBdG9tLmlzUHJlc2VudCgpKS50b0JlKHRydWUpO1xuICAgICAgICBsZXQgZGlhbG9nQXRvbSA9IERpYWxvZ0F0b20uZ2V0KCk7XG4gICAgICAgIGRpYWxvZ0F0b20uY2xpY2tGb290ZXJCdXR0b24oXCJQUk9DRUVEXCIpO1xuICAgICAgICBEaWFsb2dBdG9tLndhaXRVbnRpbEhpZGRlbigpO1xuICAgICAgICBleHBlY3QoRGlhbG9nQXRvbS5pc1ByZXNlbnQoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBpbmNsdWRlIFNUQVJUIGFuZCBDTE9TRSBmb290ZXItYnV0dG9ucyBmb3IgY3VzdG9tIGRpYWxvZ1wiLCAoKSA9PiB7XG4gICAgICAgIHNob3dDdXN0b21EaWFsb2coKTtcbiAgICAgICAgZXhwZWN0KERpYWxvZ0F0b20uaXNQcmVzZW50KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0VmlzaWJsZUZvb3RlckJ1dHRvbihcIlNUQVJUXCIpKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QoZGlhbG9nQXRvbS5nZXRWaXNpYmxlRm9vdGVyQnV0dG9uKFwiQ0xPU0VcIikpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBpbmNsdWRlIFNUQVJUIGFuZCBDTE9TRSBmb290ZXItYnV0dG9ucyBmb3IgY3VzdG9tIGRpYWxvZ1wiLCAoKSA9PiB7XG4gICAgICAgIHNob3dDdXN0b21EaWFsb2coKTtcbiAgICAgICAgZXhwZWN0KERpYWxvZ0F0b20uaXNQcmVzZW50KCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0VmlzaWJsZUZvb3RlckJ1dHRvbihcIlNUQVJUXCIpKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QoZGlhbG9nQXRvbS5nZXRWaXNpYmxlRm9vdGVyQnV0dG9uKFwiQ0xPU0VcIikpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBkaXNhYmxlIGZvb3RlciBidXR0b25zIHdoaWxlIGJ1c3lcIiwgKCkgPT4ge1xuICAgICAgICBzaG93Q3VzdG9tRGlhbG9nKCk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNCdXN5T3ZlcmxheURpc3BsYXllZCgpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgY29uc3Qgc3RhcnRCdXR0b24gPSBuZXcgQnV0dG9uQXRvbShkaWFsb2dBdG9tLmdldFZpc2libGVGb290ZXJCdXR0b24oXCJTVEFSVFwiKSk7XG4gICAgICAgIGV4cGVjdChzdGFydEJ1dHRvbikudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHN0YXJ0QnV0dG9uLmlzRGlzYWJsZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gbmV3IEJ1dHRvbkF0b20oZGlhbG9nQXRvbS5nZXRWaXNpYmxlRm9vdGVyQnV0dG9uKFwiQ0xPU0VcIikpO1xuICAgICAgICBleHBlY3QoY2xvc2VCdXR0b24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChjbG9zZUJ1dHRvbi5pc0Rpc2FibGVkKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgICBzdGFydEJ1dHRvbi5jbGljaygpO1xuICAgICAgICAvLyBhbGxvdyBkaWFsb2cgYWN0aW9uIHByb21pc2UgdG8gcmVzb2x2ZSBzbyB0aGF0IHdlIGNhblxuICAgICAgICAvLyB0ZXN0IGJ1c3kgc3RhdGUgd2hpbGUgaXQncyBhY3R1YWxseSBidXN5XG4gICAgICAgIGJyb3dzZXIuaWdub3JlU3luY2hyb25pemF0aW9uID0gdHJ1ZTtcbiAgICAgICAgYnJvd3Nlci53YWl0KCgpID0+IGRpYWxvZ0F0b20uaXNCdXN5T3ZlcmxheURpc3BsYXllZCgpKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNCdXN5T3ZlcmxheURpc3BsYXllZCgpKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3Qoc3RhcnRCdXR0b24uaXNEaXNhYmxlZCgpKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QoY2xvc2VCdXR0b24uaXNEaXNhYmxlZCgpKS50b0JlKHRydWUpO1xuICAgICAgICBkaWFsb2dBdG9tLmNhbmNlbEJ1c3koKTtcbiAgICAgICAgYnJvd3Nlci5pZ25vcmVTeW5jaHJvbml6YXRpb24gPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGNsb3NlIHRoZSBkaWFsb2cgd2hlbiBidXN5IGNhbmNlbGVkIGlzIGNsaWNrZWRcIiwgKCkgPT4ge1xuICAgICAgICBzaG93Q3VzdG9tRGlhbG9nKCk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgY29uc3Qgc3RhcnRCdXR0b24gPSBuZXcgQnV0dG9uQXRvbShkaWFsb2dBdG9tLmdldFZpc2libGVGb290ZXJCdXR0b24oXCJTVEFSVFwiKSk7XG4gICAgICAgIHN0YXJ0QnV0dG9uLmNsaWNrKCk7XG4gICAgICAgIC8vIGFsbG93IGRpYWxvZyBhY3Rpb24gcHJvbWlzZSB0byByZXNvbHZlIHNvIHRoYXQgd2UgY2FuXG4gICAgICAgIC8vIHRlc3QgYnVzeSBzdGF0ZSB3aGlsZSBpdCdzIGFjdHVhbGx5IGJ1c3lcbiAgICAgICAgYnJvd3Nlci5pZ25vcmVTeW5jaHJvbml6YXRpb24gPSB0cnVlO1xuICAgICAgICBicm93c2VyLndhaXQoKCkgPT4gZGlhbG9nQXRvbS5pc0J1c3lPdmVybGF5RGlzcGxheWVkKCkpO1xuICAgICAgICBleHBlY3QoZGlhbG9nQXRvbS5pc0J1c3lPdmVybGF5RGlzcGxheWVkKCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGRpYWxvZ0F0b20uY2FuY2VsQnVzeSgpO1xuICAgICAgICBicm93c2VyLmlnbm9yZVN5bmNocm9uaXphdGlvbiA9IGZhbHNlO1xuICAgICAgICBEaWFsb2dBdG9tLndhaXRVbnRpbEhpZGRlbigpO1xuICAgICAgICBleHBlY3QoRGlhbG9nQXRvbS5pc1ByZXNlbnQoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgbmVzdGVkIGRpYWxvZ3NcIiwgKCkgPT4ge1xuICAgICAgICBzaG93RGlhbG9nV2l0aFRlbXBsYXRlKCk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcblxuICAgICAgICBjb25zdCBsYXVuY2hCdXR0b24gPSBBdG9tLmZpbmRJbihCdXR0b25BdG9tLCBkaWFsb2dBdG9tLmdldEJvZHkoKSwgMCk7XG4gICAgICAgIGxhdW5jaEJ1dHRvbi5jbGljaygpO1xuXG4gICAgICAgIC8vc2Vjb25kIGRpYWxvZyBzaG91bGQgYmUgb3BlbiBhdCB0aGlzIHBvaW50LSB0aGUgYXRvbSBzaG91bGQgYXV0b21hdGljYWxseSByZWZvY3VzIHRvIGl0XG4gICAgICAgIGV4cGVjdChkaWFsb2dBdG9tLmlzQnVzeU92ZXJsYXlEaXNwbGF5ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgICAgIGV4cGVjdChkaWFsb2dBdG9tLmdldFZpc2libGVGb290ZXJCdXR0b24oXCJTVEFSVFwiKSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZGlhbG9nQXRvbS5jbGlja0Zvb3RlckJ1dHRvbihcIlNUQVJUXCIpO1xuICAgICAgICAvLyBhbGxvdyBkaWFsb2cgYWN0aW9uIHByb21pc2UgdG8gcmVzb2x2ZSBzbyB0aGF0IHdlIGNhblxuICAgICAgICAvLyB0ZXN0IGJ1c3kgc3RhdGUgd2hpbGUgaXQncyBhY3R1YWxseSBidXN5XG4gICAgICAgIGJyb3dzZXIuaWdub3JlU3luY2hyb25pemF0aW9uID0gdHJ1ZTtcbiAgICAgICAgYnJvd3Nlci53YWl0KCgpID0+IGRpYWxvZ0F0b20uaXNCdXN5T3ZlcmxheURpc3BsYXllZCgpKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNCdXN5T3ZlcmxheURpc3BsYXllZCgpKS50b0JlKHRydWUpO1xuICAgICAgICBkaWFsb2dBdG9tLmNhbmNlbEJ1c3koKTtcbiAgICAgICAgYnJvd3Nlci5pZ25vcmVTeW5jaHJvbml6YXRpb24gPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRyYW5zY2x1ZGUgY3VzdG9tIGRpYWxvZyB0ZW1wbGF0ZXNcIiwgKCkgPT4ge1xuICAgICAgICBzaG93RGlhbG9nV2l0aFRlbXBsYXRlKCk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0Q29udGVudChcInh1aS1kZW1vLWNvbXBvbmVudHMtZGlhbG9nXCIpLmlzRGlzcGxheWVkKCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoaWRlIHRvcCBjbG9zZSBidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICBzaG93Q3VzdG9tRGlhbG9nKCk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0SGVhZGVyQ2xvc2UoKS5pc1ByZXNlbnQoKSkudG9CZUZhbHN5KCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBzaG93IHRvcCBjbG9zZSBidXR0b25cIiwgKCkgPT4ge1xuICAgICAgICBzaG93RGlhbG9nV2l0aFRlbXBsYXRlKCk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0SGVhZGVyQ2xvc2UoKS5pc1ByZXNlbnQoKSkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgc2hvdyBkaWFsb2cgd2l0aCB0ZXh0IG1lc3NhZ2UgaW5zdGVhZCBvZiBidXR0b25zXCIsICgpID0+IHtcbiAgICAgICAgc2hvd0N1c3RvbUZvb3RlckRpYWxvZygpO1xuICAgICAgICBsZXQgZGlhbG9nQXRvbSA9IERpYWxvZ0F0b20uZ2V0KCk7XG4gICAgICAgIGV4cGVjdChkaWFsb2dBdG9tLmdldFZpc2libGVGb290ZXJCdXR0b25zKCkuY291bnQoKSkudG9CZSgwKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uZ2V0Rm9vdGVyKCkuZ2V0VGV4dCgpKS50b0NvbnRhaW4oXCJidXR0b25zXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgc2hvdyBkaWFsb2cgd2l0aCBzcGVjaWZpZWQgaWNvbnMgb24gZm9vdGVyIGJ1dHRvbnMgYW5kIGFsaWduIHRoZW0gcHJvcGVybHlcIiwgKCkgPT4ge1xuICAgICAgICBzaG93RGlhbG9nV2l0aEJ0bkljb25zKCk7XG4gICAgICAgIGxldCBkaWFsb2dBdG9tID0gRGlhbG9nQXRvbS5nZXQoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNGb290ZXJCdG5IYXNDbGFzcygwLCBcImljb24tcmlnaHRcIikpLnRvQmVUcnV0aHkoKTtcbiAgICAgICAgZXhwZWN0KGRpYWxvZ0F0b20uaXNGb290ZXJCdG5JY29uSGFzQ2xhc3MoMCwgXCJ4dWktaWNvbi1zdGF0ZV9ydW5uaW5nXCIpKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
