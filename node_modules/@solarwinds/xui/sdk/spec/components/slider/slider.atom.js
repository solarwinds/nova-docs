"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor = require("@solarwinds/uzi/protractor");
const protractor_1 = require("@solarwinds/uzi/protractor");
const uzi_1 = require("@solarwinds/uzi");
const textbox_atom_1 = require("../textbox/textbox.atom");
const _ = require("lodash");
;
class SliderAtom extends uzi_1.Atom {
    constructor(element) {
        super(element);
        // internal methods
        this.defaultOptions = {
            finishDrag: true,
            useTouch: false
        };
        protractor_1.browser.executeScript(() => {
            const clientWidth = document.documentElement.clientWidth || document.body.clientWidth;
            return clientWidth;
        }).then((clientWidth) => {
            // The real width must be decremented by 1
            // otherwise webdriver will throw exception when you try to move touch to the edge of area width
            this.adjustedClientWidth = clientWidth - 1;
        });
    }
    // public API
    // Params:
    // value - number - distance in pixels to grag
    // finish - boolean - flag, if mouse has to release grabbed element after move is done.
    //
    dragRangeLineTo(value, finish = true) {
        const sequence = protractor_1.browser.actions()
            .mouseMove(this.getRangeLine().getWebElement())
            .mouseDown();
        if (+value) {
            this.moveMouseIteratively(sequence, +value);
        }
        if (finish) {
            sequence.mouseUp();
        }
        return sequence.perform();
    }
    ;
    setSingleSliderValueByLineclick(value, min, max) {
        return this.clickSliderLineAtValue(value, min, max);
    }
    setRangeStartValueByClicking(value, min, max) {
        return this.clickSliderLineAtValue(value, min, max, true);
    }
    setRangeEndValueByClicking(value, min, max) {
        return this.clickSliderLineAtValue(value, min, max, true, true);
    }
    getValue(expectedValue) {
        let label = super.getElement().element(protractor_1.by.css(".xui-slider__lines-label.xui-slider-end-label"));
        return label.getText().then((text) => {
            return Number(text);
        });
    }
    getValueFromPosition(min, max) {
        let value;
        let lineWidth;
        let handleWidth;
        let handleX;
        let lineX;
        return this.getRangeLine().getSize().then((lineSize) => {
            lineWidth = lineSize.width;
            return this.getRangeLine().getLocation().then((lineLocation) => {
                lineX = lineLocation.x;
                return this.getValueHandle().getSize().then((buttonSize) => {
                    handleWidth = buttonSize.width;
                    return this.getValueHandle().getLocation().then((handleLocation) => {
                        handleX = handleLocation.x - lineX;
                        let percent = handleX / (lineWidth - handleWidth);
                        value = (max - min) * percent + min;
                        return Math.round(value);
                    });
                });
            });
        });
    }
    dragSingleSliderToValue(value, min, max, options) {
        let lineWidth;
        let handleWidth;
        let handleX;
        let lineX;
        return this.getRangeLine().getSize().then((lineSize) => {
            lineWidth = lineSize.width;
            return this.getRangeLine().getLocation().then((lineLocation) => {
                lineX = lineLocation.x;
                return this.getValueHandle().getSize().then((buttonSize) => {
                    handleWidth = buttonSize.width;
                    return this.getValueHandle().getLocation().then((handleLocation) => {
                        handleX = handleLocation.x;
                        let moveTo = (value - min) /
                            (max - min) *
                            (lineWidth - handleWidth);
                        let moveBy = moveTo - handleX + lineX;
                        moveBy = Math.round(moveBy);
                        return this.dragSingleSliderTo(moveBy, options);
                    });
                });
            });
        });
    }
    dragSingleSliderTo(value, options) {
        return this.dragHandleTo(this.getValueHandle().getWebElement(), value, options);
    }
    dragRangeStartTo(value, options) {
        return this.dragHandleTo(this.getRangeStartHandle().getWebElement(), value, options);
    }
    dragRangeEndTo(value, options) {
        return this.dragHandleTo(this.getRangeEndHandle().getWebElement(), value, options);
    }
    dragRangeStartToValue(value, min, max, options) {
        let lineWidth;
        let handleWidth;
        let handleX;
        let lineX;
        return this.getRangeLine().getSize().then((lineSize) => {
            lineWidth = lineSize.width;
            return this.getRangeLine().getLocation().then((lineLocation) => {
                lineX = lineLocation.x;
                return this.getRangeStartHandle().getSize().then((buttonSize) => {
                    handleWidth = buttonSize.width;
                    return this.getRangeStartHandle().getLocation().then((handleLocation) => {
                        handleX = handleLocation.x;
                        let moveTo = (value - min) /
                            (max - min) *
                            (lineWidth - 2 * handleWidth);
                        let moveBy = moveTo - handleX + lineX;
                        moveBy = Math.round(moveBy);
                        return this.dragRangeStartTo(moveBy, options);
                    });
                });
            });
        });
    }
    dragRangeEndToValue(value, min, max, options) {
        let lineWidth;
        let handleWidth;
        let handleX;
        let lineX;
        return this.getRangeLine().getSize().then((lineSize) => {
            lineWidth = lineSize.width;
            return this.getRangeLine().getLocation().then((lineLocation) => {
                lineX = lineLocation.x;
                return this.getRangeEndHandle().getSize().then((buttonSize) => {
                    handleWidth = buttonSize.width;
                    return this.getRangeEndHandle().getLocation().then((handleLocation) => {
                        handleX = handleLocation.x;
                        let moveTo = (value - min) /
                            (max - min) *
                            (lineWidth - 2 * handleWidth) +
                            handleWidth;
                        let moveBy = moveTo - handleX + lineX;
                        moveBy = Math.round(moveBy);
                        return this.dragRangeEndTo(moveBy, options);
                    });
                });
            });
        });
    }
    cancelDragging() {
        return protractor_1.browser.actions().sendKeys(protractor.Key.ESCAPE).perform();
    }
    getRange() {
        let startLabel = super.getElement().element(protractor_1.by.css(".xui-slider__lines-label.xui-slider-first-label"));
        let endLabel = super.getElement().element(protractor_1.by.css(".xui-slider__lines-label.xui-slider-end-label"));
        return startLabel.getText().then((startLabelText) => {
            return endLabel.getText().then((endLabelText) => {
                return {
                    start: Number(startLabelText),
                    end: Number(endLabelText)
                };
            });
        });
    }
    getInputValue() {
        const input = uzi_1.Atom.findIn(textbox_atom_1.TextboxAtom, this.getElement());
        return input.getText().then((value) => {
            return Number(value);
        });
    }
    setInputValue(value, expectedValue = null) {
        const expected = expectedValue || value;
        const input = uzi_1.Atom.findIn(textbox_atom_1.TextboxAtom, this.getElement());
        input.acceptText(protractor.Key.BACK_SPACE + protractor.Key.BACK_SPACE + value.toString());
        protractor_1.browser.wait(() => {
            return this.getInputValue().then((result) => {
                return result === expected;
            });
        }, 1000);
    }
    getSteps() {
        return super.getElement().all(protractor_1.by.css(".xui-slider__lines-step"));
    }
    getStartsideSteps() {
        return super.getElement().all(protractor_1.by.css(".xui-slider__lines-startside-steps .xui-slider__lines-step"));
    }
    getEndsideSteps() {
        return super.getElement().all(protractor_1.by.css(".xui-slider__lines-endside-steps .xui-slider__lines-step"));
    }
    getValueHandle() {
        return super.getElement().element(protractor_1.by.css(".xui-slider__button.xui-slider-end-button"));
    }
    getRangeStartHandle() {
        return super.getElement().element(protractor_1.by.css(".xui-slider__button.xui-slider-first-button"));
    }
    getRangeEndHandle() {
        return super.getElement().element(protractor_1.by.css(".xui-slider__button.xui-slider-end-button"));
    }
    getRangeLine() {
        return super.getElement().element(protractor_1.by.css(".xui-slider__lines"));
    }
    clickSliderLineAtValue(value, min, max, isRange = false, isRangeEnd = false, options) {
        let lineLength;
        let lineThickness;
        let lineX;
        let lineY;
        let handlerDiameter;
        let rangeLine = this.getRangeLine();
        options = _.defaults({}, options, this.defaultOptions);
        return rangeLine.getSize().then((lineSize) => {
            lineLength = lineSize.width;
            lineThickness = lineSize.height;
            return this.getRangeLine().getLocation().then((lineLocation) => {
                lineX = lineLocation.x;
                lineY = lineLocation.y;
                return this.getRangeEndHandle().getSize().then((buttonSize) => {
                    handlerDiameter = buttonSize.width;
                    const usefulLineDimension = isRange ?
                        lineLength - 2 * handlerDiameter :
                        lineLength - handlerDiameter;
                    let clickTo = (value - min) /
                        (max - min) *
                        usefulLineDimension;
                    // protractor counts the origin from the center instead of it's docs
                    clickTo -= lineLength / 2;
                    // within slider there is a radius offset for better user experience
                    clickTo += handlerDiameter / 2;
                    if (isRange && isRangeEnd) {
                        clickTo += handlerDiameter;
                    }
                    clickTo = Math.round(clickTo);
                    let promise;
                    if (options.useTouch) {
                        promise = protractor_1.browser.touchActions()
                            .tapAndHold({ x: lineX + clickTo, y: lineY })
                            .release({ x: lineX + clickTo, y: lineY })
                            .perform();
                    }
                    else {
                        promise = protractor_1.browser.actions()
                            .mouseMove(this.getRangeLine().getWebElement())
                            .mouseMove({ x: clickTo, y: 0 })
                            .click()
                            .perform();
                    }
                    return promise;
                });
            });
        });
    }
    dragHandleTo(handle, value, options) {
        options = _.defaults({}, options, this.defaultOptions);
        if (options.useTouch) {
            return handle.getLocation()
                .then((location) => {
                return handle.getSize()
                    .then((size) => {
                    return { location, size };
                });
            })
                .then(({ location, size }) => {
                location.y += size.height / 2;
                let destination = { x: location.x + value, y: location.y };
                this.makeForTouch(location);
                this.makeForTouch(destination);
                let sequence = protractor_1.browser.touchActions()
                    .tapAndHold(location)
                    .move(destination);
                if (options.finishDrag) {
                    sequence.release(destination);
                }
                return sequence.perform();
            });
        }
        else {
            let sequence = protractor_1.browser.actions()
                .mouseMove(handle)
                .mouseDown();
            if (+value) {
                this.moveMouseIteratively(sequence, +value);
            }
            if (options.finishDrag) {
                sequence.mouseUp();
            }
            return sequence.perform();
        }
    }
    // location for touch events must by rounded to int and bounded to viewport without vertical scrollbar
    // "adjustedClientWidth" fits this
    makeForTouch(location) {
        location.x = Math.min(Math.max(Math.round(location.x), 0), this.adjustedClientWidth);
        location.y = Math.max(Math.round(location.y), 0);
    }
    // Adds set of mouse iteratively moves to pass required px-distance ("value") to given sequence.
    // It splits all distance into steps to prevent moving over start/end of slider
    // without being located at it.
    //
    // More:
    // An issue it solves is when the end of move is out of item container, no move happens at all.
    moveMouseIteratively(sequence, value) {
        // These values are empiric:
        const maxAllowedStep = 10; // (pixels) max step
        const minAllowedAmountOfSteps = 10;
        const maxIterations = 400;
        let iterationInd = 0;
        let goneTrack = 0;
        // <direction (1 or -1)> * <size of step>
        // limitation of step size prevails to amount of steps
        let step = (Math.sign(value) || 1)
            * Math.round(Math.min(maxAllowedStep, Math.abs(value) / minAllowedAmountOfSteps));
        while (Math.abs(goneTrack) < Math.abs(value)
            && (maxIterations > iterationInd)) {
            // reduce step up to one-pixel
            // not to step over end of slider range
            if ((Math.abs(value) - Math.abs(goneTrack)) <= Math.abs(step)) {
                step = Math.sign(step);
            }
            iterationInd++;
            goneTrack += step;
            sequence.mouseMove({ x: step, y: 0 });
        }
    }
}
SliderAtom.CSS_CLASS = "xui-slider";
exports.SliderAtom = SliderAtom;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVyL3NsaWRlci5hdG9tLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEseURBQXlEO0FBQ3pELDJEQUFtRztBQUVuRyx5Q0FBcUM7QUFDckMsMERBQW9EO0FBQ3BELDRCQUE0QjtBQVUzQixDQUFDO0FBRUYsZ0JBQXdCLFNBQVEsVUFBSTtJQU1oQyxZQUFZLE9BQXNCO1FBQzlCLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQWlObkIsbUJBQW1CO1FBRVgsbUJBQWMsR0FBdUI7WUFDekMsVUFBVSxFQUFFLElBQUk7WUFDaEIsUUFBUSxFQUFFLEtBQUs7U0FDbEIsQ0FBQztRQXJORSxvQkFBTyxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUU7WUFDdkIsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGVBQWUsQ0FBQyxXQUFXLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7WUFDdEYsTUFBTSxDQUFDLFdBQVcsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxXQUFtQixFQUFFLEVBQUU7WUFDNUIsMENBQTBDO1lBQzFDLGdHQUFnRztZQUNoRyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsV0FBVyxHQUFHLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxhQUFhO0lBRWIsVUFBVTtJQUNWLDhDQUE4QztJQUM5Qyx1RkFBdUY7SUFDdkYsRUFBRTtJQUNLLGVBQWUsQ0FBQyxLQUFhLEVBQUUsU0FBa0IsSUFBSTtRQUN4RCxNQUFNLFFBQVEsR0FDVixvQkFBTyxDQUFDLE9BQU8sRUFBRTthQUNoQixTQUFTLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO2FBQzlDLFNBQVMsRUFBRSxDQUFDO1FBRWpCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNULElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxR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LENBQUM7Z0JBQzVELElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNCLENBQUM7WUFFRCxZQUFZLEVBQUUsQ0FBQztZQUNmLFNBQVMsSUFBSSxJQUFJLENBQUM7WUFFbEIsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDeEMsQ0FBQztJQUNMLENBQUM7O0FBOVhhLG9CQUFTLEdBQUcsWUFBWSxDQUFDO0FBRjNDLGdDQWlZQyIsImZpbGUiOiJjb21wb25lbnRzL3NsaWRlci9zbGlkZXIuYXRvbS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHByb3RyYWN0b3IgZnJvbSBcIkBzb2xhcndpbmRzL3V6aS9wcm90cmFjdG9yXCI7XG5pbXBvcnQge2Jyb3dzZXIsIGJ5LCBFbGVtZW50QXJyYXlGaW5kZXIsIEVsZW1lbnRGaW5kZXIsIHByb21pc2V9IGZyb20gXCJAc29sYXJ3aW5kcy91emkvcHJvdHJhY3RvclwiO1xuaW1wb3J0ICogYXMgd2ViZHJpdmVyIGZyb20gXCJAc29sYXJ3aW5kcy91emkvd2ViZHJpdmVyXCI7XG5pbXBvcnQge0F0b219IGZyb20gXCJAc29sYXJ3aW5kcy91emlcIjtcbmltcG9ydCB7VGV4dGJveEF0b219IGZyb20gXCIuLi90ZXh0Ym94L3RleHRib3guYXRvbVwiO1xuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJhbmdlUmVzdWx0IHtcbiAgICBzdGFydDogbnVtYmVyO1xuICAgIGVuZDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElTbGlkZXJBdG9tT3B0aW9ucyB7XG4gICAgZmluaXNoRHJhZz86IGJvb2xlYW47XG4gICAgdXNlVG91Y2g/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IGNsYXNzIFNsaWRlckF0b20gZXh0ZW5kcyBBdG9tIHtcblxuICAgIHB1YmxpYyBzdGF0aWMgQ1NTX0NMQVNTID0gXCJ4dWktc2xpZGVyXCI7XG5cbiAgICBwcml2YXRlIGFkanVzdGVkQ2xpZW50V2lkdGg6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEVsZW1lbnRGaW5kZXIpIHtcbiAgICAgICAgc3VwZXIoZWxlbWVudCk7XG4gICAgICAgIGJyb3dzZXIuZXhlY3V0ZVNjcmlwdCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnRXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoO1xuICAgICAgICAgICAgcmV0dXJuIGNsaWVudFdpZHRoO1xuICAgICAgICB9KS50aGVuKChjbGllbnRXaWR0aDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAvLyBUaGUgcmVhbCB3aWR0aCBtdXN0IGJlIGRlY3JlbWVudGVkIGJ5IDFcbiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZWJkcml2ZXIgd2lsbCB0aHJvdyBleGNlcHRpb24gd2hlbiB5b3UgdHJ5IHRvIG1vdmUgdG91Y2ggdG8gdGhlIGVkZ2Ugb2YgYXJlYSB3aWR0aFxuICAgICAgICAgICAgdGhpcy5hZGp1c3RlZENsaWVudFdpZHRoID0gY2xpZW50V2lkdGggLSAxO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBwdWJsaWMgQVBJXG5cbiAgICAvLyBQYXJhbXM6XG4gICAgLy8gdmFsdWUgLSBudW1iZXIgLSBkaXN0YW5jZSBpbiBwaXhlbHMgdG8gZ3JhZ1xuICAgIC8vIGZpbmlzaCAtIGJvb2xlYW4gLSBmbGFnLCBpZiBtb3VzZSBoYXMgdG8gcmVsZWFzZSBncmFiYmVkIGVsZW1lbnQgYWZ0ZXIgbW92ZSBpcyBkb25lLlxuICAgIC8vXG4gICAgcHVibGljIGRyYWdSYW5nZUxpbmVUbyh2YWx1ZTogbnVtYmVyLCBmaW5pc2g6IGJvb2xlYW4gPSB0cnVlKTogcHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3Qgc2VxdWVuY2U6IHdlYmRyaXZlci5BY3Rpb25TZXF1ZW5jZSA9XG4gICAgICAgICAgICBicm93c2VyLmFjdGlvbnMoKVxuICAgICAgICAgICAgLm1vdXNlTW92ZSh0aGlzLmdldFJhbmdlTGluZSgpLmdldFdlYkVsZW1lbnQoKSlcbiAgICAgICAgICAgIC5tb3VzZURvd24oKTtcblxuICAgICAgICBpZiAoK3ZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLm1vdmVNb3VzZUl0ZXJhdGl2ZWx5KHNlcXVlbmNlLCArdmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZpbmlzaCkge1xuICAgICAgICAgICAgc2VxdWVuY2UubW91c2VVcCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZXF1ZW5jZS5wZXJmb3JtKCk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBzZXRTaW5nbGVTbGlkZXJWYWx1ZUJ5TGluZWNsaWNrKHZhbHVlOiBudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6cHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xpY2tTbGlkZXJMaW5lQXRWYWx1ZSh2YWx1ZSwgbWluLCBtYXgpO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0UmFuZ2VTdGFydFZhbHVlQnlDbGlja2luZyh2YWx1ZTogbnVtYmVyLCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOnByb21pc2UuUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsaWNrU2xpZGVyTGluZUF0VmFsdWUodmFsdWUsIG1pbiwgbWF4LCB0cnVlKTtcbiAgICB9XG4gICAgcHVibGljIHNldFJhbmdlRW5kVmFsdWVCeUNsaWNraW5nKHZhbHVlOiBudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6cHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xpY2tTbGlkZXJMaW5lQXRWYWx1ZSh2YWx1ZSwgbWluLCBtYXgsIHRydWUsIHRydWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRWYWx1ZShleHBlY3RlZFZhbHVlPzogbnVtYmVyKTogcHJvbWlzZS5Qcm9taXNlPG51bWJlcj4ge1xuICAgICAgICBsZXQgbGFiZWwgPSBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jc3MoXCIueHVpLXNsaWRlcl9fbGluZXMtbGFiZWwueHVpLXNsaWRlci1lbmQtbGFiZWxcIikpO1xuICAgICAgICByZXR1cm4gbGFiZWwuZ2V0VGV4dCgpLnRoZW4oKHRleHQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBOdW1iZXIodGV4dCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwdWJsaWMgIGdldFZhbHVlRnJvbVBvc2l0aW9uKG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IHByb21pc2UuUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgbGV0IHZhbHVlOiBudW1iZXI7XG4gICAgICAgIGxldCBsaW5lV2lkdGg6IG51bWJlcjtcbiAgICAgICAgbGV0IGhhbmRsZVdpZHRoOiBudW1iZXI7XG4gICAgICAgIGxldCBoYW5kbGVYOiBudW1iZXI7XG4gICAgICAgIGxldCBsaW5lWDogbnVtYmVyO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5nZUxpbmUoKS5nZXRTaXplKCkudGhlbigobGluZVNpemUpID0+IHtcbiAgICAgICAgICAgIGxpbmVXaWR0aCA9IGxpbmVTaXplLndpZHRoO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmFuZ2VMaW5lKCkuZ2V0TG9jYXRpb24oKS50aGVuKChsaW5lTG9jYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICBsaW5lWCA9IGxpbmVMb2NhdGlvbi54O1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlSGFuZGxlKCkuZ2V0U2l6ZSgpLnRoZW4oKGJ1dHRvblNpemUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlV2lkdGggPSBidXR0b25TaXplLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZUhhbmRsZSgpLmdldExvY2F0aW9uKCkudGhlbigoaGFuZGxlTG9jYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVggPSBoYW5kbGVMb2NhdGlvbi54IC0gbGluZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGVyY2VudDogbnVtYmVyID0gaGFuZGxlWCAvIChsaW5lV2lkdGggLSBoYW5kbGVXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IChtYXggLSBtaW4pICogcGVyY2VudCArIG1pbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBkcmFnU2luZ2xlU2xpZGVyVG9WYWx1ZSh2YWx1ZTpudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciwgb3B0aW9ucz86IElTbGlkZXJBdG9tT3B0aW9ucyk6XG4gICAgICAgICAgICBwcm9taXNlLlByb21pc2U8dm9pZD4ge1xuICAgICAgICBsZXQgbGluZVdpZHRoOiBudW1iZXI7XG4gICAgICAgIGxldCBoYW5kbGVXaWR0aDogbnVtYmVyO1xuICAgICAgICBsZXQgaGFuZGxlWDogbnVtYmVyO1xuICAgICAgICBsZXQgbGluZVg6IG51bWJlcjtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmFuZ2VMaW5lKCkuZ2V0U2l6ZSgpLnRoZW4oKGxpbmVTaXplKSA9PiB7XG4gICAgICAgICAgICBsaW5lV2lkdGggPSBsaW5lU2l6ZS53aWR0aDtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFJhbmdlTGluZSgpLmdldExvY2F0aW9uKCkudGhlbigobGluZUxvY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgbGluZVggPSBsaW5lTG9jYXRpb24ueDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZUhhbmRsZSgpLmdldFNpemUoKS50aGVuKChidXR0b25TaXplKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZVdpZHRoID0gYnV0dG9uU2l6ZS53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWVIYW5kbGUoKS5nZXRMb2NhdGlvbigpLnRoZW4oKGhhbmRsZUxvY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVYID0gaGFuZGxlTG9jYXRpb24ueDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtb3ZlVG86IG51bWJlciA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHZhbHVlIC0gbWluKSAvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1heCAtIG1pbikgKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsaW5lV2lkdGggLSBoYW5kbGVXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbW92ZUJ5ID0gbW92ZVRvIC0gaGFuZGxlWCArIGxpbmVYO1xuICAgICAgICAgICAgICAgICAgICAgICAgbW92ZUJ5ID0gTWF0aC5yb3VuZChtb3ZlQnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZHJhZ1NpbmdsZVNsaWRlclRvKG1vdmVCeSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBkcmFnU2luZ2xlU2xpZGVyVG8odmFsdWU6bnVtYmVyLCBvcHRpb25zPzogSVNsaWRlckF0b21PcHRpb25zKTpwcm9taXNlLlByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kcmFnSGFuZGxlVG8odGhpcy5nZXRWYWx1ZUhhbmRsZSgpLmdldFdlYkVsZW1lbnQoKSwgdmFsdWUsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBkcmFnUmFuZ2VTdGFydFRvKHZhbHVlOm51bWJlciwgb3B0aW9ucz86IElTbGlkZXJBdG9tT3B0aW9ucyk6cHJvbWlzZS5Qcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZHJhZ0hhbmRsZVRvKHRoaXMuZ2V0UmFuZ2VTdGFydEhhbmRsZSgpLmdldFdlYkVsZW1lbnQoKSwgdmFsdWUsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBkcmFnUmFuZ2VFbmRUbyh2YWx1ZTpudW1iZXIsIG9wdGlvbnM/OiBJU2xpZGVyQXRvbU9wdGlvbnMpOnByb21pc2UuUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRyYWdIYW5kbGVUbyh0aGlzLmdldFJhbmdlRW5kSGFuZGxlKCkuZ2V0V2ViRWxlbWVudCgpLCB2YWx1ZSwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgcHVibGljIGRyYWdSYW5nZVN0YXJ0VG9WYWx1ZSh2YWx1ZTpudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciwgb3B0aW9ucz86IElTbGlkZXJBdG9tT3B0aW9ucyk6XG4gICAgICAgICAgICBwcm9taXNlLlByb21pc2U8dm9pZD4ge1xuICAgICAgICBsZXQgbGluZVdpZHRoOiBudW1iZXI7XG4gICAgICAgIGxldCBoYW5kbGVXaWR0aDogbnVtYmVyO1xuICAgICAgICBsZXQgaGFuZGxlWDogbnVtYmVyO1xuICAgICAgICBsZXQgbGluZVg6IG51bWJlcjtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmFuZ2VMaW5lKCkuZ2V0U2l6ZSgpLnRoZW4oKGxpbmVTaXplKSA9PiB7XG4gICAgICAgICAgICBsaW5lV2lkdGggPSBsaW5lU2l6ZS53aWR0aDtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFJhbmdlTGluZSgpLmdldExvY2F0aW9uKCkudGhlbigobGluZUxvY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgbGluZVggPSBsaW5lTG9jYXRpb24ueDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5nZVN0YXJ0SGFuZGxlKCkuZ2V0U2l6ZSgpLnRoZW4oKGJ1dHRvblNpemUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlV2lkdGggPSBidXR0b25TaXplLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5nZVN0YXJ0SGFuZGxlKCkuZ2V0TG9jYXRpb24oKS50aGVuKChoYW5kbGVMb2NhdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlWCA9IGhhbmRsZUxvY2F0aW9uLng7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbW92ZVRvOiBudW1iZXIgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh2YWx1ZSAtIG1pbikgL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtYXggLSBtaW4pICpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobGluZVdpZHRoIC0gMiAqIGhhbmRsZVdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtb3ZlQnkgPSBtb3ZlVG8gLSBoYW5kbGVYICsgbGluZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb3ZlQnkgPSBNYXRoLnJvdW5kKG1vdmVCeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kcmFnUmFuZ2VTdGFydFRvKG1vdmVCeSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBkcmFnUmFuZ2VFbmRUb1ZhbHVlKHZhbHVlOm51bWJlciwgbWluOiBudW1iZXIsIG1heDogbnVtYmVyLCBvcHRpb25zPzogSVNsaWRlckF0b21PcHRpb25zKTpcbiAgICAgICAgICAgIHByb21pc2UuUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGxldCBsaW5lV2lkdGg6IG51bWJlcjtcbiAgICAgICAgbGV0IGhhbmRsZVdpZHRoOiBudW1iZXI7XG4gICAgICAgIGxldCBoYW5kbGVYOiBudW1iZXI7XG4gICAgICAgIGxldCBsaW5lWDogbnVtYmVyO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5nZUxpbmUoKS5nZXRTaXplKCkudGhlbigobGluZVNpemUpID0+IHtcbiAgICAgICAgICAgIGxpbmVXaWR0aCA9IGxpbmVTaXplLndpZHRoO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmFuZ2VMaW5lKCkuZ2V0TG9jYXRpb24oKS50aGVuKChsaW5lTG9jYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICBsaW5lWCA9IGxpbmVMb2NhdGlvbi54O1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFJhbmdlRW5kSGFuZGxlKCkuZ2V0U2l6ZSgpLnRoZW4oKGJ1dHRvblNpemUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlV2lkdGggPSBidXR0b25TaXplLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5nZUVuZEhhbmRsZSgpLmdldExvY2F0aW9uKCkudGhlbigoaGFuZGxlTG9jYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVggPSBoYW5kbGVMb2NhdGlvbi54O1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1vdmVUbzogbnVtYmVyID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodmFsdWUgLSBtaW4pIC9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobWF4IC0gbWluKSAqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGxpbmVXaWR0aCAtIDIgKiBoYW5kbGVXaWR0aCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVdpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1vdmVCeSA9IG1vdmVUbyAtIGhhbmRsZVggKyBsaW5lWDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVCeSA9IE1hdGgucm91bmQobW92ZUJ5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRyYWdSYW5nZUVuZFRvKG1vdmVCeSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjYW5jZWxEcmFnZ2luZygpOiBwcm9taXNlLlByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gYnJvd3Nlci5hY3Rpb25zKCkuc2VuZEtleXMocHJvdHJhY3Rvci5LZXkuRVNDQVBFKS5wZXJmb3JtKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFJhbmdlKCk6IHByb21pc2UuUHJvbWlzZTxJUmFuZ2VSZXN1bHQ+IHtcbiAgICAgICAgbGV0IHN0YXJ0TGFiZWwgPSBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jc3MoXCIueHVpLXNsaWRlcl9fbGluZXMtbGFiZWwueHVpLXNsaWRlci1maXJzdC1sYWJlbFwiKSk7XG4gICAgICAgIGxldCBlbmRMYWJlbCA9IHN1cGVyLmdldEVsZW1lbnQoKS5lbGVtZW50KGJ5LmNzcyhcIi54dWktc2xpZGVyX19saW5lcy1sYWJlbC54dWktc2xpZGVyLWVuZC1sYWJlbFwiKSk7XG4gICAgICAgIHJldHVybiBzdGFydExhYmVsLmdldFRleHQoKS50aGVuKChzdGFydExhYmVsVGV4dCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGVuZExhYmVsLmdldFRleHQoKS50aGVuKChlbmRMYWJlbFRleHQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBzdGFydDogTnVtYmVyKHN0YXJ0TGFiZWxUZXh0KSxcbiAgICAgICAgICAgICAgICAgICAgZW5kOiBOdW1iZXIoZW5kTGFiZWxUZXh0KVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldElucHV0VmFsdWUoKTogcHJvbWlzZS5Qcm9taXNlPG51bWJlcj4ge1xuICAgICAgICBjb25zdCBpbnB1dDogVGV4dGJveEF0b20gPSBBdG9tLmZpbmRJbihUZXh0Ym94QXRvbSwgdGhpcy5nZXRFbGVtZW50KCkpO1xuICAgICAgICByZXR1cm4gaW5wdXQuZ2V0VGV4dCgpLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1YmxpYyBzZXRJbnB1dFZhbHVlKHZhbHVlOiBhbnksIGV4cGVjdGVkVmFsdWU6IGFueSA9IG51bGwpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSBleHBlY3RlZFZhbHVlIHx8IHZhbHVlO1xuICAgICAgICBjb25zdCBpbnB1dDogVGV4dGJveEF0b20gPSBBdG9tLmZpbmRJbihUZXh0Ym94QXRvbSwgdGhpcy5nZXRFbGVtZW50KCkpO1xuICAgICAgICBpbnB1dC5hY2NlcHRUZXh0KHByb3RyYWN0b3IuS2V5LkJBQ0tfU1BBQ0UgKyBwcm90cmFjdG9yLktleS5CQUNLX1NQQUNFICsgdmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgIGJyb3dzZXIud2FpdCgoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnB1dFZhbHVlKCkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gZXhwZWN0ZWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFN0ZXBzKCk6IEVsZW1lbnRBcnJheUZpbmRlciB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRFbGVtZW50KCkuYWxsKGJ5LmNzcyhcIi54dWktc2xpZGVyX19saW5lcy1zdGVwXCIpKTtcbiAgICB9XG4gICAgcHVibGljIGdldFN0YXJ0c2lkZVN0ZXBzKCk6IEVsZW1lbnRBcnJheUZpbmRlciB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRFbGVtZW50KCkuYWxsKGJ5LmNzcyhcIi54dWktc2xpZGVyX19saW5lcy1zdGFydHNpZGUtc3RlcHMgLnh1aS1zbGlkZXJfX2xpbmVzLXN0ZXBcIikpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0RW5kc2lkZVN0ZXBzKCk6IEVsZW1lbnRBcnJheUZpbmRlciB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRFbGVtZW50KCkuYWxsKGJ5LmNzcyhcIi54dWktc2xpZGVyX19saW5lcy1lbmRzaWRlLXN0ZXBzIC54dWktc2xpZGVyX19saW5lcy1zdGVwXCIpKTtcbiAgICB9XG5cbiAgICAvLyBpbnRlcm5hbCBtZXRob2RzXG5cbiAgICBwcml2YXRlIGRlZmF1bHRPcHRpb25zOiBJU2xpZGVyQXRvbU9wdGlvbnMgPSB7XG4gICAgICAgIGZpbmlzaERyYWc6IHRydWUsXG4gICAgICAgIHVzZVRvdWNoOiBmYWxzZVxuICAgIH07XG5cbiAgICBwcml2YXRlIGdldFZhbHVlSGFuZGxlKCk6IEVsZW1lbnRGaW5kZXIge1xuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0RWxlbWVudCgpLmVsZW1lbnQoYnkuY3NzKFwiLnh1aS1zbGlkZXJfX2J1dHRvbi54dWktc2xpZGVyLWVuZC1idXR0b25cIikpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmFuZ2VTdGFydEhhbmRsZSgpOiBFbGVtZW50RmluZGVyIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmdldEVsZW1lbnQoKS5lbGVtZW50KGJ5LmNzcyhcIi54dWktc2xpZGVyX19idXR0b24ueHVpLXNsaWRlci1maXJzdC1idXR0b25cIikpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmFuZ2VFbmRIYW5kbGUoKTogRWxlbWVudEZpbmRlciB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jc3MoXCIueHVpLXNsaWRlcl9fYnV0dG9uLnh1aS1zbGlkZXItZW5kLWJ1dHRvblwiKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRSYW5nZUxpbmUoKTogRWxlbWVudEZpbmRlciB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRFbGVtZW50KCkuZWxlbWVudChieS5jc3MoXCIueHVpLXNsaWRlcl9fbGluZXNcIikpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2xpY2tTbGlkZXJMaW5lQXRWYWx1ZSh2YWx1ZTpudW1iZXIsIG1pbjpudW1iZXIsIG1heDpudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUmFuZ2U6Ym9vbGVhbiA9IGZhbHNlLCBpc1JhbmdlRW5kOiBib29sZWFuID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM/OiBJU2xpZGVyQXRvbU9wdGlvbnMpOnByb21pc2UuUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGxldCBsaW5lTGVuZ3RoOiBudW1iZXI7XG4gICAgICAgIGxldCBsaW5lVGhpY2tuZXNzOiBudW1iZXI7XG4gICAgICAgIGxldCBsaW5lWDogbnVtYmVyO1xuICAgICAgICBsZXQgbGluZVk6IG51bWJlcjtcbiAgICAgICAgbGV0IGhhbmRsZXJEaWFtZXRlcjogbnVtYmVyO1xuICAgICAgICBsZXQgcmFuZ2VMaW5lID0gdGhpcy5nZXRSYW5nZUxpbmUoKTtcblxuICAgICAgICBvcHRpb25zID0gXy5kZWZhdWx0cyh7fSwgb3B0aW9ucywgdGhpcy5kZWZhdWx0T3B0aW9ucyk7XG5cbiAgICAgICAgcmV0dXJuIHJhbmdlTGluZS5nZXRTaXplKCkudGhlbigobGluZVNpemUpID0+IHtcbiAgICAgICAgICAgIGxpbmVMZW5ndGggPSBsaW5lU2l6ZS53aWR0aDtcbiAgICAgICAgICAgIGxpbmVUaGlja25lc3MgPSBsaW5lU2l6ZS5oZWlnaHQ7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5nZUxpbmUoKS5nZXRMb2NhdGlvbigpLnRoZW4oKGxpbmVMb2NhdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIGxpbmVYID0gbGluZUxvY2F0aW9uLng7XG4gICAgICAgICAgICAgICAgbGluZVkgPSBsaW5lTG9jYXRpb24ueTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSYW5nZUVuZEhhbmRsZSgpLmdldFNpemUoKS50aGVuKChidXR0b25TaXplKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXJEaWFtZXRlciA9IGJ1dHRvblNpemUud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZWZ1bExpbmVEaW1lbnNpb246IG51bWJlciA9IGlzUmFuZ2UgP1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZUxlbmd0aCAtIDIgKiBoYW5kbGVyRGlhbWV0ZXIgOlxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZUxlbmd0aCAtIGhhbmRsZXJEaWFtZXRlcjtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNsaWNrVG86IG51bWJlciA9XG4gICAgICAgICAgICAgICAgICAgICAgICAodmFsdWUgLSBtaW4pIC9cbiAgICAgICAgICAgICAgICAgICAgICAgIChtYXggLSBtaW4pICpcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZWZ1bExpbmVEaW1lbnNpb247XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcHJvdHJhY3RvciBjb3VudHMgdGhlIG9yaWdpbiBmcm9tIHRoZSBjZW50ZXIgaW5zdGVhZCBvZiBpdCdzIGRvY3NcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tUbyAtPSBsaW5lTGVuZ3RoIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgLy8gd2l0aGluIHNsaWRlciB0aGVyZSBpcyBhIHJhZGl1cyBvZmZzZXQgZm9yIGJldHRlciB1c2VyIGV4cGVyaWVuY2VcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tUbyArPSBoYW5kbGVyRGlhbWV0ZXIgLyAyO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSYW5nZSAmJiBpc1JhbmdlRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja1RvICs9IGhhbmRsZXJEaWFtZXRlcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrVG8gPSBNYXRoLnJvdW5kKGNsaWNrVG8pO1xuXG4gICAgICAgICAgICAgICAgICAgIGxldCBwcm9taXNlOiBwcm9taXNlLlByb21pc2U8dm9pZD47XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMudXNlVG91Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBicm93c2VyLnRvdWNoQWN0aW9ucygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRhcEFuZEhvbGQoe3g6IGxpbmVYICsgY2xpY2tUbywgeTogbGluZVl9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZWxlYXNlKHt4OiBsaW5lWCArIGNsaWNrVG8sIHk6IGxpbmVZfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGVyZm9ybSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IGJyb3dzZXIuYWN0aW9ucygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1vdXNlTW92ZSh0aGlzLmdldFJhbmdlTGluZSgpLmdldFdlYkVsZW1lbnQoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubW91c2VNb3ZlKHt4OiBjbGlja1RvLCB5OiAwfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2xpY2soKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wZXJmb3JtKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRyYWdIYW5kbGVUbyhoYW5kbGU6IHByb3RyYWN0b3IuV2ViRWxlbWVudCwgdmFsdWU6bnVtYmVyLCBvcHRpb25zPzogSVNsaWRlckF0b21PcHRpb25zKTpcbiAgICAgICAgICAgIHByb21pc2UuUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIG9wdGlvbnMgPSBfLmRlZmF1bHRzKHt9LCBvcHRpb25zLCB0aGlzLmRlZmF1bHRPcHRpb25zKTtcblxuICAgICAgICBpZiAob3B0aW9ucy51c2VUb3VjaCkge1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZS5nZXRMb2NhdGlvbigpXG4gICAgICAgICAgICAgICAgLnRoZW4oKGxvY2F0aW9uOiB3ZWJkcml2ZXIuSUxvY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUuZ2V0U2l6ZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoc2l6ZTogd2ViZHJpdmVyLklTaXplKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtsb2NhdGlvbiwgc2l6ZX07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKCh7bG9jYXRpb24sIHNpemV9OiB7IGxvY2F0aW9uOiB3ZWJkcml2ZXIuSUxvY2F0aW9uLCBzaXplOiB3ZWJkcml2ZXIuSVNpemUgfSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi55ICs9IHNpemUuaGVpZ2h0IC8gMjtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRlc3RpbmF0aW9uID0ge3g6IGxvY2F0aW9uLnggKyB2YWx1ZSwgeTogbG9jYXRpb24ueX07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFrZUZvclRvdWNoKGxvY2F0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlRm9yVG91Y2goZGVzdGluYXRpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIGxldCBzZXF1ZW5jZSA9IGJyb3dzZXIudG91Y2hBY3Rpb25zKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50YXBBbmRIb2xkKGxvY2F0aW9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1vdmUoZGVzdGluYXRpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmZpbmlzaERyYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlLnJlbGVhc2UoZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlcXVlbmNlLnBlcmZvcm0oKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IHNlcXVlbmNlID0gYnJvd3Nlci5hY3Rpb25zKClcbiAgICAgICAgICAgICAgICAubW91c2VNb3ZlKGhhbmRsZSlcbiAgICAgICAgICAgICAgICAubW91c2VEb3duKCk7XG5cbiAgICAgICAgICAgIGlmICgrdmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmVNb3VzZUl0ZXJhdGl2ZWx5KHNlcXVlbmNlLCArdmFsdWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5maW5pc2hEcmFnKSB7XG4gICAgICAgICAgICAgICAgc2VxdWVuY2UubW91c2VVcCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2VxdWVuY2UucGVyZm9ybSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gbG9jYXRpb24gZm9yIHRvdWNoIGV2ZW50cyBtdXN0IGJ5IHJvdW5kZWQgdG8gaW50IGFuZCBib3VuZGVkIHRvIHZpZXdwb3J0IHdpdGhvdXQgdmVydGljYWwgc2Nyb2xsYmFyXG4gICAgLy8gXCJhZGp1c3RlZENsaWVudFdpZHRoXCIgZml0cyB0aGlzXG4gICAgcHJpdmF0ZSBtYWtlRm9yVG91Y2gobG9jYXRpb246IHdlYmRyaXZlci5JTG9jYXRpb24pOiB2b2lkIHtcbiAgICAgICAgbG9jYXRpb24ueCA9IE1hdGgubWluKE1hdGgubWF4KE1hdGgucm91bmQobG9jYXRpb24ueCksIDApLCB0aGlzLmFkanVzdGVkQ2xpZW50V2lkdGgpO1xuICAgICAgICBsb2NhdGlvbi55ID0gTWF0aC5tYXgoTWF0aC5yb3VuZChsb2NhdGlvbi55KSwgMCk7XG4gICAgfVxuXG4gICAgLy8gQWRkcyBzZXQgb2YgbW91c2UgaXRlcmF0aXZlbHkgbW92ZXMgdG8gcGFzcyByZXF1aXJlZCBweC1kaXN0YW5jZSAoXCJ2YWx1ZVwiKSB0byBnaXZlbiBzZXF1ZW5jZS5cbiAgICAvLyBJdCBzcGxpdHMgYWxsIGRpc3RhbmNlIGludG8gc3RlcHMgdG8gcHJldmVudCBtb3Zpbmcgb3ZlciBzdGFydC9lbmQgb2Ygc2xpZGVyXG4gICAgLy8gd2l0aG91dCBiZWluZyBsb2NhdGVkIGF0IGl0LlxuICAgIC8vXG4gICAgLy8gTW9yZTpcbiAgICAvLyBBbiBpc3N1ZSBpdCBzb2x2ZXMgaXMgd2hlbiB0aGUgZW5kIG9mIG1vdmUgaXMgb3V0IG9mIGl0ZW0gY29udGFpbmVyLCBubyBtb3ZlIGhhcHBlbnMgYXQgYWxsLlxuICAgIHByaXZhdGUgbW92ZU1vdXNlSXRlcmF0aXZlbHkoc2VxdWVuY2U6IHdlYmRyaXZlci5BY3Rpb25TZXF1ZW5jZSwgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICAvLyBUaGVzZSB2YWx1ZXMgYXJlIGVtcGlyaWM6XG4gICAgICAgIGNvbnN0IG1heEFsbG93ZWRTdGVwID0gMTA7IC8vIChwaXhlbHMpIG1heCBzdGVwXG4gICAgICAgIGNvbnN0IG1pbkFsbG93ZWRBbW91bnRPZlN0ZXBzID0gMTA7XG4gICAgICAgIGNvbnN0IG1heEl0ZXJhdGlvbnMgPSA0MDA7XG5cbiAgICAgICAgbGV0IGl0ZXJhdGlvbkluZCA9IDA7XG4gICAgICAgIGxldCBnb25lVHJhY2sgPSAwO1xuICAgICAgICAvLyA8ZGlyZWN0aW9uICgxIG9yIC0xKT4gKiA8c2l6ZSBvZiBzdGVwPlxuICAgICAgICAvLyBsaW1pdGF0aW9uIG9mIHN0ZXAgc2l6ZSBwcmV2YWlscyB0byBhbW91bnQgb2Ygc3RlcHNcbiAgICAgICAgbGV0IHN0ZXAgPSAoTWF0aC5zaWduKHZhbHVlKSB8fCAxKVxuICAgICAgICAgICAgKiBNYXRoLnJvdW5kKE1hdGgubWluKG1heEFsbG93ZWRTdGVwLCBNYXRoLmFicyh2YWx1ZSkgLyBtaW5BbGxvd2VkQW1vdW50T2ZTdGVwcykpO1xuXG4gICAgICAgIHdoaWxlIChNYXRoLmFicyhnb25lVHJhY2spIDwgTWF0aC5hYnModmFsdWUpXG4gICAgICAgICAgICAmJiAobWF4SXRlcmF0aW9ucyA+IGl0ZXJhdGlvbkluZCkpIHtcblxuICAgICAgICAgICAgLy8gcmVkdWNlIHN0ZXAgdXAgdG8gb25lLXBpeGVsXG4gICAgICAgICAgICAvLyBub3QgdG8gc3RlcCBvdmVyIGVuZCBvZiBzbGlkZXIgcmFuZ2VcbiAgICAgICAgICAgIGlmICgoTWF0aC5hYnModmFsdWUpIC0gTWF0aC5hYnMoZ29uZVRyYWNrKSkgPD0gTWF0aC5hYnMoc3RlcCkpIHtcbiAgICAgICAgICAgICAgICBzdGVwID0gTWF0aC5zaWduKHN0ZXApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpdGVyYXRpb25JbmQrKztcbiAgICAgICAgICAgIGdvbmVUcmFjayArPSBzdGVwO1xuXG4gICAgICAgICAgICBzZXF1ZW5jZS5tb3VzZU1vdmUoe3g6IHN0ZXAsIHk6IDB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
