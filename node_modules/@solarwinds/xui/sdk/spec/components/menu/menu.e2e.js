"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protractor_1 = require("@solarwinds/uzi/protractor");
const helpers_1 = require("../helpers");
const uzi_1 = require("@solarwinds/uzi");
const index_atom_1 = require("../index.atom");
describe("USERCONTROL Menu", () => {
    let menu;
    beforeEach(() => {
        helpers_1.default.prepareBrowser("menu");
        menu = uzi_1.Atom.find(index_atom_1.MenuAtom, "menu");
    });
    it("expands closed menu when button is clicked", () => {
        // act
        menu.click();
        // assert
        expect(menu.isExpanded()).toBeTruthy();
    });
    it("closes expanded menu when button is clicked", () => {
        // arrange
        menu.expand();
        // act
        menu.click();
        // assert
        expect(menu.isExpanded()).toBeFalsy();
    });
    it("does not expand menu when button is clicked and menu is disabled", () => {
        // arrange
        menu = uzi_1.Atom.find(index_atom_1.MenuAtom, "menuDisabled");
        // act
        menu.click().then(function () {
            return true;
        }, function () {
            return false;
        });
        // assert
        expect(menu.isExpanded()).toBe(false);
    });
    it("redirects to specified url when menu link item is clicked", () => {
        // arrange
        menu.expand();
        // act
        menu.getAnchorElemForLinkOrActionItemByTitle("Link 1").click();
        // assert
        protractor_1.browser.getLocationAbsUrl().then((url) => {
            expect(url).toContain("#link");
        });
    });
    it("does not redirect to specified url when disabled menu link item is clicked", () => {
        // arrange
        menu.expand();
        // act
        menu.getAnchorElemForLinkOrActionItemByTitle("Link 2").click();
        // assert
        protractor_1.browser.getLocationAbsUrl().then((url) => {
            expect(url).not.toContain("#disabledLink");
        });
    });
    it("does an action when menu action anchor item is clicked", () => {
        // arrange
        menu.expand();
        const actionItemAnchor = menu.getAnchorElemForLinkOrActionItemByTitle("Action 2");
        // act
        actionItemAnchor.click();
        // assert
        menu.expand();
        const actionItemAnchor2 = menu.getAnchorElemForLinkOrActionItemByTitle("Changed action 2");
        actionItemAnchor2.getText().then((text) => {
            expect(text).toEqual("Changed action 2");
        });
    });
    it("does an action when menu action item is clicked", () => {
        // arrange
        menu.expand();
        const menuItem = menu.getAnchorElemForLinkOrActionItemByTitleContainingText("Bold Action");
        // act
        menuItem.click();
        // assert
        menu.expand();
        const changedMenuItem = menu.getAnchorElemForLinkOrActionItemByTitleContainingText("Changed bold action");
        changedMenuItem.getText().then((innerHtml) => {
            expect(innerHtml).toContain("Changed bold action");
        });
    });
    it("isMenuItemEnabledByTitleContainingText should return correct value", () => {
        // arrange
        menu.expand();
        // assert
        expect(menu.isMenuItemEnabledByTitleContainingText("Action 1")).toBe(false);
        expect(menu.isMenuItemEnabledByTitleContainingText("Action 2")).toBe(true);
    });
    it("does not do any action when disabled menu action item is clicked", () => {
        // arrange
        menu.expand();
        const actionItemAnchor = menu.getAnchorElemForLinkOrActionItemByTitle("Action 1");
        // act
        actionItemAnchor.click();
        // assert
        menu.expand();
        const actionItemAnchor2 = menu.getAnchorElemForLinkOrActionItemByTitle("Action 1");
        expect(actionItemAnchor2.getText()).toEqual("Action 1");
    });
    it("ticks the checkbox when menu option item is clicked", () => {
        // arrange
        menu.expand();
        const optionItemCheckbox = menu.getCheckboxElemForOptionItemByTitle("Option 2");
        // act
        optionItemCheckbox.click();
        // assert
        expect(optionItemCheckbox.isChecked()).toEqual(true);
    });
    it("does not tick the checkbox when disabled menu option item is clicked", () => {
        // arrange
        menu.expand();
        const optionItemCheckbox = menu.getCheckboxElemForOptionItemByTitle("Option 1");
        // act
        optionItemCheckbox.click();
        // assert
        expect(optionItemCheckbox.isChecked()).toEqual(false);
    });
    it("opens downside if there is enough space to display it", () => {
        // act
        menu.expand();
        // assert
        menu.isChildElementPresent(protractor_1.by.className("dropup")).then((isPresented) => {
            expect(isPresented).toBeFalsy();
        });
    });
    it("opens upside when there is no space to display it downside", () => {
        // arrange
        menu = uzi_1.Atom.findIn(index_atom_1.MenuAtom, protractor_1.element(protractor_1.by.id("menuUpside")));
        // act
        menu.expand();
        // assert
        menu.isChildElementPresent(protractor_1.by.className("dropup")).then((isPresented) => {
            expect(isPresented).toBeTruthy();
        });
    });
    it("has the left alignment if there is enough space to display it", () => {
        menu.expand()
            .then(() => menu.isChildElementPresent(protractor_1.by.className("dropdown-menu-right")))
            .then((isPresented) => expect(isPresented).toBeFalsy());
    });
    xit("has the right alignment if there is no space to display it with the left alignment", () => {
        // arrange
        menu = uzi_1.Atom.find(index_atom_1.MenuAtom, "menuRightAlignment");
        // act
        menu.expand()
            .then(() => {
            // assert
            return menu.isChildElementPresent(protractor_1.by.className("dropdown-menu-right"));
        })
            .then((isPresented) => {
            expect(isPresented).toBeTruthy();
        });
    });
    it("has 'append to body' functionality", () => {
        menu = uzi_1.Atom.find(index_atom_1.MenuAtom, "menuAppendedToBody");
        expect(menu.isAppendedToBody()).toBeTruthy();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvbWVudS9tZW51LmUyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDJEQUF5RTtBQUN6RSx3Q0FBaUM7QUFDakMseUNBQXFDO0FBQ3JDLDhDQUF1QztBQUV2QyxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUksSUFBYyxDQUFDO0lBRW5CLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixpQkFBTyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMvQixJQUFJLEdBQUcsVUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLEdBQUcsRUFBRTtRQUNsRCxNQUFNO1FBQ04sSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRWIsU0FBUztRQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUMzQyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7UUFDbkQsVUFBVTtRQUNWLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUVkLE1BQU07UUFDTixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFYixTQUFTO1FBQ1QsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLGtFQUFrRSxFQUFFLEdBQUcsRUFBRTtRQUN4RSxVQUFVO1FBQ1YsSUFBSSxHQUFHLFVBQUksQ0FBQyxJQUFJLENBQUMscUJBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUUzQyxNQUFNO1FBQ04sSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLElBQUksQ0FDYjtZQUNJLE1BQU0sQ0FBQyxJQUFJLENB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Q3JFLElBQUksQ0FBQyxNQUFNLEVBQUU7YUFDUixJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGVBQUUsQ0FBQyxTQUFTLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO2FBQzNFLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDaEUsQ0FBQyxDQUFDLENBQUM7SUFFSCxHQUFHLENBQUMsb0ZBQW9GLEVBQUUsR0FBRyxFQUFFO1FBQzNGLFVBQVU7UUFDVixJQUFJLEdBQUcsVUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBUSxFQUFFLG9CQUFvQixDQUFDLENBQUM7UUFDakQsTUFBTTtRQUNOLElBQUksQ0FBQyxNQUFNLEVBQUU7YUFDUixJQUFJLENBQUMsR0FBRyxFQUFFO1lBQ1AsU0FBUztZQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsZUFBRSxDQUFDLFNBQVMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUM7UUFDM0UsQ0FBQyxDQUFDO2FBQ0QsSUFBSSxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDbEIsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1FBQzFDLElBQUksR0FBRyxVQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFRLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztRQUVqRCxNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImNvbXBvbmVudHMvbWVudS9tZW51LmUyZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7YnJvd3NlciwgYnksIGVsZW1lbnQsIHByb21pc2V9IGZyb20gXCJAc29sYXJ3aW5kcy91emkvcHJvdHJhY3RvclwiO1xuaW1wb3J0IEhlbHBlcnMgZnJvbSBcIi4uL2hlbHBlcnNcIjtcbmltcG9ydCB7QXRvbX0gZnJvbSBcIkBzb2xhcndpbmRzL3V6aVwiO1xuaW1wb3J0IHtNZW51QXRvbX0gZnJvbSBcIi4uL2luZGV4LmF0b21cIjtcblxuZGVzY3JpYmUoXCJVU0VSQ09OVFJPTCBNZW51XCIsICgpID0+IHtcbiAgICBsZXQgbWVudTogTWVudUF0b207XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgSGVscGVycy5wcmVwYXJlQnJvd3NlcihcIm1lbnVcIik7XG4gICAgICAgIG1lbnUgPSBBdG9tLmZpbmQoTWVudUF0b20sIFwibWVudVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwiZXhwYW5kcyBjbG9zZWQgbWVudSB3aGVuIGJ1dHRvbiBpcyBjbGlja2VkXCIsICgpID0+IHtcbiAgICAgICAgLy8gYWN0XG4gICAgICAgIG1lbnUuY2xpY2soKTtcblxuICAgICAgICAvLyBhc3NlcnRcbiAgICAgICAgZXhwZWN0KG1lbnUuaXNFeHBhbmRlZCgpKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG5cbiAgICBpdChcImNsb3NlcyBleHBhbmRlZCBtZW51IHdoZW4gYnV0dG9uIGlzIGNsaWNrZWRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBhcnJhbmdlXG4gICAgICAgIG1lbnUuZXhwYW5kKCk7XG5cbiAgICAgICAgLy8gYWN0XG4gICAgICAgIG1lbnUuY2xpY2soKTtcblxuICAgICAgICAvLyBhc3NlcnRcbiAgICAgICAgZXhwZWN0KG1lbnUuaXNFeHBhbmRlZCgpKS50b0JlRmFsc3koKTtcbiAgICB9KTtcblxuICAgIGl0KFwiZG9lcyBub3QgZXhwYW5kIG1lbnUgd2hlbiBidXR0b24gaXMgY2xpY2tlZCBhbmQgbWVudSBpcyBkaXNhYmxlZFwiLCAoKSA9PiB7XG4gICAgICAgIC8vIGFycmFuZ2VcbiAgICAgICAgbWVudSA9IEF0b20uZmluZChNZW51QXRvbSwgXCJtZW51RGlzYWJsZWRcIik7XG5cbiAgICAgICAgLy8gYWN0XG4gICAgICAgIG1lbnUuY2xpY2soKS50aGVuKFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBhc3NlcnRcbiAgICAgICAgZXhwZWN0KG1lbnUuaXNFeHBhbmRlZCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KFwicmVkaXJlY3RzIHRvIHNwZWNpZmllZCB1cmwgd2hlbiBtZW51IGxpbmsgaXRlbSBpcyBjbGlja2VkXCIsICgpID0+IHtcbiAgICAgICAgLy8gYXJyYW5nZVxuICAgICAgICBtZW51LmV4cGFuZCgpO1xuXG4gICAgICAgIC8vIGFjdFxuICAgICAgICBtZW51LmdldEFuY2hvckVsZW1Gb3JMaW5rT3JBY3Rpb25JdGVtQnlUaXRsZShcIkxpbmsgMVwiKS5jbGljaygpO1xuXG4gICAgICAgIC8vIGFzc2VydFxuICAgICAgICBicm93c2VyLmdldExvY2F0aW9uQWJzVXJsKCkudGhlbigodXJsKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QodXJsKS50b0NvbnRhaW4oXCIjbGlua1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcImRvZXMgbm90IHJlZGlyZWN0IHRvIHNwZWNpZmllZCB1cmwgd2hlbiBkaXNhYmxlZCBtZW51IGxpbmsgaXRlbSBpcyBjbGlja2VkXCIsICgpID0+IHtcbiAgICAgICAgLy8gYXJyYW5nZVxuICAgICAgICBtZW51LmV4cGFuZCgpO1xuXG4gICAgICAgIC8vIGFjdFxuICAgICAgICBtZW51LmdldEFuY2hvckVsZW1Gb3JMaW5rT3JBY3Rpb25JdGVtQnlUaXRsZShcIkxpbmsgMlwiKS5jbGljaygpO1xuXG4gICAgICAgIC8vIGFzc2VydFxuICAgICAgICBicm93c2VyLmdldExvY2F0aW9uQWJzVXJsKCkudGhlbigodXJsKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QodXJsKS5ub3QudG9Db250YWluKFwiI2Rpc2FibGVkTGlua1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcImRvZXMgYW4gYWN0aW9uIHdoZW4gbWVudSBhY3Rpb24gYW5jaG9yIGl0ZW0gaXMgY2xpY2tlZFwiLCAoKSA9PiB7XG4gICAgICAgIC8vIGFycmFuZ2VcbiAgICAgICAgbWVudS5leHBhbmQoKTtcbiAgICAgICAgY29uc3QgYWN0aW9uSXRlbUFuY2hvciA9IG1lbnUuZ2V0QW5jaG9yRWxlbUZvckxpbmtPckFjdGlvbkl0ZW1CeVRpdGxlKFwiQWN0aW9uIDJcIik7XG5cbiAgICAgICAgLy8gYWN0XG4gICAgICAgIGFjdGlvbkl0ZW1BbmNob3IuY2xpY2soKTtcblxuICAgICAgICAvLyBhc3NlcnRcbiAgICAgICAgbWVudS5leHBhbmQoKTtcbiAgICAgICAgY29uc3QgYWN0aW9uSXRlbUFuY2hvcjIgPSBtZW51LmdldEFuY2hvckVsZW1Gb3JMaW5rT3JBY3Rpb25JdGVtQnlUaXRsZShcIkNoYW5nZWQgYWN0aW9uIDJcIik7XG4gICAgICAgIGFjdGlvbkl0ZW1BbmNob3IyLmdldFRleHQoKS50aGVuKCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICBleHBlY3QodGV4dCkudG9FcXVhbChcIkNoYW5nZWQgYWN0aW9uIDJcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJkb2VzIGFuIGFjdGlvbiB3aGVuIG1lbnUgYWN0aW9uIGl0ZW0gaXMgY2xpY2tlZFwiLCAoKSA9PiB7XG4gICAgICAgIC8vIGFycmFuZ2VcbiAgICAgICAgbWVudS5leHBhbmQoKTtcbiAgICAgICAgY29uc3QgbWVudUl0ZW0gPSBtZW51LmdldEFuY2hvckVsZW1Gb3JMaW5rT3JBY3Rpb25JdGVtQnlUaXRsZUNvbnRhaW5pbmdUZXh0KFwiQm9sZCBBY3Rpb25cIik7XG5cbiAgICAgICAgLy8gYWN0XG4gICAgICAgIG1lbnVJdGVtLmNsaWNrKCk7XG5cbiAgICAgICAgLy8gYXNzZXJ0XG4gICAgICAgIG1lbnUuZXhwYW5kKCk7XG4gICAgICAgIGNvbnN0IGNoYW5nZWRNZW51SXRlbSA9IG1lbnUuZ2V0QW5jaG9yRWxlbUZvckxpbmtPckFjdGlvbkl0ZW1CeVRpdGxlQ29udGFpbmluZ1RleHQoXCJDaGFuZ2VkIGJvbGQgYWN0aW9uXCIpO1xuICAgICAgICBjaGFuZ2VkTWVudUl0ZW0uZ2V0VGV4dCgpLnRoZW4oKGlubmVySHRtbCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGlubmVySHRtbCkudG9Db250YWluKFwiQ2hhbmdlZCBib2xkIGFjdGlvblwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcImlzTWVudUl0ZW1FbmFibGVkQnlUaXRsZUNvbnRhaW5pbmdUZXh0IHNob3VsZCByZXR1cm4gY29ycmVjdCB2YWx1ZVwiLCAoKSA9PiB7XG4gICAgICAgIC8vIGFycmFuZ2VcbiAgICAgICAgbWVudS5leHBhbmQoKTtcblxuICAgICAgICAvLyBhc3NlcnRcbiAgICAgICAgZXhwZWN0KG1lbnUuaXNNZW51SXRlbUVuYWJsZWRCeVRpdGxlQ29udGFpbmluZ1RleHQoXCJBY3Rpb24gMVwiKSkudG9CZShmYWxzZSk7XG4gICAgICAgIGV4cGVjdChtZW51LmlzTWVudUl0ZW1FbmFibGVkQnlUaXRsZUNvbnRhaW5pbmdUZXh0KFwiQWN0aW9uIDJcIikpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdChcImRvZXMgbm90IGRvIGFueSBhY3Rpb24gd2hlbiBkaXNhYmxlZCBtZW51IGFjdGlvbiBpdGVtIGlzIGNsaWNrZWRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBhcnJhbmdlXG4gICAgICAgIG1lbnUuZXhwYW5kKCk7XG4gICAgICAgIGNvbnN0IGFjdGlvbkl0ZW1BbmNob3IgPSBtZW51LmdldEFuY2hvckVsZW1Gb3JMaW5rT3JBY3Rpb25JdGVtQnlUaXRsZShcIkFjdGlvbiAxXCIpO1xuXG4gICAgICAgIC8vIGFjdFxuICAgICAgICBhY3Rpb25JdGVtQW5jaG9yLmNsaWNrKCk7XG5cbiAgICAgICAgLy8gYXNzZXJ0XG4gICAgICAgIG1lbnUuZXhwYW5kKCk7XG4gICAgICAgIGNvbnN0IGFjdGlvbkl0ZW1BbmNob3IyID0gbWVudS5nZXRBbmNob3JFbGVtRm9yTGlua09yQWN0aW9uSXRlbUJ5VGl0bGUoXCJBY3Rpb24gMVwiKTtcbiAgICAgICAgZXhwZWN0KGFjdGlvbkl0ZW1BbmNob3IyLmdldFRleHQoKSkudG9FcXVhbChcIkFjdGlvbiAxXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJ0aWNrcyB0aGUgY2hlY2tib3ggd2hlbiBtZW51IG9wdGlvbiBpdGVtIGlzIGNsaWNrZWRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBhcnJhbmdlXG4gICAgICAgIG1lbnUuZXhwYW5kKCk7XG4gICAgICAgIGNvbnN0IG9wdGlvbkl0ZW1DaGVja2JveCA9IG1lbnUuZ2V0Q2hlY2tib3hFbGVtRm9yT3B0aW9uSXRlbUJ5VGl0bGUoXCJPcHRpb24gMlwiKTtcblxuICAgICAgICAvLyBhY3RcbiAgICAgICAgb3B0aW9uSXRlbUNoZWNrYm94LmNsaWNrKCk7XG5cbiAgICAgICAgLy8gYXNzZXJ0XG4gICAgICAgIGV4cGVjdChvcHRpb25JdGVtQ2hlY2tib3guaXNDaGVja2VkKCkpLnRvRXF1YWwodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdChcImRvZXMgbm90IHRpY2sgdGhlIGNoZWNrYm94IHdoZW4gZGlzYWJsZWQgbWVudSBvcHRpb24gaXRlbSBpcyBjbGlja2VkXCIsICgpID0+IHtcbiAgICAgICAgLy8gYXJyYW5nZVxuICAgICAgICBtZW51LmV4cGFuZCgpO1xuICAgICAgICBjb25zdCBvcHRpb25JdGVtQ2hlY2tib3ggPSBtZW51LmdldENoZWNrYm94RWxlbUZvck9wdGlvbkl0ZW1CeVRpdGxlKFwiT3B0aW9uIDFcIik7XG5cbiAgICAgICAgLy8gYWN0XG4gICAgICAgIG9wdGlvbkl0ZW1DaGVja2JveC5jbGljaygpO1xuXG4gICAgICAgIC8vIGFzc2VydFxuICAgICAgICBleHBlY3Qob3B0aW9uSXRlbUNoZWNrYm94LmlzQ2hlY2tlZCgpKS50b0VxdWFsKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KFwib3BlbnMgZG93bnNpZGUgaWYgdGhlcmUgaXMgZW5vdWdoIHNwYWNlIHRvIGRpc3BsYXkgaXRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBhY3RcbiAgICAgICAgbWVudS5leHBhbmQoKTtcblxuICAgICAgICAvLyBhc3NlcnRcbiAgICAgICAgbWVudS5pc0NoaWxkRWxlbWVudFByZXNlbnQoYnkuY2xhc3NOYW1lKFwiZHJvcHVwXCIpKS50aGVuKChpc1ByZXNlbnRlZCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGlzUHJlc2VudGVkKS50b0JlRmFsc3koKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcIm9wZW5zIHVwc2lkZSB3aGVuIHRoZXJlIGlzIG5vIHNwYWNlIHRvIGRpc3BsYXkgaXQgZG93bnNpZGVcIiwgKCkgPT4ge1xuICAgICAgICAvLyBhcnJhbmdlXG4gICAgICAgIG1lbnUgPSBBdG9tLmZpbmRJbihNZW51QXRvbSwgZWxlbWVudChieS5pZChcIm1lbnVVcHNpZGVcIikpKTtcblxuICAgICAgICAvLyBhY3RcbiAgICAgICAgbWVudS5leHBhbmQoKTtcblxuICAgICAgICAvLyBhc3NlcnRcbiAgICAgICAgbWVudS5pc0NoaWxkRWxlbWVudFByZXNlbnQoYnkuY2xhc3NOYW1lKFwiZHJvcHVwXCIpKS50aGVuKChpc1ByZXNlbnRlZCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGlzUHJlc2VudGVkKS50b0JlVHJ1dGh5KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJoYXMgdGhlIGxlZnQgYWxpZ25tZW50IGlmIHRoZXJlIGlzIGVub3VnaCBzcGFjZSB0byBkaXNwbGF5IGl0XCIsICgpID0+IHtcbiAgICAgICAgbWVudS5leHBhbmQoKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gbWVudS5pc0NoaWxkRWxlbWVudFByZXNlbnQoYnkuY2xhc3NOYW1lKFwiZHJvcGRvd24tbWVudS1yaWdodFwiKSkpXG4gICAgICAgICAgICAudGhlbigoaXNQcmVzZW50ZWQpID0+IGV4cGVjdChpc1ByZXNlbnRlZCkudG9CZUZhbHN5KCkpO1xuICAgIH0pO1xuXG4gICAgeGl0KFwiaGFzIHRoZSByaWdodCBhbGlnbm1lbnQgaWYgdGhlcmUgaXMgbm8gc3BhY2UgdG8gZGlzcGxheSBpdCB3aXRoIHRoZSBsZWZ0IGFsaWdubWVudFwiLCAoKSA9PiB7XG4gICAgICAgIC8vIGFycmFuZ2VcbiAgICAgICAgbWVudSA9IEF0b20uZmluZChNZW51QXRvbSwgXCJtZW51UmlnaHRBbGlnbm1lbnRcIik7XG4gICAgICAgIC8vIGFjdFxuICAgICAgICBtZW51LmV4cGFuZCgpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gYXNzZXJ0XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lbnUuaXNDaGlsZEVsZW1lbnRQcmVzZW50KGJ5LmNsYXNzTmFtZShcImRyb3Bkb3duLW1lbnUtcmlnaHRcIikpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKChpc1ByZXNlbnRlZCkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChpc1ByZXNlbnRlZCkudG9CZVRydXRoeSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcImhhcyAnYXBwZW5kIHRvIGJvZHknIGZ1bmN0aW9uYWxpdHlcIiwgKCkgPT4ge1xuICAgICAgICBtZW51ID0gQXRvbS5maW5kKE1lbnVBdG9tLCBcIm1lbnVBcHBlbmRlZFRvQm9keVwiKTtcblxuICAgICAgICBleHBlY3QobWVudS5pc0FwcGVuZGVkVG9Cb2R5KCkpLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
