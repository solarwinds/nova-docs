import{a as Y}from"./chunk-TP2BH5IZ.js";import{a as q}from"./chunk-EGPV2BM7.js";import{d as j}from"./chunk-KPMNOLLU.js";import{a as J}from"./chunk-EWA4R42U.js";import{a as G}from"./chunk-5VDV6BXS.js";import{a as K}from"./chunk-PRPDBMMC.js";import{a as N}from"./chunk-YS6YGF5L.js";import{g as H,s as S}from"./chunk-P53HI2D5.js";import{c as $}from"./chunk-LVGKZ3JP.js";import{a as s}from"./chunk-KNI7S7QC.js";import{d as W}from"./chunk-7KV4WPOL.js";import{a as z}from"./chunk-SPXQGSTF.js";import{Aa as D,Ia as R,Ib as g,Ja as h,Ka as d,Kb as P,Ob as y,Pb as C,Q as V,Qb as F,Ra as b,Sa as M,Ub as B,_c as U,ec as p,g as w,ga as I,mc as l,na as k,nc as u,oa as A,ob as f,oc as c,pb as _,pc as L,yc as Q}from"./chunk-7UJBXEVU.js";import{g as T}from"./chunk-XR34LRGE.js";var v=T(G()),O=T(z()),r=T(J());var x={block:"nearest"},E=(()=>{class o{initService(e,t,i){this.overlay=t,this.popup=e,this.menuItems=e.menuItems.toArray(),this.keyboardEventsManager=new $(this.menuItems),this.menuTrigger=i}onKeyDown(e){this.overlay.showing?this.handleOpenedMenu(e):this.handleClosedMenu(e)}handleOpenedMenu(e){let{code:t}=e;t===s.ESCAPE&&this.hideMenu(),(t===s.ARROW_DOWN||t===s.ARROW_UP)&&this.navigateByArrow(e),t===s.ENTER&&(e.preventDefault(),this.keyboardEventsManager.activeItem?.doAction(e)),t===s.SPACE&&document.activeElement===this.menuTrigger&&(e.preventDefault(),this.overlay.toggle())}handleClosedMenu(e){let{code:t}=e,i=document.activeElement===this.menuTrigger&&this.isOpenMenuCode(t);(document.activeElement!==this.menuTrigger&&t===s.ARROW_DOWN||i)&&(e.preventDefault(),this.overlay.show(),this.keyboardEventsManager.setActiveItem(this.getSelectedIndex()),this.keyboardEventsManager.activeItem?.menuItem?.nativeElement?.scrollIntoView({block:"center"}))}hideMenu(){this.overlay.hide()}navigateByArrow(e){let{code:t}=e,i=this.keyboardEventsManager.activeItemIndex;if(e.preventDefault(),t===s.ARROW_UP&&i===0){this.navigateOnLast();return}if(t===s.ARROW_DOWN&&i===this.menuItems.length){this.navigateOnFirst();return}this.keyboardEventsManager.onKeydown(e),this.keyboardEventsManager.activeItem?.menuItem?.nativeElement?.scrollIntoView(x)}navigateOnLast(){this.keyboardEventsManager.setActiveItem(this.menuItems.length-1),this.keyboardEventsManager.activeItem?.menuItem.nativeElement.scrollIntoView(x)}navigateOnFirst(){this.keyboardEventsManager.setActiveItem(0),this.keyboardEventsManager.activeItem?.menuItem.nativeElement.scrollIntoView(x)}getSelectedIndex(){return this.menuItems.findIndex(e=>e.menuItem.nativeElement.parentElement.classList.contains("nui-menu-item--selected"))}isOpenMenuCode(e){return e===s.ENTER||e===s.SPACE}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=A({token:o,factory:o.\u0275fac})}}return o})();var ee=["date"],te=["popupArea"],ie=["toggleRef"],ne=["popup"],re=["menuTrigger"],Ve=(()=>{class o{get model(){return this.innerModel}set model(e){(0,r.default)(e).isValid()&&(e&&!this.preserveInsignificant&&e.year(0).month(0).date(0),this.innerModel=e,this.textbox.writeValue((0,r.default)(this.innerModel).format(this.timeFormat)))}constructor(e,t,i){this.elementRef=e,this.keyboardService=t,this.cdr=i,this.timeStep=30,this.timeFormat="LT",this.preserveInsignificant=!1,this.isInErrorState=!1,this.ariaLabel="Time Picker",this.appendToBody=!1,this.timeChanged=new M,this.inputBlurred=new M,this.itemsSource=[{itemsSource:[]}],this.overlayConfig={panelClass:[H,"nui-timepicker__menu"]},this.onDestroy$=new w,this.popupUtilities=new q,this.inputChanged=new w}ngOnInit(){this.times=this.generateTimeItems(this.timeStep),this.times.map(e=>{this.itemsSource[0].itemsSource.push({title:e,displayFormat:this.timeFormat,isSelected:!1})}),this.initEmpty||(this.innerModel=(0,r.default)(this.model).clone()||(0,r.default)(),this.textbox.writeValue((0,r.default)(this.innerModel).format(this.timeFormat))),this.itemToSelect=this.getItemToSelect(),this.inputChanged.pipe(V(500)).subscribe(e=>{this.updateInnerModel(e),this.itemToSelect=this.getItemToSelect(),this.timeChanged.emit(this.innerModel),this.onChange(this.innerModel),this.setErrorState(e)}),this.onAppendToBodyChange(this.appendToBody)}ngOnChanges(e){e.appendToBody&&this.onAppendToBodyChange(e.appendToBody.currentValue)}ngAfterViewInit(){this.overlay.clickOutside.pipe(I(this.onDestroy$)).subscribe(e=>this.overlay.hide()),this.initPopupUtilities(),this.keyboardService.initService(this.popup,this.overlay,this.menuTrigger.nativeElement),this.cdr.detectChanges()}onChange(e){}onTouched(){}onKeyDown(e){this.keyboardService.onKeyDown(e)}onFocusOut(e){!this.overlay.showing||!document.activeElement||this.popupArea.nativeElement.contains(e.relatedTarget)||this.containerEl.nativeElement.contains(e.relatedTarget)||this.overlay.hide()}updateInnerModel(e){if(setTimeout(()=>this.inputBlurred.emit(),100),e instanceof r.default&&!this.preserveInsignificant&&(e.year(0),e.date(1),e.month(0),e.seconds(0)),this.innerModel=(0,v.default)(e)||e.length===0?void 0:(0,r.default)(e,this.timeFormat),(0,r.default)(this.innerModel).isValid()||(this.innerModel=e),this.onTouched(),!(0,v.default)(this.times)&&!(0,v.default)(this.innerModel)&&!(0,O.default)(this.innerModel)){let t=this.getItemIndexToSelect(this.innerModel,this.timeStep,this.times);this.unselectAllItems(),isFinite(t)&&(this.itemsSource[0].itemsSource[t].isSelected=!0,this.itemToSelect=this.itemsSource[0].itemsSource[t])}this.setErrorState(e)}writeValue(e){this.textbox.writeValue(this.formatValue(e)),this.updateInnerModel(this.formatValue(e))}setErrorState(e){this.isInErrorState=!(0,r.default)(e,this.timeFormat,!0).isValid()}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.isDisabled=e}focusOnForm(){this.textbox.focus()}onInputActiveDateChanged(e){this.inputChanged.next(e)}select(e){this.updateInnerModel(e.title),this.textbox.writeValue(this.formatValue()),this.timeChanged.emit(this.innerModel),this.onChange(this.innerModel),this.overlay.hide()}scrollToView(){this.isDisabled||this.overlay.toggle(),this.elementRef.nativeElement.getElementsByClassName("nui-menu-item--selected")[0]?.scrollIntoView({block:"center"})}generateTimeItems(e){let t=this.preserveInsignificant?(0,r.default)().hour(0).startOf("hour"):(0,r.default)().year(0).startOf("year"),i=t.dayOfYear(),n=[];for(;t.dayOfYear()===i;)n.push(t.clone()),t.add(e,"minute");return n}isItemSelected(e){return(0,r.default)(e).isSame(this.itemToSelect.title)}getItemIndexToSelect(e,t,i){let n=(0,r.default)(e),a=n.get("hours")*60+n.get("minutes"),m=Math.round(a/t);return m===i.length?0:m}getItemToSelect(){if((0,v.default)(this.innerModel)||(0,O.default)(this.innerModel)){this.unselectAllItems();return}let e=this.getItemIndexToSelect(this.innerModel,this.timeStep,this.times);if(this.unselectAllItems(),isFinite(e))return this.itemsSource[0].itemsSource[e].isSelected=!0,this.itemsSource[0].itemsSource[e]}unselectAllItems(){this.itemsSource[0].itemsSource.forEach(e=>e.isSelected=!1)}formatValue(e=this.innerModel){return(0,r.default)(e).isValid()?(0,r.default)(e).format(this.timeFormat):e}getIconColor(){return this.isDisabled?"gray":"primary-blue"}onAppendToBodyChange(e){this.customContainer=e?void 0:this.popupArea}initPopupUtilities(){let e=this.popupUtilities.setPopupComponent(this.overlay).getResizeObserver();this.overlay.show$.pipe(I(this.onDestroy$)).subscribe(()=>{this.popupUtilities.syncWidth(),e.observe(this.elementRef.nativeElement)}),this.overlay.hide$.pipe(I(this.onDestroy$)).subscribe(()=>{e.unobserve(this.elementRef.nativeElement)})}ngOnDestroy(){this.overlay?.showing&&this.overlay.hide(),this.onDestroy$.next(),this.onDestroy$.complete(),this.inputChanged.unsubscribe()}static{this.\u0275fac=function(t){return new(t||o)(_(b),_(E),_(U))}}static{this.\u0275cmp=D({type:o,selectors:[["nui-time-picker"]],viewQuery:function(t,i){if(t&1&&(l(ee,7),l(te,7),l(ie,7),l(S,5),l(ne,5),l(re,5,b)),t&2){let n;u(n=c())&&(i.textbox=n.first),u(n=c())&&(i.popupArea=n.first),u(n=c())&&(i.containerEl=n.first),u(n=c())&&(i.overlay=n.first),u(n=c())&&(i.popup=n.first),u(n=c())&&(i.menuTrigger=n.first)}},hostBindings:function(t,i){t&1&&p("keydown",function(a){return i.onKeyDown(a)})("focusout",function(a){return i.onFocusOut(a)})},inputs:{timeStep:"timeStep",isDisabled:"isDisabled",timeFormat:"timeFormat",preserveInsignificant:"preserveInsignificant",isInErrorState:"isInErrorState",ariaLabel:"ariaLabel",initEmpty:"initEmpty",appendToBody:"appendToBody",model:"model"},outputs:{timeChanged:"timeChanged",inputBlurred:"inputBlurred"},features:[Q([{provide:N,useExisting:k(()=>o),multi:!0},{provide:K,useExisting:k(()=>o),multi:!0},E]),R],decls:13,vars:10,consts:[["toggleRef",""],["date",""],["menuTrigger",""],["popupArea",""],["overlay",""],["popup",""],[1,"nui-timepicker"],[1,"nui-timepicker__container",3,"click"],["autocomplete","off",3,"textChange","blurred","disabled","isInErrorState","ariaLabel"],["icon","clock","tabindex","0",1,"nui-timepicker__icon",3,"click","iconColor"],[3,"toggleReference","overlayConfig","customContainer"],[3,"menuItemClicked","itemsSource"]],template:function(t,i){if(t&1){let n=B();y(0,"div",6)(1,"div",7,0),p("click",function(){return h(n),d(i.scrollToView())}),y(3,"nui-textbox",8,1),p("textChange",function(m){return h(n),d(i.onInputActiveDateChanged(m))})("blurred",function(m){return h(n),d(i.updateInnerModel(m))}),C(),y(5,"nui-icon",9,2),p("click",function(){return h(n),d(i.focusOnForm())}),C()(),F(7,"div",null,3),y(9,"nui-overlay",10,4)(11,"nui-menu-popup",11,5),p("menuItemClicked",function(m){return h(n),d(i.select(m))}),C()()()}if(t&2){let n=L(2);f(3),P("nui-timepicker__input-disabled",i.isDisabled),g("disabled",i.isDisabled)("isInErrorState",i.isInErrorState)("ariaLabel",i.ariaLabel),f(2),g("iconColor",i.getIconColor()),f(4),g("toggleReference",n)("overlayConfig",i.overlayConfig)("customContainer",i.customContainer),f(2),g("itemsSource",i.itemsSource)}},dependencies:[Y,W,S,j],styles:[`.nui .nui-timepicker__container{width:135px;height:30px;position:relative}.nui .nui-timepicker__icon{cursor:pointer;position:absolute;top:7px;right:7px;z-index:501}.nui .nui-timepicker__icon:focus{border-radius:3px;outline:none;box-shadow:0 0 0 2px #00c4d280}.nui .nui-timepicker__menu{background-color:var(--nui-color-bg-content_popover,#fff);box-shadow:0 0 5px 0 var(--nui-shadow-color, rgba(17, 17, 17, .3));max-height:300px;overflow-y:auto;min-width:135px;text-align:left}.nui .nui-timepicker__input-disabled+.nui-timepicker__icon{pointer-events:auto;cursor:not-allowed}.nui .nui-timepicker .nui-popup-container{display:inline-flex}.nui .nui-timepicker .nui-textbox .has-feedback .nui-textbox__input{line-height:14px}
`],encapsulation:2})}}return o})();export{Ve as a};
