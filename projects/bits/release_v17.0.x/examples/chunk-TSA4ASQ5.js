import{a as k}from"./chunk-DAXCPQBM.js";import{a as Q}from"./chunk-NHRJVCF7.js";import{$ as y,ia as u}from"./chunk-QFUYJXD4.js";import{a as m}from"./chunk-CAUUXJ5Z.js";import{l as E,s as O,y as B}from"./chunk-N5FUFMYY.js";import{Aa as R,Gb as g,Hc as S,Ib as d,Ic as v,M as w,Mc as T,Ob as p,Pb as c,Qb as V,_c as j,fa as _,g as C,ga as f,h as I,ia as s,mc as D,nc as $,ob as o,oc as F,pb as l,pc as M,qc as x,sc as b,yc as P}from"./chunk-7UJBXEVU.js";import{j as n}from"./chunk-XR34LRGE.js";function A(i,h){if(i&1&&(p(0,"div",6),x(1),c()),i&2){let e=h.$implicit;o(),b(" ",e.value," ")}}function N(i,h){if(i&1&&(p(0,"div",3)(1,"div",4),g(2,A,2,1,"div",5),S(3,"keyvalue"),c()()),i&2){let e=h.item;o(2),d("ngForOf",v(3,1,e))}}var Y=(()=>{class i{constructor(e,t,r){this.dataSource=e,this.changeDetection=t,this.viewportManager=r,this.listItems$=new I([]),this.filteringState={},this.isBusy=!1,this.totalItems=0,this.itemConfig={trackBy:(a,z)=>z?.name},this.destroy$=new C}ngOnInit(){this.dataSource.busy.pipe(s(e=>{this.isBusy=e,this.changeDetection.detectChanges()}),f(this.destroy$)).subscribe()}ngAfterViewInit(){return n(this,null,function*(){this.dataSource.registerComponent({virtualScroll:{componentInstance:this.viewportManager},repeat:{componentInstance:this.repeat}}),this.viewportManager.setViewport(this.repeat.viewportRef).observeNextPage$({pageSize:20}).pipe(w(()=>{let e=this.listItems$.getValue();return!e.length||e.length<this.totalItems}),s(()=>n(this,null,function*(){return this.applyFilters(!1)})),_(()=>this.dataSource.outputsSubject.pipe(s(e=>{let t=e.repeat?.itemsSource||[];this.totalItems=e.repeat?.itemsSource.length,this.listItems$.next(this.listItems$.getValue().concat(t)),this.changeDetection.detectChanges()}))),f(this.destroy$)).subscribe()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}applyFilters(e=!0){return n(this,null,function*(){e&&this.viewportManager.reset({emitFirstPage:!1});let t=this.dataSource.getFilters();(this.dataSource.computeFiltersChange(t)||t.virtualScroll?.value.start===0)&&(this.listItems$.next([]),this.changeDetection.detectChanges()),yield this.dataSource.applyFilters()})}static{this.\u0275fac=function(t){return new(t||i)(l(y),l(j),l(u))}}static{this.\u0275cmp=R({type:i,selectors:[["repeat-virtual-scroll"]],viewQuery:function(t,r){if(t&1&&D(m,5),t&2){let a;$(a=F())&&(r.repeat=a.first)}},features:[P([u,{provide:y,useClass:k}])],decls:5,vars:8,consts:[["listRepeatItemTemplate",""],[1,"d-flex","flex-row"],["selectionMode","none",1,"app-virtual-scroll-list-repeat",3,"itemConfig","repeatItemTemplateRef","selection","itemsSource","virtualScroll","itemSize"],[1,"container"],[1,"row"],["class","col-sm",4,"ngFor","ngForOf"],[1,"col-sm"]],template:function(t,r){if(t&1&&(p(0,"div",1),V(1,"nui-repeat",2),S(2,"async"),c(),g(3,N,4,3,"ng-template",null,0,T)),t&2){let a=M(4);o(),d("itemConfig",r.itemConfig)("repeatItemTemplateRef",a)("selection",r.filteringState.repeat==null?null:r.filteringState.repeat.selectedItems)("itemsSource",v(2,6,r.listItems$))("virtualScroll",!0)("itemSize",30)}},dependencies:[E,m,O,B],styles:["[_nghost-%COMP%]   .app-virtual-scroll-list-repeat[_ngcontent-%COMP%]{margin:10px 15px;width:100%;height:300px}"],changeDetection:0})}}return i})();export{Y as a};
