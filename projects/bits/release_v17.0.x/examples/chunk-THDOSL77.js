import{t as _e}from"./chunk-CI5QMEPW.js";import{a as fe}from"./chunk-IFXQERSK.js";import{c as de}from"./chunk-NDX2TKMV.js";import{c as ge}from"./chunk-EMVJH4OC.js";import{c as ye}from"./chunk-WB3W4DUY.js";import{a as me}from"./chunk-QLRYULCZ.js";import{a as ue}from"./chunk-PRPDBMMC.js";import{a as te,c as ie,f as ne,g as oe,i as re,k as se,n as ae,o as le,q as pe,u as he}from"./chunk-YS6YGF5L.js";import{d as ce}from"./chunk-7KV4WPOL.js";import{l as Z,m as ee}from"./chunk-N5FUFMYY.js";import{Aa as I,Bc as Q,Gb as y,Hb as K,Hc as L,Ia as H,Ib as l,Ja as w,Jb as $,Jc as N,Ka as S,Mc as X,Ob as d,Pb as u,Qb as _,Rb as E,Sa as C,Sb as b,Ub as j,_c as J,ec as G,fc as h,g as q,ga as k,ib as P,ic as U,mc as m,na as F,nc as g,oa as z,ob as a,oc as f,pb as v,pc as R,qc as T,ra as W,rc as O,ta as A,vb as M,yc as Y}from"./chunk-7UJBXEVU.js";var D=new W("Window");function Ge(){return window}var we=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],ve=(()=>{class o{constructor(e){this.window=e}getTextareaCaretCoordinates(e,t){let i=this.window.mozInnerScreenX!=null,n=this.window.document.getElementById(e.nodeName+"--mirror-div");n||(n=this.window.document.createElement("div"),n.id=e.nodeName+"--mirror-div",this.window.document.body.appendChild(n));let r=n.style,s=getComputedStyle(e);r.whiteSpace="pre-wrap",r.position="absolute",r.top=e.offsetTop+parseInt(s.borderTopWidth,10)+"px",r.left="-400px",we.forEach(B=>{r[B]=s[B]}),i?(r.width=parseInt(s.width,10)-2+"px",e.scrollHeight>parseInt(s.height,10)&&(r.overflowY="scroll")):r.overflow="hidden",n.textContent=e.value.substring(0,t);let p=this.window.document.createElement("span");p.textContent=e.value.substring(t)||".",p.style.backgroundColor="lightgrey",n.appendChild(p);let x=e.scrollTop,Te={top:p.offsetTop+parseInt(s.borderTopWidth,10)-x,left:p.offsetLeft+parseInt(s.borderLeftWidth,10),scrollTop:x};return this.window.document.body.removeChild(n),Te}static{this.\u0275fac=function(t){return new(t||o)(A(D))}}static{this.\u0275prov=z({token:o,factory:o.\u0275fac})}}return o})();var Ee=["parentContainer"],be=["textContainer"],Oe=["text"],ke=["highlightCanvas"],V=(()=>{class o{get container(){return this.parentContainer.nativeElement}get textHolder(){return this.textContainer.nativeElement}get span(){return this.text.nativeElement}constructor(e){this.ONE_SIDE_STROKE_WIDTH=1,this.BOTH_SIDES_STROKE_WIDTH=2,this.BOX_SUM_PADDING=8,this.window=e}ngOnChanges(e){e.model&&e.model.previousValue&&setTimeout(()=>this.highlightTokens(this.model.tokens))}ngOnInit(){new ResizeObserver(()=>{this.highlightTokens(this.model.tokens)}).observe(this.textHolder),setTimeout(()=>this.highlightTokens(this.model.tokens))}getBorderWidths(e){let t=i=>this.getPixelPropertyValue(e,"border-"+i+"-width");return{top:t("top"),bottom:t("bottom"),left:t("left"),right:t("right")}}getPaddings(e){let t=i=>this.getPixelPropertyValue(e,"padding-"+i);return{top:t("top"),bottom:t("bottom"),left:t("left"),right:t("right")}}getPixelPropertyValue(e,t){return Number(this.window.getComputedStyle(e,null).getPropertyValue(t).split("px")[0])}highlightTokens(e){let t=this.highlightCanvas.nativeElement;if(!this.renderConfigurator||!t)return;let i=t.getContext("2d");if(this.setupContext(i,t),!e||e.length===0)return;let n=this.container.getBoundingClientRect(),r=this.getPaddings(this.textHolder),s=n.left+r.left,p=n.top+r.top;this.renderConfigurator.enhanceTokens&&(e=this.renderConfigurator.enhanceTokens(e)),this.processTokens(e,i,s,p)}processTokens(e,t,i,n){for(let r=0;r<e.length;r++){let s=e[r],p=this.renderConfigurator.getHighlightColor(s),x=this.renderConfigurator.getNotifColor(s);!p&&!x||!this.span.childNodes[0].textContent||this.span.childNodes[0].textContent.length<=s.start||this.span.childNodes[0].textContent.length<=s.end||this.highlightToken(s,t,{notif:x,highlight:p},{left:i,top:n})}}setupContext(e,t){e.lineWidth=1;let i=this.getPaddings(this.textHolder),n=this.getBorderWidths(this.textHolder),r=this.getPixelPropertyValue(this.textHolder,"height"),s=this.getPixelPropertyValue(this.textHolder,"width"),p=this.getPixelPropertyValue(this.container,"width");e.canvas.width=s-i.left-i.right-n.left-n.right,e.canvas.height=r-i.top-i.bottom-n.top-n.bottom,e.canvas.style.width=p+"px",e.canvas.style.height=r+"px",e.shadowOffsetX=0,e.shadowOffsetY=0,e.clearRect(0,0,t.width,t.height)}highlightToken(e,t,i,n){let r=document.createRange();r.setStart(this.span.childNodes[0],e.start),r.setEnd(this.span.childNodes[0],e.end);let s=r.getClientRects();for(let p=0;p<s.length;p++){let x=s[p];t.beginPath(),i.notif&&this.addNotificationRectangle(i,t,x,n),i.highlight&&this.addHighlightRectangle(i,t,x,n),t.closePath()}}addHighlightRectangle(e,t,i,n){t.fillStyle=e.highlight,t.fillRect(i.left-n.left-this.ONE_SIDE_STROKE_WIDTH,i.top-n.top,i.width+this.BOX_SUM_PADDING,i.height-this.BOTH_SIDES_STROKE_WIDTH)}addNotificationRectangle(e,t,i,n){t.strokeStyle=e.notif,t.strokeRect(i.left-n.left-this.BOTH_SIDES_STROKE_WIDTH,i.top-n.top-this.ONE_SIDE_STROKE_WIDTH,i.width+this.BOX_SUM_PADDING+this.BOTH_SIDES_STROKE_WIDTH,i.height)}static{this.\u0275fac=function(t){return new(t||o)(v(D))}}static{this.\u0275cmp=I({type:o,selectors:[["nui-text-highlight-overlay"]],viewQuery:function(t,i){if(t&1&&(m(Ee,7),m(be,7),m(Oe,7),m(ke,7)),t&2){let n;g(n=f())&&(i.parentContainer=n.first),g(n=f())&&(i.textContainer=n.first),g(n=f())&&(i.text=n.first),g(n=f())&&(i.highlightCanvas=n.first)}},inputs:{model:"model",renderConfigurator:"renderConfigurator"},features:[H],decls:9,vars:1,consts:[["parentContainer",""],["textContainer",""],["text",""],["highlightCanvas",""],[1,"parent"],[1,"child"],[1,"text"],["id","highlightCanvas",1,"canvas"]],template:function(t,i){t&1&&(d(0,"div",4,0)(2,"div",5,1)(4,"span",6,2),T(6),u()(),_(7,"canvas",7,3),u()),t&2&&(a(6),O(i.model.value))},styles:[".child[_ngcontent-%COMP%]{word-break:break-word;background-color:transparent;line-height:1.66666667;font-size:13px;font-family:monospace;width:100%;border:1px solid transparent;min-height:34px;padding:5px 10px}.parent[_ngcontent-%COMP%]{position:relative}.parent[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{white-space:break-spaces}.parent[_ngcontent-%COMP%]   .canvas[_ngcontent-%COMP%]{padding:5px 10px;border:1px solid transparent;position:absolute;pointer-events:none;top:0;left:0;height:100%;width:calc(100% + 1px)}"]})}}return o})();var He=["queryselect"],De=["messageTextarea"],Ve=["messageTextareaHolder"],Fe=["textHighlightOverlayHolder"],Ce=()=>[];function Pe(o,c){if(o&1&&_(0,"nui-icon",13),o&2){let e=h(2).$implicit;l("icon",e.icon)}}function Re(o,c){if(o&1&&(d(0,"nui-select-v2-option",9)(1,"div",10),y(2,Pe,1,1,"nui-icon",11),_(3,"span",12),L(4,"nuiHighlight"),u()()),o&2){let e=h().$implicit,t=h();l("displayValueContext",e)("value",e),a(2),l("ngIf",e.icon),a(),l("innerHTML",N(4,4,e.displayValue,t.focusedTokenValue),P)}}function Qe(o,c){o&1&&_(0,"nui-divider",18)}function Le(o,c){if(o&1&&(d(0,"span",19),T(1),u()),o&2){let e=h(2).$implicit;a(),O(e.header)}}function Ne(o,c){if(o&1&&(_(0,"span",12),L(1,"nuiHighlight")),o&2){let e=h().$implicit,t=h(4);l("innerHTML",N(1,1,e.displayValue,t.focusedTokenValue),P)}}function Be(o,c){if(o&1&&(d(0,"nui-select-v2-option",9),y(1,Ne,2,4,"span",21),u()),o&2){let e=c.$implicit;h(4);let t=R(4);l("displayValueContext",e)("value",e),a(),l("ngIf",!t)}}function qe(o,c){if(o&1&&(E(0),y(1,Be,2,3,"nui-select-v2-option",20),b()),o&2){let e=h(2).$implicit;a(),l("ngForOf",e.items)}}function ze(o,c){if(o&1&&(E(0),d(1,"div",22),_(2,"nui-icon",23),d(3,"span",24),T(4),u()(),b()),o&2){let e=c.$implicit;a(2),U("icon","severity_"+(e.severity?e.severity:"info")),a(2),O(e.message.displayValue)}}function We(o,c){if(o&1&&(E(0),y(1,ze,5,2,"ng-container",6),b()),o&2){let e=h(2).$implicit;a(),l("ngForOf",e.items)}}function Ae(o,c){o&1&&_(0,"nui-divider",18)}function Me(o,c){if(o&1&&(d(0,"nui-select-v2-option-group",14),y(1,Qe,1,0,"nui-divider",15)(2,Le,2,1,"span",16)(3,qe,2,1,"ng-container",17)(4,We,2,1,"ng-container",17)(5,Ae,1,0,"nui-divider",15),u()),o&2){let e=h(),t=e.$implicit,i=e.index,n=e.last;a(),l("ngIf",n&&i>1),a(),l("ngIf",t.header),a(),l("ngIf",!t.notice),a(),l("ngIf",t.notice),a(),l("ngIf",!n)}}function Ke(o,c){if(o&1&&(E(0),y(1,Re,5,7,"nui-select-v2-option",7)(2,Me,6,5,"nui-select-v2-option-group",8),b()),o&2){let e=c.$implicit;a(),l("ngIf",!e.items),a(),l("ngIf",e.items&&e.items!==Q(2,Ce))}}function $e(o,c){if(o&1){let e=j();d(0,"div",25)(1,"div")(2,"form",26)(3,"div",27,2)(5,"textarea",28,3),G("drop",function(i){w(e);let n=h();return S(n.onDrop(i))})("keydown",function(i){w(e);let n=h();return S(n.onKeyDown(i))})("keyup",function(i){w(e);let n=h();return S(n.onKeyUp(i))})("click",function(i){w(e);let n=h();return S(n.onClick(i))}),T(7,"                    "),u(),d(8,"div",29,4),_(10,"nui-text-highlight-overlay",30),u()()()()()}if(o&2){let e=h();a(2),l("formGroup",e.formGroup),a(3),$("height",e.inputHeight,"px"),l("placeholder",e.placeholder)("maxLength",e.maxLength),K("disabled",e.readonly?"disabled":null),a(5),l("model",e.highlightModel)("renderConfigurator",e.renderer)}}var It=(()=>{class o{static pasteTextCommon(e){return e=e.replace(/(\r\n|\n|\r)/gm," "),document.execCommand("insertText",!1,e)}constructor(e,t,i,n,r){this.renderer2=e,this.formBuilder=t,this.cd=i,this.toastService=n,this.utils=r,this.KEY_ENTER_CODE="Enter",this.KEY_ESC_CODE="Escape",this.maxLength=1e4,this.readonly=!1,this.currentHelp=[],this.helpItemSelected=new C,this.currentValue=new C,this.cursorPos=new C,this.cursorCoords=new C,this.submitQuery=new C,this.ON_SCROLL_CALLBACK=this.onTextAreaScroll.bind(this),this.BASE_LINE=34,this.destroy$$=new q,this.tokens=[],this.scrollValue=0,this.cursorPosition=0,this.lastHeight=0,this.focusedTokenValue="",this.highlightModel={value:"",tokens:[]},this.inputHeight=this.BASE_LINE,this.selectControl=new re,this.clearNewLinesOnPaste=s=>{if(s.preventDefault(),s.clipboardData&&s.clipboardData.getData){let p=s.clipboardData.getData("text/plain");o.pasteTextCommon(p)||this.pasteTextFirefox(this.textarea,p),this.scrollToCursor()}},this.formGroup=this.formBuilder.group({body:[""]}),this.bodyControl=this.formGroup.get("body")}ngOnChanges(e){e.value&&this.bodyControl.patchValue(e.value.currentValue)}ngAfterViewInit(){this.renderer2.listen(this.querySelect.inputElement.nativeElement,"focusin",()=>{this.openOptions()}),this.querySelect.valueSelected.pipe(k(this.destroy$$)).subscribe(e=>{this.itemSelected({newValue:e,oldValue:void 0}),setTimeout(()=>{this.openOptions()})}),this.bodyControl.valueChanges.pipe(k(this.destroy$$)).subscribe(e=>this.onValueChange(e)),this.registerListeners(),this.cursorSetter$.pipe(k(this.destroy$$)).subscribe(e=>setTimeout(()=>this.setCursorToPos(e))),this.value&&(this.onValueChange(this.value),setTimeout(()=>{this.rerender()})),this.querySelect.clickOutsideDropdown.subscribe(()=>{this.querySelect.hideDropdown()}),this.renderer2.listen(this.querySelect.inputElement.nativeElement,"focusout",e=>{this.querySelect.inputElement.nativeElement.parentElement.contains(e.currentTarget.parentElement)||setTimeout(()=>this.querySelect.hideDropdown())})}openOptions(){this.querySelect.isDropdownOpen||(this.selectControl.setValue(void 0),this.querySelect.showDropdown())}ngOnDestroy(){this.clearListeners(),this.destroy$$.next(),this.destroy$$.complete()}onKeyDown(e){e.key===this.KEY_ENTER_CODE&&(e.preventDefault(),this.querySelect.isDropdownOpen||this.submitQuery.emit())}onDrop(e){let t=e.dataTransfer?.getData("text");t&&t.length+this.value.length>this.maxLength&&(e.preventDefault(),this.toastService.error({message:"Query cannot exceed maximum length of "+this.maxLength+" characters."}))}onKeyUp(e){e.key!==this.KEY_ENTER_CODE&&this.updateCursor(e.target.selectionStart),e.key!==this.KEY_ESC_CODE&&this.openOptions(),e.key===this.KEY_ESC_CODE&&this.querySelect.hideDropdown()}onClick(e){this.updateCursor(e.target.selectionStart),this.openOptions()}itemSelected(e){this.helpItemSelected.emit({value:e.newValue.value})}get textarea(){return this.messageTextarea.nativeElement}get textareaHolder(){return this.messageTextareaHolder.nativeElement}scrollToCursor(){setTimeout(()=>{this.textarea.blur(),this.textarea.focus()})}pasteTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.value.length>this.maxLength&&(e.value=e.value.substr(0,this.maxLength)),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}onTextAreaScroll(e){this.scrollValue=e.target.scrollTop,this.textHighlightOverlayHolder.nativeElement.scrollTop=this.scrollValue,this.cd.markForCheck()}onValueChange(e){this.value=e,this.tokens=this.tokenizer.tokenizeText(this.bodyControl.value),this.focusedToken=this.tokens[this.getFocusedTokenIndex()],this.focusedTokenValue=this.focusedToken?this.focusedToken.value:"",this.openOptions(),this.rerender(),this.currentValue.emit({value:this.value,tokens:this.tokens})}setCursorToPos(e){this.textarea.focus(),this.textarea.setSelectionRange(e,e)}rerender(){this.textarea.style.height=this.textHighlightOverlay.container.scrollHeight+"px",this.highlightModel={value:this.value,tokens:this.tokens},setTimeout(()=>{let e=this.textHighlightOverlay.container.scrollHeight;this.highlightModel={value:this.value,tokens:this.tokens},this.textarea.style.height=e+"px",this.textAreaHeightChanged()&&(this.lastHeight=e,document.activeElement===this.textarea&&this.openOptions()),this.cd.detectChanges()})}getFocusedTokenIndex(){for(let e=0;e<this.tokens.length;e++)if(this.tokens[e].start<=this.cursorPosition&&this.tokens[e].end>=this.cursorPosition)return e;return-1}updateCursor(e){this.cursorPos.emit(e),this.cursorPosition=e;let t=this.getFocusedTokenIndex();this.focusedToken=this.tokens[t<0?this.tokens.length-1:t],this.focusedTokenValue=this.focusedToken?this.focusedToken.value:"",this.tokens.forEach(i=>{i.focused=i.start<=this.cursorPosition&&i.end>=this.cursorPosition}),this.rerender(),this.cursorCoords.emit(this.utils.getTextareaCaretCoordinates(this.textarea,this.textarea.selectionEnd))}textAreaHeightChanged(){return Number(this.textarea.style.height.split("px")[0])!==this.lastHeight}registerListeners(){let e=this.textareaHolder;e&&(e.addEventListener("scroll",this.ON_SCROLL_CALLBACK),e.addEventListener("paste",this.clearNewLinesOnPaste))}clearListeners(){let e=this.textareaHolder;e&&(e.removeEventListener("scroll",this.ON_SCROLL_CALLBACK),e.removeEventListener("paste",this.clearNewLinesOnPaste))}static{this.\u0275fac=function(t){return new(t||o)(v(M),v(he),v(J),v(ye),v(ve))}}static{this.\u0275cmp=I({type:o,selectors:[["nui-freetype-query-builder"]],viewQuery:function(t,i){if(t&1&&(m(He,7),m(De,5),m(Ve,5),m(Fe,5),m(V,5)),t&2){let n;g(n=f())&&(i.querySelect=n.first),g(n=f())&&(i.messageTextarea=n.first),g(n=f())&&(i.messageTextareaHolder=n.first),g(n=f())&&(i.textHighlightOverlayHolder=n.first),g(n=f())&&(i.textHighlightOverlay=n.first)}},hostAttrs:[1,"nui-freetype-query-builder"],inputs:{maxLength:"maxLength",readonly:"readonly",placeholder:"placeholder",value:"value",renderer:"renderer",tokenizer:"tokenizer",currentHelp:"currentHelp",cursorSetter$:"cursorSetter$"},outputs:{helpItemSelected:"helpItemSelected",currentValue:"currentValue",cursorPos:"cursorPos",cursorCoords:"cursorCoords",submitQuery:"submitQuery"},features:[Y([{provide:te,multi:!0,useExisting:F(()=>o)},{provide:ue,useExisting:F(()=>o),multi:!0}]),H],decls:5,vars:5,consts:[["queryselect",""],["customTemplate",""],["messageTextareaHolder",""],["messageTextarea",""],["textHighlightOverlayHolder",""],["placeholder","Select Item",1,"action",2,"z-index","1",3,"formControl","manualDropdownControl","displayValueTemplate"],[4,"ngFor","ngForOf"],["tabindex","-1",3,"displayValueContext","value",4,"ngIf"],["tabindex","-1",4,"ngIf"],["tabindex","-1",3,"displayValueContext","value"],[1,"d-inline-flex","align-items-center"],["class","mr-2",3,"icon",4,"ngIf"],["tabindex","-1",3,"innerHTML"],[1,"mr-2",3,"icon"],["tabindex","-1"],["size","extra-small",4,"ngIf"],["class","nui-select-v2-option-group--header",4,"ngIf"],[4,"ngIf"],["size","extra-small"],[1,"nui-select-v2-option-group--header"],["tabindex","-1",3,"displayValueContext","value",4,"ngFor","ngForOf"],["tabindex","-1",3,"innerHTML",4,"ngIf"],[1,"options-group"],["iconSize","small",3,"icon"],["tabindex","-1",1,"options-group__item"],[1,"freetype-query__content","custom-input-template"],[1,"freetype-query__form",3,"formGroup"],[1,"message-textarea__holder"],["spellcheck","false","type","text","formControlName","body",1,"message-textarea","form-control","input-control",3,"drop","keydown","keyup","click","placeholder","maxLength"],[1,"overlay-holder"],[3,"model","renderConfigurator"]],template:function(t,i){if(t&1&&(d(0,"nui-select-v2",5,0),y(2,Ke,3,3,"ng-container",6),u(),y(3,$e,11,8,"ng-template",null,1,X)),t&2){let n=R(4);l("formControl",i.selectControl)("manualDropdownControl",!0)("displayValueTemplate",n),a(2),l("ngForOf",i.readonly?Q(4,Ce):i.currentHelp)}},dependencies:[Z,ee,se,ie,ne,oe,ae,le,pe,me,ce,_e,ge,fe,V,de],styles:[`.freetype-query__content{position:relative;width:100%;border:solid 1px lightgray;border-radius:3px}.freetype-query__content .freetype-query__form{position:relative}.freetype-query__content .freetype-query__form .message-textarea__holder{max-height:117px;overflow:auto;font-family:monospace!important}.freetype-query__content .overlay-holder{position:absolute;overflow:auto;inset:0;z-index:-1;color:transparent;width:100%;font-size:13px;line-height:1.66666667}.freetype-query__content .message-overlay{box-sizing:border-box;font-family:monospace!important;word-break:break-word;max-height:calc(100% + 3px);overflow:auto;width:100%;color:transparent;font-size:13px;line-height:1.66666667;min-height:34px;border:1px solid transparent;padding:5px 10px;white-space:break-spaces}.freetype-query__content .message-textarea{white-space:break-spaces;overflow:hidden!important;resize:none;width:100%;z-index:1;background-color:transparent!important;padding:5px 10px;font-size:13px;box-sizing:border-box;font-family:monospace;max-width:100%;min-width:100%;line-height:22px;border:0 solid transparent}.freetype-query__content .message-textarea__container{z-index:1;font-family:monospace!important;background-color:transparent}.options-group{padding:5px 10px 0}.options-group__item{margin-left:5px}
`],encapsulation:2})}}return o})();export{D as a,Ge as b,ve as c,It as d};
