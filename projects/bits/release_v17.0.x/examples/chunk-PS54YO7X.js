import{$ as te,ia as m}from"./chunk-57V7DCE5.js";import{a as l}from"./chunk-O7UYP4LT.js";import{a as h}from"./chunk-QZPWCUUC.js";import{a as pe}from"./chunk-MNLBQFGT.js";import{a as ee}from"./chunk-M6W54X33.js";import{c as Z}from"./chunk-WLK22LTS.js";import{e as K,f as Y}from"./chunk-XAWZKRM7.js";import{a as ne}from"./chunk-ZR5STDHI.js";import{l as U,r as J}from"./chunk-EHNCPSLF.js";import{Eb as w,Gc as z,I as $,Oc as V,P as F,Pc as A,Qb as n,S as W,Tc as X,Wb as R,Xb as M,Yb as b,Yc as B,Zb as j,_b as G,aa as d,ac as L,ba as S,da as o,g as u,h as g,ia as D,mc as H,na as E,nb as s,q as _,tb as c,u as x,uc as C,v as f,vc as I,wc as T,xa as y,xc as q,ya as v,yc as P,zb as k,zc as Q}from"./chunk-MC3BMXIX.js";import{g as O,i as p}from"./chunk-VBFW7A5V.js";var re=O(pe()),ae=O(ne());function ce(r,N){r&1&&(j(0),P(1,` No results
`),G())}function le(r,N){if(r&1&&(R(0,"div")(1,"span",6),P(2),M()()),r&2){let e=N.item;s(2),Q(e.title)}}var he="https://www.googleapis.com/books/v1/volumes",oe=20,ie=(()=>{class r extends te{constructor(e,t){super(),this.logger=e,this.http=t,this.busy=new g(!1),this.cache=Array.from({length:0}),this.applyFilters$=new u,this.applyFilters$.pipe(d(i=>this.getData(i))).subscribe(i=>p(this,null,function*(){this.outputsSubject.next(yield this.getFilteredData(i))}))}getFilteredData(e){return p(this,null,function*(){return x(_(e).pipe(o(t=>{this.cache=this.cache.concat(t.books)}),f(t=>({result:{repeat:{itemsSource:this.cache},paginator:{total:t.totalItems}}}))))})}applyFilters(){return p(this,null,function*(){this.applyFilters$.next(this.getFilters())})}getData(e){return this.isNewSearchTerm(e.search)&&(this.cache=[]),this.http.get(he,{params:this.getRequestParams(e)}).pipe(o(()=>this.busy.next(!0)),F(300),f(t=>({books:t.items?.map(i=>({title:i.volumeInfo.title,authors:i.volumeInfo.authors?.join(", ")||""}))||[],totalItems:t.totalItems})),$(t=>(this.logger.error(t),_({books:[],totalItems:0}))),W(()=>{this.busy.next(!1),this.previousFilters=e}))}getRequestParams(e){return new K().set("startIndex",e.virtualScroll?.value?.start.toString()??"").set("maxResults",String(oe)).set("q",e.search?`intitle:${e.search.value}`:"_")}isNewSearchTerm(e){return!(0,ae.default)(e?.value)&&!(0,re.default)(e?.value,this.previousFilters?.search?.value)}static{this.\u0275fac=function(t){return new(t||r)(E(Z),E(Y))}}static{this.\u0275prov=D({token:r,factory:r.\u0275fac})}}return r})(),be=(()=>{class r{constructor(e,t,i){this.viewportManager=e,this.cd=t,this.dataSource=i,this.books$=new g([]),this.busy=!1,this.destroy$=new u}ngOnInit(){this.dataSource.busy.pipe(o(e=>{this.busy=e,this.cd.detectChanges()}),S(this.destroy$)).subscribe()}ngAfterViewInit(){this.registerFilters(),this.viewportManager.setViewport(this.repeat.viewportRef).observeNextPage$({pageSize:oe}).pipe(o(()=>{this.dataSource.applyFilters()}),d(()=>this.dataSource.outputsSubject.pipe(o(e=>{this.books$.next(e.result.repeat.itemsSource||[]),this.cd.detectChanges()}))),S(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSearch(){this.doSearch()}onCancelSearch(){this.doSearch()}doSearch(){this.viewportManager.reset({emitFirstPage:!1}),this.dataSource.applyFilters()}registerFilters(){this.dataSource.registerComponent({virtualScroll:{componentInstance:this.viewportManager},search:{componentInstance:this.search}})}static{this.\u0275fac=function(t){return new(t||r)(c(m),c(B),c(ie))}}static{this.\u0275cmp=k({type:r,selectors:[["nui-repeat-with-viewport-manager-example"]],viewQuery:function(t,i){if(t&1&&(C(l,5),C(h,5)),t&2){let a;I(a=T())&&(i.repeat=a.first),I(a=T())&&(i.search=a.first)}},standalone:!1,features:[z([m,ie])],decls:9,vars:11,consts:()=>{let e;return e=$localize`:␟b2f7b7a0ccfff43a2ebae08e6ba39d93be120b03␟6200922231175481486:Search book by title`,[["userItemTemplate",""],[1,"mb-2"],["placeholder",e,3,"search","cancel","value"],[4,"ngIf"],[2,"height","300px",3,"itemsSource","repeatItemTemplateRef","virtualScroll","itemSize"],["compactMode","true",3,"show"],[1,"nui-text-secondary"]]},template:function(t,i){if(t&1){let a=L();R(0,"div",1)(1,"nui-search",2),H("search",function(){return y(a),v(i.onSearch())})("cancel",function(){return y(a),v(i.onCancelSearch())}),M()(),w(2,ce,2,0,"ng-container",3),V(3,"async"),b(4,"nui-repeat",4),V(5,"async"),b(6,"nui-progress",5),w(7,le,3,1,"ng-template",null,0,X)}if(t&2){let a=q(8);s(),n("value",""),s(),n("ngIf",!i.busy&&A(3,7,i.books$).length===0),s(2),n("itemsSource",A(5,9,i.books$))("repeatItemTemplateRef",a)("virtualScroll",!0)("itemSize",30),s(2),n("show",i.busy)}},dependencies:[U,l,h,ee,J],encapsulation:2})}}return r})();export{ie as a,be as b};
