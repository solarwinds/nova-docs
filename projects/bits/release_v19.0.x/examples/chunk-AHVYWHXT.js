import{a as he,b as ge,c as fe,d as D,e as Ce,f as ve}from"./chunk-HK5JFI63.js";import{$ as me,B as de,D as ue,ia as E}from"./chunk-57V7DCE5.js";import{a as x}from"./chunk-O7UYP4LT.js";import{i as ae}from"./chunk-LF6XSF3V.js";import{a as _e}from"./chunk-HB6OB2ZQ.js";import{a as pe}from"./chunk-EP75EVMT.js";import{a as we}from"./chunk-MNLBQFGT.js";import{a as k}from"./chunk-VKEWGOOU.js";import{n as ce}from"./chunk-BEIUR5OZ.js";import{e as le,i as se}from"./chunk-LO2VWMBZ.js";import{a as P}from"./chunk-YILH52ZF.js";import{c as oe}from"./chunk-WLK22LTS.js";import{d as re}from"./chunk-OP3E7ERD.js";import{e as ie,f as ne}from"./chunk-XAWZKRM7.js";import{a as Te}from"./chunk-ZR5STDHI.js";import{l as te}from"./chunk-EHNCPSLF.js";import{$b as q,Ac as m,Eb as C,Gc as I,I as G,N as B,P as H,Qb as d,Sb as X,Tc as Y,Wb as a,Xb as s,Yb as v,Yc as Z,Zc as ee,ac as S,ba as W,da as z,g as $,hc as U,ia as Q,mc as f,na as y,nb as r,nc as p,q as F,qc as K,tb as c,u as V,uc as M,v as w,vc as b,wc as L,xa as h,xc as N,ya as g,yc as u,zb as O,zc as J}from"./chunk-MC3BMXIX.js";import{g as R,i as j}from"./chunk-VBFW7A5V.js";var xe=R(we()),Ee=R(Te());function ye(n,_){if(n&1&&(a(0,"cdk-nested-tree-node",5),v(1,"button",6),a(2,"div",7)(3,"span"),u(4),s(),a(5,"span"),u(6),s()()()),n&2){let e=_.$implicit;r(4),m("Node: ",e.name,""),r(2),m(" Status: ",e.status,"")}}function Oe(n,_){if(n&1){let e=S();a(0,"a",16),f("click",function(){h(e);let i=p().$implicit,o=p();return g(o.showAll(i))}),u(1),s()}if(n&2){let e=p().$implicit,t=p();r(),m("Show All (",t.nodesTotalItems[e.name],")")}}function Me(n,_){if(n&1){let e=S();a(0,"cdk-nested-tree-node",8,0)(2,"div",9),f("click",function(){let i=h(e).$implicit,o=N(1),l=p();return g(l.onToggleClick(i,o))}),v(3,"nui-icon",10),a(4,"span",11),u(5),s()(),a(6,"div",12)(7,"div",13),q(8,14),C(9,Oe,2,1,"a",15),s()()()}if(n&2){let e=_.$implicit,t=p();r(3),K("icon",t.treeControl.isExpanded(e)?"triangle-down":"triangle-right"),r(2),J(e.name),r(),X("nui-tree__body--collapsed",!t.treeControl.isExpanded(e)),d("@expandedState",t.treeControl.isExpanded(e)?"expanded":"collapsed"),r(),d("busy",e.isLoading),r(2),d("ngIf",e.hasChildren&&t.nodesTotalItems[e.name])}}function be(n,_){if(n&1&&(a(0,"div",7)(1,"span"),u(2),s(),a(3,"span"),u(4),s()()),n&2){let e=_.item;r(2),m("Node: ",e.name,""),r(2),m(" Status: ",e.status,"")}}var Le=function(n){return n.active="Active",n.down="Down",n}(Le||{}),Ne=[{name:"Nodes",hasChildren:!0,children:[{name:"Brno",hasChildren:!0,children:[]},{name:"Austin",hasChildren:!0,children:[]},{name:"Kyiv",hasChildren:!0,children:[]}]}],A=25,Ie="https://nova-pg.swdev.local/api/v1/servers",Se=(()=>{class n extends me{constructor(e,t){super(),this.logger=e,this.http=t,this.cache=Array.from({length:0})}getFilteredData(e){return j(this,null,function*(){return(this.filtersChanged(e,"status","location","search","sorter")||e.virtualScroll?.value.start===0)&&(this.cache=[]),V(this.getBackendData(e).pipe(z(i=>{this.cache=this.cache.concat(i.items)}),w(i=>({repeat:{itemsSource:this.cache},paginator:{total:i.count}}))))})}reset(){this.cache=[]}getRequestParams(e){let t=e.virtualScroll?.value??{start:0,end:0};return new ie().set("page",Math.ceil(t.start/A).toString()).set("pageSize",String(A)).set("searchField","location").set("searchContent",e.search?.value??"")}getBackendData(e){let t=this.getRequestParams(e);return this.http.get(Ie,{params:t}).pipe(H(300),w(i=>({items:i.items?.map(o=>({name:o.name,location:o.location,status:o.status}))||[],count:i.count})),G(i=>(this.logger.error(i),F({items:[],count:0}))))}filtersChanged(e,...t){for(let i=0;i<t.length;i++){let o=t[i],l=e[o];if(!(0,Ee.default)(l?.value)&&this.previousFilters&&!(0,xe.default)(l?.value,this.previousFilters[o]?.value))return!0}return!1}static{this.\u0275fac=function(t){return new(t||n)(y(oe),y(ne))}}static{this.\u0275prov=Q({token:n,factory:n.\u0275fac})}}return n})(),it=(()=>{class n{get activeDialogComponent(){return this.activeDialogRef.componentInstance}constructor(e,t,i,o){this.virtualScrollListDataSource=e,this.differ=t,this.eventBusService=i,this.dialogService=o,this.destroy$=new $,this.nodesTotalItems={},this.treeControl=new he(l=>l.children),this.dataSource=new ce(Ne),this.hasChild=(l,T)=>!!T.children}showAll(e){this.activeDialogRef=this.dialogService.open(Pe,{size:"sm"}),this.activeDialogComponent.items=[],this.activeDialogComponent.isLoading=!0,this.activeDialogComponent.cdRef.detectChanges(),this.setDsSearchFieldFor(e),this.subscribeToDialogScrolling(),this.activeDialogRef.closed$.subscribe(()=>{this.virtualScrollListDataSource.deregisterComponent("virtualScroll"),this.virtualScrollListDataSource.deregisterComponent("search"),this.virtualScrollListDataSource.reset()})}subscribeToDialogScrolling(){setTimeout(()=>{let e=this.activeDialogComponent.viewPortManager;this.virtualScrollListDataSource.registerComponent({virtualScroll:{componentInstance:e}}),e.observeNextPage$({pageSize:A}).pipe(W(this.destroy$)).subscribe(()=>{this.virtualScrollListDataSource.applyFilters(),this.virtualScrollListDataSource.outputsSubject.subscribe(t=>{if(!this.activeDialogComponent)return;let i=t.repeat.itemsSource;this.activeDialogComponent.items=i,this.activeDialogComponent.isLoading=!1,this.activeDialogComponent.cdRef.detectChanges()})})})}onToggleClick(e,t){this.eventBusService.getStream(le).next(new MouseEvent("click")),e.hasChildren&&e.children&&!e.children.length&&(e.isLoading=!0,this.setDsSearchFieldFor(e),this.virtualScrollListDataSource.applyFilters(),this.virtualScrollListDataSource.outputsSubject.pipe(B(1)).subscribe(i=>{let o=i.repeat,l=i.paginator,T=o.itemsSource,De=l.total;this.handleNodeTotalItems(e.name,De),this.handleNodeContent(e,t,T),e.isLoading=!1,this.virtualScrollListDataSource.deregisterComponent("search")}))}handleNodeTotalItems(e,t){this.nodesTotalItems[e]=t}handleNodeContent(e,t,i){e.children=[];let o=this.differ.find(e.children).create();e.children=i,t.nodeOutlet.first.viewContainer.clear(),this.cdkTree.renderNodeChanges(e.children,o,t.nodeOutlet.first.viewContainer,e)}setDsSearchFieldFor(e){this.virtualScrollListDataSource.registerComponent({search:{componentInstance:{getFilters:()=>({type:"search",value:e.name})}}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||n)(c(Se),c(ee),c(se),c(ue))}}static{this.\u0275cmp=O({type:n,selectors:[["nui-tree-show-all-dialog-example"]],viewQuery:function(t,i){if(t&1&&M(D,5),t&2){let o;b(o=L())&&(i.cdkTree=o.first)}},standalone:!1,features:[I([Se])],decls:4,vars:3,consts:[["nestedNode","cdkNestedTreeNode"],[2,"max-width","600px"],[1,"nui-tree",3,"dataSource","treeControl"],["class","nui-tree__leaf",4,"cdkTreeNodeDef"],["class","nui-tree__branch",4,"cdkTreeNodeDef","cdkTreeNodeDefWhen"],[1,"nui-tree__leaf"],["nui-button","","displayStyle","action","type","button","disabled",""],[1,"d-flex","justify-content-between","w-100"],[1,"nui-tree__branch"],["cdkTreeNodeToggle","",1,"nui-tree__header",3,"click"],[1,"nui-tree__header-icon",3,"icon"],[1,"nui-tree__header-title"],[1,"nui-tree__body"],["nui-busy","",2,"min-height","20px",3,"busy"],["cdkTreeNodeOutlet",""],["class","nui-tree__show-all",3,"click",4,"ngIf"],[1,"nui-tree__show-all",3,"click"]],template:function(t,i){t&1&&(a(0,"div",1)(1,"cdk-tree",2),C(2,ye,7,2,"cdk-nested-tree-node",3)(3,Me,10,7,"cdk-nested-tree-node",4),s()()),t&2&&(r(),d("dataSource",i.dataSource)("treeControl",i.treeControl),r(2),d("cdkTreeNodeDefWhen",i.hasChild))},dependencies:[Ce,fe,ve,D,ge,te,re,P,k],styles:[".nui-tree--expanded[_ngcontent-%COMP%]{padding-bottom:5px}.nui-tree__icon[_ngcontent-%COMP%]{align-items:center;align-self:flex-start;display:flex;flex-shrink:0;height:30px;justify-content:center;width:30px;margin-left:-7px}.nui-tree__header[_ngcontent-%COMP%]{align-items:center;border-radius:3px;cursor:pointer;display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}.nui-tree__header[_ngcontent-%COMP%]:hover{background-color:var(--nui-color-bg-transparent-hover,rgba(17, 17, 17, .05))}.nui-tree__header-title[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;-ms-text-overflow:ellipsis;-o-text-overflow:ellipsis;text-overflow:ellipsis;line-height:18px;font-size:13px;font-weight:600;color:#111;color:var(--nui-color-text-default,#111)}.nui-tree__header-icon[_ngcontent-%COMP%]{align-items:center;align-self:flex-start;display:flex;flex-shrink:0;height:30px;justify-content:center;width:30px}.nui-tree__header-content[_ngcontent-%COMP%]{align-items:center;display:flex;flex-grow:2;justify-content:flex-start;padding-left:5px;min-width:0;padding-right:5px}.nui-tree__header-content-icon[_ngcontent-%COMP%]{align-items:center;align-self:flex-start;flex-shrink:0;height:30px;justify-content:center;width:30px}.nui-tree__header-content--with-icon[_ngcontent-%COMP%]{padding-left:0}.nui-tree__header-content-wrapper[_ngcontent-%COMP%]{display:flex;flex-grow:2;min-width:0;width:100%}.nui-tree__header.nui-expander__header--empty.nui-expander__header[_ngcontent-%COMP%]{display:inline-flex}.nui-tree__header.nui-expander__header--empty[_ngcontent-%COMP%]   .nui-expander__header-content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.nui-tree__custom-header[_ngcontent-%COMP%]{width:100%}.nui-tree__custom-header--empty[_ngcontent-%COMP%]{display:flex;width:auto}.nui-tree__body[_ngcontent-%COMP%]{border:none;border-left:dotted 2px #d9d9d9;border-left:dotted 2px var(--nui-color-line-default, #d9d9d9);color:#111;color:var(--nui-color-text-default, #111);margin-left:14px;padding-left:14px}.nui-tree__body.hide-left-border[_ngcontent-%COMP%]{border-left:0}.nui-tree__body.ng-animating[_ngcontent-%COMP%], .nui-tree__body--collapsed[_ngcontent-%COMP%]{overflow:hidden}.nui-tree__leaf[_ngcontent-%COMP%]{display:flex;align-items:center}.nui-tree__invisible[_ngcontent-%COMP%]{display:none}.nui-tree[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]{min-height:20px}.nui-tree__show-all[_ngcontent-%COMP%]{margin-left:30px;cursor:pointer}"],data:{animation:[_e]}})}}return n})(),Pe=(()=>{class n{constructor(e,t,i){this.cdRef=e,this.viewPortManager=t,this.activeDialog=i,this.items=[],this.isLoading=!1,this.itemConfig={trackBy:(o,l)=>l?.name}}ngAfterViewInit(){this.viewPortManager.setViewport(this.repeat.viewportRef)}close(){this.activeDialog.close()}static{this.\u0275fac=function(t){return new(t||n)(c(Z),c(E),c(ae))}}static{this.\u0275cmp=O({type:n,selectors:[["nui-dialog-content-dialog-example"]],viewQuery:function(t,i){if(t&1&&M(x,5),t&2){let o;b(o=L())&&(i.repeat=o.first)}},inputs:{items:"items",isLoading:"isLoading"},standalone:!1,features:[I([E])],decls:9,vars:6,consts:()=>{let e;e=$localize`:␟eeb379308b8767b98aa0d27308f4f8dd6b46e559␟5892089246202495025:Dialog title`;let t;return t=$localize`:␟4dc1e9a4bbd21cf153990984cd4ecb4444117098␟6327967827692127661: Close `,[["repeatItemTemplate",""],t,["title",e,3,"closed"],["nui-busy","",3,"busy"],[1,"d-flex","flex-row"],[1,"virtual-scroll-list-repeat",3,"itemConfig","repeatItemTemplateRef","itemsSource","virtualScroll","itemSize"],["nui-button","","type","button",3,"click"],[1,"d-flex","justify-content-between","w-100"]]},template:function(t,i){if(t&1){let o=S();a(0,"nui-dialog-header",2),f("closed",function(){return h(o),g(i.close())}),s(),a(1,"div",3)(2,"div",4),v(3,"nui-repeat",5),s()(),a(4,"nui-dialog-footer")(5,"button",6),f("click",function(){return h(o),g(i.close())}),U(6,1),s()(),C(7,be,5,2,"ng-template",null,0,Y)}if(t&2){let o=N(8);r(),d("busy",i.isLoading),r(2),d("itemConfig",i.itemConfig)("repeatItemTemplateRef",o)("itemsSource",i.items)("virtualScroll",!0)("itemSize",30)}},dependencies:[P,de,pe,x,k],styles:[".virtual-scroll-list-repeat[_ngcontent-%COMP%]{height:400px}"],data:{animation:[]},changeDetection:0})}}return n})();export{Le as a,Ie as b,Se as c,it as d,Pe as e};
