import{a as I}from"./chunk-T336PPIV.js";import{c as d}from"./chunk-SHK7HRYS.js";import{c as p,f as u}from"./chunk-ZEY3WGPI.js";import{l as f}from"./chunk-IOE73CTL.js";import{a as t}from"./chunk-KNI7S7QC.js";import{ia as h,na as l}from"./chunk-MC3BMXIX.js";import{g as b}from"./chunk-VBFW7A5V.js";var m=b(f());var C=(()=>{class s{set scrollContainer(e){this._scrollContainer=e}get scrollContainer(){return this._scrollContainer||this.popup?.popupAreaContainer}constructor(e){this.live=e,this.keyControlItemsSource=!1}initKeyboardManager(){this.keyboardEventsManager=this.keyControlItemsSource?new u(this.menuPopup.menuItems).withVerticalOrientation():new u(this.menuItems).withVerticalOrientation(),this.keyboardEventsSubscription&&this.keyboardEventsSubscription.unsubscribe(),this.initKeyManagerHandlers(),this.menuOpenListener&&(this.menuOpenListenerSubscription=this.menuOpenListener.subscribe(()=>{this.keyboardEventsManager.setActiveItem(-1),this.live.announce(`
                    ${this.keyControlItemsSource?this.menuPopup.menuItems.length:this.menuItems.length} menu items available.`)}))}handleKeydown(e){this.popup.isOpen?this.handleOpenKeyDown(e):this.handleClosedKeyDown(e)}setActiveItem(e){this.keyboardEventsManager.setActiveItem(e)}getActiveItemIndex(){return this.keyboardEventsManager.activeItemIndex}initKeyManagerHandlers(){this.keyboardEventsSubscription=this.keyboardEventsManager.change.subscribe(e=>{this.popup.isOpen&&this.hasActiveItem()&&this.scrollActiveOptionIntoView({scrollContainer:this.scrollContainer||this.popup.popupAreaContainer,menuItemHeight:this.keyboardEventsManager.activeItem?.menuItem.nativeElement.offsetHeight,activeOptionIndex:e,menuGroups:this.menuGroups,menuItems:this.menuItems})})}shouldCloseOnEnter(){return this.keyboardEventsManager.activeItem instanceof(I||d)}hasActiveItem(){return(0,m.default)(this.keyboardEventsManager.activeItem)||(0,m.default)(this.keyboardEventsManager.activeItemIndex)?!1:this.keyboardEventsManager.activeItem&&this.keyboardEventsManager.activeItemIndex>=0}handleOpenKeyDown(e){if((e.code===t.ARROW_DOWN||e.code===t.ARROW_UP)&&(this.keyboardEventsManager.onKeydown(e),this.announceCurrentItem()),(e.code===t.PAGE_UP||e.code===t.HOME||e.metaKey&&e.code===t.ARROW_UP)&&(e.preventDefault(),this.keyboardEventsManager.onKeydown(e),this.keyboardEventsManager.setFirstItemActive(),this.announceCurrentItem()),(e.code===t.PAGE_DOWN||e.code===t.END||e.metaKey&&e.code===t.ARROW_DOWN)&&(e.preventDefault(),this.keyboardEventsManager.onKeydown(e),this.keyboardEventsManager.setLastItemActive(),this.announceCurrentItem()),this.keyboardEventsManager.activeItem?.menuItem?.nativeElement?.scrollIntoView({block:"nearest"}),!this.hasActiveItem()&&e.code===t.ENTER&&e.preventDefault(),this.hasActiveItem()&&e.code===t.ENTER){if(this.keyboardEventsManager.activeItem?.doAction(e),!this.shouldCloseOnEnter()){e.preventDefault();return}this.popup.toggleOpened(e)}(e.code===t.TAB||e.code===t.ESCAPE)&&this.popup.toggleOpened(e)}handleClosedKeyDown(e){this.shouldBePrevented(e)&&e.preventDefault(),e.code===t.ARROW_DOWN&&this.popup.toggleOpened(e)}shouldBePrevented(e){return e.code===t.ARROW_DOWN||e.code===t.ARROW_UP||e.code===t.ENTER}countGroupLabelsBeforeOption(e,n,i){if(i.length){let o=n.toArray(),r=i.toArray(),c=0;for(let a=0;a<e+1;a++)o[a].group&&o[a].group===r[c]&&c++;return c}return 0}getOptionScrollPosition(e,n,i,o){let r=e*n;return r<i?r:r+n>i+o?Math.max(0,r-o+n):i}scrollActiveOptionIntoView(e){let n=e.activeOptionIndex||0,i=this.countGroupLabelsBeforeOption(n,e.menuItems,e.menuGroups);e.scrollContainer.nativeElement.scrollTop=this.getOptionScrollPosition(n+i,e.menuItemHeight+4,e.scrollContainer.nativeElement.scrollTop,300)}announceCurrentItem(){this.live.announce(`Active item ${this.keyboardEventsManager?.activeItem?.menuItem.nativeElement.innerText}.`)}ngOnDestroy(){this.keyboardEventsSubscription&&this.keyboardEventsSubscription.unsubscribe(),this.menuOpenListenerSubscription&&this.menuOpenListenerSubscription.unsubscribe()}static{this.\u0275fac=function(n){return new(n||s)(l(p))}}static{this.\u0275prov=h({token:s,factory:s.\u0275fac})}}return s})();export{C as a};
