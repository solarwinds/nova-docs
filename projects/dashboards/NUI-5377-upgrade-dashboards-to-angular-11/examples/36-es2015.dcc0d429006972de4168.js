(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{kfUE:function(e,t,i){"use strict";i.r(t),i.d(t,"ManyWidgetsModule",function(){return K});var o=i("ofXK"),r=i("tk/3"),n=i("tyNb"),s=i("Rr1A"),a=i("gKry"),d=i("AgrY"),c=i("HNto"),l=i("A//S"),u=i("UJ+P"),b=i("U9RZ"),g=i("tghU"),h=i("k2eP"),p=i("rWRh"),f=i("mrSG"),m=i("2Vo4"),w=i("nYR2"),v=i("fXoL");let y=(()=>{class e extends s.g{constructor(e){super(),this.http=e,this.busy=new m.a(!1)}getFilteredData(){return Object(f.a)(this,void 0,void 0,function*(){this.busy.next(!0);const e=Math.floor(Math.random()*Math.floor(99))+1;return new Promise(t=>{this.http.get(`https://jsonplaceholder.typicode.com/todos/${e}`).pipe(Object(w.a)(()=>this.busy.next(!1))).subscribe({next:e=>{t({result:{value:e.id,label:e.title}})},error:e=>{t({result:null,error:{type:e.status}})}})})})}ngOnDestroy(){this.outputsSubject.complete()}}return e.providerId="AcmeKpiDataSource",e.mockError=!1,e.\u0275fac=function(t){return new(t||e)(v.fc(r.b))},e.\u0275prov=v.Lb({token:e,factory:e.\u0275fac}),e})();var S=i("QVEU"),C=i.n(S),I=i("XNiG"),U=i("IzEk"),W=i("1G5W"),D=i("BkRI"),T=i.n(D),j=i("D1y2"),x=i.n(j);const R=e=>({id:`${e}`,type:"kpi",pizzagna:{[a.Q.Configuration]:{header:{properties:{title:"KPI Widget!",subtitle:"A bunch of number boxes",collapsible:!0}},tiles:{providers:{},properties:{nodes:["kpi1"]}},kpi1:{id:"kpi1",providers:{[a.kb.DataSource]:{providerId:y.providerId},[a.kb.Adapter]:{providerId:a.I,properties:{componentId:"kpi1",propertyPath:"widgetData"}}}}}}}),[$,k]=function(e){const t=[],i={},o={cols:8,rows:6,y:0,x:0};for(let r=0;r<=15;r++){const e=`widget${r.toString()}`,n=R(e),s=i[`widget${(r-1).toString()}`],a=s?Object.assign(Object.assign({},s),{y:s.y+6}):o;t.push(n),i[e]=a}return[t,i]}();function V(e,t){if(1&e&&(v.Vb(0,"div",3),v.Vb(1,"div",4),v.Oc(2),v.Ub(),v.Ub()),2&e){const e=t.item;v.Db(2),v.Qc(" ",e.title," ")}}let z=(()=>{class e{constructor(e){this.widgetTypesService=e,this.widgetSelected=new v.o,this.widgetItems=[]}ngOnInit(){const e=new o.x;this.widgetItems=$.map(t=>({title:e.transform(t.type),widget:this.widgetTypesService.mergeWithWidgetType(t)})),$.forEach(e=>{this.addUnconfiguredWidgetWithConfigLayer(e)})}addUnconfiguredWidget(e){const t=(new o.x).transform(e);this.widgetItems.push({title:`Unconfigured ${t}`,widget:{id:`unconfigured${t}`,type:e,metadata:{needsConfiguration:!0},pizzagna:T()(this.widgetTypesService.getWidgetType(e).widget)}}),x()(this.widgetItems[this.widgetItems.length-1].widget.pizzagna,`${a.Q.Structure}.header.properties.title`,`Unconfigured ${t}`)}addUnconfiguredWidgetWithConfigLayer(e){const t=(new o.x).transform(e.type);this.widgetItems.push({title:`Unconfigured ${t} With Config Layer`,widget:Object.assign(Object.assign({},T()(this.widgetTypesService.mergeWithWidgetType(e))),{id:`unconfiguredWithConfigLayer${t}`,metadata:{needsConfiguration:!0}})}),x()(this.widgetItems[this.widgetItems.length-1].widget.pizzagna,`${a.Q.Configuration}.header.properties.title`,`Unconfigured ${t} With Config Layer`)}onSelect(e){this.widgetSelected.emit(e[0].widget),this.widgetSelection=e}}return e.lateLoadKey="AcmeCloneSelectionComponent",e.\u0275fac=function(t){return new(t||e)(v.Pb(a.nb))},e.\u0275cmp=v.Jb({type:e,selectors:[["acme-clone-selection"]],outputs:{widgetSelected:"widgetSelected"},decls:4,vars:3,consts:[[1,"nui-widget-cloner"],["selectionMode","singleWithRequiredSelection",3,"itemsSource","selection","repeatItemTemplateRef","selectionChange"],["widgetClonerItem",""],[1,"nui-widget-cloner__item","d-flex","pt-2","pb-2","align-items-center"],[1,"text-info","ml-3"]],template:function(e,t){if(1&e&&(v.Vb(0,"div",0),v.Vb(1,"nui-repeat",1),v.jc("selectionChange",function(e){return t.onSelect(e)}),v.Ub(),v.Ub(),v.Mc(2,V,3,1,"ng-template",null,2,v.Nc)),2&e){const e=v.Dc(3);v.Db(1),v.uc("itemsSource",t.widgetItems)("selection",t.widgetSelection)("repeatItemTemplateRef",e)}},directives:[s.tb],styles:[".nui-widget-cloner__item[_ngcontent-%COMP%]{height:60px}"]}),e})();function P(e,t){if(1&e&&(v.Vb(0,"div",3),v.Vb(1,"div",4),v.Oc(2),v.Ub(),v.Ub()),2&e){const e=t.item;v.Db(2),v.Qc(" ",e.title," ")}}let O=(()=>{class e extends z{constructor(e){super(e)}ngOnInit(){const e=new o.x;this.widgetItems=$.map(t=>({title:e.transform(t.type),widget:this.widgetTypesService.mergeWithWidgetType(t)}))}}return e.lateLoadKey="AcmeCloneSelectionComponent",e.\u0275fac=function(t){return new(t||e)(v.Pb(a.nb))},e.\u0275cmp=v.Jb({type:e,selectors:[["acme-clone-selection"]],features:[v.Ab],decls:4,vars:3,consts:[[1,"nui-widget-cloner"],["selectionMode","singleWithRequiredSelection",3,"itemsSource","selection","repeatItemTemplateRef","selectionChange"],["widgetClonerItem",""],[1,"nui-widget-cloner__item","d-flex","pt-2","pb-2","align-items-center"],[1,"text-info","ml-3"]],template:function(e,t){if(1&e&&(v.Vb(0,"div",0),v.Vb(1,"nui-repeat",1),v.jc("selectionChange",function(e){return t.onSelect(e)}),v.Ub(),v.Ub(),v.Mc(2,P,3,1,"ng-template",null,2,v.Nc)),2&e){const e=v.Dc(3);v.Db(1),v.uc("itemsSource",t.widgetItems)("selection",t.widgetSelection)("repeatItemTemplateRef",e)}},directives:[s.tb],styles:[".nui-widget-cloner__item[_ngcontent-%COMP%]{height:60px}"]}),e})(),L=(()=>{class e{constructor(e){this.toastService=e,this.allowSubmit=!0,this.allowRemoval=!0,this.trySubmit=(e,t)=>{const i=new I.a;return setTimeout(()=>{if(this.allowSubmit)i.next(e);else{const e=$localize`Submit failed.`;this.toastService.error({title:e}),i.error(e)}},1e3),i.asObservable()},this.tryRemove=e=>{const t=new I.a;return setTimeout(()=>{if(this.allowRemoval)t.next(e);else{const e=$localize`Widget removal failed.`;this.toastService.error({title:e}),t.error(e)}},200),t.asObservable()},this.toastService.setConfig({timeOut:2e3})}}return e.\u0275fac=function(t){return new(t||e)(v.fc(s.Yb))},e.\u0275prov=v.Lb({token:e,factory:e.\u0275fac}),e})();var M=i("sleA"),A=i("MJAs");const E=[{path:"",component:(()=>{class e{constructor(e,t,i,o,n){this.providerRegistry=e,this.submitHandler=t,this.widgetTypesService=i,this.widgetClonerService=o,this.refreshSettings=n,this.dashboard={positions:{},widgets:{}},this.gridsterConfig={minCols:12,maxCols:12,minRows:12},this.editMode=!1,this.systemRefreshInterval=60,this.belowFoldLazyLoadingConfig={enabled:!0},this.destroy$=new I.a,this.providerRegistry.setProviders({[y.providerId]:{provide:a.b,useClass:y,deps:[r.b]}})}ngOnInit(){var e,t;null===(t=null===(e=this.widgetTypesService.getWidgetType("table").configurator)||void 0===e?void 0:e[a.Q.Structure].presentation.properties)||void 0===t||t.nodes.push("refresher"),this.refreshSettings.refreshRateSeconds=this.systemRefreshInterval;const i=$.map(e=>this.widgetTypesService.mergeWithWidgetType(e)),o=C()(i,e=>e.id);this.dashboard={positions:k,widgets:o}}onDsErrorSwitch(e){y.mockError=e}onShowButtonSwitch(e,t){for(const i of Object.keys(this.dashboard.widgets))this.dashboard=Object(s.fc)(this.dashboard,`widgets.${i}.pizzagna.configuration.header.properties.${t}`,e)}ngAfterViewInit(){this.dashboardComponent.eventBus.subscribeUntil(a.fb,this.destroy$,e=>{this.widgetClonerService.open({widget:this.dashboard.widgets[e.widgetId],dashboardComponent:this.dashboardComponent,trySubmit:this.submitHandler.trySubmit,widgetSelectionComponentType:O}).pipe(Object(U.a)(1),Object(W.a)(this.destroy$)).subscribe()})}onCloneWidget(){this.widgetClonerService.open({dashboardComponent:this.dashboardComponent,trySubmit:this.submitHandler.trySubmit,widgetSelectionComponentType:z}).pipe(Object(U.a)(1),Object(W.a)(this.destroy$)).subscribe()}onEditWithCloner(){this.dashboardComponent.eventBus.next(a.fb,{widgetId:$[0].id})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSystemRefreshIntervalClick(){this.refreshSettings.refreshRateSeconds=this.systemRefreshInterval}}return e.\u0275fac=function(t){return new(t||e)(v.Pb(a.V),v.Pb(L),v.Pb(a.nb),v.Pb(a.lb),v.Pb(a.X))},e.\u0275cmp=v.Jb({type:e,selectors:[["many-widgets-dashboard-dashboard"]],viewQuery:function(e,t){if(1&e&&v.Sc(a.k,3),2&e){let e;v.Cc(e=v.kc())&&(t.dashboardComponent=e.first)}},features:[v.Cb([L])],decls:25,vars:11,consts:function(){let e,t,i,o,r,n,s,a,d,c;return e=$localize`:␟08a1b409eac8269dd4dce8a2b3bd976356ba40ee␟7260316479095556147:Create Widget Clone`,t=$localize`:␟4e17d1961186f54a679f7623cd03e5c49c411f65␟639090956363340116:Simulate edit with cloner`,i=$localize`:␟c0390f914462a77b0ab8e053abf7c77af5b1da81␟6640158718767573444: Edit mode `,o=$localize`:␟db70aaa4da7a9f7c0fa3a218907f9fa354a19038␟5855643886473775120: Allow Submit `,r=$localize`:␟d289dfdc6c4e23b49a96db083f95f1087ed1400a␟3687117978364204872: Allow Removal `,n=$localize`:␟3299af3b186d7701f4c0626e41eba58af8382723␟4106211393112768148: Show Edit Button `,s=$localize`:␟30251ad3dcd7facd3a222d48fb2ba02f8503c52c␟8096484277280346189: Show Remove Button `,a=$localize`:␟c355f0feb3f72b3594e6e975456cd0a2dac1d929␟870224976565315483: Data Source Error `,d=$localize`:␟90504d9af68fb3aa81accb4bc3005526deb04093␟5488473345097746222:System refresh interval (seconds)`,c=$localize`:␟4de55e520d95a021a3b6dcb94b34b5b2364abef8␟1472280137824054907:Update system refresh interval `,[["type","button","nui-button","",1,"mb-3","ml-4",3,"click"],e,t,[1,"w-100",2,"height","725px"],[3,"nuiWidgetEditor","dashboard","gridsterConfig","editMode","belowFoldLazyLoadingConfig","dashboardChange","gridsterConfigChange"],[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"value","valueChange"],i,o,r,n,s,[1,"ml-3",3,"valueChange"],a,[1,"d-flex","flex-row"],[2,"width","300px"],["caption",d],[3,"value","valueChange"],["type","button","nui-button","",1,"ml-4",3,"click"],c]},template:function(e,t){1&e&&(v.Vb(0,"button",0),v.jc("click",function(){return t.onCloneWidget()}),v.Zb(1,1),v.Ub(),v.Vb(2,"button",0),v.jc("click",function(){return t.onEditWithCloner()}),v.Zb(3,2),v.Ub(),v.Vb(4,"div",3),v.Vb(5,"nui-dashboard",4),v.jc("dashboardChange",function(e){return t.dashboard=e})("gridsterConfigChange",function(e){return t.gridsterConfig=e}),v.Ub(),v.Ub(),v.Vb(6,"div",5),v.Vb(7,"nui-switch",6),v.jc("valueChange",function(e){return t.editMode=e}),v.Zb(8,7),v.Ub(),v.Vb(9,"nui-switch",6),v.jc("valueChange",function(e){return t.submitHandler.allowSubmit=e}),v.Zb(10,8),v.Ub(),v.Vb(11,"nui-switch",6),v.jc("valueChange",function(e){return t.submitHandler.allowRemoval=e}),v.Zb(12,9),v.Ub(),v.Vb(13,"nui-switch",6),v.jc("valueChange",function(e){return t.onShowButtonSwitch(e,"editable")}),v.Zb(14,10),v.Ub(),v.Vb(15,"nui-switch",6),v.jc("valueChange",function(e){return t.onShowButtonSwitch(e,"removable")}),v.Zb(16,11),v.Ub(),v.Vb(17,"nui-switch",12),v.jc("valueChange",function(e){return t.onDsErrorSwitch(e)}),v.Zb(18,13),v.Ub(),v.Ub(),v.Vb(19,"div",14),v.Vb(20,"div",15),v.Vb(21,"nui-form-field",16),v.Vb(22,"nui-textbox-number",17),v.jc("valueChange",function(e){return t.systemRefreshInterval=e}),v.Ub(),v.Ub(),v.Ub(),v.Vb(23,"button",18),v.jc("click",function(){return t.onSystemRefreshIntervalClick()}),v.Zb(24,19),v.Ub(),v.Ub()),2&e&&(v.Db(5),v.uc("nuiWidgetEditor",t.submitHandler)("dashboard",t.dashboard)("gridsterConfig",t.gridsterConfig)("editMode",t.editMode)("belowFoldLazyLoadingConfig",t.belowFoldLazyLoadingConfig),v.Db(2),v.uc("value",t.editMode),v.Db(2),v.uc("value",t.submitHandler.allowSubmit),v.Db(2),v.uc("value",t.submitHandler.allowRemoval),v.Db(2),v.uc("value",!0),v.Db(2),v.uc("value",!0),v.Db(7),v.uc("value",t.systemRefreshInterval))},directives:[s.b,M.a,A.a,s.Fb,s.n,s.Sb],styles:[".nui-theme-switcher-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;padding:10px;background-color:var(--nui-color-bg-light,#fff)}"]}),e})(),data:{srlc:{hideIndicator:!0},showThemeSwitcher:!0}}];let K=(()=>{class e{constructor(e,t){this.widgetTypesService=e,this.componentRegistry=t,this.setupDataSourceProviders(),this.setupCustomProportionalWidgetDSConfig()}setupCustomProportionalWidgetDSConfig(){var e;const t=this.widgetTypesService.getWidgetType("proportional",1);null===(e=t.widget.structure[a.g].providers)||void 0===e||delete e.refresher,this.widgetTypesService.setNode(t,"configurator",a.jb.DataSourceConfigComponentType,d.a.lateLoadKey),this.componentRegistry.registerByLateLoadKey(d.a)}setupDataSourceProviders(){this.setDataSourceProviders("table",[l.a.providerId,u.a.providerId,b.a.providerId,h.a.providerId,g.a.providerId]);const e=this.widgetTypesService.getWidgetType("kpi",1);this.widgetTypesService.setNode(e,"configurator",a.jb.DataSourceConfigComponentType,a.l.lateLoadKey),this.setDataSourceProviders("kpi",[{providerId:y.providerId,label:"Acme KPI Data Source 1"}]),this.setDataSourceProviders("proportional",[c.a.providerId,c.b.providerId]),this.setDataSourceProviders("timeseries",[p.a.providerId,p.b.providerId])}setDataSourceProviders(e,t){const i=this.widgetTypesService.getWidgetType(e,1);this.widgetTypesService.setNode(i,"configurator",a.jb.DataSourceProviders,t)}}return e.\u0275mod=v.Nb({type:e}),e.\u0275inj=v.Mb({factory:function(t){return new(t||e)(v.fc(a.nb),v.fc(a.a))},providers:[a.V],imports:[[o.c,r.c,a.N,s.z,s.A,s.F,s.Z,s.J,s.K,s.T,n.d.forChild(E),s.I,s.bb]]}),e})()}}]);