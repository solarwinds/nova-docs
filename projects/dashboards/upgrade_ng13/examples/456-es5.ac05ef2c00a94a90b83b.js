!function(){"use strict";var e,t,r,i,n,o;function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,i=d(e);if(t){var n=d(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return c(this,r)}}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(self.webpackChunk_nova_ui_dashboards=self.webpackChunk_nova_ui_dashboards||[]).push([[456],{56456:function(s,c,d){var h,v;d.r(c),d.d(c,{PersistenceHandlerSetupModule:function(){return j}});var b=d(38583),m=d(91841),Z=d(99763),y=d(46806),w=d(69063),_=d(33018),T=d(64762),A=d(79765),k=d(26215),q=d(68939),U=d(46276),C=d(54607);function x(e,t){if(1&e){var r=_.EpF();_.TgZ(0,"button",6),_.NdJ("click",function(){return _.CHM(r),_.oxw().reInitializeDashboard()}),_.SDv(1,7),_.qZA()}}function I(e,t){if(1&e){var r=_.EpF();_.TgZ(0,"nui-dashboard",8),_.NdJ("dashboardChange",function(e){return _.CHM(r),_.oxw().dashboard=e})("gridsterConfigChange",function(e){return _.CHM(r),_.oxw().gridsterConfig=e}),_.qZA()}if(2&e){var i=_.oxw();_.Q6J("dashboard",i.dashboard)("gridsterConfig",i.gridsterConfig)("editMode",i.editMode)("nuiWidgetEditor",i.persistenceHandler)}}var S,D=((S=f(function n(o){var a=this;g(this,n),this.toastService=o,this.persistenceSucceeded=!0,this.trySubmit=function(r){var i=new A.xQ;return r.id||(r.id=(0,y.VjN)()),setTimeout(function(){if(a.persistenceSucceeded)i.next(r),a.toastService.success({title:$localize(e||(e=p(["Submit succeeded."])))});else{var n=$localize(t||(t=p(["Submit failed."])));a.toastService.error({title:n}),i.error(n)}i.complete()},1e3),i.asObservable()},this.tryRemove=function(e){var t=new A.xQ;return setTimeout(function(){if(a.persistenceSucceeded)t.next(e),a.toastService.success({title:$localize(r||(r=p(["Removal succeeded."])))});else{var n=$localize(i||(i=p(["Removal failed."])));a.toastService.error({title:n}),t.error(n)}t.complete()},1e3),t.asObservable()},this.toastService.setConfig({timeOut:2e3})})).\u0275fac=function(e){return new(e||S)(_.LFG(y.klp))},S.\u0275prov=_.Yz7({token:S,factory:S.\u0275fac}),S),O=function(){var e=function(){function e(t,r,i,n){g(this,e),this.widgetTypesService=t,this.providerRegistry=r,this.persistenceHandler=i,this.changeDetectorRef=n,this.gridsterConfig={},this.editMode=!1}return f(e,[{key:"ngOnInit",value:function(){var e,t=this.widgetTypesService.getWidgetType("kpi",1);this.widgetTypesService.setNode(t,"configurator",w.ACc.DataSourceProviders,[R.providerId,P.providerId]),this.providerRegistry.setProviders((l(e={},R.providerId,{provide:w.Fk3,useClass:R,deps:[m.eN]}),l(e,P.providerId,{provide:w.Fk3,useClass:P,deps:[m.eN]}),e)),this.initializeDashboard()}},{key:"reInitializeDashboard",value:function(){this.dashboard=void 0,this.changeDetectorRef.detectChanges(),this.initializeDashboard()}},{key:"initializeDashboard",value:function(){var e=z,t=l({},e.id,this.widgetTypesService.mergeWithWidgetType(e));this.dashboard={positions:l({},e.id,{cols:4,rows:6,y:0,x:0}),widgets:t}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(w.xTe),_.Y36(w.CNH),_.Y36(D),_.Y36(_.sBO))},e.\u0275cmp=_.Xpm({type:e,selectors:[["persistence-handler-setup"]],features:[_._Bn([D])],decls:6,vars:3,consts:function(){return[[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"value","valueChange"],$localize(n||(n=p([":\u241f8c375764db42f5d736fb56d01b8052c006ccc8e2\u241f6407712033679505505:Edit Mode"]))),["type","button","displayStyle","action","nui-button","",3,"click",4,"ngIf"],[1,"w-100","dashboard"],[3,"dashboard","gridsterConfig","editMode","nuiWidgetEditor","dashboardChange","gridsterConfigChange",4,"ngIf"],["type","button","displayStyle","action","nui-button","",3,"click"],$localize(o||(o=p([":\u241f6bef99833bf531d3dc3b38c9224d8ad0ce79633f\u241f5929909870970197239:Restore Widget"]))),[3,"dashboard","gridsterConfig","editMode","nuiWidgetEditor","dashboardChange","gridsterConfigChange"]]},template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"nui-switch",1),_.NdJ("valueChange",function(e){return t.editMode=e}),_.SDv(2,2),_.qZA(),_.YNc(3,x,2,0,"button",3),_.qZA(),_.TgZ(4,"div",4),_.YNc(5,I,1,4,"nui-dashboard",5),_.qZA()),2&e&&(_.xp6(1),_.Q6J("value",t.editMode),_.xp6(2),_.Q6J("ngIf",!(null!=t.dashboard&&t.dashboard.widgets.widget1)),_.xp6(2),_.Q6J("ngIf",t.dashboard))},directives:[y.qUD,b.O5,y.r0F,U.M,C.t],styles:[".dashboard[_ngcontent-%COMP%]{height:800px}"]}),e}(),R=function(){var e=function(e){a(r,e);var t=u(r);function r(e){var i;return g(this,r),(i=t.call(this)).http=e,i.busy=new k.X(!1),i}return f(r,[{key:"getFilteredData",value:function(){return(0,T.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.busy.next(!0),new Promise(function(e){t.http.get("https://www.googleapis.com/books/v1/volumes/5MQFrgEACAAJ").pipe((0,q.x)(function(){return t.busy.next(!1)})).subscribe({next:function(t){e({result:{value:t.volumeInfo.averageRating}})},error:function(t){e({result:null,error:{type:t.status}})}})})));case 1:case"end":return e.stop()}},e,this)}))}},{key:"ngOnDestroy",value:function(){this.outputsSubject.complete()}}]),r}(y.LvN);return e.providerId="AverageRatingKpiDataSource",e.\u0275fac=function(t){return new(t||e)(_.LFG(m.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac}),e}(),P=function(){var e=function(e){a(r,e);var t=u(r);function r(e){var i;return g(this,r),(i=t.call(this)).http=e,i.busy=new k.X(!1),i}return f(r,[{key:"getFilteredData",value:function(){return(0,T.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.busy.next(!0),new Promise(function(e){t.http.get("https://www.googleapis.com/books/v1/volumes/5MQFrgEACAAJ").pipe((0,q.x)(function(){return t.busy.next(!1)})).subscribe({next:function(t){e({result:{value:t.volumeInfo.ratingsCount}})},error:function(t){e({result:null,error:{type:t.status}})}})})));case 1:case"end":return e.stop()}},e,this)}))}},{key:"ngOnDestroy",value:function(){this.outputsSubject.complete()}}]),r}(y.LvN);return e.providerId="RatingsCountKpiDataSource",e.\u0275fac=function(t){return new(t||e)(_.LFG(m.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac}),e}(),z={id:"widget1",type:"kpi",pizzagna:l({},w.xW5.Configuration,(v={},l(v,w.XMI,{providers:l({},w.Muk.Refresher,{properties:{interval:600,enabled:!0}})}),l(v,"header",{properties:{title:"Harry Potter and the Sorcerer's Stone",subtitle:"By J. K. Rowling"}}),l(v,"tiles",{properties:{nodes:["kpi1"]}}),l(v,"kpi1",{id:"kpi1",componentType:w.ufE.lateLoadKey,properties:{widgetData:{units:"out of 5 Stars",label:"Average Rating"}},providers:(h={},l(h,w.Muk.DataSource,{providerId:R.providerId}),l(h,w.Muk.Adapter,{providerId:w.u1$,properties:{componentId:"kpi1",propertyPath:"widgetData"}}),h)}),v))},M=[{path:"",component:function(){var e=f(function e(){g(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["nui-dashboard-persistence-handler-setup-docs"]],decls:90,vars:3,consts:[["href","../directives/WidgetEditorDirective.html","target","_blank"],["href","../additional-documentation/getting-started.html","target","_parent"],["href","../interfaces/IDashboardPersistenceHandler.html","target","_blank"],["type","info",3,"allowDismiss"],["href","../interfaces/IWidget.html","target","_blank"],["href","../interfaces/IConfiguratorSource.html","target","_blank"],["href","../components/DashboardComponent.html","target","_blank"],["filenamePrefix","persistence-handler-setup.component","exampleTitle","Adding a persistence handler"]],template:function(e,t){1&e&&(_.TgZ(0,"h1"),_._uU(1,"Persistence"),_.qZA(),_.TgZ(2,"p"),_._uU(3," In this tutorial we'll cover how to add a persistence handler by binding it to the nuiWidgetEditor directive. The persistence handler will allow you to run any persistence or other logic before the editor form workflow is completed or before a widget is removed from the dashboard. For simplicity's sake, in this tutorial we won't perform any actual persistence. Instead, we'll display a toast from each of the handler callbacks to indicate mock success after a one-second timeout.\n"),_.qZA(),_.TgZ(4,"h2"),_._uU(5,"Fundamental Concepts"),_.qZA(),_.TgZ(6,"ul"),_.TgZ(7,"li"),_.TgZ(8,"a",0),_.TgZ(9,"code"),_._uU(10,"nuiWidgetEditor"),_.qZA(),_.qZA(),_._uU(11,"directive "),_.qZA(),_.TgZ(12,"li"),_._uU(13,"Persistence handler"),_.qZA(),_.qZA(),_.TgZ(14,"h2"),_._uU(15,"Basic Steps"),_.qZA(),_.TgZ(16,"ol"),_.TgZ(17,"li"),_._uU(18," Follow the instructions "),_.TgZ(19,"a",1),_._uU(20,"here"),_.qZA(),_._uU(21," to set up your environment for dashboard development. "),_.qZA(),_.TgZ(22,"li"),_._uU(23," Follow the instructions from previous tutorials to get a basic dashboard up and running. "),_.qZA(),_.TgZ(24,"li"),_._uU(25," Create a persistence handler class which implements "),_.TgZ(26,"a",2),_.TgZ(27,"code"),_._uU(28,"IDashboardPersistenceHandler"),_.qZA(),_.qZA(),_._uU(29,". To realize the interface, the class may have a "),_.TgZ(30,"code"),_._uU(31,"trySubmit"),_.qZA(),_._uU(32," and/or a "),_.TgZ(33,"code"),_._uU(34,"tryRemove"),_.qZA(),_._uU(35," method. "),_.TgZ(36,"nui-message",3),_.TgZ(37,"b"),_._uU(38,"Note:"),_.qZA(),_._uU(39," It's recommended to implement the persistence handler as a separate class in its own file. It can be added to the providers list of either the dashboard component itself or a parent module. "),_.qZA(),_.qZA(),_.TgZ(40,"li"),_._uU(41," Ensure that the "),_.TgZ(42,"code"),_._uU(43,"NuiToastModule"),_.qZA(),_._uU(44," is included in the imports of the module that contains the persistence handler. "),_.TgZ(45,"nui-message",3),_.TgZ(46,"strong"),_._uU(47,"Note:"),_.qZA(),_._uU(48," Importing "),_.TgZ(49,"code"),_._uU(50,"NuiToastModule"),_.qZA(),_._uU(51," is required in this example because, in this case, the persistence handler uses the "),_.TgZ(52,"code"),_._uU(53,"ToastService"),_.qZA(),_._uU(54,". "),_.qZA(),_.qZA(),_.TgZ(55,"li"),_._uU(56," Implement a "),_.TgZ(57,"code"),_._uU(58,"trySubmit"),_.qZA(),_._uU(59," method that will be invoked as a callback anytime the widget editor form gets submitted. The parameters of the callback are the updated "),_.TgZ(60,"a",4),_.TgZ(61,"code"),_._uU(62,"IWidget"),_.qZA(),_.qZA(),_._uU(63," and the "),_.TgZ(64,"a",5),_.TgZ(65,"code"),_._uU(66,"IConfiguratorSource"),_.qZA(),_.qZA(),_._uU(67," which contains a reference to the "),_.TgZ(68,"a",6),_.TgZ(69,"code"),_._uU(70,"DashboardComponent"),_.qZA(),_.qZA(),_._uU(71," and an object containing the original state of the IWidget being edited. Its expected return value is an observable that resolves to the updated "),_.TgZ(72,"a",4),_.TgZ(73,"code"),_._uU(74,"IWidget"),_.qZA(),_.qZA(),_._uU(75," if persistence is successful. "),_.qZA(),_.TgZ(76,"li"),_._uU(77," Implement a "),_.TgZ(78,"code"),_._uU(79,"tryRemove"),_.qZA(),_._uU(80," method that will be invoked as a callback anytime there's a widget removal attempt. The parameter of the callback is the string id of the widget being removed. Its expected return value is an observable that resolves to the same id of the removed widget if persistence is successful. "),_.qZA(),_.TgZ(81,"li"),_._uU(82,"In your template, assign the injected instance of the persistence handler to the "),_.TgZ(83,"code"),_._uU(84,"nuiWidgetEditor"),_.qZA(),_._uU(85," directive."),_.qZA(),_.qZA(),_.TgZ(86,"nui-message",3),_._uU(87," For more detailed information about setting up a persistence handler, take a look at the inline comments under the source expander of the following example.\n"),_.qZA(),_.TgZ(88,"nui-example-wrapper",7),_._UZ(89,"persistence-handler-setup"),_.qZA()),2&e&&(_.xp6(36),_.Q6J("allowDismiss",!1),_.xp6(9),_.Q6J("allowDismiss",!1),_.xp6(41),_.Q6J("allowDismiss",!1))},directives:[y.qqZ,y.hD2,O],encapsulation:2}),e}(),data:{srlc:{hideIndicator:!0},showThemeSwitcher:!0}},{path:"example",component:O,data:{srlc:{hideIndicator:!0}}}],j=function(){var e=f(function e(){g(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({imports:[[b.ez,m.JF,w.Pi,y.vvu,y.gkT,y.cJ5,y.tez,y.Az_,Z.Bz.forChild(M)]]}),e}()}}])}();