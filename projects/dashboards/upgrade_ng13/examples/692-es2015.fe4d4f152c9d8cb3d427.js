"use strict";(self.webpackChunk_nova_ui_dashboards=self.webpackChunk_nova_ui_dashboards||[]).push([[692],{55692:function(e,t,i){i.r(t),i.d(t,{ManyWidgetsModule:function(){return P}});var o=i(38583),r=i(91841),n=i(99763),s=i(46806),d=i(69063),a=i(93877),c=i(40837),l=i(5596),u=i(33618),g=i(85631),h=i(6376),p=i(55350),f=i(55206),m=i(64762),v=i(26215),w=i(68939),b=i(33018);let S=(()=>{class e extends s.LvN{constructor(e){super(),this.http=e,this.busy=new v.X(!1)}getFilteredData(){return(0,m.mG)(this,void 0,void 0,function*(){this.busy.next(!0);const e=Math.floor(Math.random()*Math.floor(99))+1;return new Promise(t=>{this.http.get(`https://jsonplaceholder.typicode.com/todos/${e}`).pipe((0,w.x)(()=>this.busy.next(!1))).subscribe({next:e=>{t({result:{value:e.id,label:e.title}})},error:e=>{t({result:null,error:{type:e.status}})}})})})}ngOnDestroy(){this.outputsSubject.complete()}}return e.providerId="AcmeKpiDataSource",e.mockError=!1,e.\u0275fac=function(t){return new(t||e)(b.LFG(r.eN))},e.\u0275prov=b.Yz7({token:e,factory:e.\u0275fac}),e})();var y=i(59311),C=i.n(y),T=i(79765),I=i(15257),x=i(46782),Z=i(37524),W=i.n(Z),A=i(12666),$=i.n(A);const z=e=>({id:`${e}`,type:"kpi",pizzagna:{[d.xW5.Configuration]:{header:{properties:{title:"KPI Widget!",subtitle:"A bunch of number boxes",collapsible:!0}},tiles:{providers:{},properties:{nodes:["kpi1"]}},kpi1:{id:"kpi1",providers:{[d.Muk.DataSource]:{providerId:S.providerId},[d.Muk.Adapter]:{providerId:d.u1$,properties:{componentId:"kpi1",propertyPath:"widgetData"}}}}}}}),[D,q]=function(e){const t=[],i={},o={cols:8,rows:6,y:0,x:0};for(let r=0;r<=15;r++){const e=`widget${r.toString()}`,n=z(e),s=i[`widget${(r-1).toString()}`],d=s?Object.assign(Object.assign({},s),{y:s.y+6}):o;t.push(n),i[e]=d}return[t,i]}();function R(e,t){if(1&e&&(b.TgZ(0,"div",3),b.TgZ(1,"div",4),b._uU(2),b.qZA(),b.qZA()),2&e){const e=t.item;b.xp6(2),b.hij(" ",e.title," ")}}let k=(()=>{class e{constructor(e){this.widgetTypesService=e,this.widgetSelected=new b.vpe,this.widgetItems=[]}ngOnInit(){const e=new o.rS;this.widgetItems=D.map(t=>({title:e.transform(t.type),widget:this.widgetTypesService.mergeWithWidgetType(t)})),D.forEach(e=>{this.addUnconfiguredWidgetWithConfigLayer(e)})}addUnconfiguredWidget(e){const t=(new o.rS).transform(e);this.widgetItems.push({title:`Unconfigured ${t}`,widget:{id:`unconfigured${t}`,type:e,metadata:{needsConfiguration:!0},pizzagna:W()(this.widgetTypesService.getWidgetType(e).widget)}}),$()(this.widgetItems[this.widgetItems.length-1].widget.pizzagna,`${d.xW5.Structure}.header.properties.title`,`Unconfigured ${t}`)}addUnconfiguredWidgetWithConfigLayer(e){const t=(new o.rS).transform(e.type);this.widgetItems.push({title:`Unconfigured ${t} With Config Layer`,widget:Object.assign(Object.assign({},W()(this.widgetTypesService.mergeWithWidgetType(e))),{id:`unconfiguredWithConfigLayer${t}`,metadata:{needsConfiguration:!0}})}),$()(this.widgetItems[this.widgetItems.length-1].widget.pizzagna,`${d.xW5.Configuration}.header.properties.title`,`Unconfigured ${t} With Config Layer`)}onSelect(e){this.widgetSelected.emit(e[0].widget),this.widgetSelection=e}}return e.lateLoadKey="AcmeCloneSelectionComponent",e.\u0275fac=function(t){return new(t||e)(b.Y36(d.xTe))},e.\u0275cmp=b.Xpm({type:e,selectors:[["acme-clone-selection"]],outputs:{widgetSelected:"widgetSelected"},decls:4,vars:3,consts:[[1,"nui-widget-cloner"],["selectionMode","singleWithRequiredSelection",3,"itemsSource","selection","repeatItemTemplateRef","selectionChange"],["widgetClonerItem",""],[1,"nui-widget-cloner__item","d-flex","pt-2","pb-2","align-items-center"],[1,"text-info","ml-3"]],template:function(e,t){if(1&e&&(b.TgZ(0,"div",0),b.TgZ(1,"nui-repeat",1),b.NdJ("selectionChange",function(e){return t.onSelect(e)}),b.qZA(),b.qZA(),b.YNc(2,R,3,1,"ng-template",null,2,b.W1O)),2&e){const e=b.MAs(3);b.xp6(1),b.Q6J("itemsSource",t.widgetItems)("selection",t.widgetSelection)("repeatItemTemplateRef",e)}},directives:[s.$N6],styles:[".nui-widget-cloner__item[_ngcontent-%COMP%]{height:60px}"]}),e})();function M(e,t){if(1&e&&(b.TgZ(0,"div",3),b.TgZ(1,"div",4),b._uU(2),b.qZA(),b.qZA()),2&e){const e=t.item;b.xp6(2),b.hij(" ",e.title," ")}}let J=(()=>{class e extends k{constructor(e){super(e)}ngOnInit(){const e=new o.rS;this.widgetItems=D.map(t=>({title:e.transform(t.type),widget:this.widgetTypesService.mergeWithWidgetType(t)}))}}return e.lateLoadKey="AcmeCloneSelectionComponent",e.\u0275fac=function(t){return new(t||e)(b.Y36(d.xTe))},e.\u0275cmp=b.Xpm({type:e,selectors:[["acme-clone-selection"]],features:[b.qOj],decls:4,vars:3,consts:[[1,"nui-widget-cloner"],["selectionMode","singleWithRequiredSelection",3,"itemsSource","selection","repeatItemTemplateRef","selectionChange"],["widgetClonerItem",""],[1,"nui-widget-cloner__item","d-flex","pt-2","pb-2","align-items-center"],[1,"text-info","ml-3"]],template:function(e,t){if(1&e&&(b.TgZ(0,"div",0),b.TgZ(1,"nui-repeat",1),b.NdJ("selectionChange",function(e){return t.onSelect(e)}),b.qZA(),b.qZA(),b.YNc(2,M,3,1,"ng-template",null,2,b.W1O)),2&e){const e=b.MAs(3);b.xp6(1),b.Q6J("itemsSource",t.widgetItems)("selection",t.widgetSelection)("repeatItemTemplateRef",e)}},directives:[s.$N6],styles:[".nui-widget-cloner__item[_ngcontent-%COMP%]{height:60px}"]}),e})(),N=(()=>{class e{constructor(e){this.toastService=e,this.allowSubmit=!0,this.allowRemoval=!0,this.trySubmit=(e,t)=>{const i=new T.xQ;return setTimeout(()=>{if(this.allowSubmit)i.next(e);else{const e=$localize`Submit failed.`;this.toastService.error({title:e}),i.error(e)}},1e3),i.asObservable()},this.tryRemove=e=>{const t=new T.xQ;return setTimeout(()=>{if(this.allowRemoval)t.next(e);else{const e=$localize`Widget removal failed.`;this.toastService.error({title:e}),t.error(e)}},200),t.asObservable()},this.toastService.setConfig({timeOut:2e3})}}return e.\u0275fac=function(t){return new(t||e)(b.LFG(s.klp))},e.\u0275prov=b.Yz7({token:e,factory:e.\u0275fac}),e})();var L=i(46276),_=i(54607);const O=[{path:"",component:(()=>{class e{constructor(e,t,i,o,n){this.providerRegistry=e,this.submitHandler=t,this.widgetTypesService=i,this.widgetClonerService=o,this.refreshSettings=n,this.dashboard={positions:{},widgets:{}},this.gridsterConfig={minCols:12,maxCols:12,minRows:12},this.editMode=!1,this.systemRefreshInterval=60,this.belowFoldLazyLoadingConfig={enabled:!0},this.destroy$=new T.xQ,this.providerRegistry.setProviders({[S.providerId]:{provide:d.Fk3,useClass:S,deps:[r.eN]}})}ngOnInit(){var e,t;null===(t=null===(e=this.widgetTypesService.getWidgetType("table").configurator)||void 0===e?void 0:e[d.xW5.Structure].presentation.properties)||void 0===t||t.nodes.push("refresher"),this.refreshSettings.refreshRateSeconds=this.systemRefreshInterval;const i=D.map(e=>this.widgetTypesService.mergeWithWidgetType(e)),o=C()(i,e=>e.id);this.dashboard={positions:q,widgets:o}}onDsErrorSwitch(e){S.mockError=e}onShowButtonSwitch(e,t){for(const i of Object.keys(this.dashboard.widgets))this.dashboard=(0,s.zdu)(this.dashboard,`widgets.${i}.pizzagna.configuration.header.properties.${t}`,e)}ngAfterViewInit(){this.dashboardComponent.eventBus.subscribeUntil(d.MOJ,this.destroy$,e=>{this.widgetClonerService.open({widget:this.dashboard.widgets[e.widgetId],dashboardComponent:this.dashboardComponent,trySubmit:this.submitHandler.trySubmit,widgetSelectionComponentType:J}).pipe((0,I.q)(1),(0,x.R)(this.destroy$)).subscribe()})}onCloneWidget(){this.widgetClonerService.open({dashboardComponent:this.dashboardComponent,trySubmit:this.submitHandler.trySubmit,widgetSelectionComponentType:k}).pipe((0,I.q)(1),(0,x.R)(this.destroy$)).subscribe()}onEditWithCloner(){this.dashboardComponent.eventBus.next(d.MOJ,{widgetId:D[0].id})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSystemRefreshIntervalClick(){this.refreshSettings.refreshRateSeconds=this.systemRefreshInterval}}return e.\u0275fac=function(t){return new(t||e)(b.Y36(d.CNH),b.Y36(N),b.Y36(d.xTe),b.Y36(d.$Ie),b.Y36(d.g4s))},e.\u0275cmp=b.Xpm({type:e,selectors:[["many-widgets-dashboard-dashboard"]],viewQuery:function(e,t){if(1&e&&b.Gf(d.MXM,7),2&e){let e;b.iGM(e=b.CRH())&&(t.dashboardComponent=e.first)}},features:[b._Bn([N])],decls:25,vars:11,consts:function(){let e,t,i,o,r,n,s,d,a,c;return e=$localize`:␟08a1b409eac8269dd4dce8a2b3bd976356ba40ee␟7260316479095556147:Create Widget Clone`,t=$localize`:␟4e17d1961186f54a679f7623cd03e5c49c411f65␟639090956363340116:Simulate edit with cloner`,i=$localize`:␟c0390f914462a77b0ab8e053abf7c77af5b1da81␟6640158718767573444: Edit mode `,o=$localize`:␟db70aaa4da7a9f7c0fa3a218907f9fa354a19038␟5855643886473775120: Allow Submit `,r=$localize`:␟d289dfdc6c4e23b49a96db083f95f1087ed1400a␟3687117978364204872: Allow Removal `,n=$localize`:␟3299af3b186d7701f4c0626e41eba58af8382723␟4106211393112768148: Show Edit Button `,s=$localize`:␟30251ad3dcd7facd3a222d48fb2ba02f8503c52c␟8096484277280346189: Show Remove Button `,d=$localize`:␟c355f0feb3f72b3594e6e975456cd0a2dac1d929␟870224976565315483: Data Source Error `,a=$localize`:␟90504d9af68fb3aa81accb4bc3005526deb04093␟5488473345097746222:System refresh interval (seconds)`,c=$localize`:␟4de55e520d95a021a3b6dcb94b34b5b2364abef8␟1472280137824054907:Update system refresh interval `,[["type","button","nui-button","",1,"mb-3","ml-4",3,"click"],e,t,[1,"w-100",2,"height","725px"],[3,"nuiWidgetEditor","dashboard","gridsterConfig","editMode","belowFoldLazyLoadingConfig","dashboardChange","gridsterConfigChange"],[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"value","valueChange"],i,o,r,n,s,[1,"ml-3",3,"valueChange"],d,[1,"d-flex","flex-row"],[2,"width","300px"],["caption",a],[3,"value","valueChange"],["type","button","nui-button","",1,"ml-4",3,"click"],c]},template:function(e,t){1&e&&(b.TgZ(0,"button",0),b.NdJ("click",function(){return t.onCloneWidget()}),b.SDv(1,1),b.qZA(),b.TgZ(2,"button",0),b.NdJ("click",function(){return t.onEditWithCloner()}),b.SDv(3,2),b.qZA(),b.TgZ(4,"div",3),b.TgZ(5,"nui-dashboard",4),b.NdJ("dashboardChange",function(e){return t.dashboard=e})("gridsterConfigChange",function(e){return t.gridsterConfig=e}),b.qZA(),b.qZA(),b.TgZ(6,"div",5),b.TgZ(7,"nui-switch",6),b.NdJ("valueChange",function(e){return t.editMode=e}),b.SDv(8,7),b.qZA(),b.TgZ(9,"nui-switch",6),b.NdJ("valueChange",function(e){return t.submitHandler.allowSubmit=e}),b.SDv(10,8),b.qZA(),b.TgZ(11,"nui-switch",6),b.NdJ("valueChange",function(e){return t.submitHandler.allowRemoval=e}),b.SDv(12,9),b.qZA(),b.TgZ(13,"nui-switch",6),b.NdJ("valueChange",function(e){return t.onShowButtonSwitch(e,"editable")}),b.SDv(14,10),b.qZA(),b.TgZ(15,"nui-switch",6),b.NdJ("valueChange",function(e){return t.onShowButtonSwitch(e,"removable")}),b.SDv(16,11),b.qZA(),b.TgZ(17,"nui-switch",12),b.NdJ("valueChange",function(e){return t.onDsErrorSwitch(e)}),b.SDv(18,13),b.qZA(),b.qZA(),b.TgZ(19,"div",14),b.TgZ(20,"div",15),b.TgZ(21,"nui-form-field",16),b.TgZ(22,"nui-textbox-number",17),b.NdJ("valueChange",function(e){return t.systemRefreshInterval=e}),b.qZA(),b.qZA(),b.qZA(),b.TgZ(23,"button",18),b.NdJ("click",function(){return t.onSystemRefreshIntervalClick()}),b.SDv(24,19),b.qZA(),b.qZA()),2&e&&(b.xp6(5),b.Q6J("nuiWidgetEditor",t.submitHandler)("dashboard",t.dashboard)("gridsterConfig",t.gridsterConfig)("editMode",t.editMode)("belowFoldLazyLoadingConfig",t.belowFoldLazyLoadingConfig),b.xp6(2),b.Q6J("value",t.editMode),b.xp6(2),b.Q6J("value",t.submitHandler.allowSubmit),b.xp6(2),b.Q6J("value",t.submitHandler.allowRemoval),b.xp6(2),b.Q6J("value",!0),b.xp6(2),b.Q6J("value",!0),b.xp6(7),b.Q6J("value",t.systemRefreshInterval))},directives:[s.r0F,L.M,_.t,s.qUD,s.hgI,s.I5I],styles:[".nui-theme-switcher-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;padding:10px;background-color:#fff;background-color:var(--nui-color-bg-light,#fff)}"]}),e})(),data:{srlc:{hideIndicator:!0},showThemeSwitcher:!0}}];let P=(()=>{class e{constructor(e,t){this.widgetTypesService=e,this.componentRegistry=t,this.setupDataSourceProviders(),this.setupCustomProportionalWidgetDSConfig()}setupCustomProportionalWidgetDSConfig(){var e;const t=this.widgetTypesService.getWidgetType("proportional",1);null===(e=t.widget.structure[d.XMI].providers)||void 0===e||delete e.refresher,this.widgetTypesService.setNode(t,"configurator",d.ACc.DataSourceConfigComponentType,a.b.lateLoadKey),this.componentRegistry.registerByLateLoadKey(a.b)}setupDataSourceProviders(){this.setDataSourceProviders("table",[l.g.providerId,u.W.providerId,g.t.providerId,p.n.providerId,h.a.providerId]);const e=this.widgetTypesService.getWidgetType("kpi",1);this.widgetTypesService.setNode(e,"configurator",d.ACc.DataSourceConfigComponentType,d.cY_.lateLoadKey),this.setDataSourceProviders("kpi",[{providerId:S.providerId,label:"Acme KPI Data Source 1"}]),this.setDataSourceProviders("proportional",[c.Q.providerId,c.s.providerId]),this.setDataSourceProviders("timeseries",[f.wi.providerId,f.u2.providerId])}setDataSourceProviders(e,t){const i=this.widgetTypesService.getWidgetType(e,1);this.widgetTypesService.setNode(i,"configurator",d.ACc.DataSourceProviders,t)}}return e.\u0275fac=function(t){return new(t||e)(b.LFG(d.xTe),b.LFG(d.hiK))},e.\u0275mod=b.oAB({type:e}),e.\u0275inj=b.cJS({providers:[d.CNH],imports:[[o.ez,r.JF,d.Pi,s.Gsl,s.Az_,s.vvu,s.cJ5,s.Ts3,s.sF0,s.ZuS,n.Bz.forChild(O),s.C6o,s.YMY]]}),e})()}}]);