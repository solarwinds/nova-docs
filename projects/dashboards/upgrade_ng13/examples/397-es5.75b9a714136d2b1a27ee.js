!function(){"use strict";var e;function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=s(e);if(t){var o=s(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(self.webpackChunk_nova_ui_dashboards=self.webpackChunk_nova_ui_dashboards||[]).push([[397],{61397:function(n,a,d){var s,c;d.r(a),d.d(a,{WidgetErrorHandlingModule:function(){return S}});var p=d(38583),l=d(91841),f=d(90665),g=d(99763),h=d(46806),y=d(69063),m=d(33018),v=d(64762),b=d(26215),w=d(68939),Z=d(46276),A=d(54607);function _(e,t){if(1&e){var r=m.EpF();m.TgZ(0,"button",6),m.NdJ("click",function(){return m.CHM(r),m.oxw().reInitializeDashboard()}),m._uU(1,"Restore Widget"),m.qZA()}}function T(e,t){if(1&e){var r=m.EpF();m.TgZ(0,"nui-dashboard",7),m.NdJ("dashboardChange",function(e){return m.CHM(r),m.oxw().dashboard=e})("gridsterConfigChange",function(e){return m.CHM(r),m.oxw().gridsterConfig=e}),m.qZA()}if(2&e){var n=m.oxw();m.Q6J("dashboard",n.dashboard)("gridsterConfig",n.gridsterConfig)("editMode",n.editMode)}}var k,U=((k=function(e){i(n,e);var t=u(n);function n(e){var o;return r(this,n),(o=t.call(this)).http=e,o.busy=new b.X(!1),o}return o(n,[{key:"getFilteredData",value:function(){return(0,v.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.busy.next(!0),new Promise(function(e){t.http.get("https://www.googleapis.com/books/v1/volumes/5MQFrgEACAAJ").pipe((0,w.x)(function(){return t.busy.next(!1)})).subscribe({next:function(t){e({result:{value:t.volumeInfo.averageRating}})},error:function(t){e({result:null,error:{type:t.status}})}})})));case 1:case"end":return e.stop()}},e,this)}))}},{key:"ngOnDestroy",value:function(){this.outputsSubject.complete()}}]),n}(h.LvN)).providerId="AverageRatingKpiDataSource",k.\u0275fac=function(e){return new(e||k)(m.LFG(l.eN))},k.\u0275prov=m.Yz7({token:k,factory:k.\u0275fac}),k),C=function(){var e,t=function(e){i(n,e);var t=u(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments)).busy=new b.X(!1),e}return o(n,[{key:"getFilteredData",value:function(){return(0,v.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.busy.next(!0),t={result:null,error:{type:y.WEY.Unknown}},e.abrupt("return",(this.busy.next(!1),t));case 3:case"end":return e.stop()}},e,this)}))}},{key:"ngOnDestroy",value:function(){this.outputsSubject.complete()}}]),n}(h.LvN);return t.providerId="ErrorUnknownDataSource",t.\u0275fac=function(r){return(e||(e=m.n5z(t)))(r||t)},t.\u0275prov=m.Yz7({token:t,factory:t.\u0275fac}),t}(),E=function(){var e=function(e){i(n,e);var t=u(n);function n(e){var o;return r(this,n),(o=t.call(this)).http=e,o.busy=new b.X(!1),o}return o(n,[{key:"getFilteredData",value:function(){return(0,v.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.busy.next(!0),new Promise(function(e){t.http.get("http://www.mocky.io/v2/5ecc724a3200000f0023614a?mocky-delay=4000ms").pipe((0,w.x)(function(){return t.busy.next(!1)})).subscribe({error:function(t){e({result:null,error:{type:t.status}})}})})));case 1:case"end":return e.stop()}},e,this)}))}},{key:"ngOnDestroy",value:function(){this.outputsSubject.complete()}}]),n}(h.LvN);return e.providerId="ErrorForbiddenDataSource",e.\u0275fac=function(t){return new(t||e)(m.LFG(l.eN))},e.\u0275prov=m.Yz7({token:e,factory:e.\u0275fac}),e}(),q=function(){var e=function(e){i(n,e);var t=u(n);function n(e){var o;return r(this,n),(o=t.call(this)).http=e,o.busy=new b.X(!1),o}return o(n,[{key:"getFilteredData",value:function(){return(0,v.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.busy.next(!0),new Promise(function(e){t.http.get("http://www.mocky.io/v2/5ec6bfd93200007800d75100?mocky-delay=1000ms").pipe((0,w.x)(function(){return t.busy.next(!1)})).subscribe({error:function(t){e({result:null,error:{type:t.status}})}})})));case 1:case"end":return e.stop()}},e,this)}))}},{key:"ngOnDestroy",value:function(){this.outputsSubject.complete()}}]),n}(h.LvN);return e.providerId="ErrorNotFoundDataSource",e.\u0275fac=function(t){return new(t||e)(m.LFG(l.eN))},e.\u0275prov=m.Yz7({token:e,factory:e.\u0275fac}),e}(),I=function(){var n=function(){function e(t,n,o){r(this,e),this.widgetTypesService=t,this.providerRegistry=n,this.changeDetectorRef=o,this.gridsterConfig={},this.editMode=!1}return o(e,[{key:"ngOnInit",value:function(){var e,r=this.widgetTypesService.getWidgetType("kpi",1);this.widgetTypesService.setNode(r,"configurator",y.ACc.DataSourceProviders,[C.providerId,E.providerId,q.providerId,U.providerId]),this.providerRegistry.setProviders((t(e={},C.providerId,{provide:y.Fk3,useClass:C,deps:[l.eN]}),t(e,E.providerId,{provide:y.Fk3,useClass:E,deps:[l.eN]}),t(e,q.providerId,{provide:y.Fk3,useClass:q,deps:[l.eN]}),t(e,U.providerId,{provide:y.Fk3,useClass:U,deps:[l.eN]}),e)),this.initializeDashboard()}},{key:"reInitializeDashboard",value:function(){this.dashboard=void 0,this.changeDetectorRef.detectChanges(),this.initializeDashboard()}},{key:"initializeDashboard",value:function(){var e=N,r=t({},e.id,this.widgetTypesService.mergeWithWidgetType(e));this.dashboard={positions:t({},e.id,{cols:4,rows:6,y:0,x:0}),widgets:r}}}]),e}();return n.\u0275fac=function(e){return new(e||n)(m.Y36(y.xTe),m.Y36(y.CNH),m.Y36(m.sBO))},n.\u0275cmp=m.Xpm({type:n,selectors:[["widget-error-handling"]],decls:6,vars:3,consts:function(){var t,r;return[[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"value","valueChange"],$localize(e||(t=[":\u241f18d630a3c524dbab6dc528571782a939a7bc95b1\u241f861097914887003123: Edit Mode "],r||(r=t.slice(0)),e=Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(r)}})))),["type","button","displayStyle","action","nui-button","",3,"click",4,"ngIf"],[1,"w-100","dashboard"],["nuiWidgetEditor","",3,"dashboard","gridsterConfig","editMode","dashboardChange","gridsterConfigChange",4,"ngIf"],["type","button","displayStyle","action","nui-button","",3,"click"],["nuiWidgetEditor","",3,"dashboard","gridsterConfig","editMode","dashboardChange","gridsterConfigChange"]]},template:function(e,t){1&e&&(m.TgZ(0,"div",0),m.TgZ(1,"nui-switch",1),m.NdJ("valueChange",function(e){return t.editMode=e}),m.SDv(2,2),m.qZA(),m.YNc(3,_,2,0,"button",3),m.qZA(),m.TgZ(4,"div",4),m.YNc(5,T,1,3,"nui-dashboard",5),m.qZA()),2&e&&(m.xp6(1),m.Q6J("value",t.editMode),m.xp6(2),m.Q6J("ngIf",!(null!=t.dashboard&&t.dashboard.widgets.widget1)),m.xp6(2),m.Q6J("ngIf",t.dashboard))},directives:[h.qUD,p.O5,h.r0F,Z.M,A.t],styles:[".dashboard[_ngcontent-%COMP%]{height:400px}"]}),n}(),N={id:"widget1",type:"kpi",pizzagna:t({},y.xW5.Configuration,(c={},t(c,y.XMI,{providers:t({},y.Muk.Refresher,{properties:{interval:600,enabled:!0}})}),t(c,"header",{properties:{title:"Harry Potter and the Sorcerer's Stone",subtitle:"By J. K. Rowling"}}),t(c,"tiles",{properties:{nodes:["kpi1"]}}),t(c,"kpi1",{id:"kpi1",componentType:y.ufE.lateLoadKey,properties:{widgetData:{units:"out of 5 Stars",label:"Average Rating"}},providers:(s={},t(s,y.Muk.DataSource,{providerId:C.providerId}),t(s,y.Muk.Adapter,{providerId:y.u1$,properties:{componentId:"kpi1",propertyPath:"widgetData"}}),s)}),c))},x=[{path:"",component:function(){var e=o(function e(){r(this,e),this.fallbackAdapter='\n@Injectable()\nexport class StatusContentFallbackAdapter implements OnDestroy, IHasComponent {\n\n    protected destroy$ = new Subject();\n    protected componentId: string;\n\n    constructor(@Inject(PIZZAGNA_EVENT_BUS) protected eventBus: EventBus<IEvent>,\n                protected pizzagnaService: PizzagnaService) {\n        this.eventBus.getStream(DATA_SOURCE_OUTPUT)\n            .pipe(takeUntil(this.destroy$)).subscribe((event: IEvent<any | IDataSourceOutputPayload<any>>) => {\n                this.handleDataSourceOutput(event);\n            });\n    }\n\n    public ngOnDestroy(): void {\n        this.destroy$.next();\n        this.destroy$.complete();\n    }\n\n    public setComponent(component: any, componentId: string) {\n        this.componentId = componentId;\n    }\n\n    protected handleDataSourceOutput(event: IEvent<any | IDataSourceOutputPayload<any>>) {\n        this.pizzagnaService.setProperty({\n            componentId: this.componentId,\n            propertyPath: ["fallbackKey"],\n            pizzagnaKey: PizzagnaLayer.Data,\n        }, typeof event.payload?.error?.type !== "undefined" ? event.payload?.error?.type.toString() : undefined);\n    }\n}',this.errorsMap="\nexport const ERROR_FALLBACK_MAP: Record<string, ErrorNodeKey> = {\n    [HttpStatusCode.Unknown]: ErrorNodeKey.ErrorUnknown,\n    [HttpStatusCode.Forbidden]: ErrorNodeKey.ErrorForbidden,\n    [HttpStatusCode.NotFound]: ErrorNodeKey.ErrorNotFound,\n};\n",this.errorNodes='\nexport const ERROR_NODES: Record<string, IComponentConfiguration> = {\n    [ErrorNodeKey.ErrorUnknown]: {\n        id: ErrorNodeKey.ErrorUnknown,\n        componentType: WidgetErrorComponent.lateLoadKey,\n        properties: {\n            image: "no-data-to-show",\n            title: $localize`Whoops, something went wrong`,\n            description: $localize`There was an unexpected error.`,\n        } as IWidgetErrorDisplayProperties,\n    },\n    [ErrorNodeKey.ErrorForbidden]: {\n        id: ErrorNodeKey.ErrorForbidden,\n        componentType: WidgetErrorComponent.lateLoadKey,\n        properties: {\n            image: "no-data-to-show",\n            title: $localize`403 - Forbidden`,\n            description: $localize`The requested action was forbidden.`,\n        } as IWidgetErrorDisplayProperties,\n    },\n    [ErrorNodeKey.ErrorNotFound]: {\n        id: ErrorNodeKey.ErrorNotFound,\n        componentType: WidgetErrorComponent.lateLoadKey,\n        properties: {\n            image: "no-data-to-show",\n            title: $localize`404 - Not Found`,\n            description: $localize`The requested resource could not be found.`,\n        } as IWidgetErrorDisplayProperties,\n    },\n};',this.widgetBodyContentNodesSignature="\n/**\n * Retrieves an index of the basic widget body content nodes including fallback nodes\n *\n * @param mainContentNodeKey The key corresponding to the main body content node\n * @param fallbackAdapterId The id for the adapter responsible for activating fallback content in case of an error\n * @param fallbackMap A map of node keys to fallback content definitions\n * @param fallbackNodes An index of fallback content definitions\n *\n * @returns An index of component configurations\n */\nexport function widgetBodyContentNodes(\n    mainContentNodeKey: string,\n    fallbackAdapterId = NOVA_STATUS_CONTENT_FALLBACK_ADAPTER,\n    fallbackMap: Record<string, string> = ERROR_FALLBACK_MAP,\n    fallbackNodes: Record<string, IComponentConfiguration> = ERROR_NODES\n): Record<string, IComponentConfiguration> { ... }\n"});return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Xpm({type:e,selectors:[["nui-widget-error-handling-docs"]],decls:120,vars:5,consts:[["language","typescript"],["type","info",3,"allowDismiss"],["href","../additional-documentation/getting-started.html","target","_parent"],["href","../additional-documentation/widget-types/kpi.html","target","_parent"],["href","../components/DataSourceErrorComponent.html","target","_blank"],["href","../additional-documentation/tutorials/customization/data-source-configurator.html","target","_parent"],["filenamePrefix","widget-error-handling.component","exampleTitle","Widget Error Handling"],["href","../additional-documentation/tutorials/customization/widget.html","target","_parent"]],template:function(e,t){1&e&&(m.TgZ(0,"h1"),m._uU(1,"Widget Error Handling"),m.qZA(),m.TgZ(2,"p"),m._uU(3," In this tutorial we'll show you how to handle errors in Nova dashboard. You will know-how provide an empty state view for the widget so users will be informed when there's no data or an error has occurred. We have default error state handling for all types of widgets.\n"),m.qZA(),m.TgZ(4,"p"),m._uU(5,"We have three params in the method "),m.TgZ(6,"code"),m._uU(7,"widgetBodyContentNodes"),m.qZA(),m._uU(8,", which responsible for widget error handling:"),m.qZA(),m.TgZ(9,"ul"),m.TgZ(10,"li"),m.TgZ(11,"code"),m._uU(12,"fallbackAdapterId"),m.qZA(),m._uU(13," The id for the adapter responsible for activating fallback content in case of an error (default value: NOVA_STATUS_CONTENT_FALLBACK_ADAPTER) "),m.qZA(),m.TgZ(14,"li"),m.TgZ(15,"code"),m._uU(16,"fallbackMap"),m.qZA(),m._uU(17," A map of node keys to fallback content definitions (default value: ERROR_FALLBACK_MAP)"),m.qZA(),m.TgZ(18,"li"),m.TgZ(19,"code"),m._uU(20,"fallbackNodes"),m.qZA(),m._uU(21," An index of fallback content definitions (default value: ERROR_NODES)"),m.qZA(),m.qZA(),m.TgZ(22,"p"),m._uU(23,"You can see below the code examples of each part, which are used as a default for widget error handling"),m.qZA(),m.TgZ(24,"strong"),m._uU(25,"The example of adapter"),m.qZA(),m.TgZ(26,"nui-example-code",0),m._uU(27),m.qZA(),m.TgZ(28,"p"),m.TgZ(29,"strong"),m._uU(30,"A map of error codes to widget error node keys"),m.qZA(),m.TgZ(31,"nui-message",1),m._uU(32," An error code doesn't have to be an HTTP status code. It may be any string that matches an expected data source error type. Additionally, the node keys may be any string as long as they correspond to an error configuration node defined in the widget structure. "),m.qZA(),m.TgZ(33,"nui-example-code",0),m._uU(34),m.qZA(),m.qZA(),m.TgZ(35,"strong"),m._uU(36,"An index of common error configurations"),m.qZA(),m.TgZ(37,"p"),m._uU(38,"Each error configuration has:"),m.qZA(),m.TgZ(39,"ul"),m.TgZ(40,"li"),m.TgZ(41,"code"),m._uU(42,"id"),m.qZA(),m._uU(43," of error node key"),m.qZA(),m.TgZ(44,"li"),m.TgZ(45,"code"),m._uU(46,"componentType"),m.qZA(),m._uU(47," of widget error component"),m.qZA(),m.TgZ(48,"li"),m.TgZ(49,"code"),m._uU(50,"properties (image, title and description)"),m.qZA(),m._uU(51," for displaying error details"),m.qZA(),m.qZA(),m.TgZ(52,"nui-example-code",0),m._uU(53),m.qZA(),m.TgZ(54,"h2"),m._uU(55,"Basic Steps"),m.qZA(),m.TgZ(56,"ol"),m.TgZ(57,"li"),m._uU(58," Follow the instructions "),m.TgZ(59,"a",2),m._uU(60,"here"),m.qZA(),m._uU(61," to set up your environment for dashboard development. "),m.qZA(),m.TgZ(62,"li"),m._uU(63," Follow the instructions "),m.TgZ(64,"a",3),m._uU(65,"here"),m.qZA(),m._uU(66," to get a basic KPI dashboard up and running. "),m.qZA(),m.qZA(),m.TgZ(67,"p"),m._uU(68,' In the example below, we\'ll implement a sample KPI widget with an error. If the widget data source results in a known error transition we need to show the corresponding error layout configuration. If the data source reports an unknown error type transition we need to show an "unknown error" layout configuration. Switch into other data sources to see the handling of different errors in the widget. Each data source provides an error from '),m.TgZ(69,"code"),m._uU(70,"ERROR_FALLBACK_MAP"),m.qZA(),m._uU(71,". A widget with no errors does not display an error layout. You can check it when switching to "),m.TgZ(72,"code"),m._uU(73,"AverageRatingKpiDataSource"),m.qZA(),m._uU(74,".\n"),m.qZA(),m.TgZ(75,"p"),m._uU(76," If the data source outputs an error as part of its "),m.TgZ(77,"code"),m._uU(78,"outputsSubject"),m.qZA(),m._uU(79," payload, the configurator will display an error message including the string specified in the "),m.TgZ(80,"code"),m._uU(81,"message"),m.qZA(),m._uU(82," property of the payload's error object. If there's no value for the "),m.TgZ(83,"code"),m._uU(84,"message"),m.qZA(),m._uU(85," property, the error message will just display the value of the "),m.TgZ(86,"code"),m._uU(87,"type"),m.qZA(),m._uU(88," property. The component responsible for this logic is the "),m.TgZ(89,"code"),m.TgZ(90,"a",4),m._uU(91,"DataSourceErrorComponent"),m.qZA(),m.qZA(),m._uU(92,". If you want to use a custom component for this, you'll need to to set the "),m.TgZ(93,"code"),m._uU(94,"errorComponent"),m.qZA(),m._uU(95," property in the configurator section of the pizzagna with the "),m.TgZ(96,"code"),m._uU(97,"lateLoadKey"),m.qZA(),m._uU(98," of your custom component. For instructions on how to do that, be sure to take a look at the "),m.TgZ(99,"a",5),m._uU(100,"Implementing a Custom Data Source Configurator"),m.qZA(),m._uU(101," tutorial.\n"),m.qZA(),m.TgZ(102,"nui-example-wrapper",6),m._UZ(103,"widget-error-handling"),m.qZA(),m.TgZ(104,"h2"),m._uU(105,"Custom Widget Error Handling"),m.qZA(),m.TgZ(106,"p"),m._uU(107," At first, follow the instructions "),m.TgZ(108,"a",7),m._uU(109,"here"),m.qZA(),m._uU(110," to implement your custom widget. Then you need to modify the widget type definition by changing the retrieving the definitions for the body content nodes in the method "),m.TgZ(111,"code"),m._uU(112,"widgetBodyContentNodes"),m.qZA(),m._uU(113,". You can see below the declaration of that method: "),m.TgZ(114,"nui-example-code",0),m._uU(115),m.qZA(),m._uU(116," So, you can modify any parameter: "),m.TgZ(117,"code"),m._uU(118,"fallbackAdapterId, fallbackMap, fallbackNodes"),m.qZA(),m._uU(119," to your own widget error handling.\n"),m.qZA()),2&e&&(m.xp6(27),m.hij(" ",t.fallbackAdapter,"\n"),m.xp6(4),m.Q6J("allowDismiss",!1),m.xp6(3),m.hij(" ",t.errorsMap," "),m.xp6(19),m.hij(" ",t.errorNodes,"\n"),m.xp6(62),m.hij(" ",t.widgetBodyContentNodesSignature," "))},directives:[h.i10,h.qqZ,h.hD2,I],encapsulation:2}),e}(),data:{srlc:{hideIndicator:!0},showThemeSwitcher:!0}},{path:"example",component:I,data:{srlc:{hideIndicator:!0}}}],S=function(){var e=o(function e(){r(this,e)});return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=m.oAB({type:e}),e.\u0275inj=m.cJS({imports:[[p.ez,f.UX,l.JF,h.Az_,y.Pi,y.Qpk,h.vvu,h.C6o,h.Ts3,h.gkT,h.Ts3,h.YMY,h.Ts3,h.cJ5,g.Bz.forChild(x)]]}),e}()}}])}();