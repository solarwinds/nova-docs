import{d as Z}from"./chunk-TWGF5P3J.js";import{a as Y,j as J}from"./chunk-32WL3UDE.js";import{a as Q}from"./chunk-V2MEVMRQ.js";import{Ja as q,ea as X,ha as U,ia as K}from"./chunk-USCLQP7P.js";import{C as oe,Yc as G,h as ae,lc as f,pc as k,xe as V,ye as H}from"./chunk-NZZJTGI5.js";import{f as j,z as _}from"./chunk-NEOTMEUH.js";import{$c as z,A as S,Aa as T,Ac as I,E as M,F as y,Ha as N,Pb as E,Rb as g,Sa as c,T as P,Ta as h,Xb as n,Yb as o,Z as A,bc as w,ca as R,gc as O,h as x,i as D,kc as $,lc as d,ma as F,pa as v,va as L,vc as B,yb as p,yc as m,zb as u,zc as b}from"./chunk-NNMBFNDY.js";import{g as W,i as l}from"./chunk-T555DFTC.js";var ee=W(oe()),te=W(ae());function se(r,ie){if(r&1){let e=w();n(0,"button",6),$("click",function(){c(e);let t=d();return h(t.reInitializeDashboard())}),B(1," Restore Widget "),o()}}function ne(r,ie){if(r&1){let e=w();n(0,"nui-dashboard",7),I("dashboardChange",function(t){c(e);let a=d();return b(a.dashboard,t)||(a.dashboard=t),h(t)})("gridsterConfigChange",function(t){c(e);let a=d();return b(a.gridsterConfig,t)||(a.gridsterConfig=t),h(t)}),o()}if(r&2){let e=d();m("dashboard",e.dashboard),g("editMode",e.editMode),m("gridsterConfig",e.gridsterConfig)}}var C=(()=>{class r extends V{static{this.providerId="AcmeTableGBooksDataSource"}static{this.mockError=!1}constructor(e,i){super(),this.logger=e,this.http=i,this.searchableColumn="title",this.page=1,this.busy=new D(!1),this.cache=Array.from({length:0}),this.supportedFeatures={search:{enabled:!0},pagination:{enabled:!0}},this.columnToQueryParamMap={title:"intitle",authors:"inauthor"},this.applyFilters$=new x,this.dataFields=[{id:"title",label:$localize`Title`,dataType:"string",sortable:!1},{id:"authors",label:$localize`Authors`,dataType:"string",sortable:!1}],this.features=new H(this.supportedFeatures),this.applyFilters$.pipe(F(t=>this.getData(t))).subscribe(t=>l(this,null,function*(){this.outputsSubject.next(yield this.getFilteredData(t))}))}getFilteredData(e){return l(this,null,function*(){return M(S(e).pipe(v(i=>{this.cache=this.cache.concat(i.books)}),y(i=>({result:{repeat:{itemsSource:this.cache},paginator:{total:i.totalItems},dataFields:this.dataFields}}))))})}getData(e){return this.isNewSearchTerm(e.search)&&e.virtualScroll?.value.start===0&&(this.cache=[]),this.http.get(this.getComposedUrl(e)).pipe(v(()=>this.busy.next(!0)),A(300),y(i=>({books:i.items?.map(t=>({title:t.volumeInfo.title,authors:t.volumeInfo.authors?.join(", ")||""}))||[],totalItems:i.totalItems})),P(i=>(this.logger.error(i),S({books:[],totalItems:0}))),R(()=>{this.busy.next(!1),this.previousFilters=e}))}getComposedUrl(e){let i=`${Z}?q=`,t=`maxResults=${(e.virtualScroll?.value.end||0)-(e.virtualScroll?.value.start||0)}`,a=e.virtualScroll?`startIndex=${e.virtualScroll.value.start}`:"",s=this.columnToQueryParamMap[this.searchableColumn],re=e.search?`${s}:${e.search.value}`:"_";return`${i}${re}&${t}&${a}&filter=full`}isNewSearchTerm(e){return!(0,te.default)(e?.value)&&!(0,ee.default)(e?.value,this.previousFilters?.search?.value)}applyFilters(){return l(this,null,function*(){this.applyFilters$.next(this.getFilters())})}static{this.\u0275fac=function(i){return new(i||r)(T(f),T(_))}}static{this.\u0275prov=L({token:r,factory:r.\u0275fac})}}return r})(),Ee=(()=>{class r{constructor(e,i,t){this.widgetTypesService=e,this.providerRegistry=i,this.changeDetectorRef=t,this.gridsterConfig={},this.editMode=!1}ngOnInit(){let e=this.widgetTypesService.getWidgetType("table",1);this.widgetTypesService.setNode(e,"configurator",K.DataSourceProviders,[C.providerId]),this.providerRegistry.setProviders({[C.providerId]:{provide:X,useClass:C,deps:[f,_]}}),this.initializeDashboard()}reInitializeDashboard(){this.dashboard=void 0,this.changeDetectorRef.detectChanges(),this.initializeDashboard()}initializeDashboard(){let e=de,i={[e.id]:this.widgetTypesService.mergeWithWidgetType(e)},t={[e.id]:{cols:12,rows:6,y:0,x:0}};this.dashboard={positions:t,widgets:i}}static{this.\u0275fac=function(i){return new(i||r)(u(Q),u(q),u(z))}}static{this.\u0275cmp=N({type:r,selectors:[["table-widget-search-example"]],decls:6,vars:3,consts:()=>{let e;return e=$localize`:␟18d630a3c524dbab6dc528571782a939a7bc95b1␟861097914887003123: Edit Mode `,[e,[1,"mb-2","d-flex","align-items-center"],[1,"ml-3","py-2",3,"valueChange","value"],["type","button","displayStyle","action","nui-button","",3,"click",4,"ngIf"],[1,"w-100","dashboard"],["nuiWidgetEditor","",3,"dashboard","editMode","gridsterConfig","dashboardChange","gridsterConfigChange",4,"ngIf"],["type","button","displayStyle","action","nui-button","",3,"click"],["nuiWidgetEditor","",3,"dashboardChange","gridsterConfigChange","dashboard","editMode","gridsterConfig"]]},template:function(i,t){i&1&&(n(0,"div",1)(1,"nui-switch",2),I("valueChange",function(s){return b(t.editMode,s)||(t.editMode=s),s}),O(2,0),o(),E(3,se,2,0,"button",3),o(),n(4,"div",4),E(5,ne,1,3,"nui-dashboard",5),o()),i&2&&(p(),m("value",t.editMode),p(2),g("ngIf",!(t.dashboard!=null&&t.dashboard.widgets.tableWidgetId)),p(2),g("ngIf",t.dashboard))},dependencies:[k,j,G,Y,J],styles:[".dashboard[_ngcontent-%COMP%]{height:400px}"]})}}return r})(),de={id:"tableWidgetId",type:"table",pizzagna:{configuration:{header:{properties:{title:"Google Books"}},table:{providers:{[U.DataSource]:{providerId:C.providerId}},properties:{configuration:{columns:[{id:"column1",label:$localize`Title`,isActive:!0,formatter:{componentType:"RawFormatterComponent",properties:{dataFieldIds:{value:"title"}}}},{id:"column2",label:$localize`Author`,isActive:!0,formatter:{componentType:"RawFormatterComponent",properties:{dataFieldIds:{value:"authors"}}}}],sortable:!1,searchConfiguration:{enabled:!0},hasVirtualScroll:!0}}}}}};export{C as a,Ee as b,de as c};
