import{a as Li}from"./chunk-A2HZGK4R.js";import{Be as se,C as Ct,D as Ue,Ec as zt,J as Z,M as Le,Q as fe,Vb as Ge,Z as $i,ac as Ui,h as xi,hc as Ot,he as oe,kb as bt,lc as C,m as yt,ma as Rt,o as le,p as $e,s as Be,t as ke,tb as Bi,tc as T,ve as l,xb as ki,y as Fi,yc as K}from"./chunk-3HSEZOBQ.js";import{q as he}from"./chunk-NEOTMEUH.js";import{$ as k,$c as Pt,Aa as a,Ab as St,Ba as ht,Ca as x,Da as w,F,Fb as Et,G as nt,Gb as de,Ha as lt,Ja as ue,P as at,Pa as ft,Q as pe,Qa as xe,R as ct,Ra as gt,V as pt,Xb as It,Ya as q,Yb as At,_a as vt,aa as mt,ab as Fe,e as st,h as A,ha as ut,i as z,j as $,la as me,ma as dt,na as f,pa as M,s as L,t as _,u as G,va as m,vc as Tt,ya as U,zb as te}from"./chunk-NNMBFNDY.js";import{a as E,b as D,f as ee,g as I}from"./chunk-T555DFTC.js";var Me=ee((No,_t)=>{var Gi=Bi(),Mi=Li(),Zi=Mi(function(r,n,e){Gi(r,e,n)});_t.exports=Zi});var Ye=ee((Dn,Vr)=>{var eo=Le();function to(r){return r&&r.length?eo(r):[]}Vr.exports=to});var Xr=ee((Pc,qr)=>{var ao=yt(),co=$e(),po=Be(),Yr=ke(),mo=po(function(r,n){return Yr(r)?ao(r,co(n,1,Yr,!0)):[]});qr.exports=mo});var Pi=ee((xu,Ti)=>{var go=$e(),vo=Be(),So=Le(),Eo=ke(),Io=vo(function(r){return So(go(r,1,Eo,!0))});Ti.exports=Io});var wi=ee((Zu,_i)=>{var yo=yt(),Co=$e(),zi=Le();function Ro(r,n,e){var t=r.length;if(t<2)return t?zi(r[0]):[];for(var i=-1,o=Array(t);++i<t;)for(var s=r[i],c=-1;++c<t;)c!=i&&(o[i]=yo(o[i]||s,r[c],n,e));return zi(Co(o,1),n,e)}_i.exports=Ro});var Di=ee((Ku,Ni)=>{var bo=Fi(),Oo=Be(),zo=wi(),_o=ke(),wo=Oo(function(r){return zo(bo(r,_o))});Ni.exports=wo});var jo="/",N=new T("REFRESH"),wt=new T("SET_NEXT_PAGE"),Nt=new T("SCROLL_NEXT_PAGE"),xo=new T("WIDGET_REMOVE"),Fo=new T("WIDGET_EDIT"),$o=new T("WIDGET_CREATE"),Dt=new T("WIDGET_READY"),Bo=new T("WIDGET_RESIZE"),ko=new T("WIDGET_POSITION_CHANGE"),Uo=new T("WIDGET_SEARCH",()=>new z({payload:""})),X=new T("SET_PROPERTY_VALUE"),Lo=new T("SET_TIMEFRAME"),Go=new T("PREVIEW_EVENT"),ne=new T("DATA_SOURCE_BUSY"),Mo=new T("DASHBOARD_EDIT_MODE",()=>new $(1)),Vt=new T("INTERACTION"),Zo=new T("SELECTION"),Ko=new T("CHANGE_SELECTION"),Ho=new T("SELECTED_ITEMS"),jt=new T("DATA_SOURCE_INVOKED"),xt=new T("DRILLDOWN"),Ft="NOVA_DATASOURCE_INTERVAL_REFRESHER",$t="NOVA_DATASOURCE_ADAPTER",Bt="NOVA_TIMESERIES_DATASOURCE_ADAPTER",kt="NOVA_KPI_DATASOURCE_ADAPTER",Ut="NOVA_DRILLDOWN_DATASOURCE_ADAPTER",Lt="NOVA_KPI_COLOR_PRIORITIZER",Gt="NOVA_TITLE_AND_DESCRIPTION_CONVERTER",Mt="NOVA_PROPORTIONAL_WIDGET_CHART_OPTIONS_CONVERTER",Zt="NOVA_KPI_TILES_CONVERTER",Kt="NOVA_TIMESERIES_METADATA_CONVERTER",Ht="NOVA_TIMESERIES_SERIES_CONVERTER",Wt="NOVA_DASHBOARD_EVENT_PROXY",Yt="NOVA_TABLE_COLUMNS_CONVERTER",qt="NOVA_TABLE_FILTERS_CONVERTER",Xt="NOVA_TABLE_SCROLL_TYPE_CONVERTER",Jt="NOVA_TABLE_DATASOURCE_ADAPTER",Qt="NOVA_GENERIC_CONVERTER",er="NOVA_GENERIC_ARRAY_CONVERTER",tr="NOVA_KPI_SECTION_CONVERTER",rr="NOVA_TIMESERIES_TILE_INDICATOR_DATA_CONVERTER",ir="NOVA_LOADING_ADAPTER",or="NOVA_STATUS_CONTENT_FALLBACK_ADAPTER",sr="NOVA_KPI_STATUS_CONTENT_FALLBACK_ADAPTER",nr="NOVA_KPI_SCALE_SYNC_BROKER",ar="NOVA_URL_INTERACTION_HANDLER",cr="NOVA_EVENT_BUS_DEBUGGER",pr="NOVA_PIZZAGNA_BROADCASTER",mr="NOVA_VIRTUAL_VIEWPORT_MANAGER",ur="NOVA_TABLE_FORMATTERS_REGISTRY",dr="NOVA_KPI_FORMATTERS_REGISTRY",hr="NOVA_RISK_SCORE_FORMATTERS_REGISTRY",lr="NOVA_PROPORTIONAL_CONTENT_FORMATTERS_REGISTRY";var fr="NOVA_CONFIGURATOR_DATA_SOURCE_MANAGER",Wo={id:"CHART_METRIC_REMOVE"};var p=new U("PIZZAGNA_EVENT_BUS"),ge=new U("DASHBOARD_EVENT_BUS"),b=new U("DATA_SOURCE"),ae=new U("FORMATTERS_REGISTRY"),Xo=new U("TEST_REGISTRY"),Jo=new U("HEADER_LINK_PROVIDER"),ce=function(r){return r.DataSource="dataSource",r.Adapter="adapter",r.Converter="converter",r.Broadcaster="broadcaster",r.Refresher="refresher",r.EventProxy="eventProxy",r.LoadingAdapter="loadingAdapter",r.ContentFallbackAdapter="contentFallbackAdapter",r.InteractionHandler="interactionHandler",r.EventBusDebugger="eventBusDebugger",r.KpiColorPrioritizer="kpiColorPrioritizer",r.FormattersRegistry="formattersRegistry",r.DataSourceManager="dataSourceManager",r}(ce||{}),Ki=function(r){return r.Root="root",r.DataSourceConfigComponentType="dataSourceConfigComponentType",r.TileDescriptionConfigComponentType="tileDescriptionConfigComponentType",r.DataSourceProviders="dataSourceProviders",r.Formatters="formatters",r.TileDescriptionBackgroundColors="tileDescriptionBackgroundColors",r.TileBackgroundColorRulesBackgroundColors="tileBackgroundColorRulesBackgroundColors",r}(Ki||{}),Hi=function(r){return r.Interactivity="interactivity",r.DisableTableColumnGeneration="disableTableColumnGeneration",r}(Hi||{}),h=function(r){return r.Structure="structure",r.Configuration="configuration",r.Data="data",r}(h||{}),Wi=function(r){return r.CRITICAL="critical",r.WARNING="warning",r.DEFAULT="default",r}(Wi||{}),Ze=function(r){return r.Unknown="0",r.Ok="200",r.Forbidden="403",r.NotFound="404",r}(Ze||{});var Yi={">":{comparatorFn:(r,n)=>r>n,label:"Value is greater than"},"<":{comparatorFn:(r,n)=>r<n,label:"Value is less than"},">=":{comparatorFn:(r,n)=>r>=n,label:"Value is greater, or equal to"},"<=":{comparatorFn:(r,n)=>r<=n,label:"Value is less than, or equal to"},"==":{comparatorFn:(r,n)=>r==n,label:"Value is exactly"}},ve=(()=>{class r{constructor(){this.comparators=E({},Yi)}registerComparators(e){this.comparators=E(E({},this.comparators),e)}clearComparators(){this.comparators={}}getComparators(){return this.comparators}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ke=function(r){return r.None="None",r.Right="Right",r.Bottom="Bottom",r}(Ke||{});var gr=(()=>{class r{get stateVersion(){return this._stateVersion}get isEmpty(){return this._isEmpty}constructor(e,t){this.logger=e,this.className=t,this.state$=new z({}),this.stateChanged$=this.state$.asObservable().pipe(F(()=>this.getItems())),this._isEmpty=!0}addItems(e,t={overrideExisting:!0}){let i=this.state$.value;e.forEach(o=>{if(i[this.getItemKey(o)]&&!t.overrideExisting){this.logger.warn(`Logger - ${this.className}: item with ${this.getItemKey(o)}
                    is already registered. Skipping.`);return}i[this.getItemKey(o)]=E({},o)}),this.state$.next(i),e.length>0&&this.updateStateFlags(!1)}getItem(e){return this.state$.value[e]}getItems(){return Object.values(this.state$.value)}reset(){this.state$.next({}),this.updateStateFlags(!0)}ngOnDestroy(){this.state$.complete()}updateStateFlags(e){this._isEmpty=e,this._stateVersion=zt()}static{this.\u0275fac=function(t){St()}}static{this.\u0275dir=ue({type:r})}}return r})();var J=class extends gr{constructor(){super(...arguments),this.formattersStateChanged$=this.stateChanged$}addFormatters(n,e={overrideExisting:!0}){super.addItems(n,e)}getFormatters(){return super.getItems()}getItemKey(n){return n.componentType}},vr=(()=>{class r extends J{constructor(e){super(e,"TableFormatterRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),Sr=(()=>{class r extends J{constructor(e){super(e,"KpiFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),Er=(()=>{class r extends J{constructor(e){super(e,"RiskScoreFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),Ir=(()=>{class r extends J{constructor(e){super(e,"ProportionalDonutContentFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),ps=(()=>{class r extends J{constructor(e){super(e,"ProportionalLegendFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var br=I(Ue());var W=new T("DATA_SOURCE_OUTPUT",()=>new $(1)),Se=new T("DATA_SOURCE_DESTROYED"),Ar=new T("DATA_SOURCE_CHANGE"),Tr=new T("DATA_SOURCE_CREATED",()=>new z({payload:void 0}));var Cr=I(le()),Rr=I(Ot());var Xi="WidgetConfiguratorSectionComponent",Pr=(()=>{class r{getPizzagnaUpdatedWithComponents(e,t,i){let s=e[h.Structure][t].properties?.template;return this.getPizzagnaWithChildren(e,i,s,t)}getPizzagnaWithChildren(e,t,i,o){let c=t.map(u=>({id:u,componentType:Xi})).reduce((u,g)=>this.updateChildPizzagna(u,i,g),e);return c=this.getPizzagnaWithNodesSet(c,o,t),c}updateChildPizzagna(e,t,i){let o=l(e,`${h.Structure}.${i.id}`,i),s=t.map(u=>D(E({},u),{id:`${i.id}/${u.id}`}));o=s.reduce((u,g)=>l(u,`${h.Structure}.${g.id}`,g),o);let c=s.map(u=>u.id);return o=this.getPizzagnaWithNodesSet(o,i.id,c),o}getPizzagnaWithNodesSet(e,t,i){let o=`${h.Structure}.${t}.properties.nodes`;return l(e,o,i)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();function yr(r){return r.providerKey?[r.pizzagnaKey||h.Data,r.componentId,"providers",r.providerKey,"properties",...r.propertyPath].join("."):[r.pizzagnaKey||h.Data,r.componentId,"properties",...r.propertyPath].join(".")}var d=(()=>{class r{constructor(e,t){this.eventBus=e,this.dynamicComponentCreator=t,this.pizzaChanged=new $(1)}updatePizzagna(e){this.pizzagna=e}updateComponents(e){this.components=e,this.pizzaChanged.next(e)}getComponent(e){let t=this.components[e];if(!t)throw new Error("Component '"+e+"' is not defined!");return t}setProperty(e,t){let i=typeof e=="string"?e:yr(e);this.eventBus.getStream(X).next({payload:{path:i,value:t}})}createComponentsFromTemplateWithProperties(e,t){let i=t.map(s=>s.id),o=this.dynamicComponentCreator.getPizzagnaUpdatedWithComponents(this.pizzagna,e,i);for(let s of t)for(let c of Object.keys(s.children))o=l(o,`${h.Data}.${c}.properties`,s.children[c]);this.updatePizzagna(o),this.eventBus.getStream(X).next({payload:{path:"",value:o}})}createComponentsFromTemplate(e,t){let i=this.dynamicComponentCreator.getPizzagnaUpdatedWithComponents(this.pizzagna,e,t);this.updatePizzagna(i),this.eventBus.getStream(X).next({payload:{path:"",value:i}})}removeComponents(e){(0,Cr.default)(e)?e.forEach(t=>this.removeComponent(t)):this.removeComponent(e)}removeComponent(e){let t=E({},this.pizzagna),i=this.pizzagna[h.Structure][e].properties?.nodes,o=[e,...i],s=[h.Structure,h.Configuration,h.Data];for(let c of s)if(t[c])for(let u of o)t[c]=(0,Rr.default)(t[c],u);this.eventBus.getStream(X).next({payload:{path:"",value:t}}),this.updatePizzagna(t)}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(Pr))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var B=(()=>{class r{constructor(e,t,i){this.eventBus=e,this.dataSource=t,this.pizzagnaService=i,this.destroy$=new A,this.dataSource&&(this.setupRefreshListener(),this.dataSource.outputsSubject.pipe(f(this.destroy$)).subscribe(o=>this.handleDataSourceUpdate(o)),this.dataSource.busy&&this.dataSource.busy.pipe(f(this.destroy$)).subscribe(o=>{this.eventBus.getStream(ne).next({payload:{componentId:this.componentId,busy:o}})}))}setupRefreshListener(){this.eventBus.getStream(N).pipe(f(this.destroy$)).subscribe(()=>this.handleRefresh())}handleRefresh(){this.eventBus.getStream(jt).next({}),this.dataSource.applyFilters()}handleDataSourceUpdate(e){this.lastValue=(0,br.default)(e?.result)?e:e?.result,this.updateOutput(this.lastValue),this.eventBus.getStream(W).next({payload:E({componentId:this.componentId},e)})}ngOnDestroy(){this.updateOutput(void 0);let e={payload:{componentId:this.componentId}};this.eventBus.getStream(Se).next(e);let t={payload:{componentId:this.componentId,busy:!1}};this.eventBus.getStream(ne).next(t),this.destroy$.next(),this.destroy$.complete()}updateConfiguration(e){e.componentId&&(this.componentId=e.componentId),this.updateAdapterProperties(e),this.updateDataSourceProperties(e),typeof this.lastValue<"u"&&this.updateOutput(this.lastValue)}updateAdapterProperties(e){this.propertyPath=e.propertyPath}updateDataSourceProperties(e){let t=e?.dataSource?.properties;if(this.dataSourceConfiguration!==t){this.dataSourceConfiguration=t;let i=this.dataSource;i?.updateConfiguration&&i.updateConfiguration(e.dataSource?.properties),this.eventBus.getStream(N).next({})}typeof this.dataSourceConfiguration>"u"&&typeof t>"u"&&setTimeout(()=>this.eventBus.getStream(N).next({}))}updateOutput(e){this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.propertyPath]},this.processOutput(e))}processOutput(e){return e}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(b,8),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Ee=class extends B{constructor(n,e,t){super(n,e,t),this.dataSource=e,this.drillstate=[],this.eventBus.getStream(xt).pipe(f(this.destroy$)).subscribe(i=>{this.dataSource.busy?.value||this.onDrilldown(i)}),this.registerFilters()}updateAdapterProperties(n){this.dataPath=n.dataPath,this.drillstate=n.drillstate||this.drillstate,this.groupBy=n.groupBy,this.componentsConfig=n.componentsConfig,this.navigationBarId=n.navigationBarId}updateOutput(n){let e=this.getWidgetInput(n,this.drillstate.length!==this.groupBy.length),t=`${h.Data}.${this.componentId}.properties`;if(this.pizzagnaService.setProperty(t,e),this.navigationBarId){let i=`${h.Data}.${this.navigationBarId}.properties.navBarConfig.label`,o=`${h.Data}.${this.navigationBarId}.properties.navBarConfig.isRoot`,s=`${h.Data}.${this.navigationBarId}.properties.navBarConfig.buttons.back.disabled`;this.pizzagnaService.setProperty(i,this.drillstate[this.drillstate.length-1]),this.pizzagnaService.setProperty(s,!!this.drillstate.length),this.pizzagnaService.setProperty(o,!this.drillstate.length)}}getWidgetInput(n,e){let t=this.componentsConfig[e?"group":"leaf"];return{[this.dataPath]:n,configuration:t}}onDrilldown(n){let{payload:e}=n;if(e.reset){this.drillstate=[],this.eventBus.next(N,{});return}if(e.back){this.drillstate.length=this.drillstate.length-1,this.eventBus.next(N,{});return}this.drillstate.push(e.id),this.eventBus.next(N,{})}registerFilters(){this.dataSource.registerComponent({group:{componentInstance:{getFilters:()=>({value:this.groupBy})}},drillstate:{componentInstance:{getFilters:()=>({value:this.drillstate})}}})}};Ee=L([_(0,x(p)),_(1,x(b)),G("design:paramtypes",[K,Object,d])],Ee);var Or=(()=>{class r{constructor(e){this.eventBus=e,this.destroy$=new A,e.streamAdded.pipe(f(this.destroy$)).subscribe(t=>{e.getStream({id:t}).pipe(f(this.destroy$)).subscribe(i=>{console.log(`${i.id}: `,i.payload)})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)(a(p))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var zr=(()=>{class r{constructor(e){this.eventBus=e,this.initializeSubscriptions()}updateConfiguration(e){this.properties=e}initializeSubscriptions(){this.eventBus.getStream(Vt).subscribe(e=>{(!this.properties?.interactionType||this.properties?.interactionType===e.payload?.interactionType)&&this.handleInteraction(e.payload)})}static{this.\u0275fac=function(t){return new(t||r)(a(p))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Ie=(()=>{class r{constructor(e){this.logger=e}template(e,t){let i=new RegExp(/\$\{([a-zA-Z0-9.]*)\}/g);return e.replace(i,(o,s)=>{try{return this.evaluate(s.split("."),t)??""}catch(c){return this.logger.error(c),""}})}evaluate(e,t){return e.reduce((i,o)=>i[o],t)}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var _r=(()=>{class r extends zr{constructor(e,t,i,o){super(e),this.window=t,this.logger=i,this.urlInteractionService=o}handleInteraction(e){if(!this.properties?.url){this.logger.warn("The target url has not been defined.");return}let t=this.urlInteractionService.template(this.properties.url,{data:e.data});t&&(this.properties.newWindow?this.window.open(t):this.window.location.href=t)}static{this.\u0275fac=function(t){return new(t||r)(a(p),a("windowObject"),a(C),a(Ie))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var wr=(()=>{class r{constructor(e,t,i){this.dataSource=e,this.pizzagnaService=t,this.destroy$=new A,this.propertyPath="backgroundColor",this.comparators=i.getComparators()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateConfiguration(e){e?.rules&&(this.rules=e?.rules,this.subscribeToDataChanges(),this.checkColorConditions())}setComponent(e,t){this.subscribeToDataChanges(),this.componentId=t}subscribeToDataChanges(){this.dataSource&&(this.dsSubscription$?.unsubscribe(),this.dsSubscription$=this.dataSource.outputsSubject.pipe(f(this.destroy$)).subscribe(e=>{this.latestValueFromDS=e.result?.value||this.latestValueFromDS,this.checkColorConditions()}))}checkColorConditions(){if(!this.rules)return;if(this.rules.length===0){this.setColor(void 0),this.dsSubscription$?.unsubscribe();return}let e,t=this.rules&&[...this.rules].reverse();for(let i of t)if(this.comparators[i.comparisonType]?.comparatorFn(this.latestValueFromDS,i.value)){e=i.color;break}this.setColor(e)}setColor(e){this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:[this.propertyPath]},e)}static{this.\u0275fac=function(t){return new(t||r)(a(b,8),a(d),a(ve))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var He=I(xi());var Ae=function(r){return r.Warning="var(--nui-color-semantic-warning)",r.Critical="var(--nui-color-semantic-critical)",r}(Ae||{});var Te=class extends B{constructor(n,e,t,i){super(n,e,t),this.numberPipe=i}updateConfiguration(n){this.thresholds=n.thresholds,super.updateConfiguration(n)}processOutput(n){let e=this.processThresholds(n);return this.processNumberFormat(e)}setComponent(n,e){e&&(this.componentId=e)}getThresholdColor(n,e,t){let i=this.getThresholdChecks(n,e,n.reversedThresholds);return i.warningCheck?Ae.Warning:i.criticalCheck?Ae.Critical:t}getThresholdChecks(n,e,t){let i=n.warningThresholdValue,o=n.criticalThresholdValue,s=!(0,He.default)(i)&&e.value<=i&&e.value>o,c=e.value<=o,u=!(0,He.default)(i)&&e.value>=i&&e.value<o,g=e.value>=o;return{warningCheck:t?s:u,criticalCheck:t?c:g}}processThresholds(n){if(!n||!this.thresholds?.showThresholds||typeof n.value!="number")return n;let e=this.getThresholdColor(this.thresholds,n,n.backgroundColor);return D(E({},n),{backgroundColor:e})}processNumberFormat(n){if(typeof n?.value!="number"||!n?.numberFormat)return n;let e=this.numberPipe.transform(n.value,n.numberFormat);return D(E({},n),{value:e})}};Te=L([_(0,x(p)),_(1,w()),_(1,x(b)),G("design:paramtypes",[K,Object,d,he])],Te);var Nr=I(le());var Dr=(()=>{class r{constructor(e,t){this.eventBus=e,this.pizzagnaService=t,this.brokers=[],this.builder=new We(this.brokers),this.destroySubscriptions$=new A,this.getMin=i=>Math.min(...i),this.getMax=i=>Math.max(...i),this.valuesObject=this.builder.valuesObject}updateConfiguration(e){this.properties=e,this.componentId&&this.createPropertiesAndSubscribeToBrokers()}configure(){return this.builder}getBrokers(){return this.brokers}subscribeToBrokers(){this.destroy(),this.brokers.forEach(e=>{e.in$.pipe(pe(t=>!!e.in$.observers.length),k(),M(t=>this.configureValueModel(t)),M(t=>this.processAndEmitSyncedValue(t,e)),f(this.destroySubscriptions$)).subscribe()})}setComponent(e,t){this.componentId=t,this.updateConfiguration(this.properties)}destroy(){this.destroySubscriptions$.next(),this.destroySubscriptions$.complete()}processAndEmitSyncedValue(e,t){let i=this.getMin;t?.type&&(i=t.type==="min"?this.getMin:this.getMax);let o=this.valuesObject[t.id].filter(s=>s.targetID&&s.targetValue).map(s=>s.targetValue);t.out$.next(D(E({},e),{targetValue:i([...o])}))}configureValueModel(e){let t=this.valuesObject[e.id].filter(i=>i.targetID===e.targetID);t.length?t[0].targetValue=e.targetValue:this.valuesObject[e.id].push({targetID:e.targetID,targetValue:e.targetValue})}createPropertiesAndSubscribeToBrokers(){this.tileNodes=this.pizzagnaService.getComponent(this.componentId).properties?.nodes;let{scaleSyncConfig:e}=this.properties;this.tileNodes?.length&&(this.tileNodes.forEach((t,i)=>{let o={componentId:t,pizzagnaKey:h.Data,propertyPath:["syncValuesBroker"]};this.pizzagnaService.setProperty(o,this.getBrokers())}),e&&(0,Nr.default)(e)&&(e.forEach(t=>this.configure().addBroker({id:t.id,type:t?.type})),this.subscribeToBrokers()))}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})(),We=class{constructor(n){this.brokers=n,this.valuesObject={}}addBroker(n){let e={id:n.id,targetID:"",targetValue:1};return this.valuesObject[n.id]=new Array,this.brokers.push(E(E({},n),this.getDefaultBrokerObject(e,e))),this}getDefaultBrokerObject(n,e){return{in$:new z(n),out$:new z(e)}}};var jr=I(fe()),xr=I(Ye());var Pe=(()=>{class r{constructor(e,t){this.eventBus=e,this.pizzagnaService=t,this.destroy$=new A,this.eventBus.getStream(W).pipe(f(this.destroy$)).subscribe(i=>{this.handleDataSourceOutput(i)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setComponent(e,t){this.componentId=t}handleDataSourceOutput(e){this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:["fallbackKey"],pizzagnaKey:h.Data},typeof e.payload?.error?.type<"u"?e.payload?.error?.type.toString():void 0)}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Fr=(()=>{class r extends Pe{constructor(e,t){super(e,t),this.multipleErrorFallbackKey=Ze.Unknown,this.errorMap={},this.eventBus.getStream(Se).pipe(f(this.destroy$)).subscribe(i=>{this.handleDataSourceDestroyed(i)})}updateConfiguration(e){e.multipleErrorFallbackKey&&(this.multipleErrorFallbackKey=e.multipleErrorFallbackKey)}handleDataSourceOutput(e){this.errorMap=this.updateErrorMap(e),this.setFallbackKeyProperty()}handleDataSourceDestroyed(e){e.payload?.componentId&&delete this.errorMap[e.payload.componentId],this.setFallbackKeyProperty()}setFallbackKeyProperty(){this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:["fallbackKey"],pizzagnaKey:h.Data},this.getFallbackKey())}getFallbackKey(){if((0,jr.default)(this.errorMap))return;let e=(0,xr.default)(Object.values(this.errorMap));return e.length===1?e[0]:this.multipleErrorFallbackKey}updateErrorMap(e){let t=this.errorMap,i=typeof e.payload?.error?.type<"u"?e.payload?.error?.type.toString():void 0;return i?i&&(t[e.payload.componentId]=i):delete t[e.payload.componentId],t}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var $r=I(fe());var Br=(()=>{class r{constructor(e,t){this.eventBus=e,this.pizzagnaService=t,this.loadingMap={},this.destroy$=new A,this.eventBus.getStream(ne).pipe(f(this.destroy$)).subscribe(({payload:i})=>{i?.componentId&&(i?.busy?this.loadingMap[i.componentId]=!0:delete this.loadingMap[i.componentId]),this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:["active"],pizzagnaKey:h.Data},!(0,$r.default)(this.loadingMap))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setComponent(e,t){this.componentId=t}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var qe=I(Z());function kr(r){let n=r.split("/");return n?.length>1?n[n.length-2]:r}var ro=/\{.*?\}/g,io=/\{|\}/g;function Ur(r,n){let e=r.match(ro);if(!e)return r;let t=r;for(let i of e){let o=oo(i);n[o]?t=t.replace(i,n[o]):console.warn(`There's no ${i} key found in the data: ${n}`)}return t}var oo=r=>r.replace(io,"");var Lr=(()=>{class r{constructor(e){this.pizzagnaService=e,this.defaultTrackOn="pizzagna",this.subscriptions=[]}setComponent(e,t){this.component=e,this.componentId=t,this.parentComponentId=kr(t),this.initChangeSubscriptions()}updateConfiguration(e){this.configs=e?.configs}initChangeSubscriptions(){for(let e of this.configs){let t=this.getObservableFor(e);if(!t){console.warn("no observable found on 'PizzagnaBroadcasterService', for part: ",e);return}let i=t.subscribe(o=>{for(let s of e.paths){let c=Ur(s,this);this.pizzagnaService.setProperty(c,o)}});this.subscriptions.push(i)}}getObservableFor(e){return(e.trackOn||this.defaultTrackOn)==="component"?this.getComponentObservableFor(e):this.getPizzagnaObservableFor(e)}getPizzagnaObservableFor(e){return this.pizzagnaService.pizzaChanged.pipe(F(t=>(0,qe.default)(t,e.key)),k())}getComponentObservableFor(e){return(0,qe.default)(this.component,e.key)?.pipe(k())}ngOnDestroy(){for(let e of this.subscriptions)e.unsubscribe()}static{this.\u0275fac=function(t){return new(t||r)(a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();function ye(r){r||(ft(ye),r=ht(vt));let n=new st(e=>r.onDestroy(e.next.bind(e)));return e=>e.pipe(f(n))}var Re=(()=>{class r{constructor(){this.disabled$=new z(!1),this.refreshRateSeconds$=new z(300)}get refreshRateSeconds(){return this.refreshRateSeconds$.value}set refreshRateSeconds(e){this.refreshRateSeconds$.next(e)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Gr=(()=>{class r{constructor(e,t,i){this.eventBus=e,this.ngZone=t,this.refresherSettings=i,this.enabled=!0,this.overrideDefaultSettings=!0,this.interval=300,this.eventDef=N,this.refresherSettings.refreshRateSeconds$.pipe(ye()).subscribe(()=>{this.overrideDefaultSettings||this.initializeInterval()}),this.refresherSettings.disabled$.pipe(ye()).subscribe(()=>{this.initializeInterval()})}updateConfiguration(e){this.interval=e.interval??300,this.enabled=e.enabled??!0,this.overrideDefaultSettings=e.overrideDefaultSettings??!0,this.eventDef=e.event??N,this.initializeInterval()}ngOnDestroy(){this.clearInterval()}initializeInterval(){this.clearInterval(),!(typeof this.interval>"u"||this.getInterval()<=0||this.enabled===!1||this.refresherSettings.disabled$.value===!0)&&this.ngZone.runOutsideAngular(()=>{this.intervalRef=setInterval(()=>{this.ngZone.run(()=>{this.performAction()})},this.getInterval()*1e3)})}performAction(){this.eventBus.getStream(this.eventDef).next({})}getInterval(){return this.overrideDefaultSettings?this.interval:this.refresherSettings.refreshRateSeconds}clearInterval(){typeof this.intervalRef<"u"&&(clearInterval(this.intervalRef),this.intervalRef=void 0)}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(de),a(Re))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var be=class extends B{constructor(n,e,t,i){super(n,e,t),this.virtualViewport=i}setupRefreshListener(){let n=ct(this.eventBus.getStream(Dt),this.eventBus.getStream(N)).pipe(dt(()=>this.eventBus.getStream(N).pipe(me(void 0))),M(()=>this.virtualViewport.reset({emitFirstPage:!1})),F(()=>{}));at(n,this.eventBus.getStream(Nt),this.eventBus.getStream(wt)).pipe(pt(10),M(()=>this.handleRefresh()),f(this.destroy$)).subscribe()}updateAdapterProperties(n){this.dataPath=n.dataPath,this.dataFieldsPath=n.dataFieldsPath,this.totalItemsPath=n.totalItemsPath}updateOutput(n){let e=n?.paginator?.total,t=n?.repeat?.itemsSource,i=n?.dataFields;this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.totalItemsPath]},e),this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.dataPath]},t),this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.dataFieldsPath]},i)}};be=L([_(0,x(p)),_(1,x(b)),_(3,w()),G("design:paramtypes",[K,Object,d,se])],be);var Mr=I(Ui());var Oe=class extends B{constructor(n,e,t){super(n,e,t),this.seriesIndex=[]}updateConfiguration(n){this.seriesIndex=(0,Mr.default)(n.series),super.updateConfiguration(n)}processOutput(n){return n&&D(E({},n),{series:this.buildSeriesSet(n?.series)})}buildSeriesSet(n){return n?n.filter(e=>this.seriesIndex.find(t=>t.selectedSeriesId===e.id)).map(e=>({id:e.id,data:e.data,link:e.link,secondaryLink:e.secondaryLink,legendDescriptionPrimary:this.seriesIndex.find(t=>t.selectedSeriesId===e.id)?.label,legendDescriptionSecondary:e.description})):[]}};Oe=L([_(0,x(p)),_(1,x(b)),G("design:paramtypes",[K,Object,d])],Oe);var ze=(()=>{class r{constructor(){}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Zr=I(Ue());var Kr=(()=>{class r{constructor(e,t){this.eventBus=e,this.dashwizService=t,this.onDestroy$=new A,this.dataSourceCreated$=new A,this.error$=new A,this.busy$=new z(!1),this.dataSourceFields$=new z([]),this.eventBus.subscribeUntil(Tr,this.onDestroy$,i=>{i.payload&&this.onDataSourceCreated(i.payload)}),this.eventBus.subscribeUntil(W,this.onDestroy$,i=>{if(i.payload?.error)this.error$.next(i.payload.error);else{this.error$.next(null);let o=(0,Zr.default)(i.payload.result)?i.payload:i.payload.result||{};o?.dataFields&&this.dataSourceFields$.next(o.dataFields)}})}onDataSourceCreated(e){this.dataSource=e,this.dataSourceCreated$.next(),this.dataSource.busy?.pipe(f(this.dataSourceCreated$)).subscribe(t=>{this.dashwizService?.component?.navigationControl.next({busyState:{busy:t},allowStepChange:!t}),this.busy$.next(t)})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(ze))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Xe=I(Z()),Hr=I(Ge());var S=(()=>{class r{constructor(){this.previewChanged=new A}get preview(){return this._preview}set preview(e){this._preview=e,this.previewChanged.next(e)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var y=(()=>{class r{constructor(e,t,i){this.eventBus=e,this.previewService=t,this.pizzagnaService=i,this.destroy$=new A}ngAfterViewInit(){this.buildForm(),this.toPreview(this.component.form)}setComponent(e,t){this.component=e,this.componentId=t}getPreview(){return this.previewService.preview}updatePreview(e){this.previewService.preview=e}updateFormPizzagna(e){this.pizzagnaService.updatePizzagna(e),this.eventBus.getStream(X).next({payload:{path:"",value:e}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Wr=(()=>{class r extends y{get previewComponentId(){return this.componentId.split("/")[0]}constructor(e,t,i){super(e,t,i)}updateConfiguration(e){e&&e.formParts&&(this.formParts=e.formParts)}buildForm(){let e=this.getPreview(),t=this.formParts.reduce((i,o)=>{let s=`${this.previewComponentId}.${o.previewPath}`,c=(0,Xe.default)(e,s);if(c)for(let u of o.keys)c[u]!==void 0&&(i=l(i,`${h.Data}.${this.componentId}.properties.${u}`,c[u]));return i},this.pizzagnaService.pizzagna);this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=this.formParts.reduce((o,s)=>{let c=s.previewOutputPath||s.previewPath;c=`${this.previewComponentId}.${c}`;let u=(0,Xe.default)(o,c),g=(0,Hr.default)(t,s.keys),P=E(E({},u),g);return l(o,`${c}`,P)},this.getPreview());this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Jr=I(Xr()),Qr=I(Me()),ei=I(Ot());var ti=(()=>{class r extends y{constructor(e,t,i){super(e,t,i),this.shouldReadForm=!1}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.getPreview(),t=e?.tiles?.properties?.nodes?.map(s=>({id:s,componentType:e[s].componentType}))||[],i=t?.map(s=>s.id);this.pizzagnaService.createComponentsFromTemplate("tiles",i);let o=this.pizzagnaService.pizzagna;o=l(o,`${h.Data}.tiles.properties.tiles`,t),setTimeout(()=>this.shouldReadForm=!0),this.updateFormPizzagna(o)}toPreview(e){e.get("tiles")?.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{if(!this.shouldReadForm)return;let i=this.getPreview(),o=(t||[]).map(u=>u.id),s=(0,Jr.default)(i?.tiles?.properties?.nodes,o);s.length&&(i=(0,ei.default)(i,s));let c=(0,Qr.default)(t,u=>u.id);i=l(i,"tiles.properties.nodes",o);for(let u of o){let g=c[u];if(g&&!i[g.id]){let P=this.getTileConfiguration(g.id,g.componentType);i=l(i,g.id,P)}}this.updatePreview(i)})}getTileConfiguration(e,t){return{id:e,providers:{dataSource:{providerId:void 0}}}}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var ri=(()=>{class r extends y{constructor(e,t,i){super(e,t,i),this.PROPERTIES_PATH=`${h.Configuration}.chartOptionsEditor.properties`}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.getPreview().chart?.properties?.configuration?.chartOptions,t=this.pizzagnaService.pizzagna;t=l(t,`${this.PROPERTIES_PATH}.chartType`,e?.type??void 0),t=l(t,`${this.PROPERTIES_PATH}.legendPlacement`,e?.legendPlacement??Ke.None),t=l(t,`${this.PROPERTIES_PATH}.legendFormatterComponentType`,e?.legendFormatter?.componentType??""),t=l(t,`${this.PROPERTIES_PATH}.contentFormatterComponentType`,e?.contentFormatter?.componentType??"DonutContentRawFormatterComponent"),t=l(t,`${this.PROPERTIES_PATH}.contentFormatterProperties`,e?.contentFormatter?.properties??""),this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=l(this.getPreview(),"chart.properties.configuration.chartOptions",t);this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Je=I(Z()),Qe=I(Ge());var ii=(()=>{class r extends y{get previewComponentId(){return this.componentId.split("/")[0]}constructor(e,t,i){super(e,t,i)}updateConfiguration(e){e&&e.formParts&&(this.formParts=e.formParts)}buildForm(){let e=this.getPreview(),t=this.formParts.reduce((i,o)=>{let c=(0,Je.default)(e,o.previewPath)?.find(g=>g.id===this.previewComponentId),u=(0,Qe.default)(c,o.keys);return i=l(i,`${h.Data}.${this.componentId}.properties`,u),i},this.pizzagnaService.pizzagna);this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=this.formParts.reduce((o,s)=>{let c=s.previewOutputPath||s.previewPath,u=(0,Je.default)(o,c),g=u.findIndex(De=>De.id===this.previewComponentId),P=u[g],O=(0,Qe.default)(t,s.keys),re=E(E({},P),O);return l(o,`${c}[${g}]`,re)},this.getPreview());this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var et=I(Z()),oi=I(Ge());var si=(()=>{class r extends y{constructor(e,t,i){super(e,t,i)}updateConfiguration(e){e&&e.formParts&&(this.formParts=e.formParts)}buildForm(){let e=this.getPreview(),t=this.formParts.reduce((i,o)=>{let s=(0,et.default)(e,o.previewPath);if(s)for(let c of o.keys)s[c]!==void 0&&(i=l(i,`${h.Data}.${this.componentId}.properties.${c}`,s[c]));return i},this.pizzagnaService.pizzagna);this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=this.formParts.reduce((o,s)=>{let c=s.previewOutputPath||s.previewPath,u=(0,et.default)(o,c),g=(0,oi.default)(t,s.keys),P=E(E({},u),g);return l(o,c,P)},this.getPreview());this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var _e=class r extends y{static{this.PROPERTIES_PATH=`${h.Configuration}.titleAndDescription.properties`}constructor(n,e,t){super(n,e,t)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let n=this.pizzagnaService.pizzagna,e=this.getPreview()?.header?.properties;n=l(n,`${r.PROPERTIES_PATH}.title`,e?.title),n=l(n,`${r.PROPERTIES_PATH}.subtitle`,e?.subtitle),n=l(n,`${r.PROPERTIES_PATH}.url`,e?.url),n=l(n,`${r.PROPERTIES_PATH}.description`,e?.description),n=l(n,`${r.PROPERTIES_PATH}.collapsible`,e?.collapsible),this.updateFormPizzagna(n)}toPreview(n){n.valueChanges.pipe(f(this.destroy$)).subscribe(e=>{let t=l(this.getPreview(),"header.properties",e);this.updatePreview(t)})}static{this.\u0275fac=function(e){return new(e||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}};var ni=I(Z()),ai=I(fe()),ci=I(Ct());var pi=(()=>{class r extends y{constructor(e,t,i){super(e,t,i)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.getPreview()?.table,t=e?.properties?.dataFields,i=e?.properties?.configuration?.columns,o=this.pizzagnaService.pizzagna;o=l(o,`${h.Data}.columns.properties.columns`,i??[]),o=l(o,`${h.Data}.columns.properties.dataFields`,t),this.updateFormPizzagna(o)}toPreview(e){let t=e.contains("columnsOutput")?e.get("columnsOutput"):e.get("columns");if(!t)throw new Error("FormControl is not defined!");t.valueChanges.pipe(f(this.destroy$),k(ci.default)).subscribe(i=>{let o="table.properties.configuration.columns";setTimeout(()=>{let c=this.getPreview();this.updatePreview(l(c,o,i))});let s=this.pizzagnaService.pizzagna;setTimeout(()=>{s=l(s,`${h.Structure}.columns.properties.template`,this.pizzagnaService.pizzagna[h.Structure].columns.properties?.template),s=l(s,`${h.Data}.filters.properties.columns`,i),s=l(s,`${h.Structure}.presentation.properties.nodes`,[...s?.structure?.presentation?.properties?.nodes??[]]),this.updateFormPizzagna(s)})}),this.subscribeToColumnsValueChange()}subscribeToColumnsValueChange(){this.component.form.get("columnsOutput")?.valueChanges.pipe(me(this.component.form.get("columnsOutput").value),pe(e=>e.length>0),M(()=>this.handleWidthValidation()),F(e=>this.filterColumnsWithoutSpecifiedWidth(e)),F(e=>this.handleColumnsWithoutSpecifiedWidth(e)),mt("id"),ut("id"),f(this.destroy$)).subscribe(e=>this.setWidthMessages(e))}filterColumnsWithoutSpecifiedWidth(e){return e.filter(t=>t.isActive&&!t.width)}handleColumnsWithoutSpecifiedWidth(e){switch(e.length){case 0:{let t=this.component.form.get("columns").controls.filter(o=>(0,ni.default)(o,`value.properties[${o.value.id}/description].isActive`));if((0,ai.default)(t))return{id:void 0,label:void 0};let i=t[t.length-1];return console.warn(`Cannot set width for all columns. Resetting "${i.value.label}" width.`),i.patchValue({width:null},{emitEvent:!1}),i.value}case 1:return e[0];default:return{id:void 0,label:void 0}}}handleWidthValidation(){this.component.form.get("columns").controls.forEach(e=>{let t=`properties.${e.value.id}/description`,i=e.get(t);if(!i)return;let o=i.get("isActive")?.value,s=i.get("width");o?(s?.setValidators([Rt.min(62)]),s?.markAllAsTouched(),s?.updateValueAndValidity({emitEvent:!1})):(s?.clearValidators(),s?.updateValueAndValidity({emitEvent:!1}))})}setWidthMessages(e){if(!this.pizzagnaService.pizzagna)return;let t="isWidthMessageDisplayed",{pizzagna:i}=this.pizzagnaService;(i.data.columns.properties?.columns).forEach(s=>this.pizzagnaService.setProperty(`${h.Data}.${s.id}/description.properties.${t}`,!1)),e&&this.pizzagnaService.setProperty(`${h.Data}.${e}/description.properties.${t}`,!0)}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var mi=(()=>{class r extends y{constructor(e,t,i){super(e,t,i)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.pizzagnaService.pizzagna,t=this.getPreview()?.table,i=t?.properties?.configuration?.columns,o=t?.properties?.configuration?.sorterConfiguration;e=l(e,`${h.Data}.filters.properties.columns`,i),e=l(e,`${h.Data}.filters.properties.sorterConfiguration`,o),this.updateFormPizzagna(e)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=this.getPreview();i=l(i,"table.properties.configuration.sorterConfiguration",t.sorterConfiguration),this.updatePreview(i),this.buildForm()})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var ui=(()=>{class r extends y{constructor(e,t,i){super(e,t,i)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.pizzagnaService.pizzagna,t=this.getPreview()?.table,i=t?.properties?.configuration?.paginatorConfiguration,o=t?.properties?.configuration?.hasVirtualScroll,s=t?.properties?.configuration?.scrollType;e=l(e,`${h.Data}.scrollType.properties.paginatorConfiguration`,i),e=l(e,`${h.Data}.scrollType.properties.hasVirtualScroll`,o),e=l(e,`${h.Data}.scrollType.properties.scrollType`,s),this.updateFormPizzagna(e)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=this.getPreview();i=l(i,"table.properties.configuration.hasVirtualScroll",!1),i=l(i,"table.properties.configuration.scrollType",t.paginatorConfiguration.scrollType),i=l(i,"table.properties.configuration.paginatorConfiguration.pageSizeSet",t.paginatorConfiguration.pageSizeSet),i=l(i,"table.properties.configuration.paginatorConfiguration.pageSize",t.paginatorConfiguration.pageSize),this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Q=I(Z());var di=(()=>{class r extends y{constructor(e,t,i,o){super(e,t,i),this.timeframeService=o}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.pizzagnaService.pizzagna,t=this.getPreview(),i=Object.keys(this.timeframeService.currentPresets).map(g=>({id:g,name:this.timeframeService.currentPresets[g].name})),o=`${h.Data}.timeseriesMetadata.properties`;e=l(e,`${o}.timeSpans`,i);let s=(0,Q.default)(t,"timeframeSelection.properties.timeframe.selectedPresetId","last7Days"),c=i.find(g=>g.id===s);c&&(e=l(e,`${o}.startingTimespan`,c));let u=(0,Q.default)(t,"chart.properties.configuration");u&&(e=l(e,`${o}.legendPlacement`,u.legendPlacement),e=l(e,`${o}.leftAxisLabel`,u.leftAxisLabel),e=l(e,`${o}.preset`,u.preset)),this.updateFormPizzagna(e)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=this.getPreview(),o=(0,Q.default)(t,"startingTimespan.id");o&&(i=l(i,"timeframeSelection.properties.timeframe.selectedPresetId",o));let s="chart.properties.configuration";i=l(i,`${s}.legendPlacement`,(0,Q.default)(t,"legendPlacement","")),i=l(i,`${s}.leftAxisLabel`,(0,Q.default)(t,"leftAxisLabel","")),i=l(i,`${s}.preset`,(0,Q.default)(t,"preset","")),this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d),a(oe))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Y=I(Z()),tt=I(fe()),hi=I(Ct()),li=I(Ue());var fi=(()=>{class r extends y{constructor(e,t,i){super(e,t,i),this.indicatorDataKey="indicatorData",this.previewSeriesPath=`providers.${ce.Adapter}.properties.series`,this.formSeriesComponentPath=`${h.Data}.series.properties`,this.dataSourceSeries$=new A,this.selectedSeriesIds$=new A,this.shouldReadForm=!1,this.subscribeToAvailableDataFieldsChange(),this.eventBus.subscribeUntil(Ar,this.destroy$,o=>{let s=`${h.Structure}.series.properties.nodes`,c=(0,Y.default)(this.pizzagnaService.pizzagna,s);this.pizzagnaService.removeComponents(c);let u=this.pizzagnaService.pizzagna;u=l(u,s,[]),u=l(u,`${this.formSeriesComponentPath}.series`,[]),this.updateFormPizzagna(u)}),this.eventBus.subscribeUntil(W,this.destroy$,o=>{let{series:s}=(0,li.default)(o.payload.result)?o.payload:o.payload.result||{};if(s){this.dataSourceSeries$.next(s);let c=this.pizzagnaService.pizzagna;c=l(c,`${this.formSeriesComponentPath}.allSeries`,s);let g=(this.pizzagnaService.pizzagna[h.Structure][this.component.componentId].properties?.template).findIndex(ie=>ie.id===this.indicatorDataKey),P=`${h.Structure}.series.properties.template[${g}].properties.allSeries`;c=l(c,P,s),c=(0,Y.default)(this.getPreview(),`chart.${this.previewSeriesPath}`,[]).reduce((ie,Ve)=>l(ie,`${h.Data}.${Ve.id}/${this.indicatorDataKey}.properties.allSeries`,s),c),this.updateFormPizzagna(c);let re=`${this.formSeriesComponentPath}.series`,De=(0,Y.default)(this.pizzagnaService.pizzagna,re);if((0,tt.default)(De)){this.shouldReadForm=!1;let ie=s.map(je=>({id:je.id,selectedSeriesId:je.id,label:je.name})),Ve=l(this.getPreview(),`chart.${this.previewSeriesPath}`,ie);this.updatePreview(Ve),this.buildForm(),setTimeout(()=>{this.updateAvailableSeries([]),this.shouldReadForm=!0})}}})}buildForm(){let e=this.getPreview(),t=(0,Y.default)(e,`chart.${this.previewSeriesPath}`,[]),i=t.map(u=>({id:u.id,selectedSeriesId:u.selectedSeriesId})),o=t.map(u=>u.id);this.pizzagnaService.createComponentsFromTemplate("series",o);let s=this.pizzagnaService.pizzagna,c=l(s,`${this.formSeriesComponentPath}.series`,i);this.updateFormPizzagna(c),this.selectedSeriesIds$.next(i.map(u=>u.selectedSeriesId)),setTimeout(()=>this.shouldReadForm=!0)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{if(!this.shouldReadForm)return;let i=this.getPreview(),{chart:o}=i,s=(0,Y.default)(o,this.previewSeriesPath,[]),c=t.map(P=>E({id:P.id,selectedSeriesId:P.selectedSeriesId},s.find(O=>O.id===P.id))),u=l(i,`chart.${this.previewSeriesPath}`,c);this.updatePreview(u);let g=t.map(P=>(0,Y.default)(P,`properties[${P.id}/indicatorData].id`)).filter(P=>!(0,tt.default)(P));this.selectedSeriesIds$.next(g)})}ngOnDestroy(){this.dataSourceSeries$.complete(),this.selectedSeriesIds$.complete(),super.ngOnDestroy()}updateAvailableSeries(e){if(!this.pizzagnaService.pizzagna)return;let t=this.pizzagnaService.pizzagna;t=l(t,`${this.formSeriesComponentPath}.availableSeries`,e);let o=(this.pizzagnaService.pizzagna[h.Structure][this.component.componentId].properties?.template).findIndex(u=>u.id===this.indicatorDataKey),s=`${h.Structure}.series.properties.template[${o}].properties.availableSeries`;t=l(t,s,e),t=(0,Y.default)(this.pizzagnaService.pizzagna,`${h.Structure}.series.properties.nodes`).reduce((u,g)=>l(u,`${h.Data}.${g}/${this.indicatorDataKey}.properties.availableSeries`,e),t),this.updateFormPizzagna(t)}subscribeToAvailableDataFieldsChange(){nt([this.dataSourceSeries$,this.selectedSeriesIds$]).pipe(f(this.destroy$),F(([e,t])=>e.filter(i=>!t.find(o=>o===i.id))),k(hi.default)).subscribe(this.updateAvailableSeries.bind(this))}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var rt=I(Z());var gi=(()=>{class r extends y{get previewComponentId(){return this.componentId.split("/")[0]}constructor(e,t,i){super(e,t,i),this.previewSeriesPath=`chart.providers.${ce.Adapter}.properties.series`}buildForm(){let t=(0,rt.default)(this.getPreview(),this.previewSeriesPath,[]).find(s=>s.id===this.previewComponentId),i=t&&t.selectedSeriesId,o=l(this.pizzagnaService.pizzagna,`${h.Data}.${this.componentId}.properties`,{selectedSeriesId:i});this.updateFormPizzagna(o)}toPreview(e){e.valueChanges.pipe(f(this.destroy$)).subscribe(t=>{let i=t.id,o=this.getPreview(),s=(0,rt.default)(o,this.previewSeriesPath,[]),c=s.findIndex(u=>u.id===this.previewComponentId);if(c>-1){let u=[...s];u[c]=D(E({},u[c]),{selectedSeriesId:i});let g=l(o,`${this.previewSeriesPath}`,u);this.updatePreview(g)}})}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var j=new U("CONFIGURATOR_CONVERTER");var we=(()=>{class r{constructor(){this.events={}}registerEvent(e){this.events[e.id]=e}getEvent(e){let t=this.events[e];if(!t)throw new Error("Event with id '"+e+"' is not registered. Registered events are: "+JSON.stringify(Object.keys(this.events)));return t}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ne=(()=>{class r{updateWidget(e){this.widget=e}getWidget(){return this.widget}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var vi=I(Me()),Si=I(Ye());var Ei=(()=>{class r{constructor(e,t,i,o,s){this.pizzagnaBus=e,this.dashboardBus=t,this.widgetConfigurationService=i,this.eventRegistry=o,this.pizzagnaService=s,this.upstreamSubscriptions={},this.downstreamSubscriptions={},this.destroy$=new A}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setComponent(e){this.component=e}updateConfiguration(e){this.providerKey=e.providerKey,this.upstreams=e.upstreams,this.downstreams=e.downstreams,this.upstreams&&this.registerUpstreamSubscriptions(...this.upstreams),this.downstreams&&this.registerDownstreamSubscriptions(...this.downstreams)}addUpstream(e){this.addStream(e,"upstreams")}addDownstream(e){this.addStream(e,"downstreams")}addStream(e,t){let i=(0,Si.default)((this[t]||[]).concat(e.id));this[t]=i,this.component&&this.pizzagnaService.setProperty({componentId:this.component.componentId,pizzagnaKey:h.Data,providerKey:this.providerKey,propertyPath:[t]},i)}registerUpstreamSubscriptions(...e){this.dashboardBus&&this.registerSubscriptions(e,this.upstreamSubscriptions,this.pizzagnaBus,(t,i)=>{let o=this.widgetConfigurationService.getWidget().id;this.dashboardBus.getStream(t).next(Object.assign({},i,{widgetId:o}))})}registerDownstreamSubscriptions(...e){this.dashboardBus&&this.registerSubscriptions(e,this.downstreamSubscriptions,this.dashboardBus,(t,i)=>{let o=this.widgetConfigurationService.getWidget().id;(typeof i.widgetId>"u"||o===i.widgetId)&&this.pizzagnaBus.getStream(t).next(i)})}registerSubscriptions(e=[],t,i,o){let s=e?(0,vi.default)(e,c=>c):null;for(let c of Object.keys(t))(!s||!s[c])&&(t[c].unsubscribe(),delete t[c]);for(let c of Object.keys(s??{}).filter(u=>!t[u])){let u=this.eventRegistry.getEvent(c);t[c]=i.getStream(u).pipe(f(this.destroy$)).subscribe(g=>{o(u,g)})}}static{this.\u0275fac=function(t){return new(t||r)(a(p),a(ge,8),a(Ne,8),a(we),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Ii=(()=>{class r{constructor(e){this.logger=e,this.staticProviders={},this.setProviders({[Ft]:{provide:Gr,deps:[p,de,Re]},[Wt]:{provide:Ei,deps:[p,[new w,ge],[new w,Ne],we,d]},[$t]:{provide:B,deps:[p,[new w,b],d]},[Jt]:{provide:be,deps:[p,[new w,b],d,se]},[Bt]:{provide:Oe,deps:[p,[new w,b],d]},[kt]:{provide:Te,deps:[p,[new w,b],d,he]},[Ut]:{provide:Ee,deps:[p,[new w,b],d]},[Lt]:{provide:wr,deps:[[new w,b],d,ve]},[Gt]:{provide:j,useClass:_e,deps:[p,S,d]},[Mt]:{provide:j,useClass:ri,deps:[p,S,d]},[Zt]:{provide:j,useClass:ti,deps:[p,S,d]},[tr]:{provide:j,useClass:Wr,deps:[p,S,d]},[Qt]:{provide:j,useClass:si,deps:[p,S,d]},[er]:{provide:j,useClass:ii,deps:[p,S,d]},[rr]:{provide:j,useClass:gi,deps:[p,S,d,oe]},[Kt]:{provide:j,useClass:di,deps:[p,S,d,oe]},[Ht]:{provide:j,useClass:fi,deps:[p,S,d]},[Yt]:{provide:j,useClass:pi,deps:[p,S,d]},[qt]:{provide:j,useClass:mi,deps:[p,S,d]},[Xt]:{provide:j,useClass:ui,deps:[p,S,d]},[ir]:{provide:Br,deps:[p,d]},[or]:{provide:Pe,deps:[p,d]},[sr]:{provide:Fr,deps:[p,d]},[nr]:{provide:Dr,deps:[p,d]},[ar]:{provide:_r,deps:[p,"windowObject",C,Ie]},[cr]:{provide:Or,deps:[p]},[mr]:{provide:se,deps:[]},[pr]:{provide:Lr,deps:[d]},[ur]:{provide:ae,useExisting:vr,deps:[d]},[dr]:{provide:ae,useExisting:Sr,deps:[d]},[hr]:{provide:ae,useExisting:Er,deps:[d]},[lr]:{provide:ae,useExisting:Ir,deps:[d]},[fr]:{provide:Kr,deps:[p,[new w,ze]]}})}setProviders(e){this.staticProviders=Object.assign({},this.staticProviders,e)}getProvider(e){let t=this.staticProviders[e];return t||(this.logger.warn("No provider registered for id",e),this.logger.warn("Known providers:",Object.keys(this.staticProviders).join(", "))),t}getProviderInstance(e,t){return q.create({providers:[e],parent:t}).get(b)}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ai=(()=>{class r{constructor(e){this.logger=e,this.components={}}registerByLateLoadKey(e){this.registerComponentType(e.lateLoadKey,e)}registerComponentType(e,t){this.components[e]=t}getComponentType(e){let t=this.components[e];return t||this.logger.warn("Component '"+e+"' not defined. Available components: "+JSON.stringify(Object.keys(this.components))),t}static{this.\u0275fac=function(t){return new(t||r)(a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var yi=I(le()),Ci=I(ki()),Ri=I(Pi());function it(r,...n){let e=n.filter(c=>typeof c.previousValue<"u"||typeof c.currentValue<"u");if(!(0,Ci.default)(e,c=>c.currentValue!==c.previousValue))return r;if(e.length===1)return e[0].currentValue;let t=To(e);if(!["object","object[]"].includes(t))return Ao(e);let i=(0,Ri.default)(...e.map(c=>typeof c.currentValue=="object"?Object.keys(c.currentValue||{}):[])),o=t==="object[]"?[]:{};return i.reduce((c,u)=>{let g=typeof r>"u"||r===null||typeof r[u]>"u"?void 0:r[u],P=e.map(O=>({previousValue:typeof O.previousValue>"u"||O.previousValue==null?void 0:O.previousValue[u],currentValue:typeof O.currentValue>"u"||O.currentValue==null?void 0:O.currentValue[u]}));return c[u]=it(g,...P),c},o)}function Ao(r){for(let n=r.length-1;n>=0;n--){let e=r[n].currentValue;if(typeof e<"u")return e}}function To(r){for(let n of r){let e=typeof n.currentValue;if(e!=="undefined"&&n.currentValue!=null)return(0,yi.default)(n.currentValue)?typeof n.currentValue[0]==="object"?"object[]":"array":n.currentValue.constructor!==Object?"advanced":e}return"undefined"}var bi=(()=>{class r{static{this.lateLoadKey="TemplateLoadErrorComponent"}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=lt({type:r,selectors:[["ng-component"]],decls:3,vars:0,template:function(t,i){t&1&&(It(0,"code")(1,"pre"),Tt(2,"Template load error!"),At()())},encapsulation:2})}}return r})();var Oi=(()=>{class r{constructor(e,t){this.componentRegistry=e,this.logger=t}createComponentPortal(e,t){let i;return typeof e=="string"?i=this.componentRegistry.getComponentType(e):i=e,i||(this.logger.error(`Cannot Find Component Type ${e}`),i=bi),new bt(i,null,t)}createInjector(e){let t=e.providers||[];return q.create({providers:t,parent:e.injector,name:"Component Injector"})}static{this.\u0275fac=function(t){return new(t||r)(a(Ai),a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Vi=I(le()),ji=I($i()),ot=I(Di());var sd=(()=>{class r{constructor(e,t,i,o,s){this.injector=e,this.logger=t,this.portalService=i,this.renderer=o,this.providerRegistry=s,this.output=new Fe,this.propertiesChanges=new $,this.providerInstances={},this.destroy$=new A}ngOnInit(){this.logger.debug("Portal created:",this.componentId),this.recreatePortal()}ngAfterViewInit(){Object.keys(this.providerInstances).forEach(e=>{let t=this.providerInstances[e];t.ngAfterViewInit&&t.ngAfterViewInit()})}ngOnChanges(e){let t=!1,i=e.providers;i&&!i.isFirstChange()&&(this.checkForProviderChanges(i)?(this.logger.debug("Portal recreated (provider change):",this.componentId),this.recreatePortal(),t=!0):this.updateProviderConfigurations(i)),e.componentType&&!e.componentType.isFirstChange()&&!t&&(this.logger.debug("Portal recreated (component change):",this.componentId),this.recreatePortal()),e.properties&&this.propertiesChanges.next(e.properties)}ngOnDestroy(){this.logger.debug("Portal destroyed:",this.componentId),this.destroyProviders(),this.listenerUnsubscriber?.(),this.destroy$.next(),this.destroy$.complete()}attached(e){this.component=e.instance,this.listenerUnsubscriber=this.renderer.listen(e.location.nativeElement,"click",t=>{(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.button===0&&(console.log("==================== PIZZAGNA DUMP ========================="),console.log("componentId:",this.componentId),console.log("component:",this.component),console.log("componentType:",this.componentType),console.log("properties:",this.properties),console.log("providers:",this.providers),console.log("providerInstances:",this.providerInstances),console.log("============================================================"))});for(let t of Object.keys(this.providerInstances)){let i=this.providerInstances[t];i.setComponent&&i.setComponent(this.component,this.componentId),i.setProviders&&i.setProviders(this.providerInstances,this.componentId)}this.subscribeToOutputs(),this.changesSubscription=this.propertiesChanges.pipe(f(this.destroy$)).subscribe(t=>this.applyPropertiesChange(t))}recreatePortal(){this.changesSubscription&&(this.changesSubscription.unsubscribe(),this.changesSubscription=void 0,this.propertiesChanges=new $);let e=this.injector;if(this.destroyProviders(),this.providers&&(e=this.updateProviders(e)),this.portal=this.portalService.createComponentPortal(this.componentType,e),this.properties)for(let t of Object.keys(this.properties))this.propertiesChanges.next(new xe(void 0,this.properties,!0))}updateProviders(e){let t=Object.keys(this.providers),i=t.reduce((s,c)=>(this.providers[c].providerId&&(s[c]=this.providerRegistry.getProvider(this.providers[c].providerId)),s),{}),o=this.portalService.createInjector({injector:e,providers:(0,ji.default)(i)});this.providerInstances=t.reduce((s,c)=>{let u=i[c],g=this.providers[c];if(u){let P=o.get(u.provide,null),O=(0,Vi.default)(P)?P.find(re=>re instanceof u.useClass):P;if(!O)throw new Error("Provider '"+c+"' does not exist.");O.updateConfiguration&&g.properties&&O.updateConfiguration(E({providerKey:c},g.properties||{})),O.providerKey=c,s[c]=O}else g.providerId&&this.logger.error("There's no registered provider for id",c);return s},this.providerInstances);for(let s of Object.keys(this.providerInstances)){let c=this.providerInstances[s];c.ngOnInit&&c.ngOnInit()}return o}updateProviderConfigurations(e){for(let t of Object.keys(this.providers)){if(!this.providers[t].providerId)return;let i=this.providerInstances[t];if(!i)throw new Error("Provider '"+t+"' does not exist.");let o=e.previousValue[t],s=e.currentValue[t],c=o&&o.properties,u=s&&s.properties;c!==u&&i.updateConfiguration&&i.updateConfiguration(E({providerKey:t},u))}}subscribeToOutputs(){if(this.outputs)for(let e of this.outputs.filter(t=>this.component[t]instanceof Fe))this.component[e].pipe(f(this.destroy$)).subscribe(t=>{this.output.emit({id:e,payload:t})})}checkForProviderChanges(e){let t=e.previousValue?Object.keys(e.previousValue):[],i=e.currentValue?Object.keys(e.currentValue):[];if(t.length!==i.length||(0,ot.default)(t,i).length>0)return!0;let o=Object.keys(e.previousValue).map(c=>e.previousValue[c].providerId),s=Object.keys(e.currentValue).map(c=>e.currentValue[c].providerId);return(0,ot.default)(o,s).length>0}destroyProviders(){if(this.providerInstances)for(let e of Object.keys(this.providerInstances)){let t=this.providerInstances[e];t.ngOnDestroy&&t.ngOnDestroy(),delete this.providerInstances[e]}}applyPropertiesChange(e){let t=e.currentValue;if(!t)return;t=D(E({},t),{componentId:this.componentId});let i={},o=!1;for(let s of Object.keys(t)){let c=this.component[s];t[s]!==c&&(o=!0,this.component[s]=t[s],this.component.ngOnChanges&&(i[s]=new xe(c,t[s],e.isFirstChange())))}if(o){this.component.ngOnChanges&&this.component.ngOnChanges(i);let s=this.component.changeDetector;s?s.markForCheck():this.logger.warn(`Property 'changeDetector' is missing on component '${this.componentType}', so dynamic refresh of given component might not work.`)}}static{this.\u0275fac=function(t){return new(t||r)(te(q),te(C),te(Oi),te(Et),te(Ii))}}static{this.\u0275dir=ue({type:r,selectors:[["","nuiComponentPortal",""]],inputs:{componentId:"componentId",componentType:"componentType",properties:"properties",providers:"providers",outputs:"outputs"},outputs:{output:"output"},exportAs:["nuiComponentPortal"],features:[gt]})}}return r})();var dd=(()=>{class r{constructor(e,t,i){this.changeDetector=e,this.pizzagnaService=t,this.logger=i,this.destroyed$=new A}ngOnChanges(e){(e.nodes||e.template)&&this.updateNodeConfigs({changesNodes:e.nodes,changesTemplate:e.template})}ngDoCheck(){this.checkNodeConfigs()&&(this.updateNodeConfigs(),this.changeDetector.detectChanges())}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}trackByFn(e,t){return t.id}checkNodeConfigs(){let e=this.getNodes();if(!this.nodeComponentsConfigs||e.length!==this.nodeComponentsConfigs.length)return!0;for(let t=0;t<e.length;t++)if(this.pizzagnaService.getComponent(e[t])!==this.nodeComponentsConfigs[t])return!0;return!1}updateNodeComponentConfigs(){let e=this.getNodes();this.nodeComponentsConfigs=e&&e.map(t=>{let i=this.pizzagnaService.getComponent(t);if(typeof i>"u")throw new Error("No component with id '"+t+"' was defined in the configuration.");return i})}updateNodeConfigs(e){this.nodeConfigs=it(this.nodeConfigs,this.getTemplateChangeForNodes(e),this.getNodeComponentsConfigs())}getNodeComponentsConfigs(){let e={currentValue:void 0,previousValue:this.nodeComponentsConfigs?[...this.nodeComponentsConfigs]:void 0};return this.updateNodeComponentConfigs(),e.currentValue=this.nodeComponentsConfigs,e}getTemplateChangeForNodes(e){let{changesNodes:t,changesTemplate:i}=e||{},o=s=>s&&this.getNodes()?.map(()=>s);return{currentValue:o(i?i.currentValue:this.template),previousValue:t?this.template:o(i?i.previousValue:this.template)}}static{this.\u0275fac=function(t){return new(t||r)(a(Pt),a(d),a(C))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();export{Ye as a,Me as b,jo as c,N as d,wt as e,Nt as f,xo as g,Fo as h,$o as i,Dt as j,Bo as k,ko as l,Uo as m,X as n,Lo as o,Go as p,ne as q,Mo as r,Vt as s,Zo as t,Ko as u,Ho as v,xt as w,Ft as x,$t as y,Bt as z,kt as A,Ut as B,Lt as C,Gt as D,Mt as E,Zt as F,Kt as G,Ht as H,Wt as I,Yt as J,qt as K,Xt as L,Jt as M,Qt as N,er as O,tr as P,rr as Q,ir as R,or as S,sr as T,nr as U,ar as V,pr as W,mr as X,ur as Y,dr as Z,hr as _,lr as $,fr as aa,Wo as ba,p as ca,ge as da,b as ea,ae as fa,Jo as ga,ce as ha,Ki as ia,Hi as ja,h as ka,Wi as la,Ze as ma,Ne as na,it as oa,Pr as pa,d as qa,W as ra,Ar as sa,Tr as ta,ve as ua,Re as va,ze as wa,Kr as xa,S as ya,Xr as za,Ke as Aa,we as Ba,gr as Ca,vr as Da,Sr as Ea,Er as Fa,Ir as Ga,ps as Ha,Ei as Ia,Ii as Ja,Ai as Ka,bi as La,Oi as Ma,sd as Na,dd as Oa};
