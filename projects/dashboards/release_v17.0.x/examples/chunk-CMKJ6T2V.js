import{a as st}from"./chunk-3TEQ5QET.js";import{f as C,h as at}from"./chunk-X4Y7FFXQ.js";import{a as it,b as rt,c as ot,j as nt}from"./chunk-32WL3UDE.js";import{a as tt}from"./chunk-V2MEVMRQ.js";import{B as K,Ja as et,c as X,ea as Y,ha as M,ia as Z,ka as J}from"./chunk-USCLQP7P.js";import{Yc as $,mc as z,pc as V,xe as Q}from"./chunk-NZZJTGI5.js";import{f as k,z as D}from"./chunk-NEOTMEUH.js";import{$c as j,A as E,Aa as T,Ac as W,F as g,Ha as U,Pb as I,Rb as f,Sa as h,Ta as c,Xb as d,Yb as a,bc as v,ca as w,gc as q,h as P,i as N,kc as B,lc as l,ma as A,pa as F,va as G,vc as H,yb as m,yc as R,zb as _,zc as y}from"./chunk-NNMBFNDY.js";import{a as p,b as O,i as u}from"./chunk-T555DFTC.js";function lt(r,dt){if(r&1){let t=v();d(0,"button",6),B("click",function(){h(t);let i=l();return c(i.reInitializeDashboard())}),H(1," Restore Widget "),a()}}function pt(r,dt){if(r&1){let t=v();d(0,"nui-dashboard",7),W("dashboardChange",function(i){h(t);let o=l();return y(o.dashboard,i)||(o.dashboard=i),c(i)})("gridsterConfigChange",function(i){h(t);let o=l();return y(o.gridsterConfig,i)||(o.gridsterConfig=i),c(i)}),a()}if(r&2){let t=l();R("dashboard",t.dashboard)("gridsterConfig",t.gridsterConfig),f("editMode",t.editMode)}}var S=(()=>{class r extends Q{static{this.providerId="DrilldownDataSource"}constructor(t,e){super(),this.http=t,this.apollo=e,this.busy=new N(!1),this.dataFields=[{id:"Region",label:"Region name"},{id:"Subregion",label:"Subregion name"}],this.drillState=[],this.lastDrillState=[],this.leafGroup="Country",this.applyFilters$=new P,this.groupedDataHistory=[],this.dataFieldsConfig.dataFields$.next(this.dataFields),this.applyFilters$.pipe(A(i=>this.getData(i))).subscribe(i=>u(this,null,function*(){this.outputsSubject.next(yield this.getFilteredData(i))}))}getFilteredData(t){return u(this,null,function*(){return E(t).pipe(g(e=>{if(this.isDrillDown()){let n=this.drillState.length,s=this.groupBy[n],x=this.getTransformedDataForGroup(e,s,b(this.drillState));return this.groupedDataHistory.push(x),x}let i=e.map(n=>O(p({},n),{icon:"virtual-host",icon_status:z.Up}));return this.groupedDataHistory.push(i),this.getOutput(e)})).toPromise()})}ngOnDestroy(){this.outputsSubject.complete()}applyFilters(){return u(this,null,function*(){this.applyFilters$.next(this.getFilters())})}getQuery(t,e){let i={Region:"{ Region { name } }",Subregion:`{ Subregion(filter: { region: { name: "${e}" } } ) { name } }`,Country:`{ Country(filter: { subregion: { name: "${e}" } } ) { name capital } }`};return at`
            ${i[t]}
        `}getData(t){this.drillState=t.drillstate?.value,this.groupBy=t.group?.value;let e=this.groupBy[this.drillState.length],i=this.drillState.length<this.lastDrillState.length;return this.lastDrillState=[...this.drillState],this.drillState.length||(this.groupedDataHistory.length=0),this.busy.next(!0),this.cache&&(i||this.isHome())?E(this.cache).pipe(g(o=>o.data[e]),w(()=>this.busy.next(!1))):this.apollo.use(st.COUNTRIES).query({query:this.getQuery(e||this.leafGroup,b(this.drillState))}).pipe(F(o=>this.cache={data:p(p({},this.cache?.data),o?.data)}),g(o=>o.data[e||this.leafGroup]),w(()=>this.busy.next(!1)))}getTransformedDataForGroup(t,e,i){let o=`No ${e} for ${i}`;return Object.values(t).map(s=>({id:s.name||o,label:s.name||o,statuses:[{key:"state_ok",value:s.name?.length},{key:"status_unreachable",value:L(1e5)},{key:"status_warning",value:L(1e4)},{key:"status_unknown",value:L(1e3)}]}))}isHome(){return this.drillState.length===0}isDrillDown(){return this.drillState.length!==this.groupBy.length}getOutput(t){this.isHome()&&(this.groupedDataHistory.length=0);let e=b(this.groupedDataHistory);return e?e[b(this.drillState)]||e:t}static{this.\u0275fac=function(e){return new(e||r)(T(D),T(C))}}static{this.\u0275prov=G({token:r,factory:r.\u0275fac})}}return r})(),Wt=(()=>{class r{constructor(t,e,i){this.widgetTypesService=t,this.providerRegistry=e,this.changeDetectorRef=i,this.gridsterConfig={},this.editMode=!1}ngOnInit(){this.initializeDashboard();let t=this.widgetTypesService.getWidgetType("drilldown",1);this.widgetTypesService.setNode(t,"configurator",Z.DataSourceProviders,[S.providerId]),this.providerRegistry.setProviders({[S.providerId]:{provide:Y,useClass:S,deps:[D,C]}})}reInitializeDashboard(){this.dashboard=void 0,this.changeDetectorRef.detectChanges(),this.initializeDashboard()}initializeDashboard(){let t=ut,e={[t.id]:this.widgetTypesService.mergeWithWidgetType(t)},i={[t.id]:{cols:10,rows:10,y:0,x:0}};this.dashboard={positions:i,widgets:e}}static{this.\u0275fac=function(e){return new(e||r)(_(tt),_(et),_(j))}}static{this.\u0275cmp=U({type:r,selectors:[["drilldown-multi-request-widget-example"]],decls:6,vars:3,consts:()=>{let t;return t=$localize`:␟5fa31edac506213950b479159e840b300d749592␟3766035158759769347: Edit Mode `,[t,[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"valueChange","value"],["type","button","displayStyle","action","nui-button","",3,"click",4,"ngIf"],[1,"w-100","dashboard"],["nuiWidgetEditor","",3,"dashboard","gridsterConfig","editMode","dashboardChange","gridsterConfigChange",4,"ngIf"],["type","button","displayStyle","action","nui-button","",3,"click"],["nuiWidgetEditor","",3,"dashboardChange","gridsterConfigChange","dashboard","gridsterConfig","editMode"]]},template:function(e,i){e&1&&(d(0,"div",1)(1,"nui-switch",2),W("valueChange",function(n){return y(i.editMode,n)||(i.editMode=n),n}),q(2,0),a(),I(3,lt,2,0,"button",3),a(),d(4,"div",4),I(5,pt,1,3,"nui-dashboard",5),a()),e&2&&(m(),R("value",i.editMode),m(2),f("ngIf",!(i.dashboard!=null&&i.dashboard.widgets.embeddedContentWidgetId)),m(2),f("ngIf",i.dashboard))},dependencies:[V,k,it,nt,$],styles:[".dashboard[_ngcontent-%COMP%]{height:700px}"]})}}return r})(),ut={id:"drilldown",type:"drilldown",pizzagna:{[J.Configuration]:{header:{properties:{title:"Drilldown Widget",subtitle:"Countries BY continent THEN currency"}},[X]:{providers:{[M.DataSource]:{providerId:S.providerId,properties:{}}}},listWidget:{providers:{[M.Adapter]:{providerId:K,properties:{navigationBarId:"navigationBar",componentId:"listWidget",dataPath:"data",drillstate:[],groups:["Region","Subregion"],groupBy:["Region","Subregion"],componentsConfig:{group:{componentType:rt.lateLoadKey,properties:{dataFieldIds:{id:"id",label:"label",statuses:"statuses"}},itemProperties:{canNavigate:!0}},leaf:{componentType:ot.lateLoadKey,properties:{dataFieldIds:{icon:"icon",status:"icon_status",detailedUrl:"capital",label:"name"}},itemProperties:{canNavigate:!1}}}}}},properties:{configuration:{}}}}}},b=r=>r[r.length-1],L=r=>Math.floor(Math.random()*r+1);export{S as a,Wt as b};
