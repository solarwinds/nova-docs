import{f as C,h as de}from"./chunk-X4Y7FFXQ.js";import{a as D}from"./chunk-E3F6ZG2O.js";import{a as ye}from"./chunk-JT747UGU.js";import{a as oe,b as ne,c as ae,j as se}from"./chunk-32WL3UDE.js";import{a as ie}from"./chunk-V2MEVMRQ.js";import{B as ee,Ja as re,c as J,ea as T,ha as L,ia as te,ka as N}from"./chunk-USCLQP7P.js";import{Ae as Z,Yc as Q,lc as y,mc as U,pc as $,ye as Y}from"./chunk-NZZJTGI5.js";import{f as K,z as l}from"./chunk-NEOTMEUH.js";import{$c as X,A as v,Aa as p,Ac as W,F as g,Ha as z,Pb as w,Q as G,Rb as f,Sa as u,T as H,Ta as c,Xb as s,Yb as n,Z as B,bc as E,gc as V,i as F,kc as j,lc as d,va as k,vc as q,yb as h,yc as I,zb as m,zc as _}from"./chunk-NNMBFNDY.js";import{a as M,b as O,g as _e,i as A}from"./chunk-T555DFTC.js";var pe=_e(ye());function Ce(o,ue){if(o&1){let e=E();s(0,"button",6),j("click",function(){u(e);let t=d();return c(t.reInitializeDashboard())}),q(1," Restore Widget "),n()}}function De(o,ue){if(o&1){let e=E();s(0,"nui-dashboard",7),W("dashboardChange",function(t){u(e);let r=d();return _(r.dashboard,t)||(r.dashboard=t),c(t)})("gridsterConfigChange",function(t){u(e);let r=d();return _(r.gridsterConfig,t)||(r.gridsterConfig=t),c(t)}),n()}if(o&2){let e=d();I("dashboard",e.dashboard)("gridsterConfig",e.gridsterConfig),f("editMode",e.editMode)}}var b=(()=>{class o extends Z{static{this.providerId="DrilldownDataSourceRealApi"}constructor(e,i,t){super(),this.logger=e,this.http=i,this.apollo=t,this.busy=new F(!1),this.dataFields=[{id:"regionName",label:"Region name"},{id:"subregionName",label:"Subregion name"}],this.supportedFeatures={search:{enabled:!0}},this.drillState=[],this.groupedDataHistory=[],this.features=new Y(this.supportedFeatures),this.dataFieldsConfig.dataFields$.next(this.dataFields)}getFilteredData(e){return A(this,null,function*(){return v(e).pipe(G(()=>!!this.drillState),g(i=>{let t=()=>ge(this.groupedDataHistory);if(!this.drillState.length&&!this.groupBy.length)return i;let r=["ROOT",...this.drillState],a=r.length,ce=this.groupedDataHistory.length,P=a-ce;if(!P)return t()||i;let he=r.slice(r.length-P);for(let R of he){let me=r.findIndex(S=>S===R),x=this.groupBy[me];if(x){let S=t()?t()[R]:i,fe=(0,pe.default)(S,x);this.groupedDataHistory.push(fe)}}return this.groupBy.length===this.drillState.length?t()[ge(this.drillState)]:this.getGroupsWidgetData(t())})).toPromise()})}ngOnDestroy(){this.outputsSubject.complete()}getBackendData(e){return this.apollo.watchQuery({query:this.generateQuery(e)}).valueChanges.pipe(B(300),g(t=>t.data.Country),g(t=>t.map(r=>O(M({},r),{icon:"virtual-host",icon_status:U.Up,subregionName:r.subregion?.name||"No Subregion Specified",regionName:r.subregion?.region?.name||"No Region Specified"}))),H(t=>(this.logger.error(t),v({}))))}generateQuery(e){let{search:i}=e,t=i?.value??"",r=`
            query {
                Country(filter: {
                    OR: [
                      { name_contains: "${t}" },
                      { capital_contains: "${t}" }
                    ],
                }) {
                    name
                    capital
                    population
                    officialLanguages {
                        name
                    }
                    currencies {
                        name
                    }
                    subregion {
                        name
                        region {
                            name
                        }
                    }
                }
            }
        `;return de`
            ${r}
        `}beforeApplyFilters(e){this.busy.next(!0),this.drillState=e.drillstate?.value,this.groupBy=e.group?.value,this.isHome()&&(this.groupedDataHistory.length=0),this.isBack()&&(this.groupedDataHistory.length=this.groupedDataHistory.length-1),this.getFilters().search&&this.filterChanged("search")&&(this.groupedDataHistory.length=0)}getGroupsWidgetData(e){return Object.keys(e).map(i=>({id:i,label:i,statuses:[{key:"virtual-host",value:e[i].length},{key:"acknowledge",value:this.getPopulation(e[i])}]}))}isHome(){return this.drillState?.length===0}isBack(){return this.groupedDataHistory?.length>this.drillState?.length&&!this.isHome()}getPopulation(e){return`${e.reduce((t,r)=>t+=r.population,0)*Math.pow(10,-3)} k`}static{this.\u0275fac=function(i){return new(i||o)(p(y),p(l),p(C))}}static{this.\u0275prov=k({token:o,factory:o.\u0275fac})}}return o})(),Ge=(()=>{class o{constructor(e,i,t){this.widgetTypesService=e,this.providerRegistry=i,this.changeDetectorRef=t,this.gridsterConfig={},this.editMode=!1}ngOnInit(){this.providerRegistry.setProviders({[D.providerId]:{provide:T,useClass:D,deps:[l]},[b.providerId]:{provide:T,useClass:b,deps:[y,l,C]}}),this.initializeDashboard();let e=this.widgetTypesService.getWidgetType("drilldown",1);this.widgetTypesService.setNode(e,"configurator",te.DataSourceProviders,[b.providerId,D.providerId])}initializeDashboard(){let e=le,i={[e.id]:this.widgetTypesService.mergeWithWidgetType(e)},t={[e.id]:{cols:10,rows:10,y:0,x:0}};this.dashboard={positions:t,widgets:i}}reInitializeDashboard(){this.dashboard=void 0,this.changeDetectorRef.detectChanges();let e=le.pizzagna[N.Configuration].listWidget.providers?.adapter?.properties;e&&(e.drillstate=[]),this.initializeDashboard()}static{this.\u0275fac=function(i){return new(i||o)(m(ie),m(re),m(X))}}static{this.\u0275cmp=z({type:o,selectors:[["drilldown-widget-example"]],decls:6,vars:3,consts:()=>{let e;return e=$localize`:␟5fa31edac506213950b479159e840b300d749592␟3766035158759769347: Edit Mode `,[e,[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"valueChange","value"],["type","button","displayStyle","action","nui-button","",3,"click",4,"ngIf"],[1,"w-100","dashboard"],["nuiWidgetEditor","",3,"dashboard","gridsterConfig","editMode","dashboardChange","gridsterConfigChange",4,"ngIf"],["type","button","displayStyle","action","nui-button","",3,"click"],["nuiWidgetEditor","",3,"dashboardChange","gridsterConfigChange","dashboard","gridsterConfig","editMode"]]},template:function(i,t){i&1&&(s(0,"div",1)(1,"nui-switch",2),W("valueChange",function(a){return _(t.editMode,a)||(t.editMode=a),a}),V(2,0),n(),w(3,Ce,2,0,"button",3),n(),s(4,"div",4),w(5,De,1,3,"nui-dashboard",5),n()),i&2&&(h(),I("value",t.editMode),h(2),f("ngIf",!(t.dashboard!=null&&t.dashboard.widgets.embeddedContentWidgetId)),h(2),f("ngIf",t.dashboard))},dependencies:[$,K,oe,se,Q],styles:[".dashboard[_ngcontent-%COMP%]{height:700px}"]})}}return o})(),le={id:"drilldown",type:"drilldown",pizzagna:{[N.Configuration]:{[J]:{providers:{[L.DataSource]:{providerId:b.providerId,properties:{}}}},header:{properties:{title:"Drilldown Widget",subtitle:"Search is case sensitive!"}},listWidget:{providers:{[L.Adapter]:{providerId:ee,properties:{navigationBarId:"navigationBar",componentId:"listWidget",dataPath:"data",drillstate:[],groupBy:["regionName","subregionName"],groups:["regionName","subregionName"],componentsConfig:{group:{componentType:ne.lateLoadKey,properties:{dataFieldIds:{id:"id",label:"label",statuses:"statuses"}},itemProperties:{canNavigate:!0}},leaf:{componentType:ae.lateLoadKey,properties:{dataFieldIds:{icon:"icon",status:"icon_status",detailedUrl:"capital",label:"name"}},itemProperties:{canNavigate:!1}}}}}},properties:{configuration:{}}}}}},ge=o=>o[o.length-1];export{b as a,Ge as b};
