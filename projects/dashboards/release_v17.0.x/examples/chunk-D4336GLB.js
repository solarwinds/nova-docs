import{d as $}from"./chunk-TWGF5P3J.js";import{C as k,h as D,lc as y,xe as S,ye as F}from"./chunk-3HSEZOBQ.js";import{z as b}from"./chunk-NEOTMEUH.js";import{A as s,Aa as l,E as n,F as o,T as p,Z as m,ca as d,h as u,i as h,ma as v,pa as f,va as g}from"./chunk-NNMBFNDY.js";import{g as c,i}from"./chunk-T555DFTC.js";var I=c(k()),x=c(D());var M=(()=>{class r extends S{static{this.providerId="AcmeTableGBooksDataSource"}static{this.mockError=!1}constructor(t,e){super(),this.logger=t,this.http=e,this.searchableColumn="title",this.page=1,this.busy=new h(!1),this.cache=Array.from({length:0}),this.supportedFeatures={search:{enabled:!0},pagination:{enabled:!0}},this.columnToQueryParamMap={title:"intitle",authors:"inauthor"},this.applyFilters$=new u,this.dataFields=[{id:"title",label:$localize`Title`,dataType:"string"},{id:"authors",label:$localize`Authors`,dataType:"string"}],this.features=new F(this.supportedFeatures),this.applyFilters$.pipe(v(a=>this.getData(a))).subscribe(a=>i(this,null,function*(){this.outputsSubject.next(yield this.getFilteredData(a))}))}getFilteredData(t){return i(this,null,function*(){return n(s(t).pipe(f(e=>{this.cache=this.cache.concat(e.books)}),o(e=>({result:{repeat:{itemsSource:this.cache},paginator:{total:e.totalItems},dataFields:this.dataFields}}))))})}getData(t){return(this.isNewSearchTerm(t.search)||t.virtualScroll?.value.start===0)&&(this.cache=[]),this.busy.next(!0),this.http.get(this.getComposedUrl(t)).pipe(m(300),o(e=>({books:e.items?.map(a=>({title:a.volumeInfo.title,authors:a.volumeInfo.authors?.join(", ")||""}))||[],totalItems:e.totalItems})),p(e=>(this.logger.error(e),this.busy.next(!1),s({books:[],totalItems:0}))),d(()=>{this.busy.next(!1),this.previousFilters=t}))}getComposedUrl(t){let e=`${$}?q=`,a=`maxResults=${(t.virtualScroll?.value.end??0)-(t.virtualScroll?.value.start??0)}`,j=t.virtualScroll?`startIndex=${t.virtualScroll.value.start}`:"",w=this.columnToQueryParamMap[this.searchableColumn],T=t.search?`${w}:${t.search.value}`:"_";return`${e}${T}&${a}&${j}&filter=full`}isNewSearchTerm(t){return!(0,x.default)(t?.value)&&!(0,I.default)(t?.value,this.previousFilters?.search?.value)}applyFilters(){return i(this,null,function*(){this.applyFilters$.next(this.getFilters())})}static{this.\u0275fac=function(e){return new(e||r)(l(y),l(b))}}static{this.\u0275prov=g({token:r,factory:r.\u0275fac})}}return r})();export{M as a};
