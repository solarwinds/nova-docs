import{d as pe,e as de,f as ue,g as _e}from"./chunk-AMXUNQ4T.js";import{Ja as se,Na as ce,ca as re,ra as ie,sa as ne,ta as ae}from"./chunk-USCLQP7P.js";import{$c as ee,Ba as q,D as ge,Jd as oe,Nc as Y,lc as Q,ma as H,md as te,nb as J,oa as X,pa as z,va as K,ya as Z}from"./chunk-NZZJTGI5.js";import{e as k,f as x,l as W}from"./chunk-NEOTMEUH.js";import{$b as $,$c as v,Dc as j,Ec as L,Ha as C,Jc as l,Kc as S,Lc as V,Pb as m,Ra as g,Rb as i,Sa as O,Ta as h,X as M,Xb as d,Ya as G,Yb as p,Zb as P,_b as w,ab as E,bc as b,gc as A,h as _,i as F,kc as R,lc as B,na as N,uc as y,va as U,vc as I,xc as T,yb as n,zb as s}from"./chunk-NNMBFNDY.js";import{g as Ce}from"./chunk-T555DFTC.js";var me=(()=>{class t{constructor(){this.height$=new F(0)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=U({token:t,factory:t.\u0275fac})}}return t})();var Se=Ce(ge());function Re(t,f){t&1&&(d(0,"nui-message",4)(1,"b"),A(2,0),p()()),t&2&&i("allowDismiss",!1)}function Ie(t,f){if(t&1&&(d(0,"nui-message",5)(1,"b"),A(2,1),p(),I(3),p()),t&2){let e=B();i("allowDismiss",!1),n(3),T(" ",e.dataSourceError.message||e.dataSourceError.type," ")}}var fe=(()=>{class t{static{this.lateLoadKey="DataSourceErrorComponent"}constructor(e){this.changeDetector=e,this.errorState=new E,this.onDestroy$=new _,this.dataSourceClear$=new _}ngOnChanges(e){e.dataSource&&this.onDataSourceChanged()}onDataSourceChanged(){this.dataSourceClear$.next(),this.dataSource?.busy?.pipe(N(this.dataSourceClear$)).subscribe(e=>{this.busy=e,this.changeDetector.markForCheck()}),this.dataSource?.outputsSubject.pipe(N(this.dataSourceClear$)).subscribe(e=>{this.data=(0,Se.default)(e?.result)?e:e?.result,this.dataSourceError=e?.error,this.errorState.emit(!!this.dataSourceError),this.changeDetector.markForCheck()})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete(),this.dataSourceClear$.next(),this.dataSourceClear$.complete()}static{this.\u0275fac=function(r){return new(r||t)(s(v))}}static{this.\u0275cmp=C({type:t,selectors:[["nui-data-source-error"]],inputs:{dataSource:"dataSource"},outputs:{errorState:"errorState"},features:[g],decls:3,vars:2,consts:()=>{let e;e=$localize`:␟7471accb59033b8bee2f7d6907d8deefcfe7d5de␟8643306703234832815:Select a data source`;let r;return r=$localize`:␟c399afe21627dcfed1a9865c0e084fac997896c2␟4016661485141937765:Something went wrong with the data source: `,[e,r,["class","mt-4 d-block","type","info",3,"allowDismiss",4,"ngIf"],["class","mt-4 d-block","type","critical",3,"allowDismiss",4,"ngIf"],["type","info",1,"mt-4","d-block",3,"allowDismiss"],["type","critical",1,"mt-4","d-block",3,"allowDismiss"]]},template:function(r,o){r&1&&(d(0,"div"),m(1,Re,3,1,"nui-message",2)(2,Ie,4,2,"nui-message",3),p()),r&2&&(n(),i("ngIf",!o.dataSource),n(),i("ngIf",o.dataSourceError))},dependencies:[x,Y],encapsulation:2,changeDetection:0})}}return t})();var Te=()=>["errorState"],ve=t=>({dataSource:t});function De(t,f){if(t&1&&(d(0,"nui-select-v2-option",9),I(1),p()),t&2){let e=f.$implicit;i("title",e)("value",e),n(),T(" ",e," ")}}function Ne(t,f){}var ut=(()=>{class t{static{this.lateLoadKey="DataSourceConfigurationComponent"}constructor(e,r,o,a,u,c,D){this.changeDetector=e,this.configuratorHeading=r,this.formBuilder=o,this.providerRegistryService=a,this.eventBus=u,this.injector=c,this.logger=D,this.dataSourceProviders=[],this.errorComponent=fe.lateLoadKey,this.formReady=new E,this.hasDataSourceError=!1,this.dsOutput=new _,this.dataFieldIds=new _}ngOnInit(){this.form=this.formBuilder.group({providerId:[this.providerId||"",[H.required]],properties:this.formBuilder.group(this.properties||{})}),this.form.setValidators([()=>this.hasDataSourceError?{dataSourceError:!0}:null]),this.formReady.emit(this.form)}ngOnChanges(e){e.providerId&&!e.providerId.isFirstChange()&&e.providerId.previousValue!==this.providerId&&(this.form.get("providerId")?.setValue(this.providerId),this.invokeDataSource(this.providerId))}onDataSourceChange(e){this.eventBus.next(ne,{}),this.invokeDataSource(e)}invokeDataSource(e){if(!e)return;let r=this.providerRegistryService.getProvider(e);r?(this.dataSource=this.providerRegistryService.getProviderInstance(r,this.injector),this.eventBus.next(ae,{payload:this.dataSource}),this.dataSource.outputsSubject.pipe(M(1)).subscribe(o=>{this.eventBus.next(ie,{payload:o}),this.dsOutput.next(o);let a=o?.result||o;a&&this.dataFieldIds.next(Object.keys(a))}),setTimeout(()=>{this.dataSource.applyFilters()})):this.logger.warn("No provider found for id:",e)}onErrorState(e){this.hasDataSourceError=e,this.form.markAsTouched({onlySelf:!0}),this.form.updateValueAndValidity({emitEvent:!1}),this.changeDetector.detectChanges()}static{this.\u0275fac=function(r){return new(r||t)(s(v),s(me),s(q),s(se),s(re),s(G),s(Q))}}static{this.\u0275cmp=C({type:t,selectors:[["nui-data-source-configuration"]],inputs:{dataSourceProviders:"dataSourceProviders",errorComponent:"errorComponent",properties:"properties",providerId:"providerId"},outputs:{formReady:"formReady"},features:[g],decls:14,vars:27,consts:()=>{let e;e=$localize`:␟7f3bce5049b2c517378a6624460b84d2da9ce332␟7245698475792706694:Select Data Source`;let r;return r=$localize`:␟18c18c5d61f92ef5c3caa37df00fc514fef3d90c␟4806513497858020797:Data Sources`,[["componentPortal","nuiComponentPortal"],[3,"formGroup","state"],["headerTitle","Data Source",3,"headerIcon","subtitle"],[1,"datasource-configuration__accordion-content"],["caption",e,3,"control"],["placeholder",r,"formControlName","providerId",1,"datasource-configuration__accordion-content__datasource-input",3,"valueSelected","title","popupViewportMargin"],[3,"title","value",4,"ngFor","ngForOf"],["nuiComponentPortal","",3,"output","componentId","componentType","outputs","properties"],[3,"attached","cdkPortalOutlet"],[3,"title","value"]]},template:function(r,o){if(r&1){let a=b();d(0,"nui-widget-editor-accordion",1),l(1,"nuiWidgetEditorAccordionFormState"),l(2,"async"),P(3,"nui-widget-editor-accordion-header",2),l(4,"nuiFormHeaderIconPipe"),l(5,"async"),d(6,"div",3)(7,"nui-form-field",4)(8,"nui-select-v2",5),l(9,"async"),R("valueSelected",function(c){return O(a),h(o.onDataSourceChange(c))}),m(10,De,2,3,"nui-select-v2-option",6),p()(),w(11,7,0),R("output",function(c){return O(a),h(o.onErrorState(c.payload))}),m(13,Ne,0,0,"ng-template",8),R("attached",function(c){O(a);let D=y(12);return h(D.attached(c))}),$(),p()()}if(r&2){let a,u,c=y(12);i("formGroup",o.form)("state",S(2,15,S(1,13,o.form))),n(3),i("headerIcon",S(5,20,V(4,17,o.form,"database")))("subtitle",(a=o.form.get("providerId"))==null?null:a.value),n(4),i("control",o.form.get("providerId")),n(),i("title",(u=o.form.get("providerId"))==null?null:u.value)("popupViewportMargin",S(9,22,o.configuratorHeading.height$)),n(2),i("ngForOf",o.dataSourceProviders),n(),i("componentId",o.errorComponent)("componentType",o.errorComponent)("outputs",j(24,Te))("properties",L(25,ve,o.dataSource)),n(2),i("cdkPortalOutlet",c.portal)}},dependencies:[k,X,z,K,Z,J,ce,oe,te,ee,de,pe,W,ue,_e],styles:[".datasource-configuration__accordion-content[_ngcontent-%COMP%]{padding:15px 15px 15px 46px}"],changeDetection:0})}}return t})();export{me as a,fe as b,ut as c};
