import{c as h}from"./chunk-SCLKYUYR.js";import{C as _,jc as y,kc as f,we as v}from"./chunk-VVYJCL6H.js";import{i as u,ka as w,pa as b}from"./chunk-7LLRMBML.js";import{g as m,i as d}from"./chunk-VBFW7A5V.js";var g=m(_()),S=m(y());var P=(()=>{class p extends v{static{this.providerId="BeerDataSource"}constructor(t){super(),this.logger=t,this.cache=Array.from({length:0}),this.totalItems=325,this.page=1,this.busy=new u(!1),this.dataFields=[{id:"id",label:"No",dataType:"number"},{id:"name",label:"Name",dataType:"string"},{id:"tagline",label:"Tagline",dataType:"string"},{id:"first_brewed",label:"First Brewed",dataType:"string"},{id:"description",label:"Description",dataType:"string"},{id:"brewers_tips",label:"Brewer's Tips",dataType:"string"}]}getFilteredData(t){return d(this,null,function*(){let s=t.virtualScroll?.value?.start??0,n=t.virtualScroll?.value?.end??0,o=n-s;if(t.sorter?.value&&!(0,g.default)(this.lastSortValue,t.sorter.value)&&(0,g.default)(this.lastVirtualScroll,t.virtualScroll?.value)){let l=Math.ceil(o?this.totalItems/o:1),a=Math.max(o<80?o:80,1),i=null,r;if(t.sorter?.value?.direction==="desc"){this.cache=[];for(let c=0;c<this.page;++c)i=yield(yield fetch(`${h}/?page=${l-c||1}&per_page=${a}`)).json(),i&&i.length<a&&this.page++,r={brewInfo:i?.map(e=>({id:e.id,name:e.name,tagline:e.tagline,first_brewed:e.first_brewed,description:e.description,brewers_tips:e.brewers_tips})),total:i?.length},this.cache=l-c!==0?this.cache.concat(r.brewInfo):this.cache}if(t.sorter?.value?.direction==="asc"){this.cache=[];for(let c=0;c<this.page;c++)i=yield(yield fetch(`${h}/?page=${c+1}&per_page=${a}`)).json(),r={brewInfo:i?.map(e=>({id:e.id,name:e.name,tagline:e.tagline,first_brewed:e.first_brewed,description:e.description,brewers_tips:e.brewers_tips})),total:i?.length},this.cache=this.cache.concat(r.brewInfo)}return this.lastSortValue=t.sorter?.value,this.lastVirtualScroll=t.virtualScroll?.value,{repeat:{itemsSource:this.sortData(this.cache,t)},paginator:{total:this.totalItems},dataFields:this.dataFields}}return this.busy.next(!0),new Promise(l=>{setTimeout(()=>{this.getData(s,n,t).then(a=>{a&&(this.cache=this.cache.concat(a.brewInfo),this.dataSubject.next(this.cache),l({repeat:{itemsSource:this.sortData(this.cache,t)},paginator:{total:this.totalItems},dataFields:this.dataFields}),this.lastSortValue=t.sorter?.value,this.lastVirtualScroll=t.virtualScroll?.value,this.busy.next(!1))})},500)})})}getData(t=0,s=20,n){return d(this,null,function*(){let o=s-t,l=Math.ceil(o?this.totalItems/o:1),a=null,i=Math.max(o<80?o:80,1);return n.sorter?.value?.direction==="asc"&&(a=yield(yield fetch(`${h}/?page=${this.page}&per_page=${i}`)).json()),n.sorter?.value?.direction==="desc"&&(a=yield(yield fetch(`${h}/?page=${l-this.page}&per_page=${i}`)).json()),n.sorter||(a=yield(yield fetch(`${h}/?page=${this.page}&per_page=${i}`)).json()),{brewInfo:a?.map((r,c)=>({id:r.id,name:r.name,tagline:r.tagline,first_brewed:r.first_brewed,description:r.description,brewers_tips:r.brewers_tips})),total:a?.length}})}sortData(t,s){return(0,S.default)(t,s.sorter?.value?.sortBy,s.sorter?.value?.direction)}static{this.\u0275fac=function(s){return new(s||p)(b(f))}}static{this.\u0275prov=w({token:p,factory:p.\u0275fac})}}return p})();export{P as a};
