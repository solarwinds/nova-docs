import{d as pe,e as de,f as ue,g as le}from"./chunk-7W7EWBQD.js";import{Ja as se,Na as ce,ca as re,ra as ie,sa as ne,ta as ae}from"./chunk-UW6LU7NQ.js";import{Ba as q,D as ge,Id as oe,Mc as Y,_c as ee,kc as Q,ld as te,ma as H,mb as J,oa as X,pa as z,va as K,ya as Z}from"./chunk-VVYJCL6H.js";import{e as k,f as x,l as W}from"./chunk-N5H4HNSX.js";import{Aa as g,Ac as I,Ba as O,Cb as E,Cc as T,Ga as G,Hb as m,Hc as j,Ic as L,Ka as h,Nc as _,O as M,Oc as S,Pc as V,Tb as i,Wc as v,ac as d,bc as p,cc as P,da as N,dc as w,ec as $,gc as b,h as l,i as F,ka as U,lc as A,pc as R,qb as n,qc as B,wb as s,za as C,zc as y}from"./chunk-7LLRMBML.js";import{g as Ce}from"./chunk-VBFW7A5V.js";var me=(()=>{class t{constructor(){this.height$=new F(0)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=U({token:t,factory:t.\u0275fac})}}return t})();var Se=Ce(ge());function Re(t,f){t&1&&(d(0,"nui-message",4)(1,"b"),A(2,0),p()()),t&2&&i("allowDismiss",!1)}function Ie(t,f){if(t&1&&(d(0,"nui-message",5)(1,"b"),A(2,1),p(),I(3),p()),t&2){let e=B();i("allowDismiss",!1),n(3),T(" ",e.dataSourceError.message||e.dataSourceError.type," ")}}var fe=(()=>{class t{static{this.lateLoadKey="DataSourceErrorComponent"}constructor(e){this.changeDetector=e,this.errorState=new h,this.onDestroy$=new l,this.dataSourceClear$=new l}ngOnChanges(e){e.dataSource&&this.onDataSourceChanged()}onDataSourceChanged(){this.dataSourceClear$.next(),this.dataSource?.busy?.pipe(N(this.dataSourceClear$)).subscribe(e=>{this.busy=e,this.changeDetector.markForCheck()}),this.dataSource?.outputsSubject.pipe(N(this.dataSourceClear$)).subscribe(e=>{this.data=(0,Se.default)(e?.result)?e:e?.result,this.dataSourceError=e?.error,this.errorState.emit(!!this.dataSourceError),this.changeDetector.markForCheck()})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete(),this.dataSourceClear$.next(),this.dataSourceClear$.complete()}static{this.\u0275fac=function(r){return new(r||t)(s(v))}}static{this.\u0275cmp=E({type:t,selectors:[["nui-data-source-error"]],inputs:{dataSource:"dataSource"},outputs:{errorState:"errorState"},standalone:!1,features:[C],decls:3,vars:2,consts:()=>{let e;e=$localize`:␟7471accb59033b8bee2f7d6907d8deefcfe7d5de␟8643306703234832815:Select a data source`;let r;return r=$localize`:␟c399afe21627dcfed1a9865c0e084fac997896c2␟4016661485141937765:Something went wrong with the data source: `,[e,r,["class","mt-4 d-block","type","info",3,"allowDismiss",4,"ngIf"],["class","mt-4 d-block","type","critical",3,"allowDismiss",4,"ngIf"],["type","info",1,"mt-4","d-block",3,"allowDismiss"],["type","critical",1,"mt-4","d-block",3,"allowDismiss"]]},template:function(r,o){r&1&&(d(0,"div"),m(1,Re,3,1,"nui-message",2)(2,Ie,4,2,"nui-message",3),p()),r&2&&(n(),i("ngIf",!o.dataSource),n(),i("ngIf",o.dataSourceError))},dependencies:[x,Y],encapsulation:2,changeDetection:0})}}return t})();var Te=()=>["errorState"],ve=t=>({dataSource:t});function De(t,f){if(t&1&&(d(0,"nui-select-v2-option",9),I(1),p()),t&2){let e=f.$implicit;i("title",e)("value",e),n(),T(" ",e," ")}}function Ne(t,f){}var ut=(()=>{class t{static{this.lateLoadKey="DataSourceConfigurationComponent"}constructor(e,r,o,a,u,c,D){this.changeDetector=e,this.configuratorHeading=r,this.formBuilder=o,this.providerRegistryService=a,this.eventBus=u,this.injector=c,this.logger=D,this.dataSourceProviders=[],this.errorComponent=fe.lateLoadKey,this.formReady=new h,this.hasDataSourceError=!1,this.dsOutput=new l,this.dataFieldIds=new l}ngOnInit(){this.form=this.formBuilder.group({providerId:[this.providerId||"",[H.required]],properties:this.formBuilder.group(this.properties||{})}),this.form.setValidators([()=>this.hasDataSourceError?{dataSourceError:!0}:null]),this.formReady.emit(this.form)}ngOnChanges(e){e.providerId&&!e.providerId.isFirstChange()&&e.providerId.previousValue!==this.providerId&&(this.form.get("providerId")?.setValue(this.providerId),this.invokeDataSource(this.providerId))}onDataSourceChange(e){this.eventBus.next(ne,{}),this.invokeDataSource(e)}invokeDataSource(e){if(!e)return;let r=this.providerRegistryService.getProvider(e);r?(this.dataSource=this.providerRegistryService.getProviderInstance(r,this.injector),this.eventBus.next(ae,{payload:this.dataSource}),this.dataSource.outputsSubject.pipe(M(1)).subscribe(o=>{this.eventBus.next(ie,{payload:o}),this.dsOutput.next(o);let a=o?.result||o;a&&this.dataFieldIds.next(Object.keys(a))}),setTimeout(()=>{this.dataSource.applyFilters()})):this.logger.warn("No provider found for id:",e)}onErrorState(e){this.hasDataSourceError=e,this.form.markAsTouched({onlySelf:!0}),this.form.updateValueAndValidity({emitEvent:!1}),this.changeDetector.detectChanges()}static{this.\u0275fac=function(r){return new(r||t)(s(v),s(me),s(q),s(se),s(re),s(G),s(Q))}}static{this.\u0275cmp=E({type:t,selectors:[["nui-data-source-configuration"]],inputs:{dataSourceProviders:"dataSourceProviders",errorComponent:"errorComponent",properties:"properties",providerId:"providerId"},outputs:{formReady:"formReady"},standalone:!1,features:[C],decls:14,vars:27,consts:()=>{let e;e=$localize`:␟7f3bce5049b2c517378a6624460b84d2da9ce332␟7245698475792706694:Select Data Source`;let r;return r=$localize`:␟18c18c5d61f92ef5c3caa37df00fc514fef3d90c␟4806513497858020797:Data Sources`,[["componentPortal","nuiComponentPortal"],[3,"formGroup","state"],["headerTitle","Data Source",3,"headerIcon","subtitle"],[1,"datasource-configuration__accordion-content"],["caption",e,3,"control"],["placeholder",r,"formControlName","providerId",1,"datasource-configuration__accordion-content__datasource-input",3,"valueSelected","title","popupViewportMargin"],[3,"title","value",4,"ngFor","ngForOf"],["nuiComponentPortal","",3,"output","componentId","componentType","outputs","properties"],[3,"attached","cdkPortalOutlet"],[3,"title","value"]]},template:function(r,o){if(r&1){let a=b();d(0,"nui-widget-editor-accordion",1),_(1,"nuiWidgetEditorAccordionFormState"),_(2,"async"),P(3,"nui-widget-editor-accordion-header",2),_(4,"nuiFormHeaderIconPipe"),_(5,"async"),d(6,"div",3)(7,"nui-form-field",4)(8,"nui-select-v2",5),_(9,"async"),R("valueSelected",function(c){return g(a),O(o.onDataSourceChange(c))}),m(10,De,2,3,"nui-select-v2-option",6),p()(),w(11,7,0),R("output",function(c){return g(a),O(o.onErrorState(c.payload))}),m(13,Ne,0,0,"ng-template",8),R("attached",function(c){g(a);let D=y(12);return O(D.attached(c))}),$(),p()()}if(r&2){let a,u,c=y(12);i("formGroup",o.form)("state",S(2,15,S(1,13,o.form))),n(3),i("headerIcon",S(5,20,V(4,17,o.form,"database")))("subtitle",(a=o.form.get("providerId"))==null?null:a.value),n(4),i("control",o.form.get("providerId")),n(),i("title",(u=o.form.get("providerId"))==null?null:u.value)("popupViewportMargin",S(9,22,o.configuratorHeading.height$)),n(2),i("ngForOf",o.dataSourceProviders),n(),i("componentId",o.errorComponent)("componentType",o.errorComponent)("outputs",j(24,Te))("properties",L(25,ve,o.dataSource)),n(2),i("cdkPortalOutlet",c.portal)}},dependencies:[k,X,z,K,Z,J,ce,oe,te,ee,de,pe,W,ue,le],styles:[".datasource-configuration__accordion-content[_ngcontent-%COMP%]{padding:15px 15px 15px 46px}"],changeDetection:0})}}return t})();export{me as a,fe as b,ut as c};
