import{a as ie,b as ne}from"./chunk-LZOJVJPM.js";import{Na as ee,Oa as te,qa as Z}from"./chunk-573U3PX6.js";import{Ba as G,Na as W,Oa as K,Pa as U,Qa as q,h as me,kc as Q,ma as H,mb as J,nc as X,o as se,oc as Y,pa as $,va as j}from"./chunk-PMWUHOKA.js";import{e as M,f as N}from"./chunk-YHLZAVJ5.js";import{Ac as y,Ba as f,Bc as O,Ca as _,Db as B,Dc as A,Gb as E,Hb as b,Ib as g,Ic as z,La as C,Oc as v,Rc as x,Sc as T,Ub as s,Vb as V,Xc as L,ba as F,bc as c,cc as l,da as P,dc as D,ec as k,fc as I,hc as w,qc as u,rb as m,rc as a,vc as R,xb as h}from"./chunk-MCPF2SEG.js";import{g as S}from"./chunk-VBFW7A5V.js";var re=S(se()),oe=S(me());var ae=(()=>{class r{transform(e,t,i){if((0,oe.default)(e))return;if((0,re.default)(e)){if(!t)return e;let o=[...e];return o.push(t),o}return Object.assign({},e,{[typeof i>"u"?"undefined":i]:t})}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275pipe=E({name:"nuiAddData",type:r,pure:!0,standalone:!1})}}return r})();var ce=()=>["formReady","formDestroy"];function le(r,d){if(r&1&&D(0,"nui-drop-area",9),r&2){let e=a(2);V("height",e.height,"px")}}function ue(r,d){r&1&&(k(0),c(1,"div",12),D(2,"nui-icon",13),l(),I())}function fe(r,d){if(r&1&&(g(0,ue,3,0,"ng-container",10),c(1,"span",11),v(2,"nuiWidgetConfiguratorSectionHeader"),O(3),v(4,"nuiWidgetConfiguratorSectionHeader"),l()),r&2){let e=a(),t=e.$implicit,i=e.index,n=a();s("ngIf",n.moveButtons),m(),s("title",x(2,3,n.headerMap.get(t.id),i,n.headerPrefix)),m(2),A(" ",x(4,7,n.headerMap.get(t.id),i,n.headerPrefix)," ")}}function _e(r,d){if(r&1){let e=w();c(0,"div",14)(1,"button",15),u("click",function(){f(e);let i=a(),n=i.$implicit,o=i.index,p=a();return _(p.removeItem(p.getItemForNode(n),o))}),l()()}if(r&2){let e=a().index;m(),R("id","kpi-widget-remove-btn-",e,"")}}function he(r,d){}function ge(r,d){if(r&1){let e=w();c(0,"div",5),u("cdkDragStarted",function(i){f(e);let n=a();return _(n.cdkDragStarted(i))}),g(1,le,1,2,"nui-drop-area",6)(2,fe,5,11,"ng-template",null,0,T)(4,_e,2,2,"ng-template",null,1,T),k(6,7,2),v(8,"nuiAddData"),v(9,"nuiAddData"),u("output",function(i){let n=f(e).$implicit,o=a();return _(o.onEvent(n.id,i))}),g(10,he,0,0,"ng-template",8),u("attached",function(i){f(e);let n=y(7);return _(n.attached(i))}),I(),l()}if(r&2){let e=d.$implicit,t=y(3),i=y(5),n=y(7);m(6),s("componentId",e.id)("componentType",e.componentType)("providers",e.providers)("properties",x(9,10,x(8,6,e.properties,t,"headerTextTemplate"),i,"headerButtonsTemplate"))("outputs",z(14,ce)),m(4),s("cdkPortalOutlet",n.portal)}}var Ne=(()=>{class r extends te{static{this.lateLoadKey="ItemsDynamicComponent"}constructor(e,t,i,n){super(e,t,i),this.formBuilder=n,this.items=[],this.moveButtons=!0,this.formReady=new C,this.itemsChange=new C,this.headerMap=new Map}getItemForNode(e){return this.items.find(t=>t.id===e.id)}getNodes(){return this.nodes}ngOnInit(){this.form=this.formBuilder.array([],H.required),this.formReady.emit(this.form)}onEvent(e,t){let i=this.items.find(o=>o.id===e),n=this.items.findIndex(o=>o.id===e);t.id==="formReady"&&i&&this.onFormReady(i,t.payload,n),t.id==="formDestroy"&&this.onFormDestroy(t.payload)}onFormReady(e,t,i){let n=this.formBuilder.group({id:[e.id],componentType:[e.componentType],properties:t});this.form.setControl(i,n),setTimeout(()=>{let o=t.get(`${e.id}/description`)?.get("label");o?.valueChanges.pipe(F(o.value),P(this.destroyed$)).subscribe(p=>{this.headerMap.set(e.id,p||""),this.changeDetector.markForCheck()})})}onFormDestroy(e){setTimeout(()=>{let t=0;for(;t<this.form.length&&this.form.at(t).get("properties")!==e;t++);this.form.removeAt(t),this.form.patchValue(this.form.value,{emitEvent:!0})})}trackBy(e,t){return t.id}removeItem(e,t){if(!e)throw new Error("Unable to remove undefined item from pizzagna");this.itemsChange.emit(this.items.filter(i=>i!==e)),this.items.splice(t,1),this.nodes.splice(t,1),this.pizzagnaService.removeComponents(e.id)}moveItem(e,t){let i=[...this.items],n=i.splice(e,1);i.splice(t,0,...n);let o=[...this.nodes],p=o.splice(e,1);o.splice(t,0,...p),this.nodes=[...o],this.moveFormValues(e,t),this.itemsChange.emit(i),setTimeout(()=>{this.form.setValue(this.form.value,{emitEvent:!0})})}drop(e){this.moveItem(e.previousIndex,e.currentIndex)}cdkDragStarted(e){this.height=e.source.element.nativeElement.offsetHeight}moveFormValues(e,t){let i=this.form.at(e);this.form.removeAt(e),this.form.insert(t,i)}ngOnDestroy(){super.ngOnDestroy()}static{this.\u0275fac=function(t){return new(t||r)(h(L),h(Z),h(Q),h(G))}}static{this.\u0275cmp=B({type:r,selectors:[["nui-items-dynamic"]],inputs:{items:"items",moveButtons:"moveButtons",nodes:"nodes",headerPrefix:"headerPrefix"},outputs:{formReady:"formReady",itemsChange:"itemsChange"},standalone:!1,features:[b],decls:2,vars:3,consts:[["headerText",""],["headerButtons",""],["componentPortal","nuiComponentPortal"],["cdkDropList","",1,"nui-items-dynamic",3,"cdkDropListDropped","formGroup"],["cdkDrag","","class","nui-items-dynamic__node-item",3,"cdkDragStarted",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"nui-items-dynamic__node-item",3,"cdkDragStarted"],["class","nui-items-dynamic__drop-area",3,"height",4,"cdkDragPlaceholder"],["nuiComponentPortal","",3,"output","componentId","componentType","providers","properties","outputs"],[3,"attached","cdkPortalOutlet"],[1,"nui-items-dynamic__drop-area"],[4,"ngIf"],[1,"nui-items-dynamic__header-text",3,"title"],["cdkDragHandle","",1,"nui-items-dynamic__drag-handler"],["icon","drag"],[1,"d-flex"],["nui-button","","type","button","icon","delete","displayStyle","action",3,"click","id"]],template:function(t,i){t&1&&(c(0,"div",3),u("cdkDropListDropped",function(o){return i.drop(o)}),g(1,ge,11,15,"div",4),l()),t&2&&(s("formGroup",i.form),m(),s("ngForOf",i.nodeConfigs)("ngForTrackBy",i.trackBy))},dependencies:[M,N,$,j,U,K,W,q,J,ee,X,Y,ie,ae,ne],styles:[`.nui-items-dynamic__header-text{white-space:nowrap;overflow:hidden;-ms-text-overflow:ellipsis;-o-text-overflow:ellipsis;text-overflow:ellipsis}.nui-items-dynamic__drag-handler{cursor:move;display:flex}.nui-items-dynamic__node-item{background-color:var(--nui-color-bg-light,#fff);margin:15px}.nui-items-dynamic__node-item .widget-configurator-section{margin:0}.nui-items-dynamic__drop-area{margin:15px}.kpi-indicators-configuration__color-preview{width:16px;height:16px;margin-right:15px;border-radius:3px}.cdk-drag-preview{z-index:2000!important;opacity:.9;box-shadow:0 0 5px 0 var(--nui-shadow-color, rgba(17, 17, 17, .3))}
`],encapsulation:2,changeDetection:0})}}return r})();export{ae as a,Ne as b};
