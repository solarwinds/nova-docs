import{a as Z}from"./chunk-KONGOWXB.js";import{d as tt,e as et,f as rt,g as ot}from"./chunk-7W7EWBQD.js";import{Da as J,Na as Q,fa as Y}from"./chunk-UW6LU7NQ.js";import{Ba as k,Id as K,V as at,_c as X,ld as q,ma as x,mb as z,na as w,oa as W,pa as j,va as _,ya as H}from"./chunk-VVYJCL6H.js";import{e as $,f as V,l as B}from"./chunk-N5H4HNSX.js";import{Aa as g,Ac as A,Ba as F,Cb as E,Cc as D,Gc as G,Hb as f,Hc as M,Ka as C,Nc as m,Oc as p,Pc as U,Tb as i,Wc as L,ac as c,bc as u,cc as b,da as l,dc as T,ec as y,fa as v,gc as P,h as S,pc as N,qb as a,qc as O,wb as s,za as R,zc as I}from"./chunk-7LLRMBML.js";import{g as nt}from"./chunk-VBFW7A5V.js";var it=nt(at());var st=()=>["formReady"];function mt(o,h){if(o&1&&(c(0,"nui-select-v2-option",10),A(1),u()),o&2){let t=h.$implicit;i("displayValueContext",t.label)("value",t.componentType),a(),D(" ",t.label," ")}}function pt(o,h){}function dt(o,h){if(o&1){let t=P();T(0,11,0),N("output",function(r){g(t);let n=O();return F(n.onFormReady(r.payload))}),f(2,pt,0,0,"ng-template",12),N("attached",function(r){g(t);let n=I(1);return F(n.attached(r))}),y()}if(o&2){let t=I(1),e=O();i("componentType",e.formatterConfigurator)("properties",e.formatterConfiguratorProps)("outputs",M(4,st)),a(2),i("cdkPortalOutlet",t.portal)}}var wt=(()=>{class o{static{this.lateLoadKey="PresentationConfigurationComponent"}set formatters(t){this.tableFormattersRegistryService.isEmpty&&this.handleFormattersUpdate(t)}get formatters(){return this._formatters}set dataFields(t){this._dataFields=t,this.updateAvailableFormatters()}get dataFields(){return this._dataFields}constructor(t,e,r,n,d){this.formBuilder=t,this.changeDetector=e,this.configuratorHeading=r,this.formattersRegistryCommon=n,this.tableFormattersRegistryService=d,this._providedFormatters=[],this._formatters=[],this._dataFields=[],this.formReady=new C,this.formDestroy=new C,this.formatterForm=this.formBuilder.group({}),this.formatterFormGroupName="formatter",this.onDestroy$=new S,this.subscribeToFormattersRegistry()}ngOnInit(){this.formatterForm=this.formBuilder.group({componentType:[this.formatter&&this.formatter.componentType||this._providedFormatters&&this._providedFormatters.length>0&&this._providedFormatters[0].componentType,[x.required]]}),this.form=this.formBuilder.group({[this.formatterFormGroupName]:this.formatterForm}),this.formatterForm.get("componentType")?.valueChanges.pipe(l(this.onDestroy$)).subscribe(()=>this.createFormatterConfigurator()),this.createFormatterConfigurator(),this.formReady.emit(this.form),this.formatterForm.valueChanges.pipe(l(this.onDestroy$)).subscribe(()=>{this.updateSubtitle(),this.changeDetector.detectChanges()})}ngAfterViewInit(){}ngOnChanges(t){if(t.dataFieldIds){let{currentValue:e,previousValue:r}=t.dataFieldIds;if(e&&e!==r){let n=e.map(d=>({id:d,label:(0,it.default)(d)}));this.dataFields=n,this.updateSubtitle()}}t.formatter&&(this.form?.patchValue({[this.formatterFormGroupName]:t.formatter.currentValue},{emitEvent:!1}),this.updateSubtitle()),t.dataFields&&t.dataFields.previousValue.length===0&&this.formatterForm&&this.updateSubtitle()}getSelectedFormatterDefinition(){if(this._providedFormatters.length>0){let t=this.formatterForm.get("componentType")?.value;return this._providedFormatters.find(e=>e.componentType===t)??null}return null}getSelectedDataField(){let t=this.formatterForm.controls.properties;if(t&&this.dataFields&&this.dataFields.length>0){let e=t.get("dataFieldIds")?.value.value;return this.dataFields.find(r=>r.id===e)??null}return null}onFormReady(t){this.form.get(this.formatterFormGroupName).setControl("properties",t)}updateSubtitle(){this.subtitleText=`${this.getSelectedFormatterDefinition()?.label}`,this.getSelectedDataField()&&(this.subtitleText=this.subtitleText.concat(`, ${this.getSelectedDataField()?.label}`))}createFormatterConfigurator(){let t=this._providedFormatters.find(e=>e.componentType===this.formatterForm.get("componentType")?.value);t?this.formatterConfigurator=t.configurationComponent??"ValueSelectorComponent":this.formatterConfigurator=null,t?.componentType!==this.formatter?.componentType&&this.formatter?.properties?.dataFieldIds&&(this.formatter.properties.dataFieldIds={value:null}),this.formatterConfiguratorProps={dataFields:this.dataFields,formatter:this.formatter,formatterDefinition:t}}updateAvailableFormatters(){if(!this._dataFields.length||!this._providedFormatters.length)return;let t={null:!0};this._dataFields.forEach(e=>t[e.dataType]=!0),this._formatters=this._providedFormatters.filter(e=>(e.dataTypes.value instanceof Array?e.dataTypes.value:[e.dataTypes.value]).some(n=>t[n])),this.formatterForm&&this.createFormatterConfigurator()}subscribeToFormattersRegistry(){this.handleFormattersUpdate(this.formattersRegistry.getItems()),this.formattersRegistry.stateChanged$.pipe(v(this.handleFormattersUpdate.bind(this)),l(this.onDestroy$)).subscribe()}handleFormattersUpdate(t){t!==this._providedFormatters&&(this._providedFormatters=t,this.updateAvailableFormatters())}get formattersRegistry(){return this.formattersRegistryCommon||this.tableFormattersRegistryService}ngOnDestroy(){this.formDestroy.emit(this.form),this.onDestroy$.next(),this.onDestroy$.complete()}static{this.\u0275fac=function(e){return new(e||o)(s(k),s(L),s(Z),s(Y,8),s(J))}}static{this.\u0275cmp=E({type:o,selectors:[["nui-table-column-presentation-configuration"]],inputs:{formatter:"formatter",formatters:"formatters",dataFieldIds:"dataFieldIds",dataFields:"dataFields"},outputs:{formReady:"formReady",formDestroy:"formDestroy"},standalone:!1,features:[G([],[{provide:w,useExisting:_}]),R],decls:14,vars:19,consts:()=>{let t;t=$localize`:␟7722a92a1fc887570b4f4d8a7bb916f067f32028␟7513076467032912668:Format`;let e;return e=$localize`:␟408b4f352f2fec5727e6df77cb926194384bbba0␟736196504450716827:Select Format`,[["componentPortal","nuiComponentPortal"],[3,"formGroup"],[3,"state"],["headerTitle","Property and formatting",3,"headerIcon","subtitle"],[1,"presentation-configuration__accordion-content"],[1,"mb-4"],["caption",t,3,"control"],["placeholder",e,"formControlName","componentType",3,"popupViewportMargin"],[3,"displayValueContext","value",4,"ngFor","ngForOf"],["nuiComponentPortal","","componentId","formatterConfigurator",3,"componentType","properties","outputs","output",4,"ngIf"],[3,"displayValueContext","value"],["nuiComponentPortal","","componentId","formatterConfigurator",3,"output","componentType","properties","outputs"],[3,"attached","cdkPortalOutlet"]]},template:function(e,r){e&1&&(T(0,1),c(1,"nui-widget-editor-accordion",2),m(2,"nuiWidgetEditorAccordionFormState"),m(3,"async"),b(4,"nui-widget-editor-accordion-header",3),m(5,"nuiFormHeaderIconPipe"),m(6,"async"),c(7,"div",4)(8,"div",5)(9,"nui-form-field",6)(10,"nui-select-v2",7),m(11,"async"),f(12,mt,2,3,"nui-select-v2-option",8),u()()(),f(13,dt,3,5,"ng-container",9),u()(),y()),e&2&&(i("formGroup",r.formatterForm),a(),i("state",p(3,10,p(2,8,r.form))),a(3),i("headerIcon",p(6,15,U(5,12,r.form,"customize")))("subtitle",r.subtitleText),a(5),i("control",r.formatterForm.controls.componentType),a(),i("popupViewportMargin",p(11,17,r.configuratorHeading.height$)),a(2),i("ngForOf",r.formatters),a(),i("ngIf",r.formatterConfigurator))},dependencies:[$,V,W,j,_,H,z,Q,K,q,X,et,tt,B,rt,ot],styles:[".presentation-configuration__accordion-content[_ngcontent-%COMP%]{padding:15px 15px 15px 46px}"],changeDetection:0})}}return o})();export{wt as a};
