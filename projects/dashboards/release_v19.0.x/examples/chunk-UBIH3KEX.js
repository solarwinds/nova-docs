import{e as D,g as de}from"./chunk-6RFOZAUJ.js";import{a as C}from"./chunk-WVQTOMGO.js";import{a as ye}from"./chunk-J2FL45L7.js";import{a as oe,b as ne,c as ae,j as se}from"./chunk-PPQN6QZA.js";import{a as ie}from"./chunk-MD6F45Z7.js";import{B as ee,Ja as re,c as J,ea as T,ha as L,ia as te,ka as N}from"./chunk-573U3PX6.js";import{Xc as Q,kc as y,lc as U,oc as $,xe as Y,ze as Z}from"./chunk-PMWUHOKA.js";import{C as l,f as K}from"./chunk-YHLZAVJ5.js";import{Ba as u,Bc as q,Ca as c,Db as z,Ec as I,Fc as _,Gc as W,H as G,Ib as w,K as H,P as B,Ub as f,Xc as X,bc as s,cc as n,hc as E,i as F,ka as k,mc as V,pa as p,qc as j,r as S,rb as h,rc as d,w as g,xb as m}from"./chunk-MCPF2SEG.js";import{a as M,b as O,g as _e,i as A}from"./chunk-VBFW7A5V.js";var pe=_e(ye());function De(o,ue){if(o&1){let e=E();s(0,"button",6),j("click",function(){u(e);let t=d();return c(t.reInitializeDashboard())}),q(1," Restore Widget "),n()}}function Ce(o,ue){if(o&1){let e=E();s(0,"nui-dashboard",7),W("dashboardChange",function(t){u(e);let r=d();return _(r.dashboard,t)||(r.dashboard=t),c(t)})("gridsterConfigChange",function(t){u(e);let r=d();return _(r.gridsterConfig,t)||(r.gridsterConfig=t),c(t)}),n()}if(o&2){let e=d();I("dashboard",e.dashboard)("gridsterConfig",e.gridsterConfig),f("editMode",e.editMode)}}var b=(()=>{class o extends Z{static{this.providerId="DrilldownDataSourceRealApi"}constructor(e,i,t){super(),this.logger=e,this.http=i,this.apollo=t,this.busy=new F(!1),this.dataFields=[{id:"regionName",label:"Region name"},{id:"subregionName",label:"Subregion name"}],this.supportedFeatures={search:{enabled:!0}},this.drillState=[],this.groupedDataHistory=[],this.features=new Y(this.supportedFeatures),this.dataFieldsConfig.dataFields$.next(this.dataFields)}getFilteredData(e){return A(this,null,function*(){return S(e).pipe(G(()=>!!this.drillState),g(i=>{let t=()=>ge(this.groupedDataHistory);if(!this.drillState.length&&!this.groupBy.length)return i;let r=["ROOT",...this.drillState],a=r.length,ce=this.groupedDataHistory.length,P=a-ce;if(!P)return t()||i;let he=r.slice(r.length-P);for(let x of he){let me=r.findIndex(v=>v===x),R=this.groupBy[me];if(R){let v=t()?t()[x]:i,fe=(0,pe.default)(v,R);this.groupedDataHistory.push(fe)}}return this.groupBy.length===this.drillState.length?t()[ge(this.drillState)]:this.getGroupsWidgetData(t())})).toPromise()})}ngOnDestroy(){this.outputsSubject.complete()}getBackendData(e){return this.apollo.watchQuery({query:this.generateQuery(e)}).valueChanges.pipe(B(300),g(t=>t.data.countries),g(t=>t.map(r=>O(M({},r),{icon:"virtual-host",icon_status:U.Up,subregionName:r.subregion?.name||"No Subregion Specified",regionName:r.subregion?.region?.name||"No Region Specified"}))),H(t=>(this.logger.error(t),S({}))))}generateQuery(e){let{search:i}=e,r=`
            query {
                countries(filter: {name: {regex: "${i?.value?`^[${i.value}]*`:""}"} }) {
                    name
                    native
                    capital
                    languages {
                        name
                    }
                    currencies
                    subdivisions {
                        name
                    }
                }
            }
        `;return de`
            ${r}
        `}beforeApplyFilters(e){this.busy.next(!0),this.drillState=e.drillstate?.value,this.groupBy=e.group?.value,this.isHome()&&(this.groupedDataHistory.length=0),this.isBack()&&(this.groupedDataHistory.length=this.groupedDataHistory.length-1),this.getFilters().search&&this.filterChanged("search")&&(this.groupedDataHistory.length=0)}getGroupsWidgetData(e){return Object.keys(e).map(i=>({id:i,label:i,statuses:[{key:"virtual-host",value:e[i].length},{key:"acknowledge",value:this.getPopulation(e[i])}]}))}isHome(){return this.drillState?.length===0}isBack(){return this.groupedDataHistory?.length>this.drillState?.length&&!this.isHome()}getPopulation(e){return`${e.reduce((t,r)=>t+=r.population,0)*Math.pow(10,-3)} k`}static{this.\u0275fac=function(i){return new(i||o)(p(y),p(l),p(D))}}static{this.\u0275prov=k({token:o,factory:o.\u0275fac})}}return o})(),Ge=(()=>{class o{constructor(e,i,t){this.widgetTypesService=e,this.providerRegistry=i,this.changeDetectorRef=t,this.gridsterConfig={},this.editMode=!1}ngOnInit(){this.providerRegistry.setProviders({[C.providerId]:{provide:T,useClass:C,deps:[l]},[b.providerId]:{provide:T,useClass:b,deps:[y,l,D]}}),this.initializeDashboard();let e=this.widgetTypesService.getWidgetType("drilldown",1);this.widgetTypesService.setNode(e,"configurator",te.DataSourceProviders,[b.providerId,C.providerId])}initializeDashboard(){let e=le,i={[e.id]:this.widgetTypesService.mergeWithWidgetType(e)},t={[e.id]:{cols:10,rows:10,y:0,x:0}};this.dashboard={positions:t,widgets:i}}reInitializeDashboard(){this.dashboard=void 0,this.changeDetectorRef.detectChanges();let e=le.pizzagna[N.Configuration].listWidget.providers?.adapter?.properties;e&&(e.drillstate=[]),this.initializeDashboard()}static{this.\u0275fac=function(i){return new(i||o)(m(ie),m(re),m(X))}}static{this.\u0275cmp=z({type:o,selectors:[["drilldown-widget-example"]],standalone:!1,decls:6,vars:3,consts:()=>{let e;return e=$localize`:␟5fa31edac506213950b479159e840b300d749592␟3766035158759769347: Edit Mode `,[e,[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"valueChange","value"],["type","button","displayStyle","action","nui-button","",3,"click",4,"ngIf"],[1,"w-100","dashboard"],["nuiWidgetEditor","",3,"dashboard","gridsterConfig","editMode","dashboardChange","gridsterConfigChange",4,"ngIf"],["type","button","displayStyle","action","nui-button","",3,"click"],["nuiWidgetEditor","",3,"dashboardChange","gridsterConfigChange","dashboard","gridsterConfig","editMode"]]},template:function(i,t){i&1&&(s(0,"div",1)(1,"nui-switch",2),W("valueChange",function(a){return _(t.editMode,a)||(t.editMode=a),a}),V(2,0),n(),w(3,De,2,0,"button",3),n(),s(4,"div",4),w(5,Ce,1,3,"nui-dashboard",5),n()),i&2&&(h(),I("value",t.editMode),h(2),f("ngIf",!(t.dashboard!=null&&t.dashboard.widgets.embeddedContentWidgetId)),h(2),f("ngIf",t.dashboard))},dependencies:[$,K,oe,se,Q],styles:[".dashboard[_ngcontent-%COMP%]{height:700px}"]})}}return o})(),le={id:"drilldown",type:"drilldown",pizzagna:{[N.Configuration]:{[J]:{providers:{[L.DataSource]:{providerId:b.providerId,properties:{}}}},header:{properties:{title:"Drilldown Widget",subtitle:"Search is case sensitive!"}},listWidget:{providers:{[L.Adapter]:{providerId:ee,properties:{navigationBarId:"navigationBar",componentId:"listWidget",dataPath:"data",drillstate:[],groupBy:["regionName","subregionName"],groups:["regionName","subregionName"],componentsConfig:{group:{componentType:ne.lateLoadKey,properties:{dataFieldIds:{id:"id",label:"label",statuses:"statuses"}},itemProperties:{canNavigate:!0}},leaf:{componentType:ae.lateLoadKey,properties:{dataFieldIds:{icon:"icon",status:"icon_status",detailedUrl:"capital",label:"name"}},itemProperties:{canNavigate:!1}}}}}},properties:{configuration:{}}}}}},ge=o=>o[o.length-1];export{b as a,Ge as b};
