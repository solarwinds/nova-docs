import{d as Z,e as N,f as K}from"./chunk-URWUMSY2.js";import{a as Fi}from"./chunk-SXG7KMJ2.js";import{$b as xi,Ae as se,C as It,D as Ue,Dc as Ct,J as G,M as ke,Q as le,Ub as Le,Z as Di,gc as Pt,ge as oe,h as Ni,jb as Tt,kc as R,m as Et,ma as At,o as fe,p as Fe,s as $e,sb as Vi,sc as T,t as Be,ue as f,wb as ji,xc as M,y as wi}from"./chunk-VVYJCL6H.js";import{q as he}from"./chunk-N5H4HNSX.js";import{Ac as vt,Cb as ft,Eb as de,G as st,Ga as ee,H as ce,I as nt,Ka as xe,La as ue,M as at,R as U,S as pt,Wc as St,Z as ct,ac as lt,ba as me,bc as gt,ca as mt,da as l,fa as L,h as A,i as O,j as B,ka as m,na as k,pa as a,ra as x,sa as z,vb as dt,w as F,wb as te,x as ot,xb as ht,ya as je,za as ut}from"./chunk-7LLRMBML.js";import{a as E,b as D,f as Q,g as I}from"./chunk-VBFW7A5V.js";var Ge=Q((bo,Rt)=>{var $i=Vi(),Bi=Fi(),Ui=Bi(function(r,n,e){$i(r,e,n)});Rt.exports=Ui});var We=Q((_n,Or)=>{var Yi=ke();function qi(r){return r&&r.length?Yi(r):[]}Or.exports=qi});var Kr=Q((pp,Zr)=>{var ro=Et(),io=Fe(),oo=$e(),Mr=Be(),so=oo(function(r,n){return Mr(r)?ro(r,io(n,1,Mr,!0)):[]});Zr.exports=so});var Si=Q((Au,vi)=>{var mo=Fe(),uo=$e(),ho=ke(),fo=Be(),lo=uo(function(r){return ho(mo(r,1,fo,!0))});vi.exports=lo});var yi=Q((zu,Ri)=>{var Eo=Et(),Io=Fe(),Ci=ke();function Ao(r,n,e){var t=r.length;if(t<2)return t?Ci(r[0]):[];for(var i=-1,o=Array(t);++i<t;)for(var s=r[i],p=-1;++p<t;)p!=i&&(o[i]=Eo(o[i]||s,r[p],n,e));return Ci(Io(o,1),n,e)}Ri.exports=Ao});var _i=Q((Nu,bi)=>{var To=wi(),Po=$e(),Co=yi(),Ro=Be(),yo=Po(function(r){return Co(To(r,Ro))});bi.exports=yo});var zo="/",w=new T("REFRESH"),yt=new T("SET_NEXT_PAGE"),bt=new T("SCROLL_NEXT_PAGE"),No=new T("WIDGET_REMOVE"),wo=new T("WIDGET_EDIT"),Do=new T("WIDGET_CREATE"),_t=new T("WIDGET_READY"),Vo=new T("WIDGET_RESIZE"),jo=new T("WIDGET_POSITION_CHANGE"),xo=new T("WIDGET_SEARCH",()=>new O({payload:""})),q=new T("SET_PROPERTY_VALUE"),Fo=new T("SET_TIMEFRAME"),$o=new T("PREVIEW_EVENT"),ne=new T("DATA_SOURCE_BUSY"),Bo=new T("DASHBOARD_EDIT_MODE",()=>new B(1)),Ot=new T("INTERACTION"),Uo=new T("SELECTION"),ko=new T("CHANGE_SELECTION"),Lo=new T("SELECTED_ITEMS"),zt=new T("DATA_SOURCE_INVOKED"),Nt=new T("DRILLDOWN"),wt="NOVA_DATASOURCE_INTERVAL_REFRESHER",Dt="NOVA_DATASOURCE_ADAPTER",Vt="NOVA_TIMESERIES_DATASOURCE_ADAPTER",jt="NOVA_KPI_DATASOURCE_ADAPTER",xt="NOVA_DRILLDOWN_DATASOURCE_ADAPTER",Ft="NOVA_KPI_COLOR_PRIORITIZER",$t="NOVA_TITLE_AND_DESCRIPTION_CONVERTER",Bt="NOVA_PROPORTIONAL_WIDGET_CHART_OPTIONS_CONVERTER",Ut="NOVA_KPI_TILES_CONVERTER",kt="NOVA_TIMESERIES_METADATA_CONVERTER",Lt="NOVA_TIMESERIES_SERIES_CONVERTER",Gt="NOVA_DASHBOARD_EVENT_PROXY",Mt="NOVA_TABLE_COLUMNS_CONVERTER",Zt="NOVA_TABLE_FILTERS_CONVERTER",Kt="NOVA_TABLE_SCROLL_TYPE_CONVERTER",Ht="NOVA_TABLE_DATASOURCE_ADAPTER",Wt="NOVA_GENERIC_CONVERTER",Yt="NOVA_GENERIC_ARRAY_CONVERTER",qt="NOVA_KPI_SECTION_CONVERTER",Xt="NOVA_TIMESERIES_TILE_INDICATOR_DATA_CONVERTER",Jt="NOVA_LOADING_ADAPTER",Qt="NOVA_STATUS_CONTENT_FALLBACK_ADAPTER",er="NOVA_KPI_STATUS_CONTENT_FALLBACK_ADAPTER",tr="NOVA_KPI_SCALE_SYNC_BROKER",rr="NOVA_URL_INTERACTION_HANDLER",ir="NOVA_EVENT_BUS_DEBUGGER",or="NOVA_PIZZAGNA_BROADCASTER",sr="NOVA_VIRTUAL_VIEWPORT_MANAGER",nr="NOVA_TABLE_FORMATTERS_REGISTRY",ar="NOVA_KPI_FORMATTERS_REGISTRY",pr="NOVA_RISK_SCORE_FORMATTERS_REGISTRY",cr="NOVA_PROPORTIONAL_CONTENT_FORMATTERS_REGISTRY";var mr="NOVA_CONFIGURATOR_DATA_SOURCE_MANAGER",Go={id:"CHART_METRIC_REMOVE"};var c=new k("PIZZAGNA_EVENT_BUS"),ge=new k("DASHBOARD_EVENT_BUS"),b=new k("DATA_SOURCE"),ae=new k("FORMATTERS_REGISTRY"),Ko=new k("TEST_REGISTRY"),Ho=new k("HEADER_LINK_PROVIDER"),pe=function(r){return r.DataSource="dataSource",r.Adapter="adapter",r.Converter="converter",r.Broadcaster="broadcaster",r.Refresher="refresher",r.EventProxy="eventProxy",r.LoadingAdapter="loadingAdapter",r.ContentFallbackAdapter="contentFallbackAdapter",r.InteractionHandler="interactionHandler",r.EventBusDebugger="eventBusDebugger",r.KpiColorPrioritizer="kpiColorPrioritizer",r.FormattersRegistry="formattersRegistry",r.DataSourceManager="dataSourceManager",r}(pe||{}),ki=function(r){return r.Root="root",r.DataSourceConfigComponentType="dataSourceConfigComponentType",r.TileDescriptionConfigComponentType="tileDescriptionConfigComponentType",r.DataSourceProviders="dataSourceProviders",r.Formatters="formatters",r.TileDescriptionBackgroundColors="tileDescriptionBackgroundColors",r.TileBackgroundColorRulesBackgroundColors="tileBackgroundColorRulesBackgroundColors",r}(ki||{}),Li=function(r){return r.Interactivity="interactivity",r.DisableTableColumnGeneration="disableTableColumnGeneration",r}(Li||{}),h=function(r){return r.Structure="structure",r.Configuration="configuration",r.Data="data",r}(h||{}),Gi=function(r){return r.CRITICAL="critical",r.WARNING="warning",r.DEFAULT="default",r}(Gi||{}),Me=function(r){return r.Unknown="0",r.Ok="200",r.Forbidden="403",r.NotFound="404",r}(Me||{});var Mi={">":{comparatorFn:(r,n)=>r>n,label:"Value is greater than"},"<":{comparatorFn:(r,n)=>r<n,label:"Value is less than"},">=":{comparatorFn:(r,n)=>r>=n,label:"Value is greater, or equal to"},"<=":{comparatorFn:(r,n)=>r<=n,label:"Value is less than, or equal to"},"==":{comparatorFn:(r,n)=>r==n,label:"Value is exactly"}},ve=(()=>{class r{constructor(){this.comparators=E({},Mi)}registerComparators(e){this.comparators=E(E({},this.comparators),e)}clearComparators(){this.comparators={}}getComparators(){return this.comparators}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ze=function(r){return r.None="None",r.Right="Right",r.Bottom="Bottom",r}(Ze||{});var ur=(()=>{class r{get stateVersion(){return this._stateVersion}get isEmpty(){return this._isEmpty}constructor(e,t){this.logger=e,this.className=t,this.state$=new O({}),this.stateChanged$=this.state$.asObservable().pipe(F(()=>this.getItems())),this._isEmpty=!0}addItems(e,t={overrideExisting:!0}){let i=this.state$.value;e.forEach(o=>{if(i[this.getItemKey(o)]&&!t.overrideExisting){this.logger.warn(`Logger - ${this.className}: item with ${this.getItemKey(o)}
                    is already registered. Skipping.`);return}i[this.getItemKey(o)]=E({},o)}),this.state$.next(i),e.length>0&&this.updateStateFlags(!1)}getItem(e){return this.state$.value[e]}getItems(){return Object.values(this.state$.value)}reset(){this.state$.next({}),this.updateStateFlags(!0)}ngOnDestroy(){this.state$.complete()}updateStateFlags(e){this._isEmpty=e,this._stateVersion=Ct()}static{this.\u0275fac=function(t){ht()}}static{this.\u0275dir=de({type:r})}}return r})();var X=class extends ur{constructor(){super(...arguments),this.formattersStateChanged$=this.stateChanged$}addFormatters(n,e={overrideExisting:!0}){super.addItems(n,e)}getFormatters(){return super.getItems()}getItemKey(n){return n.componentType}},dr=(()=>{class r extends X{constructor(e){super(e,"TableFormatterRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),hr=(()=>{class r extends X{constructor(e){super(e,"KpiFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),fr=(()=>{class r extends X{constructor(e){super(e,"RiskScoreFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),lr=(()=>{class r extends X{constructor(e){super(e,"ProportionalDonutContentFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),os=(()=>{class r extends X{constructor(e){super(e,"ProportionalLegendFormattersRegistryService")}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Tr=I(Ue());var W=new T("DATA_SOURCE_OUTPUT",()=>new B(1)),Se=new T("DATA_SOURCE_DESTROYED"),gr=new T("DATA_SOURCE_CHANGE"),vr=new T("DATA_SOURCE_CREATED",()=>new O({payload:void 0}));var Ir=I(fe()),Ar=I(Pt());var Ki="WidgetConfiguratorSectionComponent",Sr=(()=>{class r{getPizzagnaUpdatedWithComponents(e,t,i){let s=e[h.Structure][t].properties?.template;return this.getPizzagnaWithChildren(e,i,s,t)}getPizzagnaWithChildren(e,t,i,o){let p=t.map(u=>({id:u,componentType:Ki})).reduce((u,g)=>this.updateChildPizzagna(u,i,g),e);return p=this.getPizzagnaWithNodesSet(p,o,t),p}updateChildPizzagna(e,t,i){let o=f(e,`${h.Structure}.${i.id}`,i),s=t.map(u=>D(E({},u),{id:`${i.id}/${u.id}`}));o=s.reduce((u,g)=>f(u,`${h.Structure}.${g.id}`,g),o);let p=s.map(u=>u.id);return o=this.getPizzagnaWithNodesSet(o,i.id,p),o}getPizzagnaWithNodesSet(e,t,i){let o=`${h.Structure}.${t}.properties.nodes`;return f(e,o,i)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();function Er(r){return r.providerKey?[r.pizzagnaKey||h.Data,r.componentId,"providers",r.providerKey,"properties",...r.propertyPath].join("."):[r.pizzagnaKey||h.Data,r.componentId,"properties",...r.propertyPath].join(".")}var d=(()=>{class r{constructor(e,t){this.eventBus=e,this.dynamicComponentCreator=t,this.pizzaChanged=new B(1)}updatePizzagna(e){this.pizzagna=e}updateComponents(e){this.components=e,this.pizzaChanged.next(e)}getComponent(e){let t=this.components[e];if(!t)throw new Error("Component '"+e+"' is not defined!");return t}setProperty(e,t){let i=typeof e=="string"?e:Er(e);this.eventBus.getStream(q).next({payload:{path:i,value:t}})}createComponentsFromTemplateWithProperties(e,t){let i=t.map(s=>s.id),o=this.dynamicComponentCreator.getPizzagnaUpdatedWithComponents(this.pizzagna,e,i);for(let s of t)for(let p of Object.keys(s.children))o=f(o,`${h.Data}.${p}.properties`,s.children[p]);this.updatePizzagna(o),this.eventBus.getStream(q).next({payload:{path:"",value:o}})}createComponentsFromTemplate(e,t){let i=this.dynamicComponentCreator.getPizzagnaUpdatedWithComponents(this.pizzagna,e,t);this.updatePizzagna(i),this.eventBus.getStream(q).next({payload:{path:"",value:i}})}removeComponents(e){(0,Ir.default)(e)?e.forEach(t=>this.removeComponent(t)):this.removeComponent(e)}removeComponent(e){let t=E({},this.pizzagna),i=this.pizzagna[h.Structure][e].properties?.nodes,o=[e,...i],s=[h.Structure,h.Configuration,h.Data];for(let p of s)if(t[p])for(let u of o)t[p]=(0,Ar.default)(t[p],u);this.eventBus.getStream(q).next({payload:{path:"",value:t}}),this.updatePizzagna(t)}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(Sr))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var $=(()=>{class r{constructor(e,t,i){this.eventBus=e,this.dataSource=t,this.pizzagnaService=i,this.destroy$=new A,this.dataSource&&(this.setupRefreshListener(),this.dataSource.outputsSubject.pipe(l(this.destroy$)).subscribe(o=>this.handleDataSourceUpdate(o)),this.dataSource.busy&&this.dataSource.busy.pipe(l(this.destroy$)).subscribe(o=>{this.eventBus.getStream(ne).next({payload:{componentId:this.componentId,busy:o}})}))}setupRefreshListener(){this.eventBus.getStream(w).pipe(l(this.destroy$)).subscribe(()=>this.handleRefresh())}handleRefresh(){this.eventBus.getStream(zt).next({}),this.dataSource.applyFilters()}handleDataSourceUpdate(e){this.lastValue=(0,Tr.default)(e?.result)?e:e?.result,this.updateOutput(this.lastValue),this.eventBus.getStream(W).next({payload:E({componentId:this.componentId},e)})}ngOnDestroy(){this.updateOutput(void 0);let e={payload:{componentId:this.componentId}};this.eventBus.getStream(Se).next(e);let t={payload:{componentId:this.componentId,busy:!1}};this.eventBus.getStream(ne).next(t),this.destroy$.next(),this.destroy$.complete()}updateConfiguration(e){e.componentId&&(this.componentId=e.componentId),this.updateAdapterProperties(e),this.updateDataSourceProperties(e),typeof this.lastValue<"u"&&this.updateOutput(this.lastValue)}updateAdapterProperties(e){this.propertyPath=e.propertyPath}updateDataSourceProperties(e){let t=e?.dataSource?.properties;if(this.dataSourceConfiguration!==t){this.dataSourceConfiguration=t;let i=this.dataSource;i?.updateConfiguration&&i.updateConfiguration(e.dataSource?.properties),this.eventBus.getStream(w).next({})}typeof this.dataSourceConfiguration>"u"&&typeof t>"u"&&setTimeout(()=>this.eventBus.getStream(w).next({}))}updateOutput(e){this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.propertyPath]},this.processOutput(e))}processOutput(e){return e}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(b,8),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Ee=class extends ${constructor(n,e,t){super(n,e,t),this.dataSource=e,this.drillstate=[],this.eventBus.getStream(Nt).pipe(l(this.destroy$)).subscribe(i=>{this.dataSource.busy?.value||this.onDrilldown(i)}),this.registerFilters()}updateAdapterProperties(n){this.dataPath=n.dataPath,this.drillstate=n.drillstate||this.drillstate,this.groupBy=n.groupBy,this.componentsConfig=n.componentsConfig,this.navigationBarId=n.navigationBarId}updateOutput(n){let e=this.getWidgetInput(n,this.drillstate.length!==this.groupBy.length),t=`${h.Data}.${this.componentId}.properties`;if(this.pizzagnaService.setProperty(t,e),this.navigationBarId){let i=`${h.Data}.${this.navigationBarId}.properties.navBarConfig.label`,o=`${h.Data}.${this.navigationBarId}.properties.navBarConfig.isRoot`,s=`${h.Data}.${this.navigationBarId}.properties.navBarConfig.buttons.back.disabled`;this.pizzagnaService.setProperty(i,this.drillstate[this.drillstate.length-1]),this.pizzagnaService.setProperty(s,!!this.drillstate.length),this.pizzagnaService.setProperty(o,!this.drillstate.length)}}getWidgetInput(n,e){let t=this.componentsConfig[e?"group":"leaf"];return{[this.dataPath]:n,configuration:t}}onDrilldown(n){let{payload:e}=n;if(e.reset){this.drillstate=[],this.eventBus.next(w,{});return}if(e.back){this.drillstate.length=this.drillstate.length-1,this.eventBus.next(w,{});return}this.drillstate.push(e.id),this.eventBus.next(w,{})}registerFilters(){this.dataSource.registerComponent({group:{componentInstance:{getFilters:()=>({value:this.groupBy})}},drillstate:{componentInstance:{getFilters:()=>({value:this.drillstate})}}})}};Ee=Z([N(0,x(c)),N(1,x(b)),K("design:paramtypes",[M,Object,d])],Ee);var Pr=(()=>{class r{constructor(e){this.eventBus=e,this.destroy$=new A,e.streamAdded.pipe(l(this.destroy$)).subscribe(t=>{e.getStream({id:t}).pipe(l(this.destroy$)).subscribe(i=>{console.log(`${i.id}: `,i.payload)})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)(a(c))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Cr=(()=>{class r{constructor(e){this.eventBus=e,this.initializeSubscriptions()}updateConfiguration(e){this.properties=e}initializeSubscriptions(){this.eventBus.getStream(Ot).subscribe(e=>{(!this.properties?.interactionType||this.properties?.interactionType===e.payload?.interactionType)&&this.handleInteraction(e.payload)})}static{this.\u0275fac=function(t){return new(t||r)(a(c))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Ie=(()=>{class r{constructor(e){this.logger=e}template(e,t){let i=new RegExp(/\$\{([a-zA-Z0-9.]*)\}/g);return e.replace(i,(o,s)=>{try{return this.evaluate(s.split("."),t)??""}catch(p){return this.logger.error(p),""}})}evaluate(e,t){return e.reduce((i,o)=>i[o],t)}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Rr=(()=>{class r extends Cr{constructor(e,t,i,o){super(e),this.window=t,this.logger=i,this.urlInteractionService=o}handleInteraction(e){if(!this.properties?.url){this.logger.warn("The target url has not been defined.");return}let t=this.urlInteractionService.template(this.properties.url,{data:e.data});t&&(this.properties.newWindow?this.window.open(t):this.window.location.href=t)}static{this.\u0275fac=function(t){return new(t||r)(a(c),a("windowObject"),a(R),a(Ie))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var yr=(()=>{class r{constructor(e,t,i){this.dataSource=e,this.pizzagnaService=t,this.destroy$=new A,this.propertyPath="backgroundColor",this.comparators=i.getComparators()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateConfiguration(e){e?.rules&&(this.rules=e?.rules,this.subscribeToDataChanges(),this.checkColorConditions())}setComponent(e,t){this.subscribeToDataChanges(),this.componentId=t}subscribeToDataChanges(){this.dataSource&&(this.dsSubscription$?.unsubscribe(),this.dsSubscription$=this.dataSource.outputsSubject.pipe(l(this.destroy$)).subscribe(e=>{this.latestValueFromDS=e.result?.value||this.latestValueFromDS,this.checkColorConditions()}))}checkColorConditions(){if(!this.rules)return;if(this.rules.length===0){this.setColor(void 0),this.dsSubscription$?.unsubscribe();return}let e,t=this.rules&&[...this.rules].reverse();for(let i of t)if(this.comparators[i.comparisonType]?.comparatorFn(this.latestValueFromDS,i.value)){e=i.color;break}this.setColor(e)}setColor(e){this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:[this.propertyPath]},e)}static{this.\u0275fac=function(t){return new(t||r)(a(b,8),a(d),a(ve))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Ke=I(Ni());var Ae=function(r){return r.Warning="var(--nui-color-semantic-warning)",r.Critical="var(--nui-color-semantic-critical)",r}(Ae||{});var Te=class extends ${constructor(n,e,t,i){super(n,e,t),this.numberPipe=i}updateConfiguration(n){this.thresholds=n.thresholds,super.updateConfiguration(n)}processOutput(n){let e=this.processThresholds(n);return this.processNumberFormat(e)}setComponent(n,e){e&&(this.componentId=e)}getThresholdColor(n,e,t){let i=this.getThresholdChecks(n,e,n.reversedThresholds);return i.warningCheck?Ae.Warning:i.criticalCheck?Ae.Critical:t}getThresholdChecks(n,e,t){let i=n.warningThresholdValue,o=n.criticalThresholdValue,s=!(0,Ke.default)(i)&&e.value<=i&&e.value>o,p=e.value<=o,u=!(0,Ke.default)(i)&&e.value>=i&&e.value<o,g=e.value>=o;return{warningCheck:t?s:u,criticalCheck:t?p:g}}processThresholds(n){if(!n||!this.thresholds?.showThresholds||typeof n.value!="number")return n;let e=this.getThresholdColor(this.thresholds,n,n.backgroundColor);return D(E({},n),{backgroundColor:e})}processNumberFormat(n){if(typeof n?.value!="number"||!n?.numberFormat)return n;let e=this.numberPipe.transform(n.value,n.numberFormat);return D(E({},n),{value:e})}};Te=Z([N(0,x(c)),N(1,z()),N(1,x(b)),K("design:paramtypes",[M,Object,d,he])],Te);var br=I(fe());var _r=(()=>{class r{constructor(e,t){this.eventBus=e,this.pizzagnaService=t,this.brokers=[],this.builder=new He(this.brokers),this.destroySubscriptions$=new A,this.getMin=i=>Math.min(...i),this.getMax=i=>Math.max(...i),this.valuesObject=this.builder.valuesObject}updateConfiguration(e){this.properties=e,this.componentId&&this.createPropertiesAndSubscribeToBrokers()}configure(){return this.builder}getBrokers(){return this.brokers}subscribeToBrokers(){this.destroy(),this.brokers.forEach(e=>{e.in$.pipe(ce(t=>!!e.in$.observers.length),U(),L(t=>this.configureValueModel(t)),L(t=>this.processAndEmitSyncedValue(t,e)),l(this.destroySubscriptions$)).subscribe()})}setComponent(e,t){this.componentId=t,this.updateConfiguration(this.properties)}destroy(){this.destroySubscriptions$.next(),this.destroySubscriptions$.complete()}processAndEmitSyncedValue(e,t){let i=this.getMin;t?.type&&(i=t.type==="min"?this.getMin:this.getMax);let o=this.valuesObject[t.id].filter(s=>s.targetID&&s.targetValue).map(s=>s.targetValue);t.out$.next(D(E({},e),{targetValue:i([...o])}))}configureValueModel(e){let t=this.valuesObject[e.id].filter(i=>i.targetID===e.targetID);t.length?t[0].targetValue=e.targetValue:this.valuesObject[e.id].push({targetID:e.targetID,targetValue:e.targetValue})}createPropertiesAndSubscribeToBrokers(){this.tileNodes=this.pizzagnaService.getComponent(this.componentId).properties?.nodes;let{scaleSyncConfig:e}=this.properties;this.tileNodes?.length&&(this.tileNodes.forEach((t,i)=>{let o={componentId:t,pizzagnaKey:h.Data,propertyPath:["syncValuesBroker"]};this.pizzagnaService.setProperty(o,this.getBrokers())}),e&&(0,br.default)(e)&&(e.forEach(t=>this.configure().addBroker({id:t.id,type:t?.type})),this.subscribeToBrokers()))}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})(),He=class{constructor(n){this.brokers=n,this.valuesObject={}}addBroker(n){let e={id:n.id,targetID:"",targetValue:1};return this.valuesObject[n.id]=new Array,this.brokers.push(E(E({},n),this.getDefaultBrokerObject(e,e))),this}getDefaultBrokerObject(n,e){return{in$:new O(n),out$:new O(e)}}};var zr=I(le()),Nr=I(We());var Pe=(()=>{class r{constructor(e,t){this.eventBus=e,this.pizzagnaService=t,this.destroy$=new A,this.eventBus.getStream(W).pipe(l(this.destroy$)).subscribe(i=>{this.handleDataSourceOutput(i)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setComponent(e,t){this.componentId=t}handleDataSourceOutput(e){this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:["fallbackKey"],pizzagnaKey:h.Data},typeof e.payload?.error?.type<"u"?e.payload?.error?.type.toString():void 0)}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var wr=(()=>{class r extends Pe{constructor(e,t){super(e,t),this.multipleErrorFallbackKey=Me.Unknown,this.errorMap={},this.eventBus.getStream(Se).pipe(l(this.destroy$)).subscribe(i=>{this.handleDataSourceDestroyed(i)})}updateConfiguration(e){e.multipleErrorFallbackKey&&(this.multipleErrorFallbackKey=e.multipleErrorFallbackKey)}handleDataSourceOutput(e){this.errorMap=this.updateErrorMap(e),this.setFallbackKeyProperty()}handleDataSourceDestroyed(e){e.payload?.componentId&&delete this.errorMap[e.payload.componentId],this.setFallbackKeyProperty()}setFallbackKeyProperty(){this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:["fallbackKey"],pizzagnaKey:h.Data},this.getFallbackKey())}getFallbackKey(){if((0,zr.default)(this.errorMap))return;let e=(0,Nr.default)(Object.values(this.errorMap));return e.length===1?e[0]:this.multipleErrorFallbackKey}updateErrorMap(e){let t=this.errorMap,i=typeof e.payload?.error?.type<"u"?e.payload?.error?.type.toString():void 0;return i?i&&(t[e.payload.componentId]=i):delete t[e.payload.componentId],t}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Dr=I(le());var Vr=(()=>{class r{constructor(e,t){this.eventBus=e,this.pizzagnaService=t,this.loadingMap={},this.destroy$=new A,this.eventBus.getStream(ne).pipe(l(this.destroy$)).subscribe(({payload:i})=>{i?.componentId&&(i?.busy?this.loadingMap[i.componentId]=!0:delete this.loadingMap[i.componentId]),this.pizzagnaService.setProperty({componentId:this.componentId,propertyPath:["active"],pizzagnaKey:h.Data},!(0,Dr.default)(this.loadingMap))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setComponent(e,t){this.componentId=t}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Ye=I(G());function jr(r){let n=r.split("/");return n?.length>1?n[n.length-2]:r}var Xi=/\{.*?\}/g,Ji=/\{|\}/g;function xr(r,n){let e=r.match(Xi);if(!e)return r;let t=r;for(let i of e){let o=Qi(i);n[o]?t=t.replace(i,n[o]):console.warn(`There's no ${i} key found in the data: ${n}`)}return t}var Qi=r=>r.replace(Ji,"");var Fr=(()=>{class r{constructor(e){this.pizzagnaService=e,this.defaultTrackOn="pizzagna",this.subscriptions=[]}setComponent(e,t){this.component=e,this.componentId=t,this.parentComponentId=jr(t),this.initChangeSubscriptions()}updateConfiguration(e){this.configs=e?.configs}initChangeSubscriptions(){for(let e of this.configs){let t=this.getObservableFor(e);if(!t){console.warn("no observable found on 'PizzagnaBroadcasterService', for part: ",e);return}let i=t.subscribe(o=>{for(let s of e.paths){let p=xr(s,this);this.pizzagnaService.setProperty(p,o)}});this.subscriptions.push(i)}}getObservableFor(e){return(e.trackOn||this.defaultTrackOn)==="component"?this.getComponentObservableFor(e):this.getPizzagnaObservableFor(e)}getPizzagnaObservableFor(e){return this.pizzagnaService.pizzaChanged.pipe(F(t=>(0,Ye.default)(t,e.key)),U())}getComponentObservableFor(e){return(0,Ye.default)(this.component,e.key)?.pipe(U())}ngOnDestroy(){for(let e of this.subscriptions)e.unsubscribe()}static{this.\u0275fac=function(t){return new(t||r)(a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Re=(()=>{class r{constructor(){this._refreshRateSeconds=300,this.refreshRateSeconds$=new O(this.refreshRateSeconds)}get refreshRateSeconds(){return this._refreshRateSeconds}set refreshRateSeconds(e){this._refreshRateSeconds=e,this.refreshRateSeconds$.next(this._refreshRateSeconds)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var $r=(()=>{class r{constructor(e,t,i){this.eventBus=e,this.ngZone=t,this.refresherSettings=i,this.enabled=!0,this.overrideDefaultSettings=!0,this.interval=300,this.eventDef=w,this.destroy$=new A,this.refresherSettings.refreshRateSeconds$.pipe(l(this.destroy$)).subscribe(o=>{this.overrideDefaultSettings||this.initializeInterval()})}updateConfiguration(e){this.interval=e.interval??300,this.enabled=e.enabled??!0,this.overrideDefaultSettings=e.overrideDefaultSettings??!0,this.eventDef=e.event??w,this.initializeInterval()}ngOnDestroy(){this.clearInterval(),this.destroy$.next(),this.destroy$.complete()}initializeInterval(){this.clearInterval(),!(typeof this.interval>"u"||this.getInterval()<=0||this.enabled===!1)&&this.ngZone.runOutsideAngular(()=>{this.intervalRef=setInterval(()=>{this.ngZone.run(()=>{this.performAction()})},this.getInterval()*1e3)})}performAction(){this.eventBus.getStream(this.eventDef).next({})}getInterval(){return this.overrideDefaultSettings?this.interval:this.refresherSettings.refreshRateSeconds}clearInterval(){typeof this.intervalRef<"u"&&(clearInterval(this.intervalRef),this.intervalRef=void 0)}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(ue),a(Re))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var ye=class extends ${constructor(n,e,t,i){super(n,e,t),this.virtualViewport=i}setupRefreshListener(){let n=nt(this.eventBus.getStream(_t),this.eventBus.getStream(w)).pipe(mt(()=>this.eventBus.getStream(w).pipe(me(void 0))),L(()=>this.virtualViewport.reset({emitFirstPage:!1})),F(()=>{}));st(n,this.eventBus.getStream(bt),this.eventBus.getStream(yt)).pipe(at(10),L(()=>this.handleRefresh()),l(this.destroy$)).subscribe()}updateAdapterProperties(n){this.dataPath=n.dataPath,this.dataFieldsPath=n.dataFieldsPath,this.totalItemsPath=n.totalItemsPath}updateOutput(n){let e=n?.paginator?.total,t=n?.repeat?.itemsSource,i=n?.dataFields;this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.totalItemsPath]},e),this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.dataPath]},t),this.pizzagnaService.setProperty({pizzagnaKey:h.Data,componentId:this.componentId,propertyPath:[this.dataFieldsPath]},i)}};ye=Z([N(0,x(c)),N(1,x(b)),N(3,z()),K("design:paramtypes",[M,Object,d,se])],ye);var Br=I(xi());var be=class extends ${constructor(n,e,t){super(n,e,t),this.seriesIndex=[]}updateConfiguration(n){this.seriesIndex=(0,Br.default)(n.series),super.updateConfiguration(n)}processOutput(n){return n&&D(E({},n),{series:this.buildSeriesSet(n?.series)})}buildSeriesSet(n){return n?n.filter(e=>this.seriesIndex.find(t=>t.selectedSeriesId===e.id)).map(e=>({id:e.id,data:e.data,link:e.link,secondaryLink:e.secondaryLink,legendDescriptionPrimary:this.seriesIndex.find(t=>t.selectedSeriesId===e.id)?.label,legendDescriptionSecondary:e.description})):[]}};be=Z([N(0,x(c)),N(1,x(b)),K("design:paramtypes",[M,Object,d])],be);var _e=(()=>{class r{constructor(){}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ur=I(Ue());var kr=(()=>{class r{constructor(e,t){this.eventBus=e,this.dashwizService=t,this.onDestroy$=new A,this.dataSourceCreated$=new A,this.error$=new A,this.busy$=new O(!1),this.dataSourceFields$=new O([]),this.eventBus.subscribeUntil(vr,this.onDestroy$,i=>{i.payload&&this.onDataSourceCreated(i.payload)}),this.eventBus.subscribeUntil(W,this.onDestroy$,i=>{if(i.payload?.error)this.error$.next(i.payload.error);else{this.error$.next(null);let o=(0,Ur.default)(i.payload.result)?i.payload:i.payload.result||{};o?.dataFields&&this.dataSourceFields$.next(o.dataFields)}})}onDataSourceCreated(e){this.dataSource=e,this.dataSourceCreated$.next(),this.dataSource.busy?.pipe(l(this.dataSourceCreated$)).subscribe(t=>{this.dashwizService?.component?.navigationControl.next({busyState:{busy:t},allowStepChange:!t}),this.busy$.next(t)})}ngOnDestroy(){this.onDestroy$.next(),this.onDestroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(_e))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var qe=I(G()),Lr=I(Le());var S=(()=>{class r{constructor(){this.previewChanged=new A}get preview(){return this._preview}set preview(e){this._preview=e,this.previewChanged.next(e)}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var C=(()=>{class r{constructor(e,t,i){this.eventBus=e,this.previewService=t,this.pizzagnaService=i,this.destroy$=new A}ngAfterViewInit(){this.buildForm(),this.toPreview(this.component.form)}setComponent(e,t){this.component=e,this.componentId=t}getPreview(){return this.previewService.preview}updatePreview(e){this.previewService.preview=e}updateFormPizzagna(e){this.pizzagnaService.updatePizzagna(e),this.eventBus.getStream(q).next({payload:{path:"",value:e}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Gr=(()=>{class r extends C{get previewComponentId(){return this.componentId.split("/")[0]}constructor(e,t,i){super(e,t,i)}updateConfiguration(e){e&&e.formParts&&(this.formParts=e.formParts)}buildForm(){let e=this.getPreview(),t=this.formParts.reduce((i,o)=>{let s=`${this.previewComponentId}.${o.previewPath}`,p=(0,qe.default)(e,s);if(p)for(let u of o.keys)p[u]!==void 0&&(i=f(i,`${h.Data}.${this.componentId}.properties.${u}`,p[u]));return i},this.pizzagnaService.pizzagna);this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=this.formParts.reduce((o,s)=>{let p=s.previewOutputPath||s.previewPath;p=`${this.previewComponentId}.${p}`;let u=(0,qe.default)(o,p),g=(0,Lr.default)(t,s.keys),P=E(E({},u),g);return f(o,`${p}`,P)},this.getPreview());this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Hr=I(Kr()),Wr=I(Ge()),Yr=I(Pt());var qr=(()=>{class r extends C{constructor(e,t,i){super(e,t,i),this.shouldReadForm=!1}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.getPreview(),t=e?.tiles?.properties?.nodes?.map(s=>({id:s,componentType:e[s].componentType}))||[],i=t?.map(s=>s.id);this.pizzagnaService.createComponentsFromTemplate("tiles",i);let o=this.pizzagnaService.pizzagna;o=f(o,`${h.Data}.tiles.properties.tiles`,t),setTimeout(()=>this.shouldReadForm=!0),this.updateFormPizzagna(o)}toPreview(e){e.get("tiles")?.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{if(!this.shouldReadForm)return;let i=this.getPreview(),o=(t||[]).map(u=>u.id),s=(0,Hr.default)(i?.tiles?.properties?.nodes,o);s.length&&(i=(0,Yr.default)(i,s));let p=(0,Wr.default)(t,u=>u.id);i=f(i,"tiles.properties.nodes",o);for(let u of o){let g=p[u];if(g&&!i[g.id]){let P=this.getTileConfiguration(g.id,g.componentType);i=f(i,g.id,P)}}this.updatePreview(i)})}getTileConfiguration(e,t){return{id:e,providers:{dataSource:{providerId:void 0}}}}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Xr=(()=>{class r extends C{constructor(e,t,i){super(e,t,i),this.PROPERTIES_PATH=`${h.Configuration}.chartOptionsEditor.properties`}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.getPreview().chart?.properties?.configuration?.chartOptions,t=this.pizzagnaService.pizzagna;t=f(t,`${this.PROPERTIES_PATH}.chartType`,e?.type??void 0),t=f(t,`${this.PROPERTIES_PATH}.legendPlacement`,e?.legendPlacement??Ze.None),t=f(t,`${this.PROPERTIES_PATH}.legendFormatterComponentType`,e?.legendFormatter?.componentType??""),t=f(t,`${this.PROPERTIES_PATH}.contentFormatterComponentType`,e?.contentFormatter?.componentType??"DonutContentRawFormatterComponent"),t=f(t,`${this.PROPERTIES_PATH}.contentFormatterProperties`,e?.contentFormatter?.properties??""),this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=f(this.getPreview(),"chart.properties.configuration.chartOptions",t);this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Xe=I(G()),Je=I(Le());var Jr=(()=>{class r extends C{get previewComponentId(){return this.componentId.split("/")[0]}constructor(e,t,i){super(e,t,i)}updateConfiguration(e){e&&e.formParts&&(this.formParts=e.formParts)}buildForm(){let e=this.getPreview(),t=this.formParts.reduce((i,o)=>{let p=(0,Xe.default)(e,o.previewPath)?.find(g=>g.id===this.previewComponentId),u=(0,Je.default)(p,o.keys);return i=f(i,`${h.Data}.${this.componentId}.properties`,u),i},this.pizzagnaService.pizzagna);this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=this.formParts.reduce((o,s)=>{let p=s.previewOutputPath||s.previewPath,u=(0,Xe.default)(o,p),g=u.findIndex(we=>we.id===this.previewComponentId),P=u[g],_=(0,Je.default)(t,s.keys),re=E(E({},P),_);return f(o,`${p}[${g}]`,re)},this.getPreview());this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Qe=I(G()),Qr=I(Le());var ei=(()=>{class r extends C{constructor(e,t,i){super(e,t,i)}updateConfiguration(e){e&&e.formParts&&(this.formParts=e.formParts)}buildForm(){let e=this.getPreview(),t=this.formParts.reduce((i,o)=>{let s=(0,Qe.default)(e,o.previewPath);if(s)for(let p of o.keys)s[p]!==void 0&&(i=f(i,`${h.Data}.${this.componentId}.properties.${p}`,s[p]));return i},this.pizzagnaService.pizzagna);this.updateFormPizzagna(t)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=this.formParts.reduce((o,s)=>{let p=s.previewOutputPath||s.previewPath,u=(0,Qe.default)(o,p),g=(0,Qr.default)(t,s.keys),P=E(E({},u),g);return f(o,p,P)},this.getPreview());this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Oe=class r extends C{static{this.PROPERTIES_PATH=`${h.Configuration}.titleAndDescription.properties`}constructor(n,e,t){super(n,e,t)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let n=this.pizzagnaService.pizzagna,e=this.getPreview()?.header?.properties;n=f(n,`${r.PROPERTIES_PATH}.title`,e?.title),n=f(n,`${r.PROPERTIES_PATH}.subtitle`,e?.subtitle),n=f(n,`${r.PROPERTIES_PATH}.url`,e?.url),n=f(n,`${r.PROPERTIES_PATH}.description`,e?.description),n=f(n,`${r.PROPERTIES_PATH}.collapsible`,e?.collapsible),this.updateFormPizzagna(n)}toPreview(n){n.valueChanges.pipe(l(this.destroy$)).subscribe(e=>{let t=f(this.getPreview(),"header.properties",e);this.updatePreview(t)})}static{this.\u0275fac=function(e){return new(e||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}};var ti=I(G()),ri=I(le()),ii=I(It());var oi=(()=>{class r extends C{constructor(e,t,i){super(e,t,i)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.getPreview()?.table,t=e?.properties?.dataFields,i=e?.properties?.configuration?.columns,o=this.pizzagnaService.pizzagna;o=f(o,`${h.Data}.columns.properties.columns`,i??[]),o=f(o,`${h.Data}.columns.properties.dataFields`,t),this.updateFormPizzagna(o)}toPreview(e){let t=e.contains("columnsOutput")?e.get("columnsOutput"):e.get("columns");if(!t)throw new Error("FormControl is not defined!");t.valueChanges.pipe(l(this.destroy$),U(ii.default)).subscribe(i=>{let o="table.properties.configuration.columns";setTimeout(()=>{let p=this.getPreview();this.updatePreview(f(p,o,i))});let s=this.pizzagnaService.pizzagna;setTimeout(()=>{s=f(s,`${h.Structure}.columns.properties.template`,this.pizzagnaService.pizzagna[h.Structure].columns.properties?.template),s=f(s,`${h.Data}.filters.properties.columns`,i),s=f(s,`${h.Structure}.presentation.properties.nodes`,[...s?.structure?.presentation?.properties?.nodes??[]]),this.updateFormPizzagna(s)})}),this.subscribeToColumnsValueChange()}subscribeToColumnsValueChange(){this.component.form.get("columnsOutput")?.valueChanges.pipe(me(this.component.form.get("columnsOutput").value),ce(e=>e.length>0),L(()=>this.handleWidthValidation()),F(e=>this.filterColumnsWithoutSpecifiedWidth(e)),F(e=>this.handleColumnsWithoutSpecifiedWidth(e)),pt("id"),ct("id"),l(this.destroy$)).subscribe(e=>this.setWidthMessages(e))}filterColumnsWithoutSpecifiedWidth(e){return e.filter(t=>t.isActive&&!t.width)}handleColumnsWithoutSpecifiedWidth(e){switch(e.length){case 0:{let t=this.component.form.get("columns").controls.filter(o=>(0,ti.default)(o,`value.properties[${o.value.id}/description].isActive`));if((0,ri.default)(t))return{id:void 0,label:void 0};let i=t[t.length-1];return console.warn(`Cannot set width for all columns. Resetting "${i.value.label}" width.`),i.patchValue({width:null},{emitEvent:!1}),i.value}case 1:return e[0];default:return{id:void 0,label:void 0}}}handleWidthValidation(){this.component.form.get("columns").controls.forEach(e=>{let t=`properties.${e.value.id}/description`,i=e.get(t);if(!i)return;let o=i.get("isActive")?.value,s=i.get("width");o?(s?.setValidators([At.min(62)]),s?.markAllAsTouched(),s?.updateValueAndValidity({emitEvent:!1})):(s?.clearValidators(),s?.updateValueAndValidity({emitEvent:!1}))})}setWidthMessages(e){if(!this.pizzagnaService.pizzagna)return;let t="isWidthMessageDisplayed",{pizzagna:i}=this.pizzagnaService;(i.data.columns.properties?.columns).forEach(s=>this.pizzagnaService.setProperty(`${h.Data}.${s.id}/description.properties.${t}`,!1)),e&&this.pizzagnaService.setProperty(`${h.Data}.${e}/description.properties.${t}`,!0)}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var si=(()=>{class r extends C{constructor(e,t,i){super(e,t,i)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.pizzagnaService.pizzagna,t=this.getPreview()?.table,i=t?.properties?.configuration?.columns,o=t?.properties?.configuration?.sorterConfiguration;e=f(e,`${h.Data}.filters.properties.columns`,i),e=f(e,`${h.Data}.filters.properties.sorterConfiguration`,o),this.updateFormPizzagna(e)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=this.getPreview();i=f(i,"table.properties.configuration.sorterConfiguration",t.sorterConfiguration),this.updatePreview(i),this.buildForm()})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var ni=(()=>{class r extends C{constructor(e,t,i){super(e,t,i)}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.pizzagnaService.pizzagna,t=this.getPreview()?.table,i=t?.properties?.configuration?.paginatorConfiguration,o=t?.properties?.configuration?.hasVirtualScroll,s=t?.properties?.configuration?.scrollType;e=f(e,`${h.Data}.scrollType.properties.paginatorConfiguration`,i),e=f(e,`${h.Data}.scrollType.properties.hasVirtualScroll`,o),e=f(e,`${h.Data}.scrollType.properties.scrollType`,s),this.updateFormPizzagna(e)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=this.getPreview();i=f(i,"table.properties.configuration.hasVirtualScroll",!1),i=f(i,"table.properties.configuration.scrollType",t.paginatorConfiguration.scrollType),i=f(i,"table.properties.configuration.paginatorConfiguration.pageSizeSet",t.paginatorConfiguration.pageSizeSet),i=f(i,"table.properties.configuration.paginatorConfiguration.pageSize",t.paginatorConfiguration.pageSize),this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var J=I(G());var ai=(()=>{class r extends C{constructor(e,t,i,o){super(e,t,i),this.timeframeService=o}ngAfterViewInit(){super.ngAfterViewInit()}buildForm(){let e=this.pizzagnaService.pizzagna,t=this.getPreview(),i=Object.keys(this.timeframeService.currentPresets).map(g=>({id:g,name:this.timeframeService.currentPresets[g].name})),o=`${h.Data}.timeseriesMetadata.properties`;e=f(e,`${o}.timeSpans`,i);let s=(0,J.default)(t,"timeframeSelection.properties.timeframe.selectedPresetId","last7Days"),p=i.find(g=>g.id===s);p&&(e=f(e,`${o}.startingTimespan`,p));let u=(0,J.default)(t,"chart.properties.configuration");u&&(e=f(e,`${o}.legendPlacement`,u.legendPlacement),e=f(e,`${o}.leftAxisLabel`,u.leftAxisLabel),e=f(e,`${o}.preset`,u.preset)),this.updateFormPizzagna(e)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=this.getPreview(),o=(0,J.default)(t,"startingTimespan.id");o&&(i=f(i,"timeframeSelection.properties.timeframe.selectedPresetId",o));let s="chart.properties.configuration";i=f(i,`${s}.legendPlacement`,(0,J.default)(t,"legendPlacement","")),i=f(i,`${s}.leftAxisLabel`,(0,J.default)(t,"leftAxisLabel","")),i=f(i,`${s}.preset`,(0,J.default)(t,"preset","")),this.updatePreview(i)})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d),a(oe))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var Y=I(G()),et=I(le()),pi=I(It()),ci=I(Ue());var mi=(()=>{class r extends C{constructor(e,t,i){super(e,t,i),this.indicatorDataKey="indicatorData",this.previewSeriesPath=`providers.${pe.Adapter}.properties.series`,this.formSeriesComponentPath=`${h.Data}.series.properties`,this.dataSourceSeries$=new A,this.selectedSeriesIds$=new A,this.shouldReadForm=!1,this.subscribeToAvailableDataFieldsChange(),this.eventBus.subscribeUntil(gr,this.destroy$,o=>{let s=`${h.Structure}.series.properties.nodes`,p=(0,Y.default)(this.pizzagnaService.pizzagna,s);this.pizzagnaService.removeComponents(p);let u=this.pizzagnaService.pizzagna;u=f(u,s,[]),u=f(u,`${this.formSeriesComponentPath}.series`,[]),this.updateFormPizzagna(u)}),this.eventBus.subscribeUntil(W,this.destroy$,o=>{let{series:s}=(0,ci.default)(o.payload.result)?o.payload:o.payload.result||{};if(s){this.dataSourceSeries$.next(s);let p=this.pizzagnaService.pizzagna;p=f(p,`${this.formSeriesComponentPath}.allSeries`,s);let g=(this.pizzagnaService.pizzagna[h.Structure][this.component.componentId].properties?.template).findIndex(ie=>ie.id===this.indicatorDataKey),P=`${h.Structure}.series.properties.template[${g}].properties.allSeries`;p=f(p,P,s),p=(0,Y.default)(this.getPreview(),`chart.${this.previewSeriesPath}`,[]).reduce((ie,De)=>f(ie,`${h.Data}.${De.id}/${this.indicatorDataKey}.properties.allSeries`,s),p),this.updateFormPizzagna(p);let re=`${this.formSeriesComponentPath}.series`,we=(0,Y.default)(this.pizzagnaService.pizzagna,re);if((0,et.default)(we)){this.shouldReadForm=!1;let ie=s.map(Ve=>({id:Ve.id,selectedSeriesId:Ve.id,label:Ve.name})),De=f(this.getPreview(),`chart.${this.previewSeriesPath}`,ie);this.updatePreview(De),this.buildForm(),setTimeout(()=>{this.updateAvailableSeries([]),this.shouldReadForm=!0})}}})}buildForm(){let e=this.getPreview(),t=(0,Y.default)(e,`chart.${this.previewSeriesPath}`,[]),i=t.map(u=>({id:u.id,selectedSeriesId:u.selectedSeriesId})),o=t.map(u=>u.id);this.pizzagnaService.createComponentsFromTemplate("series",o);let s=this.pizzagnaService.pizzagna,p=f(s,`${this.formSeriesComponentPath}.series`,i);this.updateFormPizzagna(p),this.selectedSeriesIds$.next(i.map(u=>u.selectedSeriesId)),setTimeout(()=>this.shouldReadForm=!0)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{if(!this.shouldReadForm)return;let i=this.getPreview(),{chart:o}=i,s=(0,Y.default)(o,this.previewSeriesPath,[]),p=t.map(P=>E({id:P.id,selectedSeriesId:P.selectedSeriesId},s.find(_=>_.id===P.id))),u=f(i,`chart.${this.previewSeriesPath}`,p);this.updatePreview(u);let g=t.map(P=>(0,Y.default)(P,`properties[${P.id}/indicatorData].id`)).filter(P=>!(0,et.default)(P));this.selectedSeriesIds$.next(g)})}ngOnDestroy(){this.dataSourceSeries$.complete(),this.selectedSeriesIds$.complete(),super.ngOnDestroy()}updateAvailableSeries(e){if(!this.pizzagnaService.pizzagna)return;let t=this.pizzagnaService.pizzagna;t=f(t,`${this.formSeriesComponentPath}.availableSeries`,e);let o=(this.pizzagnaService.pizzagna[h.Structure][this.component.componentId].properties?.template).findIndex(u=>u.id===this.indicatorDataKey),s=`${h.Structure}.series.properties.template[${o}].properties.availableSeries`;t=f(t,s,e),t=(0,Y.default)(this.pizzagnaService.pizzagna,`${h.Structure}.series.properties.nodes`).reduce((u,g)=>f(u,`${h.Data}.${g}/${this.indicatorDataKey}.properties.availableSeries`,e),t),this.updateFormPizzagna(t)}subscribeToAvailableDataFieldsChange(){ot([this.dataSourceSeries$,this.selectedSeriesIds$]).pipe(l(this.destroy$),F(([e,t])=>e.filter(i=>!t.find(o=>o===i.id))),U(pi.default)).subscribe(this.updateAvailableSeries.bind(this))}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var tt=I(G());var ui=(()=>{class r extends C{get previewComponentId(){return this.componentId.split("/")[0]}constructor(e,t,i){super(e,t,i),this.previewSeriesPath=`chart.providers.${pe.Adapter}.properties.series`}buildForm(){let t=(0,tt.default)(this.getPreview(),this.previewSeriesPath,[]).find(s=>s.id===this.previewComponentId),i=t&&t.selectedSeriesId,o=f(this.pizzagnaService.pizzagna,`${h.Data}.${this.componentId}.properties`,{selectedSeriesId:i});this.updateFormPizzagna(o)}toPreview(e){e.valueChanges.pipe(l(this.destroy$)).subscribe(t=>{let i=t.id,o=this.getPreview(),s=(0,tt.default)(o,this.previewSeriesPath,[]),p=s.findIndex(u=>u.id===this.previewComponentId);if(p>-1){let u=[...s];u[p]=D(E({},u[p]),{selectedSeriesId:i});let g=f(o,`${this.previewSeriesPath}`,u);this.updatePreview(g)}})}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(S),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var j=new k("CONFIGURATOR_CONVERTER");var ze=(()=>{class r{constructor(){this.events={}}registerEvent(e){this.events[e.id]=e}getEvent(e){let t=this.events[e];if(!t)throw new Error("Event with id '"+e+"' is not registered. Registered events are: "+JSON.stringify(Object.keys(this.events)));return t}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ne=(()=>{class r{updateWidget(e){this.widget=e}getWidget(){return this.widget}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var di=I(Ge()),hi=I(We());var fi=(()=>{class r{constructor(e,t,i,o,s){this.pizzagnaBus=e,this.dashboardBus=t,this.widgetConfigurationService=i,this.eventRegistry=o,this.pizzagnaService=s,this.upstreamSubscriptions={},this.downstreamSubscriptions={},this.destroy$=new A}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setComponent(e){this.component=e}updateConfiguration(e){this.providerKey=e.providerKey,this.upstreams=e.upstreams,this.downstreams=e.downstreams,this.upstreams&&this.registerUpstreamSubscriptions(...this.upstreams),this.downstreams&&this.registerDownstreamSubscriptions(...this.downstreams)}addUpstream(e){this.addStream(e,"upstreams")}addDownstream(e){this.addStream(e,"downstreams")}addStream(e,t){let i=(0,hi.default)((this[t]||[]).concat(e.id));this[t]=i,this.component&&this.pizzagnaService.setProperty({componentId:this.component.componentId,pizzagnaKey:h.Data,providerKey:this.providerKey,propertyPath:[t]},i)}registerUpstreamSubscriptions(...e){this.dashboardBus&&this.registerSubscriptions(e,this.upstreamSubscriptions,this.pizzagnaBus,(t,i)=>{let o=this.widgetConfigurationService.getWidget().id;this.dashboardBus.getStream(t).next(Object.assign({},i,{widgetId:o}))})}registerDownstreamSubscriptions(...e){this.dashboardBus&&this.registerSubscriptions(e,this.downstreamSubscriptions,this.dashboardBus,(t,i)=>{let o=this.widgetConfigurationService.getWidget().id;(typeof i.widgetId>"u"||o===i.widgetId)&&this.pizzagnaBus.getStream(t).next(i)})}registerSubscriptions(e=[],t,i,o){let s=e?(0,di.default)(e,p=>p):null;for(let p of Object.keys(t))(!s||!s[p])&&(t[p].unsubscribe(),delete t[p]);for(let p of Object.keys(s??{}).filter(u=>!t[u])){let u=this.eventRegistry.getEvent(p);t[p]=i.getStream(u).pipe(l(this.destroy$)).subscribe(g=>{o(u,g)})}}static{this.\u0275fac=function(t){return new(t||r)(a(c),a(ge,8),a(Ne,8),a(ze),a(d))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();var li=(()=>{class r{constructor(e){this.logger=e,this.staticProviders={},this.setProviders({[wt]:{provide:$r,deps:[c,ue,Re]},[Gt]:{provide:fi,deps:[c,[new z,ge],[new z,Ne],ze,d]},[Dt]:{provide:$,deps:[c,[new z,b],d]},[Ht]:{provide:ye,deps:[c,[new z,b],d,se]},[Vt]:{provide:be,deps:[c,[new z,b],d]},[jt]:{provide:Te,deps:[c,[new z,b],d,he]},[xt]:{provide:Ee,deps:[c,[new z,b],d]},[Ft]:{provide:yr,deps:[[new z,b],d,ve]},[$t]:{provide:j,useClass:Oe,deps:[c,S,d]},[Bt]:{provide:j,useClass:Xr,deps:[c,S,d]},[Ut]:{provide:j,useClass:qr,deps:[c,S,d]},[qt]:{provide:j,useClass:Gr,deps:[c,S,d]},[Wt]:{provide:j,useClass:ei,deps:[c,S,d]},[Yt]:{provide:j,useClass:Jr,deps:[c,S,d]},[Xt]:{provide:j,useClass:ui,deps:[c,S,d,oe]},[kt]:{provide:j,useClass:ai,deps:[c,S,d,oe]},[Lt]:{provide:j,useClass:mi,deps:[c,S,d]},[Mt]:{provide:j,useClass:oi,deps:[c,S,d]},[Zt]:{provide:j,useClass:si,deps:[c,S,d]},[Kt]:{provide:j,useClass:ni,deps:[c,S,d]},[Jt]:{provide:Vr,deps:[c,d]},[Qt]:{provide:Pe,deps:[c,d]},[er]:{provide:wr,deps:[c,d]},[tr]:{provide:_r,deps:[c,d]},[rr]:{provide:Rr,deps:[c,"windowObject",R,Ie]},[ir]:{provide:Pr,deps:[c]},[sr]:{provide:se,deps:[]},[or]:{provide:Fr,deps:[d]},[nr]:{provide:ae,useExisting:dr,deps:[d]},[ar]:{provide:ae,useExisting:hr,deps:[d]},[pr]:{provide:ae,useExisting:fr,deps:[d]},[cr]:{provide:ae,useExisting:lr,deps:[d]},[mr]:{provide:kr,deps:[c,[new z,_e]]}})}setProviders(e){this.staticProviders=Object.assign({},this.staticProviders,e)}getProvider(e){let t=this.staticProviders[e];return t||(this.logger.warn("No provider registered for id",e),this.logger.warn("Known providers:",Object.keys(this.staticProviders).join(", "))),t}getProviderInstance(e,t){return ee.create({providers:[e],parent:t}).get(b)}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var gi=(()=>{class r{constructor(e){this.logger=e,this.components={}}registerByLateLoadKey(e){this.registerComponentType(e.lateLoadKey,e)}registerComponentType(e,t){this.components[e]=t}getComponentType(e){let t=this.components[e];return t||this.logger.warn("Component '"+e+"' not defined. Available components: "+JSON.stringify(Object.keys(this.components))),t}static{this.\u0275fac=function(t){return new(t||r)(a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ei=I(fe()),Ii=I(ji()),Ai=I(Si());function rt(r,...n){let e=n.filter(p=>typeof p.previousValue<"u"||typeof p.currentValue<"u");if(!(0,Ii.default)(e,p=>p.currentValue!==p.previousValue))return r;if(e.length===1)return e[0].currentValue;let t=vo(e);if(!["object","object[]"].includes(t))return go(e);let i=(0,Ai.default)(...e.map(p=>typeof p.currentValue=="object"?Object.keys(p.currentValue||{}):[])),o=t==="object[]"?[]:{};return i.reduce((p,u)=>{let g=typeof r>"u"||r===null||typeof r[u]>"u"?void 0:r[u],P=e.map(_=>({previousValue:typeof _.previousValue>"u"||_.previousValue==null?void 0:_.previousValue[u],currentValue:typeof _.currentValue>"u"||_.currentValue==null?void 0:_.currentValue[u]}));return p[u]=rt(g,...P),p},o)}function go(r){for(let n=r.length-1;n>=0;n--){let e=r[n].currentValue;if(typeof e<"u")return e}}function vo(r){for(let n of r){let e=typeof n.currentValue;if(e!=="undefined"&&n.currentValue!=null)return(0,Ei.default)(n.currentValue)?typeof n.currentValue[0]==="object"?"object[]":"array":n.currentValue.constructor!==Object?"advanced":e}return"undefined"}var Ti=(()=>{class r{static{this.lateLoadKey="TemplateLoadErrorComponent"}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=ft({type:r,selectors:[["ng-component"]],standalone:!1,decls:3,vars:0,template:function(t,i){t&1&&(lt(0,"code")(1,"pre"),vt(2,"Template load error!"),gt()())},encapsulation:2})}}return r})();var Pi=(()=>{class r{constructor(e,t){this.componentRegistry=e,this.logger=t}createComponentPortal(e,t){let i;return typeof e=="string"?i=this.componentRegistry.getComponentType(e):i=e,i||(this.logger.error(`Cannot Find Component Type ${e}`),i=Ti),new Tt(i,null,t)}createInjector(e){let t=e.providers||[];return ee.create({providers:t,parent:e.injector,name:"Component Injector"})}static{this.\u0275fac=function(t){return new(t||r)(a(gi),a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Oi=I(fe()),zi=I(Di()),it=I(_i());var Mu=(()=>{class r{constructor(e,t,i,o,s){this.injector=e,this.logger=t,this.portalService=i,this.renderer=o,this.providerRegistry=s,this.output=new xe,this.propertiesChanges=new B,this.providerInstances={},this.destroy$=new A}ngOnInit(){this.logger.debug("Portal created:",this.componentId),this.recreatePortal()}ngAfterViewInit(){Object.keys(this.providerInstances).forEach(e=>{let t=this.providerInstances[e];t.ngAfterViewInit&&t.ngAfterViewInit()})}ngOnChanges(e){let t=!1,i=e.providers;i&&!i.isFirstChange()&&(this.checkForProviderChanges(i)?(this.logger.debug("Portal recreated (provider change):",this.componentId),this.recreatePortal(),t=!0):this.updateProviderConfigurations(i)),e.componentType&&!e.componentType.isFirstChange()&&!t&&(this.logger.debug("Portal recreated (component change):",this.componentId),this.recreatePortal()),e.properties&&this.propertiesChanges.next(e.properties)}ngOnDestroy(){this.logger.debug("Portal destroyed:",this.componentId),this.destroyProviders(),this.listenerUnsubscriber?.(),this.destroy$.next(),this.destroy$.complete()}attached(e){this.component=e.instance,this.listenerUnsubscriber=this.renderer.listen(e.location.nativeElement,"click",t=>{(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.button===0&&(console.log("==================== PIZZAGNA DUMP ========================="),console.log("componentId:",this.componentId),console.log("component:",this.component),console.log("componentType:",this.componentType),console.log("properties:",this.properties),console.log("providers:",this.providers),console.log("providerInstances:",this.providerInstances),console.log("============================================================"))});for(let t of Object.keys(this.providerInstances)){let i=this.providerInstances[t];i.setComponent&&i.setComponent(this.component,this.componentId),i.setProviders&&i.setProviders(this.providerInstances,this.componentId)}this.subscribeToOutputs(),this.changesSubscription=this.propertiesChanges.pipe(l(this.destroy$)).subscribe(t=>this.applyPropertiesChange(t))}recreatePortal(){this.changesSubscription&&(this.changesSubscription.unsubscribe(),this.changesSubscription=void 0,this.propertiesChanges=new B);let e=this.injector;if(this.destroyProviders(),this.providers&&(e=this.updateProviders(e)),this.portal=this.portalService.createComponentPortal(this.componentType,e),this.properties)for(let t of Object.keys(this.properties))this.propertiesChanges.next(new je(void 0,this.properties,!0))}updateProviders(e){let t=Object.keys(this.providers),i=t.reduce((s,p)=>(this.providers[p].providerId&&(s[p]=this.providerRegistry.getProvider(this.providers[p].providerId)),s),{}),o=this.portalService.createInjector({injector:e,providers:(0,zi.default)(i)});this.providerInstances=t.reduce((s,p)=>{let u=i[p],g=this.providers[p];if(u){let P=o.get(u.provide,null),_=(0,Oi.default)(P)?P.find(re=>re instanceof u.useClass):P;if(!_)throw new Error("Provider '"+p+"' does not exist.");_.updateConfiguration&&g.properties&&_.updateConfiguration(E({providerKey:p},g.properties||{})),_.providerKey=p,s[p]=_}else g.providerId&&this.logger.error("There's no registered provider for id",p);return s},this.providerInstances);for(let s of Object.keys(this.providerInstances)){let p=this.providerInstances[s];p.ngOnInit&&p.ngOnInit()}return o}updateProviderConfigurations(e){for(let t of Object.keys(this.providers)){if(!this.providers[t].providerId)return;let i=this.providerInstances[t];if(!i)throw new Error("Provider '"+t+"' does not exist.");let o=e.previousValue[t],s=e.currentValue[t],p=o&&o.properties,u=s&&s.properties;p!==u&&i.updateConfiguration&&i.updateConfiguration(E({providerKey:t},u))}}subscribeToOutputs(){if(this.outputs)for(let e of this.outputs.filter(t=>this.component[t]instanceof xe))this.component[e].pipe(l(this.destroy$)).subscribe(t=>{this.output.emit({id:e,payload:t})})}checkForProviderChanges(e){let t=e.previousValue?Object.keys(e.previousValue):[],i=e.currentValue?Object.keys(e.currentValue):[];if(t.length!==i.length||(0,it.default)(t,i).length>0)return!0;let o=Object.keys(e.previousValue).map(p=>e.previousValue[p].providerId),s=Object.keys(e.currentValue).map(p=>e.currentValue[p].providerId);return(0,it.default)(o,s).length>0}destroyProviders(){if(this.providerInstances)for(let e of Object.keys(this.providerInstances)){let t=this.providerInstances[e];t.ngOnDestroy&&t.ngOnDestroy(),delete this.providerInstances[e]}}applyPropertiesChange(e){let t=e.currentValue;if(!t)return;t=D(E({},t),{componentId:this.componentId});let i={},o=!1;for(let s of Object.keys(t)){let p=this.component[s];t[s]!==p&&(o=!0,this.component[s]=t[s],this.component.ngOnChanges&&(i[s]=new je(p,t[s],e.isFirstChange())))}if(o){this.component.ngOnChanges&&this.component.ngOnChanges(i);let s=this.component.changeDetector;s?s.markForCheck():this.logger.warn(`Property 'changeDetector' is missing on component '${this.componentType}', so dynamic refresh of given component might not work.`)}}static{this.\u0275fac=function(t){return new(t||r)(te(ee),te(R),te(Pi),te(dt),te(li))}}static{this.\u0275dir=de({type:r,selectors:[["","nuiComponentPortal",""]],inputs:{componentId:"componentId",componentType:"componentType",properties:"properties",providers:"providers",outputs:"outputs"},outputs:{output:"output"},exportAs:["nuiComponentPortal"],standalone:!1,features:[ut]})}}return r})();var Xu=(()=>{class r{constructor(e,t,i){this.changeDetector=e,this.pizzagnaService=t,this.logger=i,this.destroyed$=new A}ngOnChanges(e){(e.nodes||e.template)&&this.updateNodeConfigs({changesNodes:e.nodes,changesTemplate:e.template})}ngDoCheck(){this.checkNodeConfigs()&&(this.updateNodeConfigs(),this.changeDetector.detectChanges())}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}trackByFn(e,t){return t.id}checkNodeConfigs(){let e=this.getNodes();if(!this.nodeComponentsConfigs||e.length!==this.nodeComponentsConfigs.length)return!0;for(let t=0;t<e.length;t++)if(this.pizzagnaService.getComponent(e[t])!==this.nodeComponentsConfigs[t])return!0;return!1}updateNodeComponentConfigs(){let e=this.getNodes();this.nodeComponentsConfigs=e&&e.map(t=>{let i=this.pizzagnaService.getComponent(t);if(typeof i>"u")throw new Error("No component with id '"+t+"' was defined in the configuration.");return i})}updateNodeConfigs(e){this.nodeConfigs=rt(this.nodeConfigs,this.getTemplateChangeForNodes(e),this.getNodeComponentsConfigs())}getNodeComponentsConfigs(){let e={currentValue:void 0,previousValue:this.nodeComponentsConfigs?[...this.nodeComponentsConfigs]:void 0};return this.updateNodeComponentConfigs(),e.currentValue=this.nodeComponentsConfigs,e}getTemplateChangeForNodes(e){let{changesNodes:t,changesTemplate:i}=e||{},o=s=>s&&this.getNodes()?.map(()=>s);return{currentValue:o(i?i.currentValue:this.template),previousValue:t?this.template:o(i?i.previousValue:this.template)}}static{this.\u0275fac=function(t){return new(t||r)(a(St),a(d),a(R))}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac})}}return r})();export{We as a,Ge as b,zo as c,w as d,yt as e,bt as f,No as g,wo as h,Do as i,_t as j,Vo as k,jo as l,xo as m,q as n,Fo as o,$o as p,ne as q,Bo as r,Ot as s,Uo as t,ko as u,Lo as v,Nt as w,wt as x,Dt as y,Vt as z,jt as A,xt as B,Ft as C,$t as D,Bt as E,Ut as F,kt as G,Lt as H,Gt as I,Mt as J,Zt as K,Kt as L,Ht as M,Wt as N,Yt as O,qt as P,Xt as Q,Jt as R,Qt as S,er as T,tr as U,rr as V,or as W,sr as X,nr as Y,ar as Z,pr as _,cr as $,mr as aa,Go as ba,c as ca,ge as da,b as ea,ae as fa,Ho as ga,pe as ha,ki as ia,Li as ja,h as ka,Gi as la,Me as ma,Ne as na,rt as oa,Sr as pa,d as qa,W as ra,gr as sa,vr as ta,ve as ua,Re as va,_e as wa,kr as xa,S as ya,Kr as za,Ze as Aa,ze as Ba,ur as Ca,dr as Da,hr as Ea,fr as Fa,lr as Ga,os as Ha,fi as Ia,li as Ja,gi as Ka,Ti as La,Pi as Ma,Mu as Na,Xu as Oa};
