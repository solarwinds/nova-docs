import{a as k}from"./chunk-J2FL45L7.js";import{a as b}from"./chunk-6RUQJ5HF.js";import{we as f}from"./chunk-PMWUHOKA.js";import{K as p,P as d,U as g,ca as y,fa as m,h,i as c,ka as D,r as o,w as l}from"./chunk-MCPF2SEG.js";import{g as w,i as r}from"./chunk-VBFW7A5V.js";var F=w(k());var C=(()=>{class i extends f{static{this.providerId="DrilldownDataSource"}constructor(){super(),this.busy=new c(!1),this.dataFields=[{id:"continent.name",label:"Continent name"},{id:"currency",label:"Currency"}],this.drillState=[],this.applyFilters$=new h,this.groupedDataHistory=[],this.dataFieldsConfig.dataFields$.next(this.dataFields),this.applyFilters$.pipe(y(e=>this.getData(e))).subscribe(e=>r(this,null,function*(){this.outputsSubject.next(yield this.getFilteredData(e))}))}getFilteredData(e){return r(this,null,function*(){return o(e).pipe(l(t=>{let s=this.getOutput(t);if(this.isDrillDown()){let n=this.drillState.length,a=this.groupBy[n],[v,H]=this.getTransformedDataForGroup(s,a);return this.groupedDataHistory.push(v),H}return s})).toPromise()})}ngOnDestroy(){this.outputsSubject.complete()}applyFilters(){return r(this,null,function*(){this.applyFilters$.next(this.getFilters())})}getData(e){return this.drillState=e.drillstate?.value,this.groupBy=e.group?.value,this.busy.next(!0),o(this.cache||b).pipe(d(1e3),m(t=>this.cache=t),l(t=>t.data.countries),p(t=>o([])),g(()=>this.busy.next(!1)))}getTransformedDataForGroup(e,t){let s=(0,F.default)(e,t),n=Object.keys(s).map(a=>({id:a,label:a,statuses:[{key:"state_ok",value:s[a].length},{key:"status_unreachable",value:u(1e5)},{key:"status_warning",value:u(1e4)},{key:"status_unknown",value:u(1e3)}]}));return[s,n]}isHome(){return!this.drillState||this.drillState.length===0}isBack(){return this.groupedDataHistory.length>this.drillState?.length&&!this.isHome()}isDrillDown(){return this.drillState?.length!==this.groupBy?.length}getOutput(e){this.isHome()&&(this.groupedDataHistory.length=0),this.isBack()&&(this.groupedDataHistory.length=this.groupedDataHistory.length-1);let t=S(this.groupedDataHistory);return t?t[S(this.drillState)]||t:e}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=D({token:i,factory:i.\u0275fac})}}return i})(),S=i=>i[i.length-1],u=i=>Math.floor(Math.random()*i+1);export{C as a};
