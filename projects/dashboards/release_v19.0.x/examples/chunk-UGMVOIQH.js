import{a as qe}from"./chunk-PRSAKNAG.js";import{a as Ke,b as He,c as Ue,d as Ve,e as Qe,f as Ze,g as Je}from"./chunk-UVOPQ27U.js";import{a as Z}from"./chunk-EDQ5AQLD.js";import"./chunk-TWGF5P3J.js";import{g as xe}from"./chunk-PAQQYLV4.js";import{a as F,f as ke,h as je,j as Be,k as Fe}from"./chunk-PPQN6QZA.js";import{a as g}from"./chunk-MD6F45Z7.js";import"./chunk-LVFB3RKU.js";import"./chunk-SPPZFYNP.js";import"./chunk-GDLY3HLX.js";import"./chunk-KJJ6TWPM.js";import"./chunk-LA47LHC2.js";import"./chunk-4HXDNOXI.js";import"./chunk-5ELJRXLQ.js";import"./chunk-TGKM7UGT.js";import"./chunk-IYRXTWZX.js";import"./chunk-ZXV5URGJ.js";import"./chunk-BC67S2GR.js";import"./chunk-OGZVPW3S.js";import"./chunk-4GVDWU57.js";import"./chunk-OZALKHRQ.js";import"./chunk-AZWDHRVR.js";import"./chunk-EWX2S4QW.js";import"./chunk-SE5ZEHMX.js";import"./chunk-RDGFC72M.js";import"./chunk-LZOJVJPM.js";import"./chunk-NZJJPQMD.js";import"./chunk-3J5U6KSS.js";import"./chunk-K6DXWVOP.js";import"./chunk-SBSX6PXY.js";import"./chunk-ZKE5BQF3.js";import"./chunk-KJCSOJ3W.js";import"./chunk-LTNK7SWM.js";import"./chunk-5RQCZS6F.js";import"./chunk-7ZQISLLB.js";import"./chunk-LZEECJLY.js";import"./chunk-OPPBYCVB.js";import"./chunk-NVJ4XKOU.js";import"./chunk-JOEIBHEU.js";import"./chunk-POOVCM3L.js";import"./chunk-EU2T5UE6.js";import{A as Ye,Ja as B,Ka as ze,b as st,c as Ge,ea as $e,ha as q,i as Q,ia as j,ka as T,va as Xe}from"./chunk-573U3PX6.js";import"./chunk-URWUMSY2.js";import"./chunk-GDYE5MCV.js";import{Dd as Oe,Gc as Ee,Hc as Me,Id as Ie,Jd as We,Kd as Ae,Pc as ye,Xc as we,Zb as rt,oc as Te,od as ve,sd as be,te as De,ub as nt,ue as Re,vd as k,we as Le,xd as Ne,zd as Pe}from"./chunk-PMWUHOKA.js";import{C as z,F as he,N as Ce,n as v,r as fe}from"./chunk-YHLZAVJ5.js";import{Ac as G,Ba as A,Bc as Y,Ca as D,Db as M,Dc as $,Eb as ce,Ec as y,Fc as C,Gc as w,Hb as pe,Hc as Se,Ib as R,La as me,O as U,Sc as X,U as de,Ub as _,bc as s,cc as a,da as V,h as b,hc as L,i as ae,ka as W,la as le,mc as p,pa as h,qc as l,rb as d,xb as c,xc as ue,yc as _e,zc as ge}from"./chunk-MCPF2SEG.js";import"./chunk-CUY44B7R.js";import{a as O,b as I,g as H,i as se}from"./chunk-VBFW7A5V.js";var J=H(rt()),ee=H(nt());var S=(()=>{class o extends Le{static{this.providerId="AcmeKpiDataSource"}static{this.mockError=!1}constructor(t){super(),this.http=t,this.busy=new ae(!1)}getFilteredData(){return se(this,null,function*(){this.busy.next(!0);let t=Math.floor(Math.random()*Math.floor(99))+1;return new Promise(i=>{this.http.get(`https://jsonplaceholder.typicode.com/todos/${t}`).pipe(de(()=>this.busy.next(!1))).subscribe({next:e=>{i({result:{value:e.id,label:e.title}})},error:e=>{i({result:null,error:{type:e.status}})}})})})}ngOnDestroy(){this.outputsSubject.complete()}static{this.\u0275fac=function(i){return new(i||o)(h(z))}}static{this.\u0275prov=W({token:o,factory:o.\u0275fac})}}return o})();var at=o=>({id:`${o}`,type:"kpi",pizzagna:{[T.Configuration]:{header:{properties:{title:"KPI Widget!",subtitle:"A bunch of number boxes",collapsible:!0}},tiles:{providers:{},properties:{nodes:["kpi1"]}},kpi1:{id:"kpi1",providers:{[q.DataSource]:{providerId:S.providerId},[q.Adapter]:{providerId:Ye,properties:{componentId:"kpi1",propertyPath:"widgetData"}}}}}}});function dt(o){let E=[],t={},i={cols:8,rows:6,y:0,x:0};for(let e=0;e<=o;e++){let r=`widget${e.toString()}`,n=at(r),m=t[`widget${(e-1).toString()}`],P=m?I(O({},m),{y:m.y+6}):i;E.push(n),t[r]=P}return[E,t]}var[f,et]=dt(15);function lt(o,E){if(o&1&&(s(0,"div",3)(1,"div",4),Y(2),a()()),o&2){let t=E.item;d(2),$(" ",t.title," ")}}var x=(()=>{class o{static{this.lateLoadKey="AcmeCloneSelectionComponent"}constructor(t){this.widgetTypesService=t,this.widgetSelected=new me,this.widgetItems=[]}ngOnInit(){let t=new v;this.widgetItems=f.map(i=>({title:t.transform(i.type),widget:this.widgetTypesService.mergeWithWidgetType(i)})),f.forEach(i=>{this.addUnconfiguredWidgetWithConfigLayer(i)})}addUnconfiguredWidget(t){let i=new v().transform(t);this.widgetItems.push({title:`Unconfigured ${i}`,widget:{id:`unconfigured${i}`,type:t,metadata:{needsConfiguration:!0},pizzagna:(0,J.default)(this.widgetTypesService.getWidgetType(t).widget)}}),(0,ee.default)(this.widgetItems[this.widgetItems.length-1].widget.pizzagna,`${T.Structure}.header.properties.title`,`Unconfigured ${i}`)}addUnconfiguredWidgetWithConfigLayer(t){let i=new v().transform(t.type);this.widgetItems.push({title:`Unconfigured ${i} With Config Layer`,widget:I(O({},(0,J.default)(this.widgetTypesService.mergeWithWidgetType(t))),{id:`unconfiguredWithConfigLayer${i}`,metadata:{needsConfiguration:!0}})}),(0,ee.default)(this.widgetItems[this.widgetItems.length-1].widget.pizzagna,`${T.Configuration}.header.properties.title`,`Unconfigured ${i} With Config Layer`)}onSelect(t){this.widgetSelected.emit(t[0].widget),this.widgetSelection=t}static{this.\u0275fac=function(i){return new(i||o)(c(g))}}static{this.\u0275cmp=M({type:o,selectors:[["acme-clone-selection"]],outputs:{widgetSelected:"widgetSelected"},standalone:!1,decls:4,vars:3,consts:[["widgetClonerItem",""],[1,"nui-widget-cloner"],["selectionMode","singleWithRequiredSelection",3,"selectionChange","itemsSource","selection","repeatItemTemplateRef"],[1,"nui-widget-cloner__item","d-flex","pt-2","pb-2","align-items-center"],[1,"text-info","ml-3"]],template:function(i,e){if(i&1){let r=L();s(0,"div",1)(1,"nui-repeat",2),l("selectionChange",function(m){return A(r),D(e.onSelect(m))}),a()(),R(2,lt,3,1,"ng-template",null,0,X)}if(i&2){let r=G(3);d(),_("itemsSource",e.widgetItems)("selection",e.widgetSelection)("repeatItemTemplateRef",r)}},dependencies:[k],styles:[".nui-widget-cloner__item[_ngcontent-%COMP%]{height:60px}"]})}}return o})();function mt(o,E){if(o&1&&(s(0,"div",3)(1,"div",4),Y(2),a()()),o&2){let t=E.item;d(2),$(" ",t.title," ")}}var tt=(()=>{class o extends x{static{this.lateLoadKey="AcmeCloneSelectionComponent"}constructor(t){super(t)}ngOnInit(){let t=new v;this.widgetItems=f.map(i=>({title:t.transform(i.type),widget:this.widgetTypesService.mergeWithWidgetType(i)}))}static{this.\u0275fac=function(i){return new(i||o)(c(g))}}static{this.\u0275cmp=M({type:o,selectors:[["acme-clone-selection"]],standalone:!1,features:[pe],decls:4,vars:3,consts:[["widgetClonerItem",""],[1,"nui-widget-cloner"],["selectionMode","singleWithRequiredSelection",3,"selectionChange","itemsSource","selection","repeatItemTemplateRef"],[1,"nui-widget-cloner__item","d-flex","pt-2","pb-2","align-items-center"],[1,"text-info","ml-3"]],template:function(i,e){if(i&1){let r=L();s(0,"div",1)(1,"nui-repeat",2),l("selectionChange",function(m){return A(r),D(e.onSelect(m))}),a()(),R(2,mt,3,1,"ng-template",null,0,X)}if(i&2){let r=G(3);d(),_("itemsSource",e.widgetItems)("selection",e.widgetSelection)("repeatItemTemplateRef",r)}},dependencies:[k],styles:[".nui-widget-cloner__item[_ngcontent-%COMP%]{height:60px}"]})}}return o})();var it=H(st());var K=(()=>{class o{constructor(t){this.toastService=t,this.allowSubmit=!0,this.allowRemoval=!0,this.trySubmit=(i,e)=>{let r=new b;return setTimeout(()=>{if(this.allowSubmit)r.next(i);else{let n=$localize`Submit failed.`;this.toastService.error({title:n}),r.error(n)}},1e3),r.asObservable()},this.tryRemove=i=>{let e=new b;return setTimeout(()=>{if(this.allowRemoval)e.next(i);else{let r=$localize`Widget removal failed.`;this.toastService.error({title:r}),e.error(r)}},200),e.asObservable()},this.toastService.setConfig({timeOut:2e3})}static{this.\u0275fac=function(i){return new(i||o)(h(Ae))}}static{this.\u0275prov=W({token:o,factory:o.\u0275fac})}}return o})();var ot=(()=>{class o{constructor(t,i,e,r,n){this.providerRegistry=t,this.submitHandler=i,this.widgetTypesService=e,this.widgetClonerService=r,this.refreshSettings=n,this.dashboard={positions:{},widgets:{}},this.gridsterConfig={minCols:12,maxCols:12,minRows:12},this.editMode=!1,this.systemRefreshInterval=60,this.belowFoldLazyLoadingConfig={enabled:!0},this.destroy$=new b,this.providerRegistry.setProviders({[S.providerId]:{provide:$e,useClass:S,deps:[z]}})}ngOnInit(){this.widgetTypesService.getWidgetType("table").configurator?.[T.Structure].presentation.properties?.nodes.push("refresher"),this.refreshSettings.refreshRateSeconds=this.systemRefreshInterval;let t=f.map(e=>this.widgetTypesService.mergeWithWidgetType(e)),i=(0,it.default)(t,e=>e.id);this.dashboard={positions:et,widgets:i}}onDsErrorSwitch(t){S.mockError=t}onShowButtonSwitch(t,i){for(let e of Object.keys(this.dashboard.widgets))this.dashboard=Re(this.dashboard,`widgets.${e}.pizzagna.configuration.header.properties.${i}`,t)}ngAfterViewInit(){this.dashboardComponent.eventBus.subscribeUntil(Q,this.destroy$,t=>{let i={widget:this.dashboard.widgets[t.widgetId],dashboardComponent:this.dashboardComponent,trySubmit:this.submitHandler.trySubmit,widgetSelectionComponentType:tt};this.widgetClonerService.open(i).pipe(U(1),V(this.destroy$)).subscribe()})}onCloneWidget(){let t={dashboardComponent:this.dashboardComponent,trySubmit:this.submitHandler.trySubmit,widgetSelectionComponentType:x};this.widgetClonerService.open(t).pipe(U(1),V(this.destroy$)).subscribe()}onEditWithCloner(){this.dashboardComponent.eventBus.next(Q,{widgetId:f[0].id})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSystemRefreshIntervalClick(){this.refreshSettings.refreshRateSeconds=this.systemRefreshInterval}static{this.\u0275fac=function(i){return new(i||o)(c(B),c(K),c(g),c(je),c(Xe))}}static{this.\u0275cmp=M({type:o,selectors:[["many-widgets-dashboard-dashboard"]],viewQuery:function(i,e){if(i&1&&ue(F,7),i&2){let r;_e(r=ge())&&(e.dashboardComponent=r.first)}},standalone:!1,features:[Se([K])],decls:25,vars:11,consts:()=>{let t;t=$localize`:␟90504d9af68fb3aa81accb4bc3005526deb04093␟5488473345097746222:System refresh interval (seconds)`;let i;i=$localize`:␟489801ff09de9b4a6ca8b6e05a475fa1ca00d98e␟5813529530812520031: Create Widget Clone
`;let e;e=$localize`:␟d8e9c9957a5d6ebe7749aab0e18dcb5d944b2ef9␟7916291516675251750: Simulate edit with cloner
`;let r;r=$localize`:␟5cab2718f1d3c09ccb1fca4886710430f59bf7c0␟81810662047948365: Edit mode `;let n;n=$localize`:␟db70aaa4da7a9f7c0fa3a218907f9fa354a19038␟5855643886473775120: Allow Submit `;let m;m=$localize`:␟d289dfdc6c4e23b49a96db083f95f1087ed1400a␟3687117978364204872: Allow Removal `;let P;P=$localize`:␟3299af3b186d7701f4c0626e41eba58af8382723␟4106211393112768148: Show Edit Button `;let oe;oe=$localize`:␟30251ad3dcd7facd3a222d48fb2ba02f8503c52c␟8096484277280346189: Show Remove Button `;let ne;ne=$localize`:␟c355f0feb3f72b3594e6e975456cd0a2dac1d929␟870224976565315483: Data Source Error `;let re;return re=$localize`:␟559db359e3dcc0820499a4e58208fb22273e0d55␟5928813357836950616: Update system refresh interval `,[i,e,r,n,m,P,oe,ne,re,["type","button","nui-button","",1,"mb-3","ml-4",3,"click"],[1,"w-100",2,"height","725px"],[3,"dashboardChange","gridsterConfigChange","nuiWidgetEditor","dashboard","gridsterConfig","editMode","belowFoldLazyLoadingConfig"],[1,"my-3","d-flex","align-items-center"],[1,"ml-3",3,"valueChange","value"],[1,"ml-3",3,"valueChange"],[1,"d-flex","flex-row"],[2,"width","300px"],["caption",t],[3,"valueChange","value"],["type","button","nui-button","",1,"ml-4",3,"click"]]},template:function(i,e){i&1&&(s(0,"button",9),l("click",function(){return e.onCloneWidget()}),p(1,0),a(),s(2,"button",9),l("click",function(){return e.onEditWithCloner()}),p(3,1),a(),s(4,"div",10)(5,"nui-dashboard",11),w("dashboardChange",function(n){return C(e.dashboard,n)||(e.dashboard=n),n})("gridsterConfigChange",function(n){return C(e.gridsterConfig,n)||(e.gridsterConfig=n),n}),a()(),s(6,"div",12)(7,"nui-switch",13),w("valueChange",function(n){return C(e.editMode,n)||(e.editMode=n),n}),p(8,2),a(),s(9,"nui-switch",13),w("valueChange",function(n){return C(e.submitHandler.allowSubmit,n)||(e.submitHandler.allowSubmit=n),n}),p(10,3),a(),s(11,"nui-switch",13),w("valueChange",function(n){return C(e.submitHandler.allowRemoval,n)||(e.submitHandler.allowRemoval=n),n}),p(12,4),a(),s(13,"nui-switch",13),l("valueChange",function(n){return e.onShowButtonSwitch(n,"editable")}),p(14,5),a(),s(15,"nui-switch",13),l("valueChange",function(n){return e.onShowButtonSwitch(n,"removable")}),p(16,6),a(),s(17,"nui-switch",14),l("valueChange",function(n){return e.onDsErrorSwitch(n)}),p(18,7),a()(),s(19,"div",15)(20,"div",16)(21,"nui-form-field",17)(22,"nui-textbox-number",18),w("valueChange",function(n){return C(e.systemRefreshInterval,n)||(e.systemRefreshInterval=n),n}),a()()(),s(23,"button",19),l("click",function(){return e.onSystemRefreshIntervalClick()}),p(24,8),a()()),i&2&&(d(5),_("nuiWidgetEditor",e.submitHandler),y("dashboard",e.dashboard)("gridsterConfig",e.gridsterConfig),_("editMode",e.editMode)("belowFoldLazyLoadingConfig",e.belowFoldLazyLoadingConfig),d(2),y("value",e.editMode),d(2),y("value",e.submitHandler.allowSubmit),d(2),y("value",e.submitHandler.allowRemoval),d(2),_("value",!0),d(2),_("value",!0),d(7),y("value",e.systemRefreshInterval))},dependencies:[F,Be,Te,we,Ie,be],styles:[".nui-theme-switcher-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;padding:10px;background-color:var(--nui-color-bg-light,#fff)}"]})}}return o})();var pt=[{path:"",component:ot,data:{srlc:{hideIndicator:!0},showThemeSwitcher:!0}}],yi=(()=>{class o{constructor(t,i){this.widgetTypesService=t,this.componentRegistry=i,this.setupDataSourceProviders(),this.setupCustomProportionalWidgetDSConfig()}setupCustomProportionalWidgetDSConfig(){let t=this.widgetTypesService.getWidgetType("proportional",1);delete t.widget.structure[Ge].providers?.refresher,this.widgetTypesService.setNode(t,"configurator",j.DataSourceConfigComponentType,Z.lateLoadKey),this.componentRegistry.registerByLateLoadKey(Z)}setupDataSourceProviders(){this.setDataSourceProviders("table",[Ue.providerId,Ve.providerId,Qe.providerId,xe.providerId,qe.providerId]);let t=this.widgetTypesService.getWidgetType("kpi",1);this.widgetTypesService.setNode(t,"configurator",j.DataSourceConfigComponentType,ke.lateLoadKey),this.setDataSourceProviders("kpi",[{providerId:S.providerId,label:"Acme KPI Data Source 1"}]),this.setDataSourceProviders("proportional",[Ke.providerId,He.providerId]),this.setDataSourceProviders("timeseries",[Ze.providerId,Je.providerId])}setDataSourceProviders(t,i){let e=this.widgetTypesService.getWidgetType(t,1);this.widgetTypesService.setNode(e,"configurator",j.DataSourceProviders,i)}static{this.\u0275fac=function(i){return new(i||o)(h(g),h(ze))}}static{this.\u0275mod=ce({type:o})}static{this.\u0275inj=le({providers:[B],imports:[fe,he,Fe,Oe,Me,De,ve,Ee,ye,Ne,Ce.forChild(pt),We,Pe]})}}return o})();export{yi as ManyWidgetsModule};
