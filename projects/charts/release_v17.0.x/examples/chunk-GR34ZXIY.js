import{a as Z}from"./chunk-Y2K7DIYS.js";import{a as Y}from"./chunk-QATIJP7Q.js";import{A as N,C as L,D as V,F as $,Ia as Q,Sa as W,Z as U,_ as H,fa as X,ga as j,j as x,la as z,ma as G,qa as q,z as O}from"./chunk-FM3MSO55.js";import{Hb as R,Ib as k,Jb as P,Kb as w,La as B,Pa as _,Ub as h,pb as I}from"./chunk-JEEHY2QT.js";import{e as M}from"./chunk-FWIJ3MN4.js";import{a as ee}from"./chunk-RIV6QGH7.js";import{A as S,Fa as s,Ga as o,Ha as d,La as F,Qa as v,Ua as c,Va as u,cb as y,eb as b,fa as a,ga as f,ib as A,pb as E,q as T,qb as D,wa as C,ya as n,z as g}from"./chunk-VSZOZJXN.js";import{g as K}from"./chunk-7KJRK3NW.js";var p=K(ee());function te(m,J){if(m&1){let e=F();s(0,"nui-legend-series",16),c("mouseenter",function(){let t=g(e).$implicit,r=u();return S(r.chartAssist.emphasizeSeries(t.id))})("isSelectedChange",function(t){let r=g(e).$implicit,l=u();return S(l.chartAssist.toggleSeries(r.id,t))}),s(1,"nui-rich-legend-tile",17),d(2,"nui-chart-marker",18),o()()}if(m&2){let e=J.$implicit,i=u();n("descriptionPrimary",e.name)("seriesRenderState",i.chartAssist.renderStatesIndex[e.id]==null?null:i.chartAssist.renderStatesIndex[e.id].state)("isSelected",!i.chartAssist.isSeriesHidden(e.id)),a(),n("value",i.chartAssist.getHighlightedValue(e,"y"))("backgroundColor",i.chartAssist.palette.standardColors.get(e.id))("color",i.chartAssist.palette.textColors.get(e.id)),a(),n("marker",i.chartAssist.markers.get(e.id))("color",i.chartAssist.palette.standardColors.get(e.id))}}var _e=(()=>{class m{history;dataSourceService;fromDate=(0,p.default)("2018-05-01 15:00:00").subtract(2,"days");toDate=(0,p.default)("2018-05-01 15:00:00");chart=new X(new q);chartAssist=new j(this.chart);timeFrame;busy;addDelay=!0;xScale=new Q("time-scale");yScale=new G;accessors=new U(this.chartAssist.palette.standardColors,this.chartAssist.markers);renderer=new H;filteringSubscription;dataService=new Z;constructor(e,i){this.history=e,this.dataSourceService=i}ngAfterContentInit(){this.yScale.domainCalculator=z([0,100]),this.chart.addPlugins(new W),this.filteringSubscription=this.setUpFiltering(),this.chart.getEventBus().getStream(x).subscribe(e=>{let t=e.data[this.xScale.id];this.applyFilters(this.history.save({startDatetime:(0,p.default)(t[0]),endDatetime:(0,p.default)(t[1]),selectedPresetId:void 0}))}),this.applyFilters(this.history.save({startDatetime:this.fromDate,endDatetime:this.toDate,selectedPresetId:void 0}))}ngOnDestroy(){this.filteringSubscription&&this.filteringSubscription.unsubscribe()}updateTimeFrame(e){this.applyFilters(this.history.restart(e))}zoomUndo(){this.applyFilters(this.history.undo())}applyFilters(e){this.busy=!0,this.timeFrame=e,this.xScale.fixDomain([e.startDatetime.toDate(),e.endDatetime.toDate()]),this.chart.updateDimensions(),this.dataSourceService.applyFilters()}setUpFiltering(){return this.dataSourceService.registerComponent({timeframe:{componentInstance:{getFilters:()=>({type:"ITimeframe",value:this.timeFrame})}}}),this.dataSourceService.outputsSubject.subscribe(e=>{let i=e.timeframe.value.startDatetime,t=e.timeframe.value.endDatetime;this.dataService.getChartData(i,t,this.addDelay?1e3:0).subscribe(r=>{this.chartAssist.update(Object.keys(r).map(l=>({id:l,name:l,data:r[l],accessors:this.accessors,renderer:this.renderer,scales:{x:this.xScale,y:this.yScale}}))),this.busy=!1})})}static \u0275fac=function(i){return new(i||m)(f(_),f(h))};static \u0275cmp=T({type:m,selectors:[["nui-time-frame-bar-test"]],features:[A([h,_])],decls:22,vars:14,consts:()=>{let e;return e=$localize`:␟a8a8afdb3773c92f866263dd8ceabcc3d92682fb␟8471193138456330657:Average CPU load (%)`,[e,[1,"nui-time-frame-bar-test"],["nui-busy","",1,"m-5",2,"border","1px solid lightgrey",3,"busy"],[1,"time-frame-bar",2,"display","block","border-bottom","1px solid lightgrey",3,"timeFrameChange","undo","clear","timeFrame","historyIndex","minDate","maxDate"],["icon","calendar",1,"pr-3"],["timeFrameSelection",""],[1,"nui-chart-layout","p-3"],[1,"axis-label-left","nui-text-small"],[1,"chart"],[1,"w-100",3,"chart"],[1,"legend"],["seriesUnitLabel","%",3,"mouseleave","active","interactive"],[3,"descriptionPrimary","seriesRenderState","isSelected","mouseenter","isSelectedChange",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-5"],["id","delay","name","delay","type","checkbox",3,"change","checked"],["for","delay",1,"pl-2"],[3,"mouseenter","isSelectedChange","descriptionPrimary","seriesRenderState","isSelected"],[3,"value","backgroundColor","color"],["rightEdge","",3,"marker","color"]]},template:function(i,t){i&1&&(s(0,"charts-test-harness")(1,"div",1)(2,"div",2)(3,"nui-time-frame-bar",3),c("timeFrameChange",function(l){return t.updateTimeFrame(l)})("undo",function(){return t.zoomUndo()})("clear",function(){return t.updateTimeFrame()}),d(4,"nui-icon",4),y(5),E(6,"timeFrame"),s(7,"nui-quick-picker",5),d(8,"nui-time-frame-picker"),o()(),s(9,"div",6)(10,"div",7)(11,"strong"),v(12,0),o()(),s(13,"div",8),d(14,"nui-chart",9),o(),s(15,"div",10)(16,"nui-legend",11),c("mouseleave",function(){return t.chartAssist.resetVisibleSeries()}),C(17,te,3,8,"nui-legend-series",12),o()()()(),s(18,"div",13)(19,"input",14),c("change",function(){return t.addDelay=!t.addDelay}),o(),s(20,"label",15),y(21,"Add delay to server requests"),o()()()()),i&2&&(a(2),n("busy",t.busy),a(),n("timeFrame",t.timeFrame)("historyIndex",t.history.index)("minDate",t.fromDate)("maxDate",t.toDate),a(2),b(" ",D(6,12,t.timeFrame)," "),a(9),n("chart",t.chart),a(2),n("active",t.chartAssist.isLegendActive)("interactive",!0),a(),n("ngForOf",t.chartAssist.legendSeriesSet)("ngForTrackBy",t.chartAssist.seriesTrackByFn),a(2),n("checked",t.addDelay))},dependencies:[Y,M,I,L,V,$,N,O,B,R,k,P,w],encapsulation:2})}return m})();export{_e as a};
