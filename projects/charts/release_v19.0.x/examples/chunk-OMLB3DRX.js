import{A as R,B as V,Ea as j,Ja as I,K as G,La as q,M as y,Na as J,R as Y,S as X,T as x,U as F,W as p,Xa as Q,Ya as $,b as k,c as m,fa as T,h as O,ha as W,n as H,na as z,oa as K,pa as E,q as u,qa as w,ua as Z}from"./chunk-JLRCU3YI.js";import{B as at,L as st,Ma as L,Pb as N,_a as B}from"./chunk-PJ4NWNDH.js";import{a as it}from"./chunk-6NQICH4K.js";import{Ma as b,Ta as f,Ua as D,Va as _,gb as U,ja as C,qb as h,va as A}from"./chunk-YSXLQTCP.js";import{a as S,b as P,g as v}from"./chunk-B7O3QC5Z.js";var g=v(st()),M=v(at()),a=v(it());var s="YYYY-MM-DDTHH:mm:ssZ",i="2016-12-25T15:05:00Z",c=function(l){return l.Up="up",l.Warning="warning",l.Critical="critical",l}(c||{}),mt=(()=>{class l{barChart;statusChart;xScaleId="xScale";selectedDataPoints={};labelPlugin=new K;renderer;selectedLabelPosition;colorProvider={get:t=>t==="selection-box"?"transparent":G[0],reset:()=>{}};ngOnInit(){this.setUpBarChart(),this.setUpStatusChart()}onReset(){this.selectedDataPoints={},this.selectedLabelPosition=void 0,this.redrawCharts(),this.labelPlugin.areLabelUpdatesEnabled=!0,this.barChart.getEventBus().getStream(m).next({data:{interactionType:u.MouseMove,values:{}}})}setUpBarChart(){this.barChart=new T(this.configureBarGrid()),this.barChart.addPlugin(new E),this.barChart.addPlugin(this.labelPlugin),this.barChart.getEventBus().getStream(O).subscribe(this.handleDataPointsInteraction),this.barChart.getEventBus().getStream(m).subscribe(this.handleInteractionLabelUpdates),this.barChart.getEventBus().getStream(k).subscribe(this.handleMouseActive);let t=Q({},this.colorProvider);t.data.cssClass=this.cssClassAccessor;let e=Z();e.x=new I((0,a.duration)(5,"minutes"),this.xScaleId),t.data.thickness=this.barThickness(e);let n={highlightStrategy:new $("x",1,this.selectedDataPointIdxFn),cursor:"pointer"};this.renderer=new p(n),this.barChart.update(nt().map(o=>P(S({},o),{accessors:t,renderer:this.renderer,scales:e})))}setUpStatusChart(){this.statusChart=new T(this.configureStatusGrid()),this.statusChart.addPlugin(new E);let t=new z;t.fixDomain(Y.STATUS_DOMAIN);let e=new I((0,a.duration)(5,"minutes"),this.xScaleId);e.fixDomain([(0,a.default)(i,s).toDate(),(0,a.default)(i,s).add(25,"minutes").toDate()]);let n={x:e,y:t},o=X(new j(rt()));o.data.thickness=r=>r.status===c.Up?p.THIN:p.THICK,o.data.cssClass=this.cssClassAccessor,this.statusChart.update(ot().map(r=>P(S({},r),{accessors:o,renderer:this.renderer,scales:n})))}configureBarGrid(){let t=new q;return t.axis.left.visible=!1,t.axis.left.gridTicks=!1,t.axis.bottom.fit=!1,t.borders.top=new W,t.cursor="pointer",t.dimension.padding.top=0,t.dimension.margin.right=t.dimension.margin.left,new w(t)}configureStatusGrid(){let t=new J;return t.axis.bottom.visible=!1,t.cursor="pointer",t.dimension.margin.bottom=0,t.dimension.margin.right=t.dimension.margin.left,t.borders.bottom.visible=!1,new w(t)}redrawCharts(){this.barChart.update(this.barChart.getDataManager().chartSeriesSet),this.statusChart.update(this.statusChart.getDataManager().chartSeriesSet)}handleDataPointsInteraction=t=>{let e=t.data;e.interactionType===u.Click&&(this.selectedDataPoints=e.dataPoints,this.renderer.config.stateStyles&&(this.renderer.config.stateStyles.deemphasized={opacity:.3}),this.redrawCharts(),this.selectedLabelPosition=this.calculateInteractionLabelPosition(e),this.barChart.getEventBus().getStream(m).next({data:{interactionType:u.MouseMove,values:this.selectedLabelPosition}}))};handleInteractionLabelUpdates=t=>{let e=t.data;e.interactionType===u.MouseMove&&(0,g.default)(e.values)&&this.selectedLabelPosition?(this.labelPlugin.areLabelUpdatesEnabled=!0,this.barChart.getEventBus().getStream(m).next({data:{interactionType:u.MouseMove,values:this.selectedLabelPosition},broadcast:!0}),this.labelPlugin.areLabelUpdatesEnabled=!1):e.interactionType===u.MouseMove&&!(0,g.default)(e.values)&&(this.labelPlugin.areLabelUpdatesEnabled=!0)};handleMouseActive=t=>{this.renderer.config.stateStyles&&(!(0,g.default)(this.selectedDataPoints)&&!t.data?this.renderer.config.stateStyles.deemphasized={opacity:.3}:t.data&&(this.renderer.config.stateStyles.deemphasized={opacity:.1})),this.barChart.getDataManager().chartSeriesSet.length>0&&this.statusChart.getDataManager().chartSeriesSet.length>0&&this.redrawCharts()};barThickness(t){return(e,n,o,r)=>{let d,tt=x(t.x,r.accessors.data?.startX?.(e,n,r.data,r),0),et=x(t.x,r.accessors.data?.endX?.(e,n,r.data,r),1);return d=Math.abs(tt-et),d-=r.id==="selection-box"?2:6,d=Math.max(d,p.MIN_BAR_THICKNESS),d}}selectedDataPointIdxFn=t=>this.selectedDataPoints?.[t]?.index??H;cssClassAccessor=(t,e,n,o)=>!(0,g.default)(this.selectedDataPoints)&&o.id==="selection-box"&&this.selectedDataPoints[o.id]?.index===e?"selected":"";calculateInteractionLabelPosition(t){let e=t.dataPoints[Object.keys(t.dataPoints)[0]],n=[e.dataSeries.scales.x],o=[e.dataSeries.scales.y];if(!e.position||(0,M.default)(e.position.width)||(0,M.default)(e.position.height))throw new Error("Can't calculate x and y values");let r=e.position.x+e.position.width/2,d=e.position.y+e.position.height/2;return F.getXYValues(n,o,r,d)}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=A({type:l,selectors:[["ng-component"]],standalone:!1,decls:13,vars:3,consts:[["filenamePrefix","data-point-selection-prototype","exampleTitle","Data Point Selection Prototype"],["type","critical",3,"allowDismiss"],["nuiChartCollectionId","collection",1,"d-flex","chart",3,"chart"],["type","button","nui-button","",3,"click"]],template:function(e,n){e&1&&(f(0,"nui-example-wrapper",0)(1,"nui-message",1)(2,"strong"),h(3,"Note:"),D(),h(4," This is only a prototype, so its implementation is unpolished. Please use discretion when copying the code as there are likely solutions more concise and/or elegant than those presented here. "),f(5,"strong"),h(6,"For assistance, please contact Blake Simmon or Lukas Holcik."),D()(),_(7,"hr")(8,"nui-chart",2)(9,"nui-chart",2)(10,"hr"),f(11,"button",3),U("click",function(){return n.onReset()}),h(12,"Reset"),D()()),e&2&&(C(),b("allowDismiss",!1),C(7),b("chart",n.statusChart),C(),b("chart",n.barChart))},dependencies:[L,N,B,R,V],styles:[`.selected{stroke:#52d9e3!important}.chart{max-width:800px}
`],encapsulation:2})}return l})();function nt(){return[{id:"series-1",data:[{category:(0,a.default)(i,s).toDate(),value:66},{category:(0,a.default)(i,s).add(5,"minutes").toDate(),value:14},{category:(0,a.default)(i,s).add(10,"minutes").toDate(),value:25},{category:(0,a.default)(i,s).add(15,"minutes").toDate(),value:55},{category:(0,a.default)(i,s).add(20,"minutes").toDate(),value:33},{category:(0,a.default)(i,s).add(25,"minutes").toDate(),value:5}]},{id:"selection-box",data:[{category:(0,a.default)(i,s).toDate(),value:100},{category:(0,a.default)(i,s).add(5,"minutes").toDate(),value:100},{category:(0,a.default)(i,s).add(10,"minutes").toDate(),value:100},{category:(0,a.default)(i,s).add(15,"minutes").toDate(),value:100},{category:(0,a.default)(i,s).add(20,"minutes").toDate(),value:100},{category:(0,a.default)(i,s).add(25,"minutes").toDate(),value:100}]}]}function rt(){return{[c.Up]:y[8],[c.Warning]:y[4],[c.Critical]:y[2]}}function ot(){return[{id:"series-1",name:"Series 1",data:[{status:c.Up,start:(0,a.default)(i,s).toDate(),end:(0,a.default)(i,s).toDate()},{status:c.Warning,start:(0,a.default)(i,s).add(5,"minutes").toDate(),end:(0,a.default)(i,s).add(5,"minutes").toDate()},{status:c.Critical,start:(0,a.default)(i,s).add(10,"minutes").toDate(),end:(0,a.default)(i,s).add(10,"minutes").toDate()},{status:c.Up,start:(0,a.default)(i,s).add(15,"minutes").toDate(),end:(0,a.default)(i,s).add(15,"minutes").toDate()},{status:c.Critical,start:(0,a.default)(i,s).add(20,"minutes").toDate(),end:(0,a.default)(i,s).add(20,"minutes").toDate()},{status:c.Up,start:(0,a.default)(i,s).add(25,"minutes").toDate(),end:(0,a.default)(i,s).add(25,"minutes").toDate()}]}]}export{mt as a};
